{"version":3,"file":"4chan-XT-noupdate.user.min.js","sources":["../../../../src/globals/globals.ts","../src/classes/Callbacks.js","../src/config/Config.js","../src/Monitoring/Favicon.js","../src/Monitoring/Favicon/ferongr.unreadDead.png","../src/Monitoring/Favicon/ferongr.unreadDeadY.png","../src/Monitoring/Favicon/ferongr.unreadSFW.png","../src/Monitoring/Favicon/ferongr.unreadSFWY.png","../src/Monitoring/Favicon/ferongr.unreadNSFW.png","../src/Monitoring/Favicon/ferongr.unreadNSFWY.png","../src/Monitoring/Favicon/xat-.unreadDead.png","../src/Monitoring/Favicon/xat-.unreadDeadY.png","../src/Monitoring/Favicon/xat-.unreadSFW.png","../src/Monitoring/Favicon/xat-.unreadSFWY.png","../src/Monitoring/Favicon/xat-.unreadNSFW.png","../src/Monitoring/Favicon/xat-.unreadNSFWY.png","../src/Monitoring/Favicon/Mayhem.unreadDead.png","../src/Monitoring/Favicon/Mayhem.unreadDeadY.png","../src/Monitoring/Favicon/Mayhem.unreadSFW.png","../src/Monitoring/Favicon/Mayhem.unreadSFWY.png","../src/Monitoring/Favicon/Mayhem.unreadNSFW.png","../src/Monitoring/Favicon/Mayhem.unreadNSFWY.png","../src/Monitoring/Favicon/4chanJS.unreadDead.png","../src/Monitoring/Favicon/4chanJS.unreadDeadY.png","../src/Monitoring/Favicon/4chanJS.unreadSFW.png","../src/Monitoring/Favicon/4chanJS.unreadSFWY.png","../src/Monitoring/Favicon/4chanJS.unreadNSFW.png","../src/Monitoring/Favicon/4chanJS.unreadNSFWY.png","../src/Monitoring/Favicon/Original.unreadDead.png","../src/Monitoring/Favicon/Original.unreadDeadY.png","../src/Monitoring/Favicon/Original.unreadSFW.png","../src/Monitoring/Favicon/Original.unreadSFWY.png","../src/Monitoring/Favicon/Original.unreadNSFW.png","../src/Monitoring/Favicon/Original.unreadNSFWY.png","../src/Monitoring/Favicon/Metro.unreadDead.png","../src/Monitoring/Favicon/Metro.unreadDeadY.png","../src/Monitoring/Favicon/Metro.unreadSFW.png","../src/Monitoring/Favicon/Metro.unreadSFWY.png","../src/Monitoring/Favicon/Metro.unreadNSFW.png","../src/Monitoring/Favicon/Metro.unreadNSFWY.png","../src/platform/$$.js","../src/Posting/Captcha.replace.js","../src/Posting/Captcha.t.js","../../../../src/platform/helpers.ts","../src/classes/DataBoard.js","../../../../src/classes/SimpleDict.ts","../src/classes/Thread.js","../src/classes/CatalogThread.js","../src/General/UI.js","../src/Miscellaneous/Nav.js","../src/Images/ImageHost.js","../src/Images/Volume.js","../src/Images/ImageCommon.js","../src/Images/ImageExpand.js","../../../../src/classes/Post.ts","../src/Menu/Menu.js","../src/Filtering/Recursive.js","../src/Filtering/PostHiding.js","../src/Miscellaneous/RelativeDates.js","../src/General/BoardConfig.js","../src/classes/Board.js","../src/Posting/PostRedirect.js","../src/Miscellaneous/ExpandComment.js","../src/Quotelinks/QuoteYou.js","../src/classes/RandomAccessList.js","../src/Monitoring/Unread.js","../src/Miscellaneous/ExpandThread.js","../src/Monitoring/UnreadIndex.js","../src/Monitoring/ThreadWatcher.js","../src/classes/Fetcher.js","../src/Quotelinks/QuotePreview.js","../src/General/Index.js","../src/Filtering/ThreadHiding.js","../../../../src/globals/jsx.ts","../../../../src/General/Settings/SettingsHtml.tsx","../../../../src/css/style.ts","../../../../src/css/CSS.ts","../src/css/linkify.audio.png","../src/css/linkify.bitchute.png","../src/css/linkify.clyp.png","../src/css/linkify.dailymotion.png","../src/css/linkify.gfycat.png","../src/css/linkify.gist.png","../src/css/linkify.image.png","../src/css/linkify.installgentoo.png","../src/css/linkify.liveleak.png","../src/css/linkify.pastebin.png","../src/css/linkify.peertube.png","../src/css/linkify.soundcloud.png","../src/css/linkify.streamable.png","../src/css/linkify.twitchtv.png","../src/css/linkify.twitter.png","../src/css/linkify.video.png","../src/css/linkify.vidlii.png","../src/css/linkify.vimeo.png","../src/css/linkify.vine.png","../src/css/linkify.vocaroo.png","../src/css/linkify.youtube.png","../src/Miscellaneous/CustomCSS.js","../src/site/SW.tinyboard.js","../../../../src/Miscellaneous/PassMessage/PassMessageHtml.tsx","../src/Miscellaneous/PassMessage.js","../src/Miscellaneous/Report.js","../src/Posting/PostSuccessful.js","../../../../src/site/SW.yotsuba.tsx","../../../../src/site/SW.yotsuba.Build/PostInfoHtml.tsx","../../../../src/site/SW.yotsuba.Build/FileHtml.tsx","../../../../src/site/SW.yotsuba.Build/CatalogThreadHtml.tsx","../src/site/SW.js","../../../../src/Miscellaneous/FileInfo.tsx","../src/Miscellaneous/Time.js","../src/Monitoring/ReplyPruning.js","../src/Quotelinks/QuoteThreading.js","../src/Monitoring/ThreadUpdater.js","../../../../src/General/Settings.tsx","../src/Images/FappeTyme.js","../src/Images/Sauce.js","../src/Images/Gallery.js","../src/Linkification/Embedding.js","../src/Miscellaneous/Keybinds.js","../src/Posting/Captcha.js","../src/Posting/QR.js","../src/platform/CrossOrigin.js","../src/platform/$.js","../src/General/Get.js","../../../../src/Filtering/Filter.ts","../src/site/Site.js","../src/Miscellaneous/CatalogLinks.js","../src/General/Header.js","../src/classes/Notice.js","../src/Archive/Redirect.js","../src/classes/CatalogThreadNative.js","../src/Filtering/Anonymize.js","../src/Images/ImageHover.js","../src/Images/ImageLoader.js","../src/Images/Metadata.js","../src/Images/RevealSpoilers.js","../src/Linkification/Linkify.js","../src/Menu/ArchiveLink.js","../src/Menu/CopyTextLink.js","../src/Menu/DeleteLink.js","../src/Menu/DownloadLink.js","../src/Menu/ReportLink.js","../src/Miscellaneous/AntiAutoplay.js","../src/Miscellaneous/Banner.js","../src/Miscellaneous/Flash.js","../src/Miscellaneous/Fourchan.js","../src/Miscellaneous/IDColor.js","../src/Miscellaneous/IDHighlight.js","../src/Miscellaneous/IDPostCount.js","../src/Miscellaneous/ModContact.js","../src/Miscellaneous/NormalizeURL.js","../src/Miscellaneous/PostJumper.js","../src/Miscellaneous/PSA.js","../src/Miscellaneous/PSAHiding.js","../src/Miscellaneous/RemoveSpoilers.js","../src/Miscellaneous/ThreadLinks.js","../src/Miscellaneous/Tinyboard.js","../src/Monitoring/MarkNewIPs.js","../src/Monitoring/ThreadStats.js","../src/Posting/PassLink.js","../src/Quotelinks/QuoteInline.js","../src/Quotelinks/QuoteBacklink.js","../src/Quotelinks/QuoteCT.js","../src/Quotelinks/QuoteOP.js","../src/Quotelinks/Quotify.js","../src/General/Polyfill.js","../src/main/Main.js","../src/Quotelinks/QuoteStrikeThrough.js"],"sourcesContent":[null,"import Main from \"../main/Main\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS206: Consider reworking classes to avoid initClass\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nexport default class Callbacks {\r\n  static initClass() {\r\n    this.Post          = new Callbacks('Post');\r\n    this.Thread        = new Callbacks('Thread');\r\n    this.CatalogThread = new Callbacks('Catalog Thread');\r\n    this.CatalogThreadNative = new Callbacks('Catalog Thread');\r\n  }\r\n\r\n  constructor(type) {\r\n    this.type = type;\r\n    this.keys = [];\r\n  }\r\n\r\n  push({name, cb}) {\r\n    if (!this[name]) { this.keys.push(name); }\r\n    return this[name] = cb;\r\n  }\r\n\r\n  execute(node, keys=this.keys, force=false) {\r\n    let errors;\r\n    if (node.callbacksExecuted && !force) { return; }\r\n    node.callbacksExecuted = true;\r\n    for (var name of keys) {\r\n      try {\r\n        this[name]?.call(node);\r\n      } catch (err) {\r\n        if (!errors) { errors = []; }\r\n        errors.push({\r\n          message: ['\"', name, '\" crashed on node ', this.type, ' No.', node.ID, ' (', node.board, ').'].join(''),\r\n          error: err,\r\n          html: node.nodes?.root?.outerHTML\r\n        });\r\n      }\r\n    }\r\n\r\n    if (errors) { return Main.handleErrors(errors); }\r\n  }\r\n}\r\nCallbacks.initClass();\r\n","import userCss from './user.css';\r\nimport banners from './banners.json';\r\nimport meta from '../../package.json';\r\n\r\nconst Config = {\r\n  main: {\r\n    'Miscellaneous': {\r\n      'Redirect to HTTPS': [\r\n        true,\r\n        'Redirect to the HTTPS version of 4chan.'\r\n      ],\r\n      'JSON Index': [\r\n        true,\r\n        'Replace the original board index with one supporting searching, sorting, infinite scrolling, and a catalog mode.'\r\n      ],\r\n      [`Use ${meta.name} Catalog`]: [\r\n        true,\r\n        `Link to ${meta.name}'s catalog instead of the native 4chan one.`,\r\n        1\r\n      ],\r\n      'Index Refresh Notifications': [\r\n        false,\r\n        'Show a notice at the top of the page when the index is refreshed.',\r\n        1\r\n      ],\r\n      'Follow Cursor': [\r\n        true,\r\n        'Image Hover and Quote Preview move with the mouse cursor.'\r\n      ],\r\n      'Open Threads in New Tab': [\r\n        false,\r\n        `Make links to threads in the index / ${meta.name} catalog open in a new tab.`\r\n      ],\r\n      'External Catalog': [\r\n        false,\r\n        'Link to external catalog instead of the internal one.'\r\n      ],\r\n      'Catalog Links': [\r\n        false,\r\n        'Add toggle link in header menu to turn Navigation links into links to each board\\'s catalog.'\r\n      ],\r\n      'Announcement Hiding': [\r\n        true,\r\n        'Add button to hide 4chan announcements.'\r\n      ],\r\n      'Desktop Notifications': [\r\n        true,\r\n        `Enables desktop notifications across various ${meta.name} features.`\r\n      ],\r\n      '404 Redirect': [\r\n        true,\r\n        'Redirect dead threads and images to the archives.'\r\n      ],\r\n      'Archive Report': [\r\n        true,\r\n        'Enable reporting posts to supported archives.'\r\n      ],\r\n      'Exempt Archives from Encryption': [\r\n        true,\r\n        'Permit loading content from, and warningless redirects to, HTTP-only archives from HTTPS pages.'\r\n      ],\r\n      'Keybinds': [\r\n        true,\r\n        'Bind actions to keyboard shortcuts.'\r\n      ],\r\n      'Time Formatting': [\r\n        true,\r\n        'Localize and format timestamps.'\r\n      ],\r\n      'Relative Post Dates': [\r\n        true,\r\n        'Display dates like \"3 minutes ago\". Tooltip shows the timestamp.'\r\n      ],\r\n      'Relative Date Title': [\r\n        true,\r\n        'Show Relative Post Date only when hovering over dates.',\r\n        1\r\n      ],\r\n      'Comment Expansion': [\r\n        true,\r\n        'Expand comments that are too long to display on the index. Not applicable with JSON Index.'\r\n      ],\r\n      'File Info Formatting': [\r\n        true,\r\n        'Reformat the file information.'\r\n      ],\r\n      'Thread Expansion': [\r\n        true,\r\n        'Add buttons to expand threads.'\r\n      ],\r\n      'Index Navigation': [\r\n        false,\r\n        'Add buttons to navigate between threads.'\r\n      ],\r\n      'Reply Navigation': [\r\n        false,\r\n        'Add buttons to navigate to top / bottom of thread.'\r\n      ],\r\n      'Unique ID and Capcode Navigation': [\r\n        false,\r\n        'Add buttons to navigate to posts having the same unique ID or capcode.'\r\n      ],\r\n      'Custom Board Titles': [\r\n        true,\r\n        'Allow editing of the board title and subtitle by ctrl/\\u2318+clicking them.'\r\n      ],\r\n      'Persistent Custom Board Titles': [\r\n        false,\r\n        'Force custom board titles to be persistent, even if the board titles are updated.',\r\n        1\r\n      ],\r\n      'Show Updated Notifications': [\r\n        true,\r\n        `Show notifications when ${meta.name} is successfully updated.`\r\n      ],\r\n      'Color User IDs': [\r\n        true,\r\n        'Assign unique colors to user IDs on boards that use them'\r\n      ],\r\n      'Count Posts by ID': [\r\n        true,\r\n        'Display number of posts in the thread when hovering over an ID.'\r\n      ],\r\n      'Remove Spoilers': [\r\n        false,\r\n        'Remove all spoilers in text.'\r\n      ],\r\n      'Reveal Spoilers': [\r\n        false,\r\n        'Indicate spoilers if Remove Spoilers is enabled, or make the text appear hovered if Remove Spoiler is disabled.'\r\n      ],\r\n      'Normalize URL': [\r\n        true,\r\n        'Rewrite the URL of the current page, removing slugs and excess slashes, and changing /res/ to /thread/.'\r\n      ],\r\n      'Work around CORB Bug': [\r\n        true,\r\n        'Leave this checked until your garbage browser is fixed.'\r\n      ],\r\n      'Disable Autoplaying Sounds': [\r\n        false,\r\n        'Prevent sounds on the page from autoplaying.'\r\n      ],\r\n      'Disable Native Extension': [\r\n        true,\r\n        `${meta.name} is NOT designed to work with the native extension.`\r\n      ],\r\n      'Enable Native Flash Embedding': [\r\n        true,\r\n        'Activate the native extension\\'s Flash embedding if the native extension is disabled.'\r\n      ]\r\n    },\r\n\r\n    'Linkification': {\r\n      'Linkify': [\r\n        true,\r\n        'Convert text into links where applicable.'\r\n      ],\r\n      'Link Title': [\r\n        true,\r\n        'Replace the link of a supported site with its actual title.',\r\n        1\r\n      ],\r\n      'Cover Preview': [\r\n        true,\r\n        'Show preview of supported links on hover.',\r\n        1\r\n      ],\r\n      'Embedding': [\r\n        true,\r\n        'Embed supported services. Note: Some services don\\'t work on HTTPS.',\r\n        1\r\n      ],\r\n      'Auto-embed': [\r\n        false,\r\n        'Auto-embed Linkify Embeds.',\r\n        2\r\n      ],\r\n      'Floating Embeds': [\r\n        false,\r\n        'Embed content in a frame that remains in place when the page is scrolled.',\r\n        2\r\n      ]\r\n    },\r\n\r\n    'Filtering': {\r\n      'Anonymize': [\r\n        false,\r\n        'Make everyone Anonymous.'\r\n      ],\r\n      'Filter': [\r\n        true,\r\n        'Self-moderation placebo.'\r\n      ],\r\n      'Filtered Backlinks': [\r\n        false,\r\n        'When enabled, shows backlinks to filtered posts with a line-through decoration. Otherwise, hides the backlinks.',\r\n        1\r\n      ],\r\n      'Filter in Native Catalog': [\r\n        true,\r\n        'Apply 4chan X filters in native catalog.',\r\n        1\r\n      ],\r\n      'MD5 Quick Filter Notifications': [\r\n        true,\r\n        'Show notification when quick filtering MD5s using the button or keybind.',\r\n        1\r\n      ],\r\n      'Recursive Hiding': [\r\n        true,\r\n        'Hide replies of hidden posts, recursively.'\r\n      ],\r\n      'Thread Hiding Buttons': [\r\n        true,\r\n        'Add buttons to hide entire threads.'\r\n      ],\r\n      'Reply Hiding Buttons': [\r\n        true,\r\n        'Add buttons to hide single replies.'\r\n      ],\r\n      'Stubs': [\r\n        true,\r\n        'Show stubs of hidden threads / replies.'\r\n      ]\r\n    },\r\n\r\n    'Images and Videos': {\r\n      'Image Expansion': [\r\n        true,\r\n        'Expand images / videos.'\r\n      ],\r\n      'Image Hover': [\r\n        true,\r\n        'Show full image / video on mouseover.'\r\n      ],\r\n      'Image Hover in Catalog': [\r\n        true,\r\n        `Show full image / video on mouseover in ${meta.name} catalog.`\r\n      ],\r\n      'Gallery': [\r\n        true,\r\n        'Adds a simple and cute image gallery. Has more options in the gallery menu.'\r\n      ],\r\n      'Fullscreen Gallery': [\r\n        false,\r\n        'Open gallery in fullscreen mode.',\r\n        1\r\n      ],\r\n      'PDF in Gallery': [\r\n        false,\r\n        'Show PDF files in gallery.',\r\n        1\r\n      ],\r\n      'Sauce': [\r\n        true,\r\n        'Add sauce links to images.'\r\n      ],\r\n      'WEBM Metadata': [\r\n        true,\r\n        'Add link to fetch title metadata from webm videos.'\r\n      ],\r\n      'Reveal Spoiler Thumbnails': [\r\n        false,\r\n        'Replace spoiler thumbnails with the original image.'\r\n      ],\r\n      'Replace GIF': [\r\n        false,\r\n        'Replace gif thumbnails with the actual image.'\r\n      ],\r\n      'Replace JPG': [\r\n        false,\r\n        'Replace jpg thumbnails with the actual image.'\r\n      ],\r\n      'Replace PNG': [\r\n        false,\r\n        'Replace png thumbnails with the actual image.'\r\n      ],\r\n      'Replace WEBM': [\r\n        false,\r\n        'Replace webm, mp4, and ogv thumbnails with the actual video. Probably will degrade browser performance ;)'\r\n      ],\r\n      'Image Prefetching': [\r\n        true,\r\n        'Add a shortcut icon to the header to turn on image preloading.'\r\n      ],\r\n      'Fappe Tyme': [\r\n        true,\r\n        'Hide posts without images when header menu item is checked. *hint* *hint*'\r\n      ],\r\n      'Werk Tyme': [\r\n        true,\r\n        'Hide all post images when header menu item is checked.'\r\n      ],\r\n      'Autoplay': [\r\n        true,\r\n        'Videos begin playing immediately when opened.'\r\n      ],\r\n      'Restart when Opened': [\r\n        false,\r\n        'Restart GIFs and WebMs when you hover over or expand them.'\r\n      ],\r\n      'Show Controls': [\r\n        true,\r\n        'Show controls on videos expanded inline.'\r\n      ],\r\n      'Click Passthrough': [\r\n        false,\r\n        'Clicks on videos trigger your browser\\'s default behavior. Videos can be contracted with button / dragging to the left.',\r\n        1\r\n      ],\r\n      'Allow Sound': [\r\n        true,\r\n        'Open videos with the sound unmuted.'\r\n      ],\r\n      'Mouse Wheel Volume': [\r\n        true,\r\n        'Adjust volume of videos with the mouse wheel over the thumbnail/filename/gallery.'\r\n      ],\r\n      'Loop in New Tab': [\r\n        true,\r\n        'Loop videos opened in their own tabs.'\r\n      ],\r\n      'Volume in New Tab': [\r\n        true,\r\n        `Apply ${meta.name} mute and volume settings to videos opened in their own tabs.`\r\n      ]\r\n    },\r\n\r\n    'Menu': {\r\n      'Menu': [\r\n        true,\r\n        'Add a drop-down menu to posts.'\r\n      ],\r\n      'Report Link': [\r\n        true,\r\n        'Add a report link to the menu.',\r\n        1\r\n      ],\r\n      'Copy Text Link': [\r\n        true,\r\n        'Add a link to copy the post\\'s text.',\r\n        1\r\n      ],\r\n      'Thread Hiding Link': [\r\n        true,\r\n        'Add a link to hide entire threads.',\r\n        1\r\n      ],\r\n      'Reply Hiding Link': [\r\n        true,\r\n        'Add a link to hide single replies.',\r\n        1\r\n      ],\r\n      'Delete Link': [\r\n        true,\r\n        'Add post and image deletion links to the menu.',\r\n        1\r\n      ],\r\n      'Archive Link': [\r\n        true,\r\n        'Add an archive link to the menu.',\r\n        1\r\n      ],\r\n      'Edit Link': [\r\n        true,\r\n        'Add a link to edit the image in Tegaki, /i/\\'s painting program. Requires Quick Reply.',\r\n        1\r\n      ],\r\n      'Download Link': [\r\n        false,\r\n        'Add a download with original filename link to the menu.',\r\n        1\r\n      ]\r\n    },\r\n\r\n    'Monitoring': {\r\n      'Thread Updater': [\r\n        true,\r\n        'Fetch and insert new replies. Has more options in the header menu and the \"Advanced\" tab.'\r\n      ],\r\n      'Unread Count': [\r\n        true,\r\n        'Show the unread posts count in the tab title.'\r\n      ],\r\n      'Quoted Title': [\r\n        false,\r\n        'Change the page title to reflect you\\'ve been quoted.',\r\n        1\r\n      ],\r\n      'Hide Unread Count at (0)': [\r\n        false,\r\n        'Hide the unread posts count in the tab title when it reaches 0.',\r\n        1\r\n      ],\r\n      'Unread Favicon': [\r\n        true,\r\n        'Show a different favicon when there are unread posts.'\r\n      ],\r\n      'Unread Line': [\r\n        true,\r\n        'Show a line to distinguish read posts from unread ones.'\r\n      ],\r\n      'Remember Last Read Post': [\r\n        true,\r\n        'Remember how far you\\'ve read after you close the thread.'\r\n      ],\r\n      'Scroll to Last Read Post': [\r\n        true,\r\n        'Scroll back to the last read post when reopening a thread.',\r\n        1\r\n      ],\r\n      'Unread Line in Index': [\r\n        false,\r\n        'Show a line between read and unread posts in threads in the index.',\r\n        1\r\n      ],\r\n      'Remove Thread Excerpt': [\r\n        false,\r\n        'Replace the excerpt of the thread in the tab title with the board title.'\r\n      ],\r\n      'Thread Stats': [\r\n        true,\r\n        'Display reply and image count.'\r\n      ],\r\n      'IP Count in Stats': [\r\n        true,\r\n        'Display the unique IP count in the thread stats.',\r\n        1\r\n      ],\r\n      'Page Count in Stats': [\r\n        true,\r\n        'Display the page count in the thread stats.',\r\n        1\r\n      ],\r\n      'Updater and Stats in Header': [\r\n        true,\r\n        'Places the thread updater and thread stats in the header instead of floating them.'\r\n      ],\r\n      'Thread Watcher': [\r\n        true,\r\n        'Bookmark threads. Has more options in the thread watcher menu.'\r\n      ],\r\n      'Fixed Thread Watcher': [\r\n        true,\r\n        'Makes the thread watcher scroll with the page.',\r\n        1\r\n      ],\r\n      'Persistent Thread Watcher': [\r\n        false,\r\n        'The thread watcher will be visible when the page is loaded.',\r\n        1\r\n      ],\r\n      'Mark New IPs': [\r\n        false,\r\n        'Label each post from a new IP with the thread\\'s current IP count.'\r\n      ],\r\n      'Reply Pruning': [\r\n        true,\r\n        'Add option in header menu to hide old replies in long threads. Activated by default in stickies.'\r\n      ],\r\n      'Prune All Threads': [\r\n        false,\r\n        'Activate Reply Pruning by default in all threads.',\r\n        1\r\n      ]\r\n    },\r\n\r\n    'Posting and Captchas': {\r\n      'Quick Reply': [\r\n        true,\r\n        'All-in-one form to reply, create threads, automate dumping and more.'\r\n      ],\r\n      'Persistent QR': [\r\n        false,\r\n        'The Quick reply won\\'t disappear after posting.',\r\n        1\r\n      ],\r\n      'Auto Hide QR': [\r\n        true,\r\n        'Automatically hide the quick reply when posting.',\r\n        2\r\n      ],\r\n      'Open Post in New Tab': [\r\n        true,\r\n        'Open new threads in a new tab, and open replies in a new tab if you\\'re not already in the thread.',\r\n        1\r\n      ],\r\n      'Remember QR Size': [\r\n        false,\r\n        'Remember the size of the Quick reply.',\r\n        1\r\n      ],\r\n      'Remember Spoiler': [\r\n        false,\r\n        'Remember the spoiler state, instead of resetting after posting.',\r\n        1\r\n      ],\r\n      'Randomize Filename': [\r\n        false,\r\n        'Set the filename to a random timestamp within the past year. Disabled on /f/.',\r\n        1\r\n      ],\r\n      'Show New Thread Option in Threads': [\r\n        true,\r\n        'Show the option to post a new / different thread from inside a thread.',\r\n        1\r\n      ],\r\n      'Show Upload Progress': [\r\n        true,\r\n        'Track progress of file uploads as percentage in submit button.',\r\n        1\r\n      ],\r\n      'Cooldown': [\r\n        true,\r\n        'Indicate the remaining time before posting again.',\r\n        1\r\n      ],\r\n      'Posting Success Notifications': [\r\n        true,\r\n        'Show notifications on successful post creation or file uploading.',\r\n        1\r\n      ],\r\n      'Auto-load captcha': [\r\n        false,\r\n        'Automatically load the captcha in the QR even if your post is empty.',\r\n        1\r\n      ],\r\n      'Post on Captcha Completion': [\r\n        false,\r\n        'Submit the post immediately when the captcha is completed.',\r\n        1\r\n      ],\r\n      'Force Noscript Captcha': [\r\n        false,\r\n        'Use the non-Javascript fallback captcha even if Javascript is enabled.'\r\n      ],\r\n      'Pass Link': [\r\n        false,\r\n        'Add a 4chan Pass login link to the bottom of the page.'\r\n      ]\r\n    },\r\n\r\n    'Quote Links': {\r\n      'Quote Backlinks': [\r\n        true,\r\n        'Add quote backlinks.'\r\n      ],\r\n      'OP Backlinks': [\r\n        true,\r\n        'Add backlinks to the OP.',\r\n        1\r\n      ],\r\n      'Bottom Backlinks': [\r\n        false,\r\n        'Place backlinks at the bottom of posts.',\r\n        1\r\n      ],\r\n      'Quote Inlining': [\r\n        true,\r\n        'Inline quoted post on click.'\r\n      ],\r\n      'Inline Cross-thread Quotes Only': [\r\n        false,\r\n        'Don\\'t inline quote links when the posts are visible in the thread.',\r\n        1\r\n      ],\r\n      'Quote Hash Navigation': [\r\n        false,\r\n        'Include an extra link after quotes for autoscrolling to quoted posts.',\r\n        1\r\n      ],\r\n      'Forward Hiding': [\r\n        true,\r\n        'Hide original posts of inlined backlinks.',\r\n        1\r\n      ],\r\n      'Quote Previewing': [\r\n        true,\r\n        'Show quoted post on hover.'\r\n      ],\r\n      'Quote Highlighting': [\r\n        true,\r\n        'Highlight the previewed post.',\r\n        1\r\n      ],\r\n      'Resurrect Quotes': [\r\n        true,\r\n        'Link dead quotes to the archives, and support inlining/previewing of archive links like quote links.'\r\n      ],\r\n      'Remember Your Posts': [\r\n        true,\r\n        'Remember your posting history.'\r\n      ],\r\n      'Mark Quotes of You': [\r\n        true,\r\n        'Add \\'(You)\\' to quotes linking to your posts.',\r\n        1\r\n      ],\r\n      'Highlight Posts Quoting You': [\r\n        true,\r\n        'Highlights any posts that contain a quote to your post.',\r\n        1\r\n      ],\r\n      'Highlight Own Posts': [\r\n        true,\r\n        'Highlights own posts.',\r\n        1\r\n      ],\r\n      'Mark OP Quotes': [\r\n        true,\r\n        'Add \\'(OP)\\' to OP quotes.'\r\n      ],\r\n      'Mark Cross-thread Quotes': [\r\n        true,\r\n        'Add \\'(Cross-thread)\\' to cross-threads quotes.'\r\n      ],\r\n      'Quote Threading': [\r\n        true,\r\n        'Add option in header menu to thread conversations.'\r\n      ]\r\n    }\r\n  },\r\n\r\n  imageExpansion: {\r\n    'Fit width': [\r\n      true,\r\n      ''\r\n    ],\r\n    'Fit height': [\r\n      false,\r\n      ''\r\n    ],\r\n    'Scroll into view': [\r\n      true,\r\n      'Scroll down when expanding images to bring the full image into view.'\r\n    ],\r\n    'Expand spoilers': [\r\n      true,\r\n      'Expand all images along with spoilers.'\r\n    ],\r\n    'Expand videos': [\r\n      true,\r\n      'Expand all images also expands videos.'\r\n    ],\r\n    'Expand from here': [\r\n      false,\r\n      'Expand all images only from current position to thread end.'\r\n    ],\r\n    'Expand thread only': [\r\n      false,\r\n      'In index, expand all images only within the current thread.'\r\n    ],\r\n    'Advance on contract': [\r\n      false,\r\n      'Advance to next post when contracting an expanded image.'\r\n    ]\r\n  },\r\n\r\n  gallery: {\r\n    'Hide Thumbnails': [\r\n      false\r\n    ],\r\n    'Fit Width': [ // 'Fit width' (lowercase W) belongs to Image Expansion. Engine limitations, heh.\r\n      true\r\n    ],\r\n    'Fit Height': [\r\n      true\r\n    ],\r\n    'Stretch to Fit': [\r\n      false\r\n    ],\r\n    'Scroll to Post': [\r\n      true\r\n    ],\r\n    'Slide Delay': [\r\n      6.0\r\n    ]\r\n  },\r\n\r\n  'Default Volume': 1.0,\r\n\r\n  threadWatcher: {\r\n    'Current Board': [\r\n      false,\r\n      'Only show watched threads from the current board.'\r\n    ],\r\n    'Auto Update Thread Watcher': [\r\n      true,\r\n      'Periodically check status of watched threads.'\r\n    ],\r\n    'Auto Watch': [\r\n      true,\r\n      'Automatically watch threads you start.'\r\n    ],\r\n    'Auto Watch Reply': [\r\n      true,\r\n      'Automatically watch threads you reply to.'\r\n    ],\r\n    'Auto Prune': [\r\n      false,\r\n      'Automatically remove dead threads.'\r\n    ],\r\n    'Show Page': [\r\n      true,\r\n      'Show what page watched threads are on.'\r\n    ],\r\n    'Show Unread Count': [\r\n      true,\r\n      'Show number of unread posts in watched threads.'\r\n    ],\r\n    'Show Site Prefix': [\r\n      true,\r\n      'When multiple sites are shown in the thread watcher, add a prefix to board names to distinguish them.'\r\n    ],\r\n    'Require OP Quote Link': [\r\n      false,\r\n      'For purposes of thread watcher highlighting, only consider posts with a quote link to the OP as replies to the OP.'\r\n    ]\r\n  },\r\n\r\n  filter: {\r\n    general: '',\r\n\r\n    postID: `\\\r\n# Highlight dubs on [s4s]:\r\n#/(\\\\d)\\\\1$/;highlight;top:no;boards:s4s\\\r\n`,\r\n\r\n    name: `\\\r\n# Filter any namefags:\r\n#/^(?!Anonymous$)/\\\r\n`,\r\n\r\n    uniqueID: `\\\r\n# Filter a specific ID:\r\n#/Txhvk1Tl/\\\r\n`,\r\n\r\n    tripcode: `\\\r\n# Filter any tripfag\r\n#/^!/\\\r\n`,\r\n\r\n    capcode: `\\\r\n# Set a custom class for mods:\r\n#/Mod$/;highlight:mod;op:yes\r\n# Set a custom class for admins:\r\n#/Admin$/;highlight:admin;op:yes\\\r\n`,\r\n\r\n    pass: `\\\r\n# Filter anyone using since4pass:\r\n#/./\\\r\n`,\r\n\r\n    email: '',\r\n\r\n    subject: `\\\r\n# Filter Generals on /v/:\r\n#/general/i;boards:v;op:only\\\r\n`,\r\n\r\n    comment: `\\\r\n# Filter Stallman copypasta on /g/:\r\n#/what you\\'re refer+ing to as linux/i;boards:g\r\n# Filter posts with 20 or more quote links:\r\n#/(?:>>\\\\d(?:(?!>>\\\\d)[^])*){20}/\r\n# Filter posts like T H I S / H / I / S:\r\n#/^>?\\\\s?\\\\w\\\\s?(\\\\w)\\\\s?(\\\\w)\\\\s?(\\\\w).*$[\\\\s>]+\\\\1[\\\\s>]+\\\\2[\\\\s>]+\\\\3/im\\\r\n`,\r\n\r\n    flag: '',\r\n    filename: '',\r\n    dimensions: `\\\r\n# Highlight potential wallpapers:\r\n#/1920x1080/;op:yes;highlight;top:no;boards:w,wg\\\r\n`,\r\n\r\n    filesize: '',\r\n\r\n    MD5: ''\r\n  },\r\n\r\n  sauces: `\\\r\n# Known filename formats:\r\nhttps://www.pixiv.net/member_illust.php?mode=medium&illust_id=%$1;regexp:/^(\\\\d+)_p\\\\d+/\r\njavascript:void(open(\"https://www.deviantart.com/\"+%$1.replace(/_/g,\"-\")+\"/art/\"+parseInt(%$2,36)));regexp:/^\\\\w+_by_(\\\\w+)[_-]d([\\\\da-z]{6})\\\\b/\r\nhttps://imgur.com/%$1;regexp:/^(?![a-zA-Z][a-z]{6})(?![A-Z]{7})(?!\\\\d{7})([\\\\da-zA-Z]{7})(?: \\\\(\\\\d+\\\\))?\\\\.\\\\w+$/\r\nhttps://flickr.com/photo.gne?id=%$1;regexp:/^(\\\\d+)_[\\\\da-f]{10}(?:_\\\\w)*\\\\b/\r\nhttps://www.facebook.com/photo.php?fbid=%$1;regexp:/^\\\\d+_(\\\\d+)_\\\\d+_[no]\\\\b/\r\n\r\n# Reverse image search:\r\nhttps://www.google.com/searchbyimage?sbisrc=4chanx&image_url=%IMG&safe=off\r\nhttps://yandex.com/images/search?rpt=imageview&url=%IMG\r\n#//tineye.com/search?url=%IMG\r\n#//www.bing.com/images/search?q=imgurl:%IMG&view=detailv2&iss=sbi#enterInsights\r\n#https://lens.google.com/uploadbyurl?url=%IMG;text:lens\r\n\r\n# Specialized reverse image search:\r\n//iqdb.org/?url=%IMG\r\nhttps://trace.moe/?auto&url=%IMG;text:wait\r\n#//3d.iqdb.org/?url=%IMG\r\n#//saucenao.com/search.php?url=%IMG\r\n\r\n# \"View Same\" in archives:\r\nhttp://eye.swfchan.com/search/?q=%name;types:swf\r\n#https://desuarchive.org/_/search/image/%sMD5/\r\n#https://archive.4plebs.org/_/search/image/%sMD5/\r\n#https://boards.fireden.net/_/search/image/%sMD5/\r\n#https://foolz.fireden.net/_/search/image/%sMD5/\r\n\r\n# Other tools:\r\n#http://exif.regex.info/exif.cgi?imgurl=%URL\r\n#//imgops.com/start?url=%URL;types:gif,jpg,png\r\n#//www.gif-explode.com/%URL;types:gif\\\r\n`,\r\n\r\n  FappeT: {\r\n    werk:  false\r\n  },\r\n\r\n  'Custom CSS': true,\r\n\r\n  Index: {\r\n    'Index Mode': 'paged',\r\n    'Previous Index Mode': 'paged',\r\n    'Index Size': 'small',\r\n    'Show Replies':          [true,  'Show replies in the index, and also in the catalog if \"Catalog hover expand\" is checked.'],\r\n    'Catalog Hover Expand':  [false, 'Expand the comment and show more details when you hover over a thread in the catalog.'],\r\n    'Catalog Hover Toggle':  [true,  'Turn \"Catalog hover expand\" on and off by clicking in the catalog.'],\r\n    'Pin Watched Threads':   [false, 'Move watched threads to the start of the index.'],\r\n    'Anchor Hidden Threads': [true,  'Move hidden threads to the end of the index.'],\r\n    'Refreshed Navigation':  [false, 'Refresh index when navigating through pages.']\r\n  },\r\n\r\n  Header: {\r\n    'Fixed Header':               true,\r\n    'Header auto-hide':           false,\r\n    'Header auto-hide on scroll': false,\r\n    'Bottom Header':              false,\r\n    'Centered links':             false,\r\n    'Header catalog links':       false,\r\n    'Bottom Board List':          true,\r\n    'Shortcut Icons':             true,\r\n    'Custom Board Navigation':    true\r\n  },\r\n\r\n  archives: {\r\n    archiveLists:      'https://4chenz.github.io/archives.json/archives.json',\r\n    lastarchivecheck:  0,\r\n    archiveAutoUpdate: true\r\n  },\r\n\r\n  externalCatalogURLs: `\\\r\n//catalog.neet.tv/%board/;boards:4chan.org:3,a,adv,an,asp,biz,c,cgl,ck,cm,co,diy,f,fa,fit,g,gd,his,i,int,jp,k,lgbt,lit,m,mlp,mu,n,news,o,out,p,po,pol,s4s,sci,sp,tg,toy,trv,tv,v,vg,vip,vp,vr,w,wg,wsg,wsr,x\\\r\n`,\r\n\r\n  boardnav: `\\\r\n[ toggle-all ]\r\n[current-index-text:\"Index\"\r\ncurrent-catalog-text:\"Catalog\"\r\ncurrent-expired-text:\"Expired\"\r\ncurrent-archive-text:\"Archive\"]\r\n[external-text:\"FAQ\",\"${meta.name}\"]\\\r\n`,\r\n\r\n  QR: {\r\n    'QR.personas': `\\\r\n#options:\"sage\";boards:jp;always\\\r\n`,\r\n    sjisPreview: false\r\n  },\r\n\r\n  jsWhitelist: `\\\r\nhttp://s.4cdn.org\r\nhttps://s.4cdn.org\r\nhttp://www.google.com\r\nhttps://www.google.com\r\nhttps://www.gstatic.com\r\nhttp://cdn.mathjax.org\r\nhttps://cdn.mathjax.org\r\nhttps://cdnjs.cloudflare.com\r\nhttps://hcaptcha.com\r\nhttps://*.hcaptcha.com\r\n'self'\r\n'unsafe-inline'\r\n'unsafe-eval'\\\r\n`,\r\n\r\n  captchaLanguage: '',\r\n\r\n  time: '%m/%d/%y(%a)%H:%M:%S',\r\n  timeLocale: '',\r\n\r\n  backlink: '>>%id',\r\n\r\n  pastedname: 'file',\r\n\r\n  fileInfo: '%l %d (%p%s, %r%g)',\r\n\r\n  favicon: 'ferongr',\r\n\r\n  usercss: userCss,\r\n\r\n  hotkeys: {\r\n    // QR & Options\r\n    'Toggle board list': [\r\n      'Ctrl+b',\r\n      'Toggle the full board list.'\r\n    ],\r\n    'Toggle header': [\r\n      'Shift+h',\r\n      'Toggle the auto-hide option of the header.'\r\n    ],\r\n    'Open empty QR': [\r\n      'q',\r\n      'Open QR without post number inserted.'\r\n    ],\r\n    'Open QR': [\r\n      'Shift+q',\r\n      'Open QR with post number inserted.'\r\n    ],\r\n    'Open settings': [\r\n      'Alt+o',\r\n      'Open Settings.'\r\n    ],\r\n    'Close': [\r\n      'Esc',\r\n      'Close dialogs or notifications.'\r\n    ],\r\n    'Spoiler tags': [\r\n      'Ctrl+s',\r\n      'Insert spoiler tags.'\r\n    ],\r\n    'Code tags': [\r\n      'Alt+c',\r\n      'Insert code tags.'\r\n    ],\r\n    'Eqn tags':  [\r\n      'Alt+e',\r\n      'Insert eqn tags.'\r\n    ],\r\n    'Math tags': [\r\n      'Alt+m',\r\n      'Insert math tags.'\r\n    ],\r\n    'SJIS tags': [\r\n      'Alt+a',\r\n      'Insert SJIS tags.'\r\n    ],\r\n    'Toggle sage': [\r\n      'Alt+s',\r\n      'Toggle sage in options field.'\r\n    ],\r\n    'Toggle Cooldown': [\r\n      'Alt+Comma',\r\n      'Toggle custom cooldown timer.'\r\n    ],\r\n    'Post from URL': [\r\n      'Alt+l',\r\n      'Post from URL.'\r\n    ],\r\n    'Add new post': [\r\n      'Alt+n',\r\n      'Add new post to the QR dump list.'\r\n    ],\r\n    'Submit QR': [\r\n      'Ctrl+Enter',\r\n      'Submit post.'\r\n    ],\r\n    // Thread related\r\n    'Watch': [\r\n      'w',\r\n      'Watch thread.'\r\n    ],\r\n    'Update': [\r\n      'r',\r\n      'Update the thread / refresh the index.'\r\n    ],\r\n    'Update thread watcher': [\r\n      'Shift+r',\r\n      'Manually refresh thread watcher.'\r\n    ],\r\n    'Toggle thread watcher': [\r\n      't',\r\n      'Toggle visibility of thread watcher.'\r\n    ],\r\n    'Toggle threading': [\r\n      'Shift+t',\r\n      'Toggle threading.'\r\n    ],\r\n    'Mark thread read': [\r\n      'Ctrl+0',\r\n      'Mark thread read from index (requires \"Unread Line in Index\").'\r\n    ],\r\n    // Images\r\n    'Expand image': [\r\n      'Shift+e',\r\n      'Expand selected image.'\r\n    ],\r\n    'Expand images': [\r\n      'e',\r\n      'Expand all images.'\r\n    ],\r\n    'Open Gallery': [\r\n      'g',\r\n      'Opens the gallery.'\r\n    ],\r\n    'Next Gallery Image': [\r\n      'Right',\r\n      'Go to the next image in gallery mode.'\r\n    ],\r\n    'Previous Gallery Image': [\r\n      'Left',\r\n      'Go to the previous image in gallery mode.'\r\n    ],\r\n    'Advance Gallery': [\r\n      'Enter',\r\n      'Go to next image or, if Autoplay is off, play video.'\r\n    ],\r\n    'Pause': [\r\n      'p',\r\n      'Pause/play videos in the gallery.'\r\n    ],\r\n    'Slideshow': [\r\n      'Ctrl+Right',\r\n      'Toggle the gallery slideshow mode.'\r\n    ],\r\n    'Rotate image clockwise': [\r\n      'Shift+Right',\r\n      'Rotate image clockwise in gallery.'\r\n    ],\r\n    'Rotate image anticlockwise': [\r\n      'Shift+Left',\r\n      'Rotate image anticlockwise in gallery.'\r\n    ],\r\n    'Download Gallery Image': [\r\n      'Shift+j',\r\n      'Download current image in gallery.'\r\n    ],\r\n    'fappeTyme': [\r\n      'f',\r\n      'Toggle Fappe Tyme.'\r\n    ],\r\n    'werkTyme': [\r\n      'Shift+w',\r\n      'Toggle Werk Tyme.'\r\n    ],\r\n    // Board Navigation\r\n    'Front page': [\r\n      '1',\r\n      'Jump to front page.'\r\n    ],\r\n    'Open front page': [\r\n      'Shift+1',\r\n      'Open front page in a new tab.'\r\n    ],\r\n    'Next page': [\r\n      'Ctrl+Right',\r\n      'Jump to the next page.'\r\n    ],\r\n    'Previous page': [\r\n      'Ctrl+Left',\r\n      'Jump to the previous page.'\r\n    ],\r\n    'Paged mode': [\r\n      'Alt+1',\r\n      'Open the index in paged mode.'\r\n    ],\r\n    'Infinite scrolling mode': [\r\n      'Alt+2',\r\n      'Open the index in infinite scrolling mode.'\r\n    ],\r\n    'All pages mode': [\r\n      'Alt+3',\r\n      'Open the index in all threads mode.'\r\n    ],\r\n    'Open catalog': [\r\n      'Shift+c',\r\n      'Open the catalog of the current board.'\r\n    ],\r\n    'Search form': [\r\n      'Ctrl+Alt+s',\r\n      'Focus the search field on the board index.'\r\n    ],\r\n    'Cycle sort type': [\r\n      'Alt+x',\r\n      'Cycle through index sort types.'\r\n    ],\r\n    // Thread Navigation\r\n    'Next thread': [\r\n      'Ctrl+Down',\r\n      'See next thread.'\r\n    ],\r\n    'Previous thread': [\r\n      'Ctrl+Up',\r\n      'See previous thread.'\r\n    ],\r\n    'Expand thread': [\r\n      'Ctrl+e',\r\n      'Expand thread.'\r\n    ],\r\n    'Open thread': [\r\n      'o',\r\n      'Open thread in current tab.'\r\n    ],\r\n    'Open thread tab': [\r\n      'Shift+o',\r\n      'Open thread in new tab.'\r\n    ],\r\n    // Reply Navigation\r\n    'Next reply': [\r\n      'j',\r\n      'Select next reply.'\r\n    ],\r\n    'Previous reply': [\r\n      'k',\r\n      'Select previous reply.'\r\n    ],\r\n    'Deselect reply': [\r\n      'Shift+d',\r\n      'Deselect reply.'\r\n    ],\r\n    'Hide': [\r\n      'x',\r\n      'Hide thread.'\r\n    ],\r\n    'Quick Filter MD5': [\r\n      '5',\r\n      'Add the MD5 of the selected image to the filter list.'\r\n    ],\r\n    'Previous Post Quoting You': [\r\n      'Alt+Up',\r\n      'Scroll to the previous post that quotes you.'\r\n    ],\r\n    'Next Post Quoting You': [\r\n      'Alt+Down',\r\n      'Scroll to the next post that quotes you.'\r\n    ]\r\n  },\r\n\r\n  updater: {\r\n    checkbox: {\r\n      'Beep': [\r\n        false,\r\n        'Beep on new post to completely read thread.'\r\n      ],\r\n      'Beep Quoting You': [\r\n        false,\r\n        'Beep on new post quoting you.'\r\n      ],\r\n      'Auto Scroll': [\r\n        false,\r\n        'Scroll updated posts into view. Only enabled at bottom of page.'\r\n      ],\r\n      'Bottom Scroll': [\r\n        false,\r\n        'Always scroll to the bottom, not the first new post. Useful for event threads.'\r\n      ],\r\n      'Scroll BG': [\r\n        false,\r\n        'Auto-scroll background tabs.'\r\n      ],\r\n      'Auto Update': [\r\n        true,\r\n        'Automatically fetch new posts.'\r\n      ],\r\n      'Optional Increase': [\r\n        false,\r\n        'Increase the intervals between updates on threads without new posts.'\r\n      ]\r\n    },\r\n    'Interval': 5\r\n  },\r\n\r\n  customCooldown: 0,\r\n  customCooldownEnabled: true,\r\n\r\n  'Thread Quotes': false,\r\n\r\n  'Max Replies': 1000,\r\n\r\n  'Autohiding Scrollbar': false,\r\n\r\n  position: {\r\n    'embedding.position':      'top: 50px; right: 0px;',\r\n    'thread-stats.position':   'bottom: 0px; right: 0px;',\r\n    'updater.position':        'bottom: 0px; left: 0px;',\r\n    'thread-watcher.position': 'top: 50px; left: 0px;',\r\n    'qr.position':             'top: 50px; right: 0px;'\r\n  },\r\n\r\n  fourchanImageHost: 'i.4cdn.org',\r\n\r\n  hiddenPSAList: [{}],\r\n\r\n  knownBanners: banners.join(','),\r\n\r\n  passMessageClosed: false,\r\n\r\n  'Prerequest Captcha': false,\r\n\r\n  'PSAseen': [[]]\r\n};\r\nexport default Config;\r\n","import ferongr_unreadDead from './Favicon/ferongr.unreadDead.png';\r\nimport ferongr_unreadDeadY from './Favicon/ferongr.unreadDeadY.png';\r\nimport ferongr_unreadSFW from './Favicon/ferongr.unreadSFW.png';\r\nimport ferongr_unreadSFWY from './Favicon/ferongr.unreadSFWY.png';\r\nimport ferongr_unreadNSFW from './Favicon/ferongr.unreadNSFW.png';\r\nimport ferongr_unreadNSFWY from './Favicon/ferongr.unreadNSFWY.png';\r\nimport xat_unreadDead from './Favicon/xat-.unreadDead.png';\r\nimport xat_unreadDeadY from './Favicon/xat-.unreadDeadY.png';\r\nimport xat_unreadSFW from './Favicon/xat-.unreadSFW.png';\r\nimport xat_unreadSFWY from './Favicon/xat-.unreadSFWY.png';\r\nimport xat_unreadNSFW from './Favicon/xat-.unreadNSFW.png';\r\nimport xat_unreadNSFWY from './Favicon/xat-.unreadNSFWY.png';\r\nimport Mayhem_unreadDead from './Favicon/Mayhem.unreadDead.png';\r\nimport Mayhem_unreadDeadY from './Favicon/Mayhem.unreadDeadY.png';\r\nimport Mayhem_unreadSFW from './Favicon/Mayhem.unreadSFW.png';\r\nimport Mayhem_unreadSFWY from './Favicon/Mayhem.unreadSFWY.png';\r\nimport Mayhem_unreadNSFW from './Favicon/Mayhem.unreadNSFW.png';\r\nimport Mayhem_unreadNSFWY from './Favicon/Mayhem.unreadNSFWY.png';\r\nimport fourChanJS_unreadDead from './Favicon/4chanJS.unreadDead.png';\r\nimport fourChanJS_unreadDeadY from './Favicon/4chanJS.unreadDeadY.png';\r\nimport fourChanJS_unreadSFW from './Favicon/4chanJS.unreadSFW.png';\r\nimport fourChanJS_unreadSFWY from './Favicon/4chanJS.unreadSFWY.png';\r\nimport fourChanJS_unreadNSFW from './Favicon/4chanJS.unreadNSFW.png';\r\nimport fourChanJS_unreadNSFWY from './Favicon/4chanJS.unreadNSFWY.png';\r\nimport Original_unreadDead from './Favicon/Original.unreadDead.png';\r\nimport Original_unreadDeadY from './Favicon/Original.unreadDeadY.png';\r\nimport Original_unreadSFW from './Favicon/Original.unreadSFW.png';\r\nimport Original_unreadSFWY from './Favicon/Original.unreadSFWY.png';\r\nimport Original_unreadNSFW from './Favicon/Original.unreadNSFW.png';\r\nimport Original_unreadNSFWY from './Favicon/Original.unreadNSFWY.png';\r\nimport Metro_unreadDead from './Favicon/Metro.unreadDead.png';\r\nimport Metro_unreadDeadY from './Favicon/Metro.unreadDeadY.png';\r\nimport Metro_unreadSFW from './Favicon/Metro.unreadSFW.png';\r\nimport Metro_unreadSFWY from './Favicon/Metro.unreadSFWY.png';\r\nimport Metro_unreadNSFW from './Favicon/Metro.unreadNSFW.png';\r\nimport Metro_unreadNSFWY from './Favicon/Metro.unreadNSFWY.png';\r\nimport dead from './Favicon/dead.gif';\r\nimport empty from './Favicon/empty.gif';\r\nimport $ from '../platform/$';\r\nimport { Conf, d } from '../globals/globals';\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n\r\nvar Favicon = {\r\n  init() {\r\n    return $.asap((() => d.head && (Favicon.el = $('link[rel=\"shortcut icon\"]', d.head))), Favicon.initAsap);\r\n  },\r\n\r\n  set(status) {\r\n    Favicon.status = status;\r\n    if (Favicon.el) {\r\n      Favicon.el.href = Favicon[status];\r\n      // `favicon.href = href` doesn't work on Firefox.\r\n      return $.add(d.head, Favicon.el);\r\n    }\r\n  },\r\n\r\n  initAsap() {\r\n    Favicon.el.type = 'image/x-icon';\r\n    const {href}          = Favicon.el;\r\n    Favicon.isSFW   = /ws\\.ico$/.test(href);\r\n    Favicon.default = href;\r\n    Favicon.switch();\r\n    if (Favicon.status) {\r\n      return Favicon.set(Favicon.status);\r\n    }\r\n  },\r\n\r\n  switch() {\r\n    let items = {\r\n      ferongr: [\r\n        ferongr_unreadDead,\r\n        ferongr_unreadDeadY,\r\n        ferongr_unreadSFW,\r\n        ferongr_unreadSFWY,\r\n        ferongr_unreadNSFW,\r\n        ferongr_unreadNSFWY,\r\n      ],\r\n      'xat-': [\r\n        xat_unreadDead,\r\n        xat_unreadDeadY,\r\n        xat_unreadSFW,\r\n        xat_unreadSFWY,\r\n        xat_unreadNSFW,\r\n        xat_unreadNSFWY,\r\n      ],\r\n      Mayhem: [\r\n        Mayhem_unreadDead,\r\n        Mayhem_unreadDeadY,\r\n        Mayhem_unreadSFW,\r\n        Mayhem_unreadSFWY,\r\n        Mayhem_unreadNSFW,\r\n        Mayhem_unreadNSFWY,\r\n      ],\r\n      '4chanJS': [\r\n        fourChanJS_unreadDead,\r\n        fourChanJS_unreadDeadY,\r\n        fourChanJS_unreadSFW,\r\n        fourChanJS_unreadSFWY,\r\n        fourChanJS_unreadNSFW,\r\n        fourChanJS_unreadNSFWY,\r\n      ],\r\n      Original: [\r\n        Original_unreadDead,\r\n        Original_unreadDeadY,\r\n        Original_unreadSFW,\r\n        Original_unreadSFWY,\r\n        Original_unreadNSFW,\r\n        Original_unreadNSFWY,\r\n      ],\r\n      'Metro': [\r\n        Metro_unreadDead,\r\n        Metro_unreadDeadY,\r\n        Metro_unreadSFW,\r\n        Metro_unreadSFWY,\r\n        Metro_unreadNSFW,\r\n        Metro_unreadNSFWY,\r\n      ]\r\n    };\r\n    items = $.getOwn(items, Conf['favicon']);\r\n\r\n    const f = Favicon;\r\n    const t = 'data:image/png;base64,';\r\n    let i = 0;\r\n    while (items[i]) {\r\n      items[i] = t + items[i++];\r\n    }\r\n\r\n    [f.unreadDead, f.unreadDeadY, f.unreadSFW, f.unreadSFWY, f.unreadNSFW, f.unreadNSFWY] = Array.from(items);\r\n    return f.update();\r\n  },\r\n\r\n  update() {\r\n    if (this.isSFW) {\r\n      this.unread  = this.unreadSFW;\r\n      return this.unreadY = this.unreadSFWY;\r\n    } else {\r\n      this.unread  = this.unreadNSFW;\r\n      return this.unreadY = this.unreadNSFWY;\r\n    }\r\n  },\r\n\r\n  SFW:   '//s.4cdn.org/image/favicon-ws.ico',\r\n  NSFW:  '//s.4cdn.org/image/favicon.ico',\r\n  dead: `data:image/gif;base64,${dead}`,\r\n  logo: `data:image/png;base64,${empty}`,\r\n};\r\nexport default Favicon;\r\n","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAFVBMVEX///9zBQC/AADpDAP/gID/q6voCwJJTwpOAAAAAXRSTlMAQObYZgAAAGJJREFUeF5Fi7ENg0AQBCfa/AFdDh2gdwPIogMK2E2+/xLslwOvdqRJhv+GQQPUCtJM7svankLrq/I+TY5e6Ueh1jyBMX7AFJi9vwfyVO4CbbO6jNYpp9GyVPbdkFhVgAQ2H0NOE5jk9DT8AAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAxUlEQVR42q1TOwrCQBB9s0FRtJI0WoqFtSLYegoP4gVSeJsUHsHSI3iFeIqRXXgwrhlXwYHHhLwPTB7B36abBCV+0pA4DUBQUNZYQptGtW3jtoKyxgoe0yrBCoyZfL/5ioQ3URZOXW9I341l3oo+NXEZiW4CEuIzvPECopED4OaZ3RNmeAm4u+a8Jr5f17VyVoL8fr8qcltzwlyyj2iqcgPOQ9ExkHAITgD75bYBe0A5S4H/P9htuWMF3QXoQpwaKeT+lnsC6JE5I6aq6fEAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAFVBMVEX///8AcH4AtswA2PJ55fKi6fIA1/FtpPADAAAAAXRSTlMAQObYZgAAAGJJREFUeF5Fi7ENg0AQBCfa/AFdDh2gdwPIogMK2E2+/xLslwOvdqRJhv+GQQPUCtJM7svankLrq/I+TY5e6Ueh1jyBMX7AFJi9vwfyVO4CbbO6jNYpp9GyVPbdkFhVgAQ2H0NOE5jk9DT8AAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAxElEQVQ4y2NgoBq4/vE/HJOsBiRQUIfA2AzBqQYqUfn00/9FLz+BaQxDCKqBmX7jExijKEDSDJPHrnnbGQhGV4RmOFwdVkNwhQMheYwQxhaIi7b9Z9A3gWAQm2BUoQOgRhgA8o7j1ozLC4LCyAZcx6kZI5qg4kLKqggDFFWxJySsUQVzlb4pwgAJaTRvokcVNgOqOv8zcHBCsL07DgNg8YsczzA5MxtUL+DMD8g0slxI/H8GQ/P/DJKyeKIRpglXZsIiBwBhP5O+VbI/JgAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAFVBMVEX///8oeQBJ3ABV/wHM/7Lu/+ZU/gAqUP3dAAAAAXRSTlMAQObYZgAAAGJJREFUeF5Fi7ENg0AQBCfa/AFdDh2gdwPIogMK2E2+/xLslwOvdqRJhv+GQQPUCtJM7svankLrq/I+TY5e6Ueh1jyBMX7AFJi9vwfyVO4CbbO6jNYpp9GyVPbdkFhVgAQ2H0NOE5jk9DT8AAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAx0lEQVQ4y2NgoBYI+cfwH4ZJVgMS0KhEYGyG4FQDkzjzf9P/d/+fgWl0QwiqgSkI/c8IxsgKkDXD5LFq9rwDweiK0A2HqcNqCK5wICSPEcLYAtH+AMN/IXMIBrEJRie6OEgjDAC5x3FqxuUFNiEUA67j1IweTTBxBQ1puAG86jgSEraogskJWSBcwCGF5k30qMJmgMFEhv/MXBAs5oLDAFj8IsczTE7UEeECbhU8+QGZRpaTi2b4L2zF8J9TGk80wjThykzY5AAW/2O1C2mIbgAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAG1BMVEX+AACLkZFub2yfaF3zZGIAAAD/AAD/iYr/zs8IPcF6AAAABXRSTlMAeprJ7xzg6IEAAABZSURBVAjXY2DABKGBSkqioQwMrGmpxsZhaQEMDGFpIa5pqSCRtPDSNJBIaGh5eShQDYOye0V7iREKAyQFYoiCFAcyILQDGcGmEEZYkGoqiMHKysAQEICwGwAAjBmBqhYlagAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAPFBMVEUAAACEgoBva2ilamDxcG7IaWYgFBNOSEf//f0PDQwBAAA7LCwAAAD/AAD+hIX+m5z+zc5HAADPAAAGAADl032uAAAADHRSTlMAzNv0/vz+6v3+7ALrmfyXAAAAaUlEQVQY042PyxKAIAhFAc1eV7T6/3/N8VXOtAgWwBm4ANEPA8AswpySXHvvYZLlpBNrh9pDtcSqAQ1BUTVIjNUQY5icmwfglmXNgE0d6QBF9GigrU0A9LoM53U1kFzk6SBQuWfD/vHqDUCpBmVKTTM4AAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAIVBMVEUAAACRjop4dXVpZ2tdcI9dfKdisfMAAAAumMN9xv+s2/+PADT2AAAAB3RSTlMAepGdv83v3HIc4QAAAFxJREFUCNdjYMAE5YXKRuLlDAzsHe2uIRUdBQwMFR1l6R3tIJGOyukdIJHy8lkry4FqGEwzV62aFozMUAFJOQEZ4iDFhQwI7UBGaTiEUVFs3g5isLMzMBQUIOwGAJRlIu9hk08QAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAMFBMVEUAAACAgYVlc4ljsu4AAAAAAAAAAAAumMODyP6b1P6e1f/g8v89msgSIiwNFxwbPU3tQYj5AAAABnRSTlMAxej+9VTmD9ciAAAAZElEQVQI12NgwARpiUKKYmkMDGzlZUpK6eUJDAzp5clm5WUgkfKMtnKQSFpa54o0oBoGJYvZO88+gjJu7wMyhIBS2SCGGFDxaxADpP32NjAjSe0bSFd6epIaWISNjYEhJRVhNwAGlyJpYtcvcAAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAHlBMVEUfJSCRi5Frbm9dn19082KR/30AAABmzDOq/5vZ/9Gt/vt2AAAABnRSTlMAe5rJ7/4vxEp4AAAAWUlEQVQI12NgwARpiUpKYmkMDGzlZcbG6eUJDAzp5Slu5WUgkfLUsHKQSFpaRGsaUA2DsmvnjBAjFAZICsQQAylOZEBoBzKSzSCM9CS1MhCDjY2BISEBYTcAtgAcKSK2vuIAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAM1BMVEUAAACBj39tfm1qj2RepFlu2VQAAQAAAAAAAABmyzOX/oSr/pus/pzk/98PGgtatC4CBAI1ENblAAAACHRSTlMA09/p9v77ig0SBcQAAABnSURBVBjTjY9LDsAgCEQRsR2xWu9/2hK/adJFYQG8wABEPwyAYzNnSatjjPAiviWLhPCqI1R7HBrQdCmGBrEETTmnUAq/QMm5dODHyAQOXXR1zLUGsIEI7lonMGfeHQTq9xw4P159AIxSBSC53km7AAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABFklEQVR4AZ2R4WqEMBCEFy1yiJQQ14gcIhIuFBFR+qPQ93+v66QMksrlTwMfkZ2ZZbMKTgVqYIDl3YAbeCM31lJP/Zul4MAEPJjBQGNDLGsz8PQ6aqLAP5PTdd1WlmU09mSKtdTDRgrkzspJPKq6RxMahfj9yhOzQEZwZAwfzrk1ox3MXibIN8hO4MAjeV72CemJGWblnRsOYOdoGw0jebB20BPAwKzUQPlrFhrXFw1Wagu9yuzZwINzVAZCURRL+gRr7Wd8Vtqg4Th/lsUmewyk9WQ/A7NiwJz5VV/GmO+MNjMrFvh/NPDMigHTaeJN09a27ZHRJmalBg54CgfvAGYSLpoHjlmpuAwFdzDy7oGS/qIpM9UPFGg1b1kUlssAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABR0lEQVR4AYWSQWq0QBCFCw0SRIK0PQ4hiIhEZBhEySLyewUPEMgqR/JIXiDhzz7kKKYePIZajEzDRxfV9dWU3SO6IiVWUsVxT5R75Y4gTmwNnUh4kCulUiuV8sjChDjmKtaUcHgmHsnNrMPh0IVhiMIjKZGzNXDoyhMzF7C89z2KtFGD+FoNXEUKZdgpaPM8P++cDXTtBDca7EyQK8+bXTufYBccuvLAG26UnqN1LCgI4g/lm7zTgSux4vk0J8rnKw3+m1//pBPbBrVyGZVNmiAITviEtm3t+D+2QcJx7GUxlN4594K4ZY75Xzh0JVWqnad6TdP0H+LRNBjHcYNDV5xS32qwaC4my7Lwn6guu5QoomgbdFmWDYhnM8E8zxscuhLzPWtKA/dGqUizrityX9M0YX+DQ1ciXobnP6vgfmTOM7Znnk70B58pPaEvx+epAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/ElEQVR4AZ3RUWqEMBSF4ftQZAhSREQJIiIXpQwi+tSldkFdWPsLhyEE0ocKH2Fyzg1mNJ4KAQ1arTUeeJMH6qwTUJmCHjMcC6KKtbSIylzdXpl18J/k4fdTpUFmPLOOa9bGe+P4+n5RYYfLXuiMsAlXofBxK2QXpvwN/jqg+AY91vR+pStk+apZe0fEhhMXDhUmWXEoO9WNmrWAzvRPq7jnB2jvUGfWTEgPcJzZFTbZk/0Tnh5QI+af6lVGvq/Do2atwVL4VJ+3QrZo1lr4Pw5wzVqDWaV7SUvHrZDNmrWAHq7g0rphkS3LXDMBVqFGhxGT1gGdDFnWaab6BRmXRvbxDmYiAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABQElEQVR4AY2SQUrEQBBFS9CMNFEkhAQdYmiCIUgcZlYGc4VsBcGVF/AuWXme4F7RtXiVWF9+Y9MYtOHRTdX/NZWaEj2RYpQTJeEdK4fKPuA7DjSGXiQkU0qlUqxySmFMEsYsNSU8zEmK4OwdEbmkKCclYoGmolfWCGyenh1O0EJE2gXNWpFC2S0IGrCQ29EbdPCPAmEHmXIxByf8hDAPD71yzAnXypatbSgoAN8Pyju5h4deMUrqJk1z+0uBN+/XX+gxfoFK2QafUJO2aRq//Q+/QIx2wr+Kwq0rusrP/QKf9MTCtbQLf9U1wNvYnz3qug45S68kSvVXgbPbx3nvYPXNOI7cRPWySukK+DcGCvA+urqZ3RmGAbmSXjFK5rpwW8nhWVJP04TYa9/3uO/goVciDiPlZhW8c8ZAHuRSeqIv32FK/GYGL8YAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAA/ElEQVR4AZ3RUWqEMBSF4ftQZAihDCKKiAQJShERQx+6o662e2p/4TCEQF468BEm95yLovFr4PBEq9PjgTd5wBcZp6559AiIWDAq6KXV3aJMUMfDOsTf7Mf/XaFBAvYiE9W16b74/vl8UeBAlKOSmWAzUiXwcavMkrrFE9QXVJ+gx5q9XvUVivmqrr1jxIYLCacCs6y6S8psGNU1hw4Bu4JHuUB3pzJBHZcviLiKV9jkyO4vxHyBx1h+qlcY5b2Wj+raE0vlU33dKrNFXWsR/7EgqmtPBIXuIw+dt8osqGsOPaIGSeeGRbZiFtVxsAYeHSbMOgd0MhSzTp3mD4RaQX4aW3NMAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABP0lEQVR4AYWS0UqFQBCGhziImNRBRImDmUgiIaF0kWSP4AMEXXXTE/QiPpL3UdR19Crb/PAvLEtyFj5mmfn/cdxd0RUokbJXEsZYCZUd4D72NBG8wkKmlEqtVMoFhTFJmKuoKelBTVIkjbNE5IainJTIeZqaXjkg8fp+Z7GCjiLQbWgOihTKsCFowUZtoNef4HgDf4JMuTbe8n/Br8NDr5zxhBul52i3FBQE+xflmzzTA69ESmpPmubunwZfztc/6IncBrXSe7/QkK5tW3f8H7dBjHH8q6Kwt033V6Hb4JeeWPgsq42rugfYZ92psWscRwMPvZIo9bEGD2+F2YUnBizLwpeoXnYpbQM34kAB9peP58aueZ4NPPRKxPusaRoYG6UizbquyH1O04T4RA+8EvAwUr6sgjFnDuReLaUn+ANygUa7+9SCWgAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAD1BMVEUBAAAAAAD/AABnZ2f///8nFk05AAAAAXRSTlMAQObYZgAAAEFJREFUeNqNjgEKACAMAjvX/98cAkkxgmSgO8Bt/Ai4ApJ6KKhzF3OiEMDASrGB/QWgPEHsUpN+Ng9xAETMYhDrWmeHAMcmvycWAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAAAAAD/AABmZmYA/wBD99DBAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAE9JREFUCNdljcsRACEIQ5MOiNKAdGAJ9N/Uiu7nsMzABHgB4B8ygFoZA2hhVWavhhGeURPJU9q45+17hGbfGxa82Ndex3hEM44SJGD2/b4AzDgGlHbl388AAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAD1BMVEUBAAAAAAAul8NnZ2f////82iC9AAAAAXRSTlMAQObYZgAAAEFJREFUeNqNjgEKACAMAjvX/98cAkkxgmSgO8Bt/Ai4ApJ6KKhzF3OiEMDASrGB/QWgPEHsUpN+Ng9xAETMYhDrWmeHAMcmvycWAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAAAAAAul8NnZ2f/AAD7B+mqAAAAAXRSTlMAQObYZgAAAAlwSFlzAAALEgAACxIB0t1+/AAAAE9JREFUCNdljcsRACEIQ5MOiNKAdGAJ9N/Uiu7nsMzABHgB4B8ygFoZA2hhVWavhhGeURPJU9q45+17hGbfGxa82Ndex3hEM44SJGD2/b4AzDgGlHbl388AAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAElBMVEUBAAAAAABmzDNlyjJnZ2f///+6o7dfAAAAAXRSTlMAQObYZgAAAERJREFUeF6NjkEKADEIA51o///lJZfQxUsHITogWi8AvwZJuxmYa25xDooBLEwOWFTYAsYVhdorLZt9Ng9xCUTCUCQ2H3F4ANrZ2WNiAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAD1BMVEUAAAAAAABmzDNmZmb/AAC8/wCMAAAAAXRSTlMAQObYZgAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAE9JREFUCNdljcsRACEIQ5MOiNKAdGAJ9N/Uiu7nsMzABHgB4B8ygFoZA2hhVWavhhGeURPJU9q45+17hGbfGxa82Ndex3hEM44SJGD2/b4AzDgGlHbl388AAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAADFBMVEX/////AAD///8AAABBZmS3AAAAAXRSTlMAQObYZgAAAExJREFUeF4tyrENgDAMAMFXKuQswQLBG3mOlBnFS1gwDfIYLpEivvjq2MlqjmYvYg5jWEzCwtDSQlwcXKCVLrpFbvLvvSf9uZJ2HusDtJAY7Tkn1oYAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAhElEQVR42q1RwQnAMAjMu5M4guAKXa4j5dUROo5tipSDcrFChUONd0di2m/hEGVOHDyIPufgwAFASDkpoSzmBrkJ2UMyR9LsJ3rvrqo3Rt1YMIMhhNnOxLMnoMFBxHyJAr2IOBFzA8U+6pLBdmEJTA0aMVjpDd6Loks0s5HZNwYx8tfZCZ0kll7ORffZAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAADFBMVEX///8ul8P///8AAACaqgkzAAAAAXRSTlMAQObYZgAAAExJREFUeF4tyrENgDAMAMFXKuQswQLBG3mOlBnFS1gwDfIYLpEivvjq2MlqjmYvYg5jWEzCwtDSQlwcXKCVLrpFbvLvvSf9uZJ2HusDtJAY7Tkn1oYAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAALVBMVEUAAAAAAAAAAAAAAAABBQcHFx4KISoNLToaVW4oKCgul8M4ODg7OzvBwcH///8uS/CdAAAAA3RSTlMAx9dmesIgAAAAV0lEQVR42m2NWw6AIBAD1eILZO5/XI0UAgm7H9tOsu0yGWAQSOoFijHOxOANGqm/LczpOaXs4gISrPZ+gc2+hO5w2xdwgOjBFUIF+sEJrhUl9JFr+badFwR+BfqlmGUJAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAgMAAABinRfyAAAADFBMVEX///9mzDP///8AAACT0n1lAAAAAXRSTlMAQObYZgAAAExJREFUeF4tyrENgDAMAMFXKuQswQLBG3mOlBnFS1gwDfIYLpEivvjq2MlqjmYvYg5jWEzCwtDSQlwcXKCVLrpFbvLvvSf9uZJ2HusDtJAY7Tkn1oYAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAALVBMVEUAAAAAAAAAAAAAAAAECAIQIAgWLAsePA8oKCg4ODg6dB07OztmzDPBwcH///+rsf3XAAAAA3RSTlMAx9dmesIgAAAAV0lEQVR42m2NWw6AIBAD1eIDhbn/cTVSCCTsfmw7ybbLZIBBIKkXKKU0E4M3aKT+tjCn5xiziwuIsNr7BTb7ErrDZV/AAaIHdwgV6AcnuFaU0Eeu5dt2XiUyBjCQ2bIrAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAC/AABrZQDiAAAAAXRSTlMAQObYZgAAABJJREFUCB1jZGBgrMNAQEEc4gCSfAX5bRw/NQAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAAAAAAAAAC/AAD///8dAAApAABsAAAHAAA4AACQAAAsAABMCpCvAAAAA3RSTlMAPse+s4iwAAAAMklEQVQI12NggAFmY2MDECaNAQZCilAzVJyg5oS4GqAxUtygjIp2KGOKJ5SxepcB3BUAcdYRqxAtgFoAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAAAA1/GhpCidAAAAAXRSTlMAQObYZgAAABJJREFUCB1jZGBgrMNAQEEc4gCSfAX5bRw/NQAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAAAAAAAAAAA1/H///8AISUALzQAeokACAkAQEcAorYAMTcE9WFNAAAAA3RSTlMAPse+s4iwAAAAMklEQVQI12NggAFmY2MDECaNAQZCilAzVJyg5oS4GqAxUtygjIp2KGOKJ5SxepcB3BUAcdYRqxAtgFoAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQAQMAAAAlPW0iAAAABlBMVEUAAABV/wErM5hwAAAAAXRSTlMAQObYZgAAABJJREFUCB1jZGBgrMNAQEEc4gCSfAX5bRw/NQAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAJFBMVEUAAAAAAAAAAABV/wH///8NKAASOAAwkQADCgAZTABAwQATOwC5e3VGAAAAA3RSTlMAPse+s4iwAAAAMklEQVQI12NggAFmY2MDECaNAQZCilAzVJyg5oS4GqAxUtygjIp2KGOKJ5SxepcB3BUAcdYRqxAtgFoAAAAASUVORK5CYII=';","import { d } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst $$ = (selector, root = d.body) => [...Array.from(root.querySelectorAll(selector))];\r\nexport default $$;\r\n","import { g, Conf, doc, d } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\nimport Captcha from \"./Captcha\";\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst CaptchaReplace = {\r\n  init() {\r\n    if ((g.SITE.software !== 'yotsuba') || (d.cookie.indexOf('pass_enabled=1') >= 0)) { return; }\r\n\r\n    if (Conf['Force Noscript Captcha'] && Main.jsEnabled) {\r\n      $.ready(Captcha.replace.noscript);\r\n      return;\r\n    }\r\n\r\n    if (Conf['captchaLanguage'].trim()) {\r\n      if (['boards.4chan.org', 'boards.4channel.org'].includes(location.hostname)) {\r\n        return $.onExists(doc, '#captchaFormPart', node => $.onExists(node, 'iframe[src^=\"https://www.google.com/recaptcha/\"]', Captcha.replace.iframe));\r\n      } else {\r\n        return $.onExists(doc, 'iframe[src^=\"https://www.google.com/recaptcha/\"]', Captcha.replace.iframe);\r\n      }\r\n    }\r\n  },\r\n\r\n  noscript() {\r\n    let noscript, original, toggle;\r\n    if (!((original = $('#g-recaptcha')) && (noscript = $('noscript', original.parentNode)))) { return; }\r\n    const span = $.el('span',\r\n      {id: 'captcha-forced-noscript'});\r\n    $.replace(noscript, span);\r\n    $.rm(original);\r\n    const insert = function() {\r\n      span.innerHTML = noscript.textContent;\r\n      return Captcha.replace.iframe($('iframe[src^=\"https://www.google.com/recaptcha/\"]', span));\r\n    };\r\n    if (toggle = $('#togglePostFormLink a, #form-link')) {\r\n      return $.on(toggle, 'click', insert);\r\n    } else {\r\n      return insert();\r\n    }\r\n  },\r\n\r\n  iframe(iframe) {\r\n    let lang;\r\n    if (lang = Conf['captchaLanguage'].trim()) {\r\n      const src = /[?&]hl=/.test(iframe.src) ?\r\n        iframe.src.replace(/([?&]hl=)[^&]*/, '$1' + encodeURIComponent(lang))\r\n      :\r\n        iframe.src + `&hl=${encodeURIComponent(lang)}`;\r\n      if (iframe.src !== src) { iframe.src = src; }\r\n    }\r\n  }\r\n};\r\nexport default CaptchaReplace;\r\n","import { d, g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport QR from \"./QR\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst CaptchaT = {\r\n  init() {\r\n    if (d.cookie.indexOf('pass_enabled=1') >= 0) { return; }\r\n    if (!(this.isEnabled = !!$('#t-root') || !$.id('postForm'))) { return; }\r\n\r\n    const root = $.el('div', {className: 'captcha-root'});\r\n    this.nodes = {root};\r\n\r\n    $.addClass(QR.nodes.el, 'has-captcha', 'captcha-t');\r\n    return $.after(QR.nodes.com.parentNode, root);\r\n  },\r\n\r\n  moreNeeded() {\r\n  },\r\n\r\n  getThread() {\r\n    let threadID;\r\n    const boardID = g.BOARD.ID;\r\n    if (QR.posts[0].thread === 'new') {\r\n      threadID = '0';\r\n    } else {\r\n      threadID = '' + QR.posts[0].thread;\r\n    }\r\n    return {boardID, threadID};\r\n  },\r\n\r\n  setup(focus) {\r\n    if (!this.isEnabled) { return; }\r\n\r\n    if (!this.nodes.container) {\r\n      this.nodes.container = $.el('div', {className: 'captcha-container'});\r\n      $.prepend(this.nodes.root, this.nodes.container);\r\n      CaptchaT.currentThread = CaptchaT.getThread();\r\n      $.global(function() {\r\n        const el = document.querySelector('#qr .captcha-container');\r\n        window.TCaptcha.init(el, this.boardID, +this.threadID);\r\n        return window.TCaptcha.setErrorCb(err => window.dispatchEvent(new CustomEvent('CreateNotification', {detail: {\r\n          type: 'warning',\r\n          content: '' + err\r\n        }})\r\n        ));\r\n      }\r\n      , CaptchaT.currentThread);\r\n    }\r\n\r\n    if (focus) {\r\n      return $('#t-resp').focus();\r\n    }\r\n  },\r\n\r\n  destroy() {\r\n    if (!this.isEnabled || !this.nodes.container) { return; }\r\n    $.global(() => window.TCaptcha.destroy());\r\n    $.rm(this.nodes.container);\r\n    return delete this.nodes.container;\r\n  },\r\n\r\n  updateThread() {\r\n    if (!this.isEnabled) { return; }\r\n    const {boardID, threadID} = (CaptchaT.currentThread || {});\r\n    const newThread = CaptchaT.getThread();\r\n    if ((newThread.boardID !== boardID) || (newThread.threadID !== threadID)) {\r\n      CaptchaT.destroy();\r\n      return CaptchaT.setup();\r\n    }\r\n  },\r\n\r\n  getOne() {\r\n    let el;\r\n    let response = {};\r\n    if (this.nodes.container) {\r\n      for (var key of ['t-response', 't-challenge']) {\r\n        response[key] = $(`[name='${key}']`, this.nodes.container).value;\r\n      }\r\n    }\r\n    if (!response['t-response'] && !((el = $('#t-msg')) && /Verification not required/i.test(el.textContent))) {\r\n      response = null;\r\n    }\r\n    return response;\r\n  },\r\n\r\n  setUsed() {\r\n    if (!this.isEnabled) { return; }\r\n    if (this.nodes.container) {\r\n      return $.global(() => window.TCaptcha.clearChallenge());\r\n    }\r\n  },\r\n\r\n  occupied() {\r\n    return !!this.nodes.container;\r\n  }\r\n};\r\nexport default CaptchaT;\r\n",null,"import { Conf, d, g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { dict, HOUR } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * DS206: Consider reworking classes to avoid initClass\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nexport default class DataBoard {\r\n  static initClass() {\r\n    this.keys = ['hiddenThreads', 'hiddenPosts', 'lastReadPosts', 'yourPosts', 'watchedThreads', 'watcherLastModified', 'customTitles'];\r\n\r\n    this.changes = [];\r\n  }\r\n\r\n  constructor(key, sync, dontClean) {\r\n    this.onSync = this.onSync.bind(this);\r\n    this.key = key;\r\n    this.initData(Conf[this.key]);\r\n    $.sync(this.key, this.onSync);\r\n    if (!dontClean) { this.clean(); }\r\n    if (!sync) { return; }\r\n    // Chrome also fires the onChanged callback on the current tab,\r\n    // so we only start syncing when we're ready.\r\n    var init = () => {\r\n      $.off(d, '4chanXInitFinished', init);\r\n      return this.sync = sync;\r\n    };\r\n    $.on(d, '4chanXInitFinished', init);\r\n  }\r\n\r\n  initData(data) {\r\n    let boards;\r\n    this.data = data;\r\n    if (this.data.boards) {\r\n      let lastChecked;\r\n      ({boards, lastChecked} = this.data);\r\n      this.data['4chan.org'] = {boards, lastChecked};\r\n      delete this.data.boards;\r\n      delete this.data.lastChecked;\r\n    }\r\n    return this.data[g.SITE.ID] || (this.data[g.SITE.ID] = { boards: dict() });\r\n  }\r\n\r\n  save(change, cb) {\r\n    change();\r\n    DataBoard.changes.push(change);\r\n    return $.get(this.key, { boards: dict() }, items => {\r\n      if (!DataBoard.changes.length) { return; }\r\n      const needSync = ((items[this.key].version || 0) > (this.data.version || 0));\r\n      if (needSync) {\r\n        this.initData(items[this.key]);\r\n        for (change of DataBoard.changes) { change(); }\r\n      }\r\n      DataBoard.changes = [];\r\n      this.data.version = (this.data.version || 0) + 1;\r\n      return $.set(this.key, this.data, () => {\r\n        if (needSync) { this.sync?.(); }\r\n        return cb?.();\r\n      });\r\n    });\r\n  }\r\n\r\n  forceSync(cb) {\r\n    return $.get(this.key, { boards: dict() }, items => {\r\n      if ((items[this.key].version || 0) > (this.data.version || 0)) {\r\n        this.initData(items[this.key]);\r\n        for (var change of DataBoard.changes) { change(); }\r\n        this.sync?.();\r\n      }\r\n      return cb?.();\r\n    });\r\n  }\r\n\r\n  delete({siteID, boardID, threadID, postID}, cb) {\r\n    if (!siteID) { siteID = g.SITE.ID; }\r\n    if (!this.data[siteID]) { return; }\r\n    return this.save(() => {\r\n      if (postID) {\r\n        if (!this.data[siteID].boards[boardID]?.[threadID]) { return; }\r\n        delete this.data[siteID].boards[boardID][threadID][postID];\r\n        return this.deleteIfEmpty({siteID, boardID, threadID});\r\n      } else if (threadID) {\r\n        if (!this.data[siteID].boards[boardID]) { return; }\r\n        delete this.data[siteID].boards[boardID][threadID];\r\n        return this.deleteIfEmpty({siteID, boardID});\r\n      } else {\r\n        return delete this.data[siteID].boards[boardID];\r\n      }\r\n    }\r\n    , cb);\r\n  }\r\n\r\n  deleteIfEmpty({siteID, boardID, threadID}) {\r\n    if (!this.data[siteID]) { return; }\r\n    if (threadID) {\r\n      if (!Object.keys(this.data[siteID].boards[boardID][threadID]).length) {\r\n        delete this.data[siteID].boards[boardID][threadID];\r\n        return this.deleteIfEmpty({siteID, boardID});\r\n      }\r\n    } else if (!Object.keys(this.data[siteID].boards[boardID]).length) {\r\n      return delete this.data[siteID].boards[boardID];\r\n    }\r\n  }\r\n\r\n  set(data, cb) {\r\n    return this.save(() => {\r\n      return this.setUnsafe(data);\r\n    }\r\n    , cb);\r\n  }\r\n\r\n  setUnsafe({siteID, boardID, threadID, postID, val}) {\r\n    if (!siteID) { siteID = g.SITE.ID; }\r\n    if (!this.data[siteID]) { this.data[siteID] = { boards: dict() }; }\r\n    if (postID !== undefined) {\r\n      let base;\r\n      return (((base = this.data[siteID].boards[boardID] || (this.data[siteID].boards[boardID] = dict())))[threadID] || (base[threadID] = dict()))[postID] = val;\r\n    } else if (threadID !== undefined) {\r\n      return (this.data[siteID].boards[boardID] || (this.data[siteID].boards[boardID] = dict()))[threadID] = val;\r\n    } else {\r\n      return this.data[siteID].boards[boardID] = val;\r\n    }\r\n  }\r\n\r\n  extend({siteID, boardID, threadID, postID, val}, cb) {\r\n    return this.save(() => {\r\n      const oldVal = this.get({ siteID, boardID, threadID, postID, defaultValue: dict() });\r\n      for (var key in val) {\r\n        var subVal = val[key];\r\n        if (typeof subVal === 'undefined') {\r\n          delete oldVal[key];\r\n        } else {\r\n          oldVal[key] = subVal;\r\n        }\r\n      }\r\n      return this.setUnsafe({siteID, boardID, threadID, postID, val: oldVal});\r\n    }\r\n    , cb);\r\n  }\r\n\r\n  setLastChecked(key='lastChecked') {\r\n    return this.save(() => {\r\n      return this.data[key] = Date.now();\r\n    });\r\n  }\r\n\r\n  get({siteID, boardID, threadID, postID, defaultValue}) {\r\n    let board, val;\r\n    if (!siteID) { siteID = g.SITE.ID; }\r\n    if (board = this.data[siteID]?.boards[boardID]) {\r\n      let thread;\r\n      if (threadID == null) {\r\n        if (postID != null) {\r\n          for (thread = 0; thread < board.length; thread++) {\r\n            var ID = board[thread];\r\n            if (postID in thread) {\r\n              val = thread[postID];\r\n              break;\r\n            }\r\n          }\r\n        } else {\r\n          val = board;\r\n        }\r\n      } else if (thread = board[threadID]) {\r\n        val = (postID != null) ?\r\n          thread[postID]\r\n        :\r\n          thread;\r\n      }\r\n    }\r\n    return val || defaultValue;\r\n  }\r\n\r\n  clean() {\r\n    let boardID, middle;\r\n    const siteID = g.SITE.ID;\r\n    for (boardID in this.data[siteID].boards) {\r\n      var val = this.data[siteID].boards[boardID];\r\n      this.deleteIfEmpty({siteID, boardID});\r\n    }\r\n    const now = Date.now();\r\n    if (now - (2 * HOUR) >= ((middle = this.data[siteID].lastChecked || 0)) || middle > now) {\r\n      this.data[siteID].lastChecked = now;\r\n      for (boardID in this.data[siteID].boards) {\r\n        this.ajaxClean(boardID);\r\n      }\r\n    }\r\n  }\r\n\r\n  ajaxClean(boardID) {\r\n    const that = this;\r\n    const siteID = g.SITE.ID;\r\n    const threadsList = g.SITE.urls.threadsListJSON?.({siteID, boardID});\r\n    if (!threadsList) { return; }\r\n    return $.cache(threadsList, function() {\r\n      if (this.status !== 200) { return; }\r\n      const archiveList = g.SITE.urls.archiveListJSON?.({siteID, boardID});\r\n      if (!archiveList) { return that.ajaxCleanParse(boardID, this.response); }\r\n      const response1 = this.response;\r\n      return $.cache(archiveList, function() {\r\n        if ((this.status !== 200) && (!!g.SITE.archivedBoardsKnown || (this.status !== 404))) { return; }\r\n        return that.ajaxCleanParse(boardID, response1, this.response);\r\n      });\r\n    });\r\n  }\r\n\r\n  ajaxCleanParse(boardID, response1, response2) {\r\n    let board, ID;\r\n    const siteID = g.SITE.ID;\r\n    if (!(board = this.data[siteID].boards[boardID])) { return; }\r\n    const threads = dict();\r\n    if (response1) {\r\n      for (var page of response1) {\r\n        for (var thread of page.threads) {\r\n          ID = thread.no;\r\n          if (ID in board) { threads[ID] = board[ID]; }\r\n        }\r\n      }\r\n    }\r\n    if (response2) {\r\n      for (ID of response2) {\r\n        if (ID in board) { threads[ID] = board[ID]; }\r\n      }\r\n    }\r\n    this.data[siteID].boards[boardID] = threads;\r\n    this.deleteIfEmpty({siteID, boardID});\r\n    return $.set(this.key, this.data);\r\n  }\r\n\r\n  onSync(data) {\r\n    if ((data.version || 0) <= (this.data.version || 0)) { return; }\r\n    this.initData(data);\r\n    return this.sync?.();\r\n  }\r\n}\r\nDataBoard.initClass();\r\n",null,"import SimpleDict from \"./SimpleDict\";\r\nimport $ from \"../platform/$\";\r\nimport { g } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nexport default class Thread {\r\n  toString() { return this.ID; }\r\n\r\n  constructor(ID, board) {\r\n    this.board = board;\r\n    this.ID         = +ID;\r\n    this.threadID   = this.ID;\r\n    this.boardID    = this.board.ID;\r\n    this.siteID     = g.SITE.ID;\r\n    this.fullID     = `${this.board}.${this.ID}`;\r\n    this.posts      = new SimpleDict();\r\n    this.isDead     = false;\r\n    this.isHidden   = false;\r\n    this.isSticky   = false;\r\n    this.isClosed   = false;\r\n    this.isArchived = false;\r\n    this.postLimit  = false;\r\n    this.fileLimit  = false;\r\n    this.lastPost   = 0;\r\n    this.ipCount    = undefined;\r\n    this.json       = null;\r\n\r\n    this.OP = null;\r\n    this.catalogView = null;\r\n\r\n    this.nodes =\r\n      {root: null};\r\n\r\n    this.board.threads.push(this.ID, this);\r\n    g.threads.push(this.fullID, this);\r\n  }\r\n\r\n  setPage(pageNum) {\r\n    let icon;\r\n    const {info, reply} = this.OP.nodes;\r\n    if (!(icon = $('.page-num', info))) {\r\n      icon = $.el('span', {className: 'page-num'});\r\n      $.replace(reply.parentNode.previousSibling, [$.tn(' '), icon, $.tn(' ')]);\r\n    }\r\n    icon.title       = `This thread is on page ${pageNum} in the original index.`;\r\n    icon.textContent = `[${pageNum}]`;\r\n    if (this.catalogView) { return this.catalogView.nodes.pageCount.textContent = pageNum; }\r\n  }\r\n\r\n  setCount(type, count, reachedLimit) {\r\n    if (!this.catalogView) { return; }\r\n    const el = this.catalogView.nodes[`${type}Count`];\r\n    el.textContent = count;\r\n    return (reachedLimit ? $.addClass : $.rmClass)(el, 'warning');\r\n  }\r\n\r\n  setStatus(type, status) {\r\n    const name = `is${type}`;\r\n    if (this[name] === status) { return; }\r\n    this[name] = status;\r\n    if (!this.OP) { return; }\r\n    this.setIcon('Sticky',   this.isSticky);\r\n    this.setIcon('Closed',   this.isClosed && !this.isArchived);\r\n    return this.setIcon('Archived', this.isArchived);\r\n  }\r\n\r\n  setIcon(type, status) {\r\n    const typeLC = type.toLowerCase();\r\n    let icon = $(`.${typeLC}Icon`, this.OP.nodes.info);\r\n    if (!!icon === status) { return; }\r\n\r\n    if (!status) {\r\n      $.rm(icon.previousSibling);\r\n      $.rm(icon);\r\n      if (this.catalogView) { $.rm($(`.${typeLC}Icon`, this.catalogView.nodes.icons)); }\r\n      return;\r\n    }\r\n    icon = $.el('img', {\r\n      src: `${g.SITE.Build.staticPath}${typeLC}${g.SITE.Build.gifIcon}`,\r\n      alt:   type,\r\n      title: type,\r\n      className: `${typeLC}Icon retina`\r\n    }\r\n    );\r\n    if (g.BOARD.ID === 'f') {\r\n      icon.style.cssText = 'height: 18px; width: 18px;';\r\n    }\r\n\r\n    const root = (type !== 'Sticky') && this.isSticky ?\r\n      $('.stickyIcon', this.OP.nodes.info)\r\n    :\r\n      $('.page-num', this.OP.nodes.info) || this.OP.nodes.quote;\r\n    $.after(root, [$.tn(' '), icon]);\r\n\r\n    if (!this.catalogView) { return; }\r\n    return ((type === 'Sticky') && this.isClosed ? $.prepend : $.add)(this.catalogView.nodes.icons, icon.cloneNode());\r\n  }\r\n\r\n  kill() {\r\n    return this.isDead = true;\r\n  }\r\n\r\n  collect() {\r\n    let n = 0;\r\n    this.posts.forEach(function(post) {\r\n      if (post.clones.length) {\r\n        return n++;\r\n      } else {\r\n        return post.collect();\r\n      }\r\n    });\r\n    if (!n) {\r\n      g.threads.rm(this.fullID);\r\n      return this.board.threads.rm(this);\r\n    }\r\n  }\r\n}\r\n","import $ from \"../platform/$\";\r\n\r\nexport default class CatalogThread {\r\n  toString() { return this.ID; }\r\n\r\n  constructor(root, thread) {\r\n    this.thread = thread;\r\n    this.ID    = this.thread.ID;\r\n    this.board = this.thread.board;\r\n    const {post} = this.thread.OP.nodes;\r\n    this.nodes = {\r\n      root,\r\n      thumb:     $('.catalog-thumb', post),\r\n      icons:     $('.catalog-icons', post),\r\n      postCount: $('.post-count',    post),\r\n      fileCount: $('.file-count',    post),\r\n      pageCount: $('.page-count',    post),\r\n      replies:   null\r\n    };\r\n    this.thread.catalogView = this;\r\n  }\r\n}\r\n","import { Conf, d, doc } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport Header from \"./Header\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS206: Consider reworking classes to avoid initClass\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst dialog = function(id, properties) {\r\n  const el = $.el('div', {\r\n    className: 'dialog',\r\n    id\r\n  }\r\n  );\r\n  $.extend(el, properties);\r\n  el.style.cssText = Conf[`${id}.position`];\r\n\r\n  const move = $('.move', el);\r\n  $.on(move, 'touchstart mousedown', dragstart);\r\n  for (var child of move.children) {\r\n    if (!child.tagName) { continue; }\r\n    $.on(child, 'touchstart mousedown', e => e.stopPropagation());\r\n  }\r\n\r\n  return el;\r\n};\r\n\r\nvar Menu = (function() {\r\n  let currentMenu = undefined;\r\n  let lastToggledButton = undefined;\r\n  Menu = class Menu {\r\n    static initClass() {\r\n      currentMenu       = null;\r\n      lastToggledButton = null;\r\n    }\r\n\r\n    constructor(type) {\r\n      // XXX AddMenuEntry event is deprecated\r\n      this.setPosition = this.setPosition.bind(this);\r\n      this.close = this.close.bind(this);\r\n      this.keybinds = this.keybinds.bind(this);\r\n      this.onFocus = this.onFocus.bind(this);\r\n      this.addEntry = this.addEntry.bind(this);\r\n      this.type = type;\r\n      $.on(d, 'AddMenuEntry', ({detail}) => {\r\n        if (detail.type !== this.type) { return; }\r\n        delete detail.open;\r\n        return this.addEntry(detail);\r\n      });\r\n      this.entries = [];\r\n    }\r\n\r\n    makeMenu() {\r\n      const menu = $.el('div', {\r\n        className: 'dialog',\r\n        id:        'menu',\r\n        tabIndex:  0\r\n      }\r\n      );\r\n      menu.dataset.type = this.type;\r\n      $.on(menu, 'click', e => e.stopPropagation());\r\n      $.on(menu, 'keydown', this.keybinds);\r\n      return menu;\r\n    }\r\n\r\n    toggle(e, button, data) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      if (currentMenu) {\r\n        // Close if it's already opened.\r\n        // Reopen if we clicked on another button.\r\n        const previousButton = lastToggledButton;\r\n        currentMenu.close();\r\n        if (previousButton === button) { return; }\r\n      }\r\n\r\n      if (!this.entries.length) { return; }\r\n      return this.open(button, data);\r\n    }\r\n\r\n    open(button, data) {\r\n      let entry;\r\n      const menu = (this.menu = this.makeMenu());\r\n      currentMenu       = this;\r\n      lastToggledButton = button;\r\n\r\n      this.entries.sort((first, second) => first.order - second.order);\r\n\r\n      for (entry of this.entries) {\r\n        this.insertEntry(entry, menu, data);\r\n      }\r\n\r\n      $.addClass(lastToggledButton, 'active');\r\n\r\n      $.on(d, 'click CloseMenu', this.close);\r\n      $.on(d, 'scroll', this.setPosition);\r\n      $.on(window, 'resize', this.setPosition);\r\n      $.after(button, menu);\r\n\r\n      this.setPosition();\r\n\r\n      entry = $('.entry', menu);\r\n      // We've removed flexbox, so we don't use order anymore.\r\n      // while prevEntry = @findNextEntry entry, -1\r\n      //   entry = prevEntry\r\n      this.focus(entry);\r\n\r\n      return menu.focus();\r\n    }\r\n\r\n    setPosition() {\r\n      const mRect   = this.menu.getBoundingClientRect();\r\n      const bRect   = lastToggledButton.getBoundingClientRect();\r\n      const bTop    = window.scrollY + bRect.top;\r\n      const bLeft   = window.scrollX + bRect.left;\r\n      const cHeight = doc.clientHeight;\r\n      const cWidth  = doc.clientWidth;\r\n      const [top, bottom] = Array.from((bRect.top + bRect.height + mRect.height) < cHeight ?\r\n        [`${bRect.bottom}px`, '']\r\n      :\r\n        ['', `${cHeight - bRect.top}px`]);\r\n      const [left, right] = Array.from((bRect.left + mRect.width) < cWidth ?\r\n        [`${bRect.left}px`, '']\r\n      :\r\n        ['', `${cWidth - bRect.right}px`]);\r\n      $.extend(this.menu.style, {top, right, bottom, left});\r\n      return this.menu.classList.toggle('left', right);\r\n    }\r\n\r\n    insertEntry(entry, parent, data) {\r\n      let submenu;\r\n      if (typeof entry.open === 'function') {\r\n        try {\r\n          if (!entry.open(data)) { return; }\r\n        } catch (err) {\r\n          Main.handleErrors({\r\n            message: `Error in building the ${this.type} menu.`,\r\n            error: err\r\n          });\r\n          return;\r\n        }\r\n      }\r\n      $.add(parent, entry.el);\r\n\r\n      if (!entry.subEntries) { return; }\r\n      if (submenu = $('.submenu', entry.el)) {\r\n        // Reset sub menu, remove irrelevant entries.\r\n        $.rm(submenu);\r\n      }\r\n      submenu = $.el('div',\r\n        {className: 'dialog submenu'});\r\n      for (var subEntry of entry.subEntries) {\r\n        this.insertEntry(subEntry, submenu, data);\r\n      }\r\n      $.add(entry.el, submenu);\r\n    }\r\n\r\n    close() {\r\n      $.rm(this.menu);\r\n      delete this.menu;\r\n      $.rmClass(lastToggledButton, 'active');\r\n      currentMenu       = null;\r\n      lastToggledButton = null;\r\n      $.off(d, 'click scroll CloseMenu', this.close);\r\n      $.off(d, 'scroll', this.setPosition);\r\n      return $.off(window, 'resize', this.setPosition);\r\n    }\r\n\r\n    findNextEntry(entry, direction) {\r\n      const entries = [...Array.from(entry.parentNode.children)];\r\n      entries.sort((first, second) => first.style.order - second.style.order);\r\n      return entries[entries.indexOf(entry) + direction];\r\n    }\r\n\r\n    keybinds(e) {\r\n      let subEntry;\r\n      let next, submenu;\r\n      let entry = $('.focused', this.menu);\r\n      while ((subEntry = $('.focused', entry))) {\r\n        entry = subEntry;\r\n      }\r\n\r\n      switch (e.keyCode) {\r\n        case 27: // Esc\r\n          lastToggledButton.focus();\r\n          this.close();\r\n          break;\r\n        case 13: case 32: // Enter, Space\r\n          entry.click();\r\n          break;\r\n        case 38: // Up\r\n          if (next = this.findNextEntry(entry, -1)) {\r\n            this.focus(next);\r\n          }\r\n          break;\r\n        case 40: // Down\r\n          if (next = this.findNextEntry(entry, +1)) {\r\n            this.focus(next);\r\n          }\r\n          break;\r\n        case 39: // Right\r\n          if ((submenu = $('.submenu', entry)) && (next = submenu.firstElementChild)) {\r\n            let nextPrev;\r\n            while ((nextPrev = this.findNextEntry(next, -1))) {\r\n              next = nextPrev;\r\n            }\r\n            this.focus(next);\r\n          }\r\n          break;\r\n        case 37: // Left\r\n          if (next = $.x('parent::*[contains(@class,\"submenu\")]/parent::*', entry)) {\r\n            this.focus(next);\r\n          }\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n\r\n      e.preventDefault();\r\n      return e.stopPropagation();\r\n    }\r\n\r\n    onFocus(e) {\r\n      e.stopPropagation();\r\n      return this.focus(e.target);\r\n    }\r\n\r\n    focus(entry) {\r\n      let focused, submenu;\r\n      while ((focused = $.x('parent::*/child::*[contains(@class,\"focused\")]', entry))) {\r\n        $.rmClass(focused, 'focused');\r\n      }\r\n      for (focused of $$('.focused', entry)) {\r\n        $.rmClass(focused, 'focused');\r\n      }\r\n      $.addClass(entry, 'focused');\r\n\r\n      // Submenu positioning.\r\n      if (!(submenu = $('.submenu', entry))) { return; }\r\n      const sRect   = submenu.getBoundingClientRect();\r\n      const eRect   = entry.getBoundingClientRect();\r\n      const cHeight = doc.clientHeight;\r\n      const cWidth  = doc.clientWidth;\r\n      const [top, bottom] = Array.from((eRect.top + sRect.height) < cHeight ?\r\n        ['0px', 'auto']\r\n      :\r\n        ['auto', '0px']);\r\n      const [left, right] = Array.from((eRect.right + sRect.width) < (cWidth - 150) ?\r\n        ['100%', 'auto']\r\n      :\r\n        ['auto', '100%']);\r\n      const {style} = submenu;\r\n      style.top    = top;\r\n      style.bottom = bottom;\r\n      style.left   = left;\r\n      return style.right  = right;\r\n    }\r\n\r\n    addEntry(entry) {\r\n      this.parseEntry(entry);\r\n      return this.entries.push(entry);\r\n    }\r\n\r\n    parseEntry(entry) {\r\n      const {el, subEntries} = entry;\r\n      $.addClass(el, 'entry');\r\n      $.on(el, 'focus mouseover', this.onFocus);\r\n      el.style.order = entry.order || 100;\r\n      if (!subEntries) { return; }\r\n      $.addClass(el, 'has-submenu');\r\n      for (var subEntry of subEntries) {\r\n        this.parseEntry(subEntry);\r\n      }\r\n    }\r\n  };\r\n  Menu.initClass();\r\n  return Menu;\r\n})();\r\n\r\nexport var dragstart = function (e) {\r\n  let isTouching;\r\n  if ((e.type === 'mousedown') && (e.button !== 0)) { return; } // not LMB\r\n  // prevent text selection\r\n  e.preventDefault();\r\n  if (isTouching = e.type === 'touchstart') {\r\n    e = e.changedTouches[e.changedTouches.length - 1];\r\n  }\r\n  // distance from pointer to el edge is constant; calculate it here.\r\n  const el = $.x('ancestor::div[contains(@class,\"dialog\")][1]', this);\r\n  const rect = el.getBoundingClientRect();\r\n  const screenHeight = doc.clientHeight;\r\n  const screenWidth  = doc.clientWidth;\r\n  const o = {\r\n    id:     el.id,\r\n    style:  el.style,\r\n    dx:     e.clientX - rect.left,\r\n    dy:     e.clientY - rect.top,\r\n    height: screenHeight - rect.height,\r\n    width:  screenWidth  - rect.width,\r\n    screenHeight,\r\n    screenWidth,\r\n    isTouching\r\n  };\r\n\r\n  [o.topBorder, o.bottomBorder] = Array.from(Conf['Header auto-hide'] || !Conf['Fixed Header'] ?\r\n    [0, 0]\r\n  : Conf['Bottom Header'] ?\r\n    [0, Header.bar.getBoundingClientRect().height]\r\n  :\r\n    [Header.bar.getBoundingClientRect().height, 0]);\r\n\r\n  if (isTouching) {\r\n    o.identifier = e.identifier;\r\n    o.move = touchmove.bind(o);\r\n    o.up   = touchend.bind(o);\r\n    $.on(d, 'touchmove', o.move);\r\n    return $.on(d, 'touchend touchcancel', o.up);\r\n  } else { // mousedown\r\n    o.move = drag.bind(o);\r\n    o.up   = dragend.bind(o);\r\n    $.on(d, 'mousemove', o.move);\r\n    return $.on(d, 'mouseup',   o.up);\r\n  }\r\n};\r\n\r\nexport var touchmove = function (e) {\r\n  for (var touch of e.changedTouches) {\r\n    if (touch.identifier === this.identifier) {\r\n      drag.call(this, touch);\r\n      return;\r\n    }\r\n  }\r\n};\r\n\r\nexport var drag = function (e) {\r\n  const {clientX, clientY} = e;\r\n\r\n  let left = clientX - this.dx;\r\n  left = left < 10 ?\r\n    0\r\n  : (this.width - left) < 10 ?\r\n    ''\r\n  :\r\n    ((left / this.screenWidth) * 100) + '%';\r\n\r\n  let top = clientY - this.dy;\r\n  top = top < (10 + this.topBorder) ?\r\n    this.topBorder + 'px'\r\n  : (this.height - top) < (10 + this.bottomBorder) ?\r\n    ''\r\n  :\r\n    ((top / this.screenHeight) * 100) + '%';\r\n\r\n  const right = left === '' ?\r\n    0\r\n  :\r\n    '';\r\n\r\n  const bottom = top === '' ?\r\n    this.bottomBorder + 'px'\r\n  :\r\n    '';\r\n\r\n  const {style} = this;\r\n  style.left   = left;\r\n  style.right  = right;\r\n  style.top    = top;\r\n  return style.bottom = bottom;\r\n};\r\n\r\nexport var touchend = function (e) {\r\n  for (var touch of e.changedTouches) {\r\n    if (touch.identifier === this.identifier) {\r\n      dragend.call(this);\r\n      return;\r\n    }\r\n  }\r\n};\r\n\r\nexport var dragend = function () {\r\n  if (this.isTouching) {\r\n    $.off(d, 'touchmove', this.move);\r\n    $.off(d, 'touchend touchcancel', this.up);\r\n  } else { // mouseup\r\n    $.off(d, 'mousemove', this.move);\r\n    $.off(d, 'mouseup',   this.up);\r\n  }\r\n  return $.set(`${this.id}.position`, this.style.cssText);\r\n};\r\n\r\nconst hoverstart = function ({ root, el, latestEvent, endEvents, height, width, cb, noRemove }) {\r\n  const rect = root.getBoundingClientRect();\r\n  const o = {\r\n    root,\r\n    el,\r\n    style: el.style,\r\n    isImage: ['IMG', 'VIDEO'].includes(el.nodeName),\r\n    cb,\r\n    endEvents,\r\n    latestEvent,\r\n    clientHeight: doc.clientHeight,\r\n    clientWidth:  doc.clientWidth,\r\n    height,\r\n    width,\r\n    noRemove,\r\n    clientX: (rect.left + rect.right) / 2,\r\n    clientY: (rect.top + rect.bottom) / 2\r\n  };\r\n  o.hover    = hover.bind(o);\r\n  o.hoverend = hoverend.bind(o);\r\n\r\n  o.hover(o.latestEvent);\r\n  new MutationObserver(function() {\r\n    if (el.parentNode) { return o.hover(o.latestEvent); }\r\n  }).observe(el, {childList: true});\r\n\r\n  $.on(root, endEvents,   o.hoverend);\r\n  if ($.x('ancestor::div[contains(@class,\"inline\")][1]', root)) {\r\n    $.on(d,    'keydown',   o.hoverend);\r\n  }\r\n  $.on(root, 'mousemove', o.hover);\r\n\r\n  // Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=674955\r\n  o.workaround = function(e) { if (!root.contains(e.target)) { return o.hoverend(e); } };\r\n  return $.on(doc,  'mousemove', o.workaround);\r\n};\r\n\r\nhoverstart.padding = 25;\r\n\r\nexport var hover = function (e) {\r\n  this.latestEvent = e;\r\n  const height = (this.height || this.el.offsetHeight) + hoverstart.padding;\r\n  const width  = (this.width  || this.el.offsetWidth);\r\n  const {clientX, clientY} = Conf['Follow Cursor'] ? e : this;\r\n\r\n  const top = this.isImage ?\r\n    Math.max(0, (clientY * (this.clientHeight - height)) / this.clientHeight)\r\n  :\r\n    Math.max(0, Math.min(this.clientHeight - height, clientY - 120));\r\n\r\n  let threshold = this.clientWidth / 2;\r\n  if (!this.isImage) { threshold = Math.max(threshold, this.clientWidth - 400); }\r\n  let marginX = (clientX <= threshold ? clientX : this.clientWidth - clientX) + 45;\r\n  if (this.isImage) { marginX = Math.min(marginX, this.clientWidth - width); }\r\n  marginX += 'px';\r\n  const [left, right] = Array.from(clientX <= threshold ? [marginX, ''] : ['', marginX]);\r\n\r\n  const {style} = this;\r\n  style.top   = top + 'px';\r\n  style.left  = left;\r\n  return style.right = right;\r\n};\r\n\r\nexport var hoverend = function (e) {\r\n  if (((e.type === 'keydown') && (e.keyCode !== 13)) || (e.target.nodeName === \"TEXTAREA\")) { return; }\r\n  if (!this.noRemove) { $.rm(this.el); }\r\n  $.off(this.root, this.endEvents,  this.hoverend);\r\n  $.off(d,     'keydown',   this.hoverend);\r\n  $.off(this.root, 'mousemove', this.hover);\r\n  // Workaround for https://bugzilla.mozilla.org/show_bug.cgi?id=674955\r\n  $.off(doc,   'mousemove', this.workaround);\r\n  if (this.cb) { return this.cb.call(this); }\r\n};\r\n\r\nexport const checkbox = function (name, text, checked) {\r\n  if (checked == null) { checked = Conf[name]; }\r\n  const label = $.el('label');\r\n  const input = $.el('input', {type: 'checkbox', name, checked});\r\n  $.add(label, [input, $.tn(` ${text}`)]);\r\n  return label;\r\n};\r\n\r\nconst UI = {\r\n  dialog,\r\n  Menu,\r\n  hover:    hoverstart,\r\n  checkbox\r\n};\r\nexport default UI;\r\n","import Get from \"../General/Get\";\r\nimport Header from \"../General/Header\";\r\nimport { g, Conf, d, doc } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Nav = {\r\n  init() {\r\n    switch (g.VIEW) {\r\n      case 'index':\r\n        if (!Conf['Index Navigation']) { return; }\r\n        break;\r\n      case 'thread':\r\n        if (!Conf['Reply Navigation']) { return; }\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n\r\n    const span = $.el('span',\r\n      {id: 'navlinks'});\r\n    const prev = $.el('a', {\r\n      textContent: '',\r\n      href: 'javascript:;'\r\n    }\r\n    );\r\n    const next = $.el('a', {\r\n      textContent: '',\r\n      href: 'javascript:;'\r\n    }\r\n    );\r\n\r\n    $.on(prev, 'click', this.prev);\r\n    $.on(next, 'click', this.next);\r\n\r\n    $.add(span, [prev, $.tn(' '), next]);\r\n    var append = function() {\r\n      $.off(d, '4chanXInitFinished', append);\r\n      return $.add(d.body, span);\r\n    };\r\n    return $.on(d, '4chanXInitFinished', append);\r\n  },\r\n\r\n  prev() {\r\n    if (g.VIEW === 'thread') {\r\n      return window.scrollTo(0, 0);\r\n    } else {\r\n      return Nav.scroll(-1);\r\n    }\r\n  },\r\n\r\n  next() {\r\n    if (g.VIEW === 'thread') {\r\n      return window.scrollTo(0, d.body.scrollHeight);\r\n    } else {\r\n      return Nav.scroll(+1);\r\n    }\r\n  },\r\n\r\n  getThread() {\r\n    if (g.VIEW === 'thread') { return g.threads.get(`${g.BOARD}.${g.THREADID}`).nodes.root; }\r\n    if ($.hasClass(doc, 'catalog-mode')) { return; }\r\n    for (var threadRoot of $$(g.SITE.selectors.thread)) {\r\n      var thread = Get.threadFromRoot(threadRoot);\r\n      if (thread.isHidden && !thread.stub) { continue; }\r\n      if (Header.getTopOf(threadRoot) >= -threadRoot.getBoundingClientRect().height) { // not scrolled past\r\n        return threadRoot;\r\n      }\r\n    }\r\n  },\r\n\r\n  scroll(delta) {\r\n    let next;\r\n    d.activeElement?.blur();\r\n    let thread = Nav.getThread();\r\n    if (!thread) { return; }\r\n    const axis = delta === +1 ?\r\n      'following'\r\n    :\r\n      'preceding';\r\n    if (next = $.x(`${axis}-sibling::${g.SITE.xpath.thread}[not(@hidden)][1]`, thread)) {\r\n      // Unless we're not at the beginning of the current thread,\r\n      // and thus wanting to move to beginning,\r\n      // or we're above the first thread and don't want to skip it.\r\n      const top = Header.getTopOf(thread);\r\n      if (((delta === +1) && (top < 5)) || ((delta === -1) && (top > -5))) { thread = next; }\r\n    }\r\n    // Add extra space to the end of the page if necessary so that all threads can be selected by keybinds.\r\n    const extra = (Header.getTopOf(thread) + doc.clientHeight) - d.body.getBoundingClientRect().bottom;\r\n    if (extra > 0) { d.body.style.marginBottom = `${extra}px`; }\r\n\r\n    Header.scrollTo(thread);\r\n\r\n    if ((extra > 0) && !Nav.haveExtra) {\r\n      Nav.haveExtra = true;\r\n      return $.on(d, 'scroll', Nav.removeExtra);\r\n    }\r\n  },\r\n\r\n  removeExtra() {\r\n    const extra = doc.clientHeight - d.body.getBoundingClientRect().bottom;\r\n    if (extra > 0) {\r\n      return d.body.style.marginBottom = `${extra}px`;\r\n    } else {\r\n      d.body.style.marginBottom = '';\r\n      delete Nav.haveExtra;\r\n      return $.off(d, 'scroll', Nav.removeExtra);\r\n    }\r\n  }\r\n};\r\nexport default Nav;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { Conf, g } from \"../globals/globals\";\r\nimport $$ from \"../platform/$$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ImageHost = {\r\n  init() {\r\n    if ((!(this.useFaster = /\\S/.test(Conf['fourchanImageHost']))) || (g.SITE.software !== 'yotsuba') || !['index', 'thread'].includes(g.VIEW)) { return; }\r\n    return Callbacks.Post.push({\r\n      name: 'Image Host Rewriting',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  suggestions: ['i.4cdn.org', 'is2.4chan.org'],\r\n\r\n  host() {\r\n    return Conf['fourchanImageHost'].trim() || 'i.4cdn.org';\r\n  },\r\n  flashHost() {\r\n    return 'i.4cdn.org';\r\n  },\r\n  thumbHost() {\r\n    return 'i.4cdn.org';\r\n  },\r\n  test(hostname) {\r\n    return (hostname === 'i.4cdn.org') || ImageHost.regex.test(hostname);\r\n  },\r\n\r\n  regex: /^is\\d*\\.4chan(?:nel)?\\.org$/,\r\n\r\n  node() {\r\n    if (this.isClone) { return; }\r\n    const host = ImageHost.host();\r\n    if (this.file && ImageHost.test(this.file.url.split('/')[2]) && !/\\.swf$/.test(this.file.url)) {\r\n      this.file.link.hostname = host;\r\n      if (this.file.thumbLink) { this.file.thumbLink.hostname = host; }\r\n      this.file.url = this.file.link.href;\r\n    }\r\n    return ImageHost.fixLinks($$('a', this.nodes.comment));\r\n  },\r\n\r\n  fixLinks(links) {\r\n    for (var link of links) {\r\n      if (ImageHost.test(link.hostname) && !/\\.swf$/.test(link.pathname)) {\r\n        var host = ImageHost.host();\r\n        if (link.hostname !== host) { link.hostname = host; }\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default ImageHost;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Config from \"../config/Config\";\r\nimport Header from \"../General/Header\";\r\nimport UI from \"../General/UI\";\r\nimport { g, Conf, E } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Volume = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) ||\r\n      (!Conf['Image Expansion'] && !Conf['Image Hover'] && !Conf['Image Hover in Catalog'] && !Conf['Gallery'])) { return; }\r\n\r\n    $.sync('Allow Sound', function(x) {\r\n      Conf['Allow Sound'] = x;\r\n      if (Volume.inputs) Volume.inputs.unmute.checked = x;\r\n    });\r\n\r\n    $.sync('Default Volume', function(x) {\r\n      Conf['Default Volume'] = x;\r\n      if (Volume.inputs) Volume.inputs.volume.value = x;\r\n    });\r\n\r\n    if (Conf['Mouse Wheel Volume']) {\r\n      Callbacks.Post.push({\r\n        name: 'Mouse Wheel Volume',\r\n        cb:   this.node\r\n      });\r\n    }\r\n\r\n    if (g.SITE.noAudio?.(g.BOARD)) { return; }\r\n\r\n    if (Conf['Mouse Wheel Volume']) {\r\n      Callbacks.CatalogThread.push({\r\n        name: 'Mouse Wheel Volume',\r\n        cb:   this.catalogNode\r\n      });\r\n    }\r\n\r\n    const unmuteEntry = UI.checkbox('Allow Sound', 'Allow Sound');\r\n    unmuteEntry.title = Config.main['Images and Videos']['Allow Sound'][1];\r\n\r\n    const volumeEntry = $.el('label',\r\n      {title: 'Default volume for videos.'});\r\n    $.extend(volumeEntry,\r\n      {innerHTML: \"<input name=\\\"Default Volume\\\" type=\\\"range\\\" min=\\\"0\\\" max=\\\"1\\\" step=\\\"0.01\\\" value=\\\"\" + E(Conf[\"Default Volume\"]) + \"\\\"> Volume\"});\r\n\r\n    this.inputs = {\r\n      unmute: unmuteEntry.firstElementChild,\r\n      volume: volumeEntry.firstElementChild\r\n    };\r\n\r\n    $.on(this.inputs.unmute, 'change', $.cb.checked);\r\n    $.on(this.inputs.volume, 'change', $.cb.value);\r\n\r\n    Header.menu.addEntry({el: unmuteEntry, order: 200});\r\n    return Header.menu.addEntry({el: volumeEntry, order: 201});\r\n  },\r\n\r\n  setup(video) {\r\n    video.muted  = !Conf['Allow Sound'];\r\n    video.volume = Conf['Default Volume'];\r\n    return $.on(video, 'volumechange', Volume.change);\r\n  },\r\n\r\n  change() {\r\n    const {muted, volume} = this;\r\n    const items = {\r\n      'Allow Sound': !muted,\r\n      'Default Volume': volume\r\n    };\r\n    for (var key in items) {\r\n      var val = items[key];\r\n      if (Conf[key] === val) {\r\n        delete items[key];\r\n      }\r\n    }\r\n    $.set(items);\r\n    $.extend(Conf, items);\r\n    if (Volume.inputs) {\r\n      Volume.inputs.unmute.checked = !muted;\r\n      return Volume.inputs.volume.value = volume;\r\n    }\r\n  },\r\n\r\n  node() {\r\n    if (g.SITE.noAudio?.(this.board)) { return; }\r\n    for (var file of this.files) {\r\n      if (file.isVideo) {\r\n        if (file.thumb) { $.on(file.thumb,                                'wheel', Volume.wheel.bind(Header.hover)); }\r\n        $.on(($('.file-info', file.text) || file.link), 'wheel', Volume.wheel.bind(file.thumbLink));\r\n      }\r\n    }\r\n  },\r\n\r\n  catalogNode() {\r\n    const file = this.thread.OP.files[0];\r\n    if (!file?.isVideo) { return; }\r\n    return $.on(this.nodes.thumb, 'wheel', Volume.wheel.bind(Header.hover));\r\n  },\r\n\r\n  wheel(e) {\r\n    let el;\r\n    if (e.shiftKey || e.altKey || e.ctrlKey || e.metaKey) { return; }\r\n    if (!(el = $('video:not([data-md5])', this))) { return; }\r\n    if (el.muted || !$.hasAudio(el)) { return; }\r\n    let volume = el.volume + 0.1;\r\n    if (e.deltaY < 0) { volume *= 1.1; }\r\n    if (e.deltaY > 0) { volume /= 1.1; }\r\n    el.volume = $.minmax(volume - 0.1, 0, 1);\r\n    return e.preventDefault();\r\n  }\r\n};\r\nexport default Volume;\r\n","import Redirect from \"../Archive/Redirect\";\r\nimport Notice from \"../classes/Notice\";\r\nimport { g, Conf, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport CrossOrigin from \"../platform/CrossOrigin\";\r\nimport ImageHost from \"./ImageHost\";\r\nimport Volume from \"./Volume\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * DS204: Change includes calls to have a more natural evaluation order\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ImageCommon = {\r\n  // Pause and mute video in preparation for removing the element from the document.\r\n  pause(video) {\r\n    if (video.nodeName !== 'VIDEO') { return; }\r\n    video.pause();\r\n    $.off(video, 'volumechange', Volume.change);\r\n    return video.muted = true;\r\n  },\r\n\r\n  rewind(el) {\r\n    if (el.nodeName === 'VIDEO') {\r\n      if (el.readyState >= el.HAVE_METADATA) { return el.currentTime = 0; }\r\n    } else if (/\\.gif$/.test(el.src)) {\r\n      return $.queueTask(() => el.src = el.src);\r\n    }\r\n  },\r\n\r\n  pushCache(el) {\r\n    ImageCommon.cache = el;\r\n    return $.on(el, 'error', ImageCommon.cacheError);\r\n  },\r\n\r\n  popCache() {\r\n    const el = ImageCommon.cache;\r\n    $.off(el, 'error', ImageCommon.cacheError);\r\n    delete ImageCommon.cache;\r\n    return el;\r\n  },\r\n\r\n  cacheError() {\r\n    if (ImageCommon.cache === this) { return delete ImageCommon.cache; }\r\n  },\r\n\r\n  decodeError(file, fileObj) {\r\n    let message;\r\n    if (file.error?.code !== MediaError.MEDIA_ERR_DECODE) { return false; }\r\n    if (!(message = $('.warning', fileObj.thumb.parentNode))) {\r\n      message = $.el('div', {className:   'warning'});\r\n      $.after(fileObj.thumb, message);\r\n    }\r\n    message.textContent = 'Error: Corrupt or unplayable video';\r\n    return true;\r\n  },\r\n\r\n  isFromArchive(file) {\r\n    return (g.SITE.software === 'yotsuba') && !ImageHost.test(file.src.split('/')[2]);\r\n  },\r\n\r\n  error(file, post, fileObj, delay, cb) {\r\n    let timeoutID;\r\n    const src = fileObj.url.split('/');\r\n    let url = null;\r\n    if ((g.SITE.software === 'yotsuba') && Conf['404 Redirect']) {\r\n      url = Redirect.to('file', {\r\n        boardID:  post.board.ID,\r\n        filename: src[src.length - 1]\r\n      });\r\n    }\r\n    if (!url || !Redirect.securityCheck(url)) { url = null; }\r\n\r\n    if ((post.isDead || fileObj.isDead) && !ImageCommon.isFromArchive(file)) { return cb(url); }\r\n\r\n    if (delay != null) { timeoutID = setTimeout((() => cb(url)), delay); }\r\n    if (post.isDead || fileObj.isDead) { return; }\r\n    const redirect = function() {\r\n      if (!ImageCommon.isFromArchive(file)) {\r\n        if (delay != null) { clearTimeout(timeoutID); }\r\n        return cb(url);\r\n      }\r\n    };\r\n\r\n    const threadJSON = g.SITE.urls.threadJSON?.(post);\r\n    if (!threadJSON) { return; }\r\n    var parseJSON = function(isArchiveURL) {\r\n      let needle, postObj;\r\n      if (this.status === 404) {\r\n        let archivedThreadJSON;\r\n        if (!isArchiveURL && (archivedThreadJSON = g.SITE.urls.archivedThreadJSON?.(post))) {\r\n          $.ajax(archivedThreadJSON, {onloadend() { return parseJSON.call(this, true); }});\r\n        } else {\r\n          post.kill(!post.isClone, fileObj.index);\r\n        }\r\n      }\r\n      if (this.status !== 200) { return redirect(); }\r\n      for (postObj of this.response.posts) {\r\n        if (postObj.no === post.ID) { break; }\r\n      }\r\n      if (postObj.no !== post.ID) {\r\n        post.kill();\r\n        return redirect();\r\n      } else if ((needle = fileObj.docIndex, g.SITE.Build.parseJSON(postObj, post.board).filesDeleted.includes(needle))) {\r\n        post.kill(true);\r\n        return redirect();\r\n      } else {\r\n        return url = fileObj.url;\r\n      }\r\n    };\r\n    return $.ajax(threadJSON, {onloadend() { return parseJSON.call(this); }});\r\n  },\r\n\r\n  // Add controls, but not until the mouse is moved over the video.\r\n  addControls(video) {\r\n    var handler = function() {\r\n      $.off(video, 'mouseover', handler);\r\n      // Hacky workaround for Firefox forever-loading bug for very short videos\r\n      const t = new Date().getTime();\r\n      return $.asap((() => ($.engine !== 'gecko') || ((video.readyState >= 3) && (video.currentTime <= Math.max(0.1, (video.duration - 0.5)))) || (new Date().getTime() >= (t + 1000))), () => video.controls = true);\r\n    };\r\n    return $.on(video, 'mouseover', handler);\r\n  },\r\n\r\n  // XXX Estimate whether clicks are on the video controls and should be ignored.\r\n  onControls(e) {\r\n    return (Conf['Show Controls'] && Conf['Click Passthrough'] && (e.target.nodeName === 'VIDEO')) ||\r\n      (e.target.controls && ((e.target.getBoundingClientRect().bottom - e.clientY) < 35));\r\n  },\r\n\r\n  download(e) {\r\n    if (this.protocol === 'blob:') { return true; }\r\n    e.preventDefault();\r\n    const {href, download} = this;\r\n    return CrossOrigin.file(href, function(blob) {\r\n      if (blob) {\r\n        const a = $.el('a', {\r\n          href: URL.createObjectURL(blob),\r\n          download,\r\n          hidden: true\r\n        }\r\n        );\r\n        $.add(d.body, a);\r\n        a.click();\r\n        return $.rm(a);\r\n      } else {\r\n        return new Notice('warning', `Could not download ${href}`, 20);\r\n      }\r\n    });\r\n  }\r\n};\r\nexport default ImageCommon;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Config from \"../config/Config\";\r\nimport Get from \"../General/Get\";\r\nimport Header from \"../General/Header\";\r\nimport UI from \"../General/UI\";\r\nimport { Conf, d, doc, g } from \"../globals/globals\";\r\nimport Nav from \"../Miscellaneous/Nav\";\r\nimport $ from \"../platform/$\";\r\nimport { SECOND } from \"../platform/helpers\";\r\nimport ImageCommon from \"./ImageCommon\";\r\nimport Volume from \"./Volume\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ImageExpand = {\r\n  init() {\r\n    if (!(this.enabled = Conf['Image Expansion'] && ['index', 'thread'].includes(g.VIEW))) { return; }\r\n\r\n    this.EAI = $.el('a', {\r\n      className: 'expand-all-shortcut',\r\n      textContent: '',\r\n      title: 'Expand All Images',\r\n      href: 'javascript:;'\r\n    }\r\n    );\r\n\r\n    $.on(this.EAI, 'click', this.cb.toggleAll);\r\n    Header.addShortcut('expand-all', this.EAI, 520);\r\n    $.on(d, 'scroll visibilitychange', this.cb.playVideos);\r\n    this.videoControls = $.el('span', {className: 'video-controls'});\r\n    $.extend(this.videoControls, {innerHTML: \" <a href=\\\"javascript:;\\\" title=\\\"You can also contract the video by dragging it to the left.\\\">contract</a>\"});\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Image Expansion',\r\n      cb: this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (!this.file || (!this.file.isImage && !this.file.isVideo)) { return; }\r\n    $.on(this.file.thumbLink, 'click', ImageExpand.cb.toggle);\r\n\r\n    if (this.isClone) {\r\n      if (this.file.isExpanding) {\r\n        // If we clone a post where the image is still loading,\r\n        // make it loading in the clone too.\r\n        ImageExpand.contract(this);\r\n        return ImageExpand.expand(this);\r\n\r\n      } else if (this.file.isExpanded && this.file.isVideo) {\r\n        Volume.setup(this.file.fullImage);\r\n        ImageExpand.setupVideoCB(this);\r\n        return ImageExpand.setupVideo(this, !this.origin.file.fullImage?.paused || this.origin.file.wasPlaying, this.file.fullImage.controls);\r\n      }\r\n\r\n    } else if (ImageExpand.on && !this.isHidden && !this.isFetchedQuote &&\r\n      (Conf['Expand spoilers'] || !this.file.isSpoiler) &&\r\n      (Conf['Expand videos'] || !this.file.isVideo)) {\r\n        return ImageExpand.expand(this);\r\n      }\r\n  },\r\n\r\n  cb: {\r\n    toggle(e) {\r\n      if ($.modifiedClick(e)) { return; }\r\n      const post = Get.postFromNode(this);\r\n      const {file} = post;\r\n      if (file.isExpanded && ImageCommon.onControls(e)) { return; }\r\n      e.preventDefault();\r\n      if (!Conf['Autoplay'] && file.fullImage?.paused) {\r\n        return file.fullImage.play();\r\n      } else {\r\n        return ImageExpand.toggle(post);\r\n      }\r\n    },\r\n\r\n    toggleAll() {\r\n      let func;\r\n      $.event('CloseMenu');\r\n      const threadRoot = Nav.getThread();\r\n      const toggle = function(post) {\r\n        const {file} = post;\r\n        if (!file || (!file.isImage && !file.isVideo) || !doc.contains(post.nodes.root)) { return; }\r\n        if (ImageExpand.on &&\r\n          ((!Conf['Expand spoilers']  && file.isSpoiler) ||\r\n          (!Conf['Expand videos']     && file.isVideo) ||\r\n          (Conf['Expand from here']   && (Header.getTopOf(file.thumb) < 0)) ||\r\n          (Conf['Expand thread only'] && (g.VIEW === 'index') && !threadRoot?.contains(file.thumb)))) {\r\n            return;\r\n          }\r\n        return $.queueTask(func, post);\r\n      };\r\n\r\n      if (ImageExpand.on = $.hasClass(ImageExpand.EAI, 'expand-all-shortcut')) {\r\n        ImageExpand.EAI.className   = 'contract-all-shortcut';\r\n        ImageExpand.EAI.title       = 'Contract All Images';\r\n        ImageExpand.EAI.textContent = '';\r\n        func = ImageExpand.expand;\r\n      } else {\r\n        ImageExpand.EAI.className   = 'expand-all-shortcut';\r\n        ImageExpand.EAI.title       = 'Expand All Images';\r\n        ImageExpand.EAI.textContent = '';\r\n        func = ImageExpand.contract;\r\n      }\r\n\r\n      return g.posts.forEach(function(post) {\r\n        for (post of [post, ...Array.from(post.clones)]) { toggle(post); }\r\n      });\r\n    },\r\n\r\n    playVideos() {\r\n      return g.posts.forEach(function(post) {\r\n        for (post of [post, ...Array.from(post.clones)]) {\r\n          var {file} = post;\r\n          if (!file || !file.isVideo || !file.isExpanded) { continue; }\r\n\r\n          var video = file.fullImage;\r\n          var visible = ($.hasAudio(video) && !video.muted) || Header.isNodeVisible(video);\r\n          if (visible && file.wasPlaying) {\r\n            delete file.wasPlaying;\r\n            video.play();\r\n          } else if (!visible && !video.paused) {\r\n            file.wasPlaying = true;\r\n            video.pause();\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    setFitness() {\r\n      return $[this.checked ? 'addClass' : 'rmClass'](doc, this.name.toLowerCase().replace(/\\s+/g, '-'));\r\n    }\r\n  },\r\n\r\n  toggle(post) {\r\n    if (!post.file.isExpanding && !post.file.isExpanded) {\r\n      post.file.scrollIntoView = Conf['Scroll into view'];\r\n      ImageExpand.expand(post);\r\n      return;\r\n    }\r\n\r\n    ImageExpand.contract(post);\r\n\r\n    if (Conf['Advance on contract']) {\r\n      let next = post.nodes.root;\r\n      while ((next = $.x(\"following::div[contains(@class,'postContainer')][1]\", next))) {\r\n        if (!$('.stub', next) && (next.offsetHeight !== 0)) { break; }\r\n      }\r\n      if (next) {\r\n        return Header.scrollTo(next);\r\n      }\r\n    }\r\n  },\r\n\r\n  contract(post) {\r\n    let bottom, el, oldHeight, scrollY;\r\n    const {file} = post;\r\n\r\n    if (el = file.fullImage) {\r\n      const top = Header.getTopOf(el);\r\n      bottom = top + el.getBoundingClientRect().height;\r\n      oldHeight = d.body.clientHeight;\r\n      ({scrollY} = window);\r\n    }\r\n\r\n    $.rmClass(post.nodes.root, 'expanded-image');\r\n    $.rmClass(file.thumb,      'expanding');\r\n    $.rm(file.videoControls);\r\n    file.thumbLink.href   = file.url;\r\n    file.thumbLink.target = '_blank';\r\n    for (var x of ['isExpanding', 'isExpanded', 'videoControls', 'wasPlaying', 'scrollIntoView']) {\r\n      delete file[x];\r\n    }\r\n\r\n    if (!el) { return; }\r\n\r\n    if (doc.contains(el)) {\r\n      if (bottom <= 0) {\r\n        // For images entirely above us, scroll to remain in place.\r\n        window.scrollBy(0, ((scrollY - window.scrollY) + d.body.clientHeight) - oldHeight);\r\n      } else {\r\n        // For images not above us that would be moved above us, scroll to the thumbnail.\r\n        Header.scrollToIfNeeded(post.nodes.root);\r\n      }\r\n      if (window.scrollX > 0) {\r\n        // If we have scrolled right viewing an expanded image, return to the left.\r\n        window.scrollBy(-window.scrollX, 0);\r\n      }\r\n    }\r\n\r\n    $.off(el, 'error', ImageExpand.error);\r\n    ImageCommon.pushCache(el);\r\n    if (file.isVideo) {\r\n      ImageCommon.pause(el);\r\n      for (var eventName in ImageExpand.videoCB) {\r\n        var cb = ImageExpand.videoCB[eventName];\r\n        $.off(el, eventName, cb);\r\n      }\r\n    }\r\n    if (Conf['Restart when Opened']) { ImageCommon.rewind(file.thumb); }\r\n    delete file.fullImage;\r\n    return $.queueTask(function() {\r\n      // XXX Work around Chrome/Chromium not firing mouseover on the thumbnail.\r\n      if (file.isExpanding || file.isExpanded) { return; }\r\n      $.rmClass(el, 'full-image');\r\n      if (el.id) { return; }\r\n      return $.rm(el);\r\n    });\r\n  },\r\n\r\n  expand(post, src) {\r\n    // Do not expand images of hidden/filtered replies, or already expanded pictures.\r\n    let el;\r\n    const {file} = post;\r\n    const {thumb, thumbLink, isVideo} = file;\r\n    if (post.isHidden || file.isExpanding || file.isExpanded) { return; }\r\n\r\n    $.addClass(thumb, 'expanding');\r\n    file.isExpanding = true;\r\n\r\n    if (file.fullImage) {\r\n      el = file.fullImage;\r\n    } else if (ImageCommon.cache?.dataset.fileID === `${post.fullID}.${file.index}`) {\r\n      el = (file.fullImage = ImageCommon.popCache());\r\n      $.on(el, 'error', ImageExpand.error);\r\n      if (Conf['Restart when Opened'] && (el.id !== 'ihover')) { ImageCommon.rewind(el); }\r\n      el.removeAttribute('id');\r\n    } else {\r\n      el = (file.fullImage = $.el((isVideo ? 'video' : 'img')));\r\n      el.dataset.fileID = `${post.fullID}.${file.index}`;\r\n      $.on(el, 'error', ImageExpand.error);\r\n      el.src = src || file.url;\r\n    }\r\n\r\n    el.className = 'full-image';\r\n    $.after(thumb, el);\r\n\r\n    if (isVideo) {\r\n      // add contract link to file info\r\n      if (!file.videoControls) {\r\n        file.videoControls = ImageExpand.videoControls.cloneNode(true);\r\n        $.add(file.text, file.videoControls);\r\n      }\r\n\r\n      // disable link to file so native controls can work\r\n      thumbLink.removeAttribute('href');\r\n      thumbLink.removeAttribute('target');\r\n\r\n      el.loop = true;\r\n      Volume.setup(el);\r\n      ImageExpand.setupVideoCB(post);\r\n    }\r\n\r\n    if (!isVideo) {\r\n      return $.asap((() => el.naturalHeight), () => ImageExpand.completeExpand(post));\r\n    } else if (el.readyState >= el.HAVE_METADATA) {\r\n      return ImageExpand.completeExpand(post);\r\n    } else {\r\n      return $.on(el, 'loadedmetadata', () => ImageExpand.completeExpand(post));\r\n    }\r\n  },\r\n\r\n  completeExpand(post) {\r\n    const {file} = post;\r\n    if (!file.isExpanding) { return; } // contracted before the image loaded\r\n\r\n    const bottom = Header.getTopOf(file.thumb) + file.thumb.getBoundingClientRect().height;\r\n    const oldHeight = d.body.clientHeight;\r\n    const {scrollY} = window;\r\n\r\n    $.addClass(post.nodes.root, 'expanded-image');\r\n    $.rmClass(file.thumb,      'expanding');\r\n    file.isExpanded = true;\r\n    delete file.isExpanding;\r\n\r\n    // Scroll to keep our place in the thread when images are expanded above us.\r\n    if (doc.contains(post.nodes.root) && (bottom <= 0)) {\r\n      window.scrollBy(0, ((scrollY - window.scrollY) + d.body.clientHeight) - oldHeight);\r\n    }\r\n\r\n    // Scroll to display full image.\r\n    if (file.scrollIntoView) {\r\n      delete file.scrollIntoView;\r\n      const imageBottom = Math.min(doc.clientHeight - file.fullImage.getBoundingClientRect().bottom - 25, Header.getBottomOf(file.fullImage));\r\n      if (imageBottom < 0) {\r\n        window.scrollBy(0, Math.min(-imageBottom, Header.getTopOf(file.fullImage)));\r\n      }\r\n    }\r\n\r\n    if (file.isVideo) {\r\n      return ImageExpand.setupVideo(post, Conf['Autoplay'], Conf['Show Controls']);\r\n    }\r\n  },\r\n\r\n  setupVideo(post, playing, controls) {\r\n    const {fullImage} = post.file;\r\n    if (!playing) {\r\n      fullImage.controls = controls;\r\n      return;\r\n    }\r\n    fullImage.controls = false;\r\n    $.asap((() => doc.contains(fullImage)), function() {\r\n      if (!d.hidden && Header.isNodeVisible(fullImage)) {\r\n        return fullImage.play();\r\n      } else {\r\n        return post.file.wasPlaying = true;\r\n      }\r\n    });\r\n    if (controls) {\r\n      return ImageCommon.addControls(fullImage);\r\n    }\r\n  },\r\n\r\n  videoCB: (function() {\r\n    // dragging to the left contracts the video\r\n    let mousedown = false;\r\n    return {\r\n      mouseover() { return mousedown = false; },\r\n      mousedown(e) { if (e.button === 0) { return mousedown = true; } },\r\n      mouseup(e) { if (e.button === 0) { return mousedown = false; } },\r\n      mouseout(e) { if (((e.buttons & 1) || mousedown) && (e.clientX <= this.getBoundingClientRect().left)) { return ImageExpand.toggle(Get.postFromNode(this)); } }\r\n    };\r\n  })(),\r\n\r\n  setupVideoCB(post) {\r\n    for (var eventName in ImageExpand.videoCB) {\r\n      var cb = ImageExpand.videoCB[eventName];\r\n      $.on(post.file.fullImage, eventName, cb);\r\n    }\r\n    if (post.file.videoControls) {\r\n      return $.on(post.file.videoControls.firstElementChild, 'click', () => ImageExpand.toggle(post));\r\n    }\r\n  },\r\n\r\n  error() {\r\n    const post = Get.postFromNode(this);\r\n    $.rm(this);\r\n    delete post.file.fullImage;\r\n    // Images can error:\r\n    //  - before the image started loading.\r\n    //  - after the image started loading.\r\n    // Don't try to re-expand if it was already contracted.\r\n    if (!post.file.isExpanding && !post.file.isExpanded) { return; }\r\n    if (ImageCommon.decodeError(this, post.file)) {\r\n      return ImageExpand.contract(post);\r\n    }\r\n    // Don't autoretry images from the archive.\r\n    if (ImageCommon.isFromArchive(this)) {\r\n      return ImageExpand.contract(post);\r\n    }\r\n    return ImageCommon.error(this, post, post.file, 10 * SECOND, function(URL) {\r\n      if (post.file.isExpanding || post.file.isExpanded) {\r\n        ImageExpand.contract(post);\r\n        if (URL) { return ImageExpand.expand(post, URL); }\r\n      }\r\n    });\r\n  },\r\n\r\n  menu: {\r\n    init() {\r\n      if (!ImageExpand.enabled) { return; }\r\n\r\n      const el = $.el('span', {\r\n        textContent: 'Image Expansion',\r\n        className:   'image-expansion-link'\r\n      }\r\n      );\r\n\r\n      const {createSubEntry} = ImageExpand.menu;\r\n      const subEntries = [];\r\n      for (var name in Config.imageExpansion) {\r\n        var conf = Config.imageExpansion[name];\r\n        subEntries.push(createSubEntry(name, conf[1]));\r\n      }\r\n\r\n      return Header.menu.addEntry({\r\n        el,\r\n        order: 105,\r\n        subEntries\r\n      });\r\n    },\r\n\r\n    createSubEntry(name, desc) {\r\n      const label = UI.checkbox(name, name);\r\n      label.title = desc;\r\n      const input = label.firstElementChild;\r\n      if (['Fit width', 'Fit height'].includes(name)) {\r\n        $.on(input, 'change', ImageExpand.cb.setFitness);\r\n      }\r\n      $.event('change', null, input);\r\n      $.on(input, 'change', $.cb.checked);\r\n      return {el: label};\r\n    }\r\n  }\r\n};\r\nexport default ImageExpand;\r\n",null,"import Callbacks from \"../classes/Callbacks\";\r\nimport UI from \"../General/UI\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Menu = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Menu']) { return; }\r\n\r\n    this.button = $.el('a', {\r\n      className: 'menu-button',\r\n      href:      'javascript:;'\r\n    }\r\n    );\r\n\r\n    $.extend(this.button, {textContent: \"\"});\r\n\r\n    this.menu = new UI.Menu('post');\r\n    Callbacks.Post.push({\r\n      name: 'Menu',\r\n      cb:   this.node\r\n    });\r\n\r\n    return Callbacks.CatalogThread.push({\r\n      name: 'Menu',\r\n      cb:   this.catalogNode\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone) {\r\n      const button = $('.menu-button', this.nodes.info);\r\n      $.rmClass(button, 'active');\r\n      $.rm($('.dialog', this.nodes.info));\r\n      Menu.makeButton(this, button);\r\n      return;\r\n    }\r\n    return $.add(this.nodes.info, Menu.makeButton(this));\r\n  },\r\n\r\n  catalogNode() {\r\n    return $.after(this.nodes.icons, Menu.makeButton(this.thread.OP));\r\n  },\r\n\r\n  makeButton(post, button) {\r\n    if (!button) { button = Menu.button.cloneNode(true); }\r\n    $.on(button, 'click', function(e) {\r\n      return Menu.menu.toggle(e, this, post);\r\n    });\r\n    return button;\r\n  }\r\n};\r\nexport default Menu;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { g } from \"../globals/globals\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Recursive = {\r\n  recursives: dict(),\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW)) { return; }\r\n    return Callbacks.Post.push({\r\n      name: 'Recursive',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone || this.isFetchedQuote) { return; }\r\n    for (var quote of this.quotes) {\r\n      var obj;\r\n      if ((obj = Recursive.recursives[quote])) {\r\n        for (var i = 0; i < obj.recursives.length; i++) {\r\n          var recursive = obj.recursives[i];\r\n          recursive(this, ...Array.from(obj.args[i]));\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  add(recursive, post, ...args) {\r\n    const obj = Recursive.recursives[post.fullID] || (Recursive.recursives[post.fullID] = {\r\n      recursives: [],\r\n      args: []\r\n    });\r\n    obj.recursives.push(recursive);\r\n    return obj.args.push(args);\r\n  },\r\n\r\n  rm(recursive, post) {\r\n    let obj;\r\n    if (!(obj = Recursive.recursives[post.fullID])) { return; }\r\n    for (let i = 0; i < obj.recursives.length; i++) {\r\n      var rec = obj.recursives[i];\r\n      if (rec === recursive) {\r\n        obj.recursives.splice(i, 1);\r\n        obj.args.splice(i, 1);\r\n      }\r\n    }\r\n  },\r\n\r\n  apply(recursive, post, ...args) {\r\n    const {fullID} = post;\r\n    return g.posts.forEach(function(post) {\r\n      if (post.quotes.includes(fullID)) {\r\n        return recursive(post, ...Array.from(args));\r\n      }\r\n    });\r\n  }\r\n};\r\nexport default Recursive;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport DataBoard from \"../classes/DataBoard\";\r\nimport Get from \"../General/Get\";\r\nimport UI from \"../General/UI\";\r\nimport { g, Conf, doc } from \"../globals/globals\";\r\nimport Menu from \"../Menu/Menu\";\r\nimport $ from \"../platform/$\";\r\nimport Recursive from \"./Recursive\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar PostHiding = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || (!Conf['Reply Hiding Buttons'] && !(Conf['Menu'] && Conf['Reply Hiding Link']))) { return; }\r\n\r\n    if (Conf['Reply Hiding Buttons']) {\r\n      $.addClass(doc, \"reply-hide\");\r\n    }\r\n\r\n    this.db = new DataBoard('hiddenPosts');\r\n    return Callbacks.Post.push({\r\n      name: 'Reply Hiding',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  isHidden(boardID, threadID, postID) {\r\n    return !!(PostHiding.db && PostHiding.db.get({boardID, threadID, postID}));\r\n  },\r\n\r\n  node() {\r\n    let data, sa;\r\n    if (!this.isReply || this.isClone || this.isFetchedQuote) { return; }\r\n\r\n    if (data = PostHiding.db.get({boardID: this.board.ID, threadID: this.thread.ID, postID: this.ID})) {\r\n      if (data.thisPost) {\r\n        PostHiding.hide(this, data.makeStub, data.hideRecursively);\r\n      } else {\r\n        Recursive.apply(PostHiding.hide, this, data.makeStub, true);\r\n        Recursive.add(PostHiding.hide, this, data.makeStub, true);\r\n      }\r\n    }\r\n\r\n    if (!Conf['Reply Hiding Buttons']) { return; }\r\n\r\n    const button = PostHiding.makeButton(this, 'hide');\r\n    if (sa = g.SITE.selectors.sideArrows) {\r\n      const sideArrows = $(sa, this.nodes.root);\r\n      $.replace(sideArrows.firstChild, button);\r\n      return sideArrows.className = 'replacedSideArrows';\r\n    } else {\r\n      return $.prepend(this.nodes.info, button);\r\n    }\r\n  },\r\n\r\n  menu: {\r\n    init() {\r\n      if (!['index', 'thread'].includes(g.VIEW) || !Conf['Menu'] || !Conf['Reply Hiding Link']) { return; }\r\n\r\n      // Hide\r\n      let div = $.el('div', {\r\n        className: 'hide-reply-link',\r\n        textContent: 'Hide'\r\n      }\r\n      );\r\n\r\n      let apply = $.el('a', {\r\n        textContent: 'Apply',\r\n        href: 'javascript:;'\r\n      }\r\n      );\r\n      $.on(apply, 'click', PostHiding.menu.hide);\r\n\r\n      let thisPost = UI.checkbox('thisPost', 'This post',    true);\r\n      let replies  = UI.checkbox('replies',  'Hide replies', Conf['Recursive Hiding']);\r\n      const makeStub = UI.checkbox('makeStub', 'Make stub',    Conf['Stubs']);\r\n\r\n      Menu.menu.addEntry({\r\n        el: div,\r\n        order: 20,\r\n        open(post) {\r\n          if (!post.isReply || post.isClone || post.isHidden) {\r\n            return false;\r\n          }\r\n          PostHiding.menu.post = post;\r\n          return true;\r\n        },\r\n        subEntries: [\r\n            {el: apply}\r\n          ,\r\n            {el: thisPost}\r\n          ,\r\n            {el: replies}\r\n          ,\r\n            {el: makeStub}\r\n        ]});\r\n\r\n      // Show\r\n      div = $.el('div', {\r\n        className: 'show-reply-link',\r\n        textContent: 'Show'\r\n      }\r\n      );\r\n\r\n      apply = $.el('a', {\r\n        textContent: 'Apply',\r\n        href: 'javascript:;'\r\n      }\r\n      );\r\n      $.on(apply, 'click', PostHiding.menu.show);\r\n\r\n      thisPost = UI.checkbox('thisPost', 'This post',    false);\r\n      replies  = UI.checkbox('replies',  'Show replies', false);\r\n      const hideStubLink = $.el('a', {\r\n        textContent: 'Hide stub',\r\n        href: 'javascript:;'\r\n      }\r\n      );\r\n      $.on(hideStubLink, 'click', PostHiding.menu.hideStub);\r\n\r\n      Menu.menu.addEntry({\r\n        el: div,\r\n        order: 20,\r\n        open(post) {\r\n          let data;\r\n          if (!post.isReply || post.isClone || !post.isHidden) {\r\n            return false;\r\n          }\r\n          if (!(data = PostHiding.db.get({boardID: post.board.ID, threadID: post.thread.ID, postID: post.ID}))) {\r\n            return false;\r\n          }\r\n          PostHiding.menu.post = post;\r\n          thisPost.firstChild.checked = post.isHidden;\r\n          replies.firstChild.checked  = (data?.hideRecursively != null) ? data.hideRecursively : Conf['Recursive Hiding'];\r\n          return true;\r\n        },\r\n        subEntries: [\r\n            {el: apply}\r\n          ,\r\n            {el: thisPost}\r\n          ,\r\n            {el: replies}\r\n        ]});\r\n\r\n      return Menu.menu.addEntry({\r\n        el: hideStubLink,\r\n        order: 15,\r\n        open(post) {\r\n          let data;\r\n          if (!post.isReply || post.isClone || !post.isHidden) {\r\n            return false;\r\n          }\r\n          if (!(data = PostHiding.db.get({boardID: post.board.ID, threadID: post.thread.ID, postID: post.ID}))) {\r\n            return false;\r\n          }\r\n          return PostHiding.menu.post = post;\r\n        }\r\n      });\r\n    },\r\n\r\n    hide() {\r\n      const parent   = this.parentNode;\r\n      const thisPost = $('input[name=thisPost]', parent).checked;\r\n      const replies  = $('input[name=replies]',  parent).checked;\r\n      const makeStub = $('input[name=makeStub]', parent).checked;\r\n      const {post}   = PostHiding.menu;\r\n      if (thisPost) {\r\n        PostHiding.hide(post, makeStub, replies);\r\n      } else if (replies) {\r\n        Recursive.apply(PostHiding.hide, post, makeStub, true);\r\n        Recursive.add(PostHiding.hide, post, makeStub, true);\r\n      } else {\r\n        return;\r\n      }\r\n      PostHiding.saveHiddenState(post, true, thisPost, makeStub, replies);\r\n      return $.event('CloseMenu');\r\n    },\r\n\r\n    show() {\r\n      let data;\r\n      const parent   = this.parentNode;\r\n      const thisPost = $('input[name=thisPost]', parent).checked;\r\n      const replies  = $('input[name=replies]',  parent).checked;\r\n      const {post}   = PostHiding.menu;\r\n      if (thisPost) {\r\n        PostHiding.show(post, replies);\r\n      } else if (replies) {\r\n        Recursive.apply(PostHiding.show, post, true);\r\n        Recursive.rm(PostHiding.hide, post, true);\r\n      } else {\r\n        return;\r\n      }\r\n      if (data = PostHiding.db.get({boardID: post.board.ID, threadID: post.thread.ID, postID: post.ID})) {\r\n        PostHiding.saveHiddenState(post, !(thisPost && replies), !thisPost, data.makeStub, !replies);\r\n      }\r\n      return $.event('CloseMenu');\r\n    },\r\n    hideStub() {\r\n      let data;\r\n      const {post} = PostHiding.menu;\r\n      if (data = PostHiding.db.get({boardID: post.board.ID, threadID: post.thread.ID, postID: post.ID})) {\r\n        PostHiding.show(post, data.hideRecursively);\r\n        PostHiding.hide(post, false, data.hideRecursively);\r\n        PostHiding.saveHiddenState(post, true, true, false, data.hideRecursively);\r\n      }\r\n      $.event('CloseMenu');\r\n    }\r\n  },\r\n\r\n  makeButton(post, type) {\r\n    const span = $.el('span', {\r\n      textContent: type === 'hide' ? '' : '',\r\n    });\r\n    const a = $.el('a', {\r\n      className: `${type}-reply-button`,\r\n      href:      'javascript:;'\r\n    }\r\n    );\r\n    $.add(a, span);\r\n    $.on(a, 'click', PostHiding.toggle);\r\n    return a;\r\n  },\r\n\r\n  saveHiddenState(post, isHiding, thisPost, makeStub, hideRecursively) {\r\n    const data = {\r\n      boardID:  post.board.ID,\r\n      threadID: post.thread.ID,\r\n      postID:   post.ID\r\n    };\r\n    if (isHiding) {\r\n      data.val = {\r\n        thisPost: thisPost !== false, // undefined -> true\r\n        makeStub,\r\n        hideRecursively\r\n      };\r\n      return PostHiding.db.set(data);\r\n    } else {\r\n      return PostHiding.db.delete(data);\r\n    }\r\n  },\r\n\r\n  toggle() {\r\n    const post = Get.postFromNode(this);\r\n    PostHiding[(post.isHidden ? 'show' : 'hide')](post);\r\n    return PostHiding.saveHiddenState(post, post.isHidden);\r\n  },\r\n\r\n  hide(post, makeStub=Conf['Stubs'], hideRecursively=Conf['Recursive Hiding']) {\r\n    if (post.isHidden) { return; }\r\n    post.isHidden = true;\r\n\r\n    if (hideRecursively) {\r\n      Recursive.apply(PostHiding.hide, post, makeStub, true);\r\n      Recursive.add(PostHiding.hide, post, makeStub, true);\r\n    }\r\n\r\n    for (var quotelink of Get.allQuotelinksLinkingTo(post)) {\r\n      $.addClass(quotelink, 'filtered');\r\n    }\r\n\r\n    if (!makeStub) {\r\n      post.nodes.root.hidden = true;\r\n      return;\r\n    }\r\n\r\n    const a = PostHiding.makeButton(post, 'show');\r\n    $.add(a, $.tn(` ${post.info.nameBlock}`));\r\n    post.nodes.stub = $.el('div',\r\n      {className: 'stub'});\r\n    $.add(post.nodes.stub, a);\r\n    if (Conf['Menu']) {\r\n      $.add(post.nodes.stub, Menu.makeButton(post));\r\n    }\r\n    return $.prepend(post.nodes.root, post.nodes.stub);\r\n  },\r\n\r\n  show(post, showRecursively=Conf['Recursive Hiding']) {\r\n    if (post.nodes.stub) {\r\n      $.rm(post.nodes.stub);\r\n      delete post.nodes.stub;\r\n    } else {\r\n      post.nodes.root.hidden = false;\r\n    }\r\n    post.isHidden = false;\r\n    if (showRecursively) {\r\n      Recursive.apply(PostHiding.show, post, true);\r\n      Recursive.rm(PostHiding.hide, post);\r\n    }\r\n    for (var quotelink of Get.allQuotelinksLinkingTo(post)) {\r\n      $.rmClass(quotelink, 'filtered');\r\n    }\r\n  }\r\n};\r\nexport default PostHiding;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Post from \"../classes/Post\";\r\nimport Index from \"../General/Index\";\r\nimport { g, Conf, d, doc } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { DAY, HOUR, MINUTE, SECOND } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar RelativeDates = {\r\n  INTERVAL: 30000,\r\n\r\n  init() {\r\n    if (\r\n      (['index', 'thread', 'archive'].includes(g.VIEW) && Conf['Relative Post Dates'] && !Conf['Relative Date Title']) ||\r\n      Index.enabled\r\n    ) {\r\n      this.flush();\r\n      $.on(d, 'visibilitychange PostsInserted', this.flush);\r\n    }\r\n\r\n    if (Conf['Relative Post Dates']) {\r\n      return Callbacks.Post.push({\r\n        name: 'Relative Post Dates',\r\n        cb:   this.node\r\n      });\r\n    }\r\n  },\r\n\r\n  node() {\r\n    if (!this.info.date) { return; }\r\n    const dateEl = this.nodes.date;\r\n    if (Conf['Relative Date Title']) {\r\n      $.on(dateEl, 'mouseover', () => RelativeDates.hover(this));\r\n      return;\r\n    }\r\n    if (this.isClone) { return; }\r\n\r\n    // Show original absolute time as tooltip so users can still know exact times\r\n    // Since \"Time Formatting\" runs its `node` before us, the title tooltip will\r\n    // pick up the user-formatted time instead of 4chan time when enabled.\r\n    dateEl.title = dateEl.textContent;\r\n\r\n    return RelativeDates.update(this);\r\n  },\r\n\r\n  // diff is milliseconds from now.\r\n  relative(diff, now, date, abbrev) {\r\n    let number;\r\n    let unit = (() => {\r\n      if ((number = (diff / DAY)) >= 1) {\r\n      const years  = now.getFullYear()  - date.getFullYear();\r\n        let months = now.getMonth() - date.getMonth();\r\n      const days   = now.getDate()  - date.getDate();\r\n        if (years > 1) {\r\n          number = years - ((months < 0) || ((months === 0) && (days < 0)));\r\n          return 'year';\r\n        } else if ((years === 1) && ((months > 0) || ((months === 0) && (days >= 0)))) {\r\n          number = years;\r\n          return 'year';\r\n      } else if ((months = months + (12*years)) > 1) {\r\n          number = months - (days < 0);\r\n          return 'month';\r\n        } else if ((months === 1) && (days >= 0)) {\r\n          number = months;\r\n          return 'month';\r\n        } else {\r\n          return 'day';\r\n        }\r\n    } else if ((number = (diff / HOUR)) >= 1) {\r\n      return 'hour';\r\n    } else if ((number = (diff / MINUTE)) >= 1) {\r\n      return 'minute';\r\n    } else {\r\n      // prevent \"-1 seconds ago\"\r\n      number = Math.max(0, diff) / SECOND;\r\n      return 'second';\r\n    }\r\n    })();\r\n\r\n    const rounded = Math.round(number);\r\n\r\n    if (abbrev) {\r\n      unit = unit === 'month' ? 'mo' : unit[0];\r\n    } else {\r\n      if (rounded !== 1) { unit += 's'; } // pluralize\r\n    }\r\n\r\n    if (abbrev) { return `${rounded}${unit}`; } else { return `${rounded} ${unit} ago`; }\r\n  },\r\n\r\n  // Changing all relative dates as soon as possible incurs many annoying\r\n  // redraws and scroll stuttering. Thus, sacrifice accuracy for UX/CPU economy,\r\n  // and perform redraws when the DOM is otherwise being manipulated (and scroll\r\n  // stuttering won't be noticed), falling back to INTERVAL while the page\r\n  // is visible.\r\n  //\r\n  // Each individual dateTime element will add its update() function to the stale list\r\n  // when it is to be called.\r\n  stale: [],\r\n  flush() {\r\n    // No point in changing the dates until the user sees them.\r\n    if (d.hidden) { return; }\r\n\r\n    const now = new Date();\r\n    for (var data of RelativeDates.stale) { RelativeDates.update(data, now); }\r\n    RelativeDates.stale = [];\r\n\r\n    // Reset automatic flush.\r\n    clearTimeout(RelativeDates.timeout);\r\n    return RelativeDates.timeout = setTimeout(RelativeDates.flush, RelativeDates.INTERVAL);\r\n  },\r\n\r\n  hover(post) {\r\n    const {\r\n      date\r\n    } = post.info;\r\n    const now  = new Date();\r\n    const diff = now - date;\r\n    return post.nodes.date.title = RelativeDates.relative(diff, now, date);\r\n  },\r\n\r\n  // `update()`, when called from `flush()`, updates the elements,\r\n  // and re-calls `setOwnTimeout()` to re-add `data` to the stale list later.\r\n  update(data, now) {\r\n    let abbrev, date;\r\n    const isPost = data instanceof Post;\r\n    if (isPost) {\r\n      ({\r\n        date\r\n      } = data.info);\r\n      abbrev = false;\r\n    } else {\r\n      date = new Date(+data.dataset.utc);\r\n      abbrev = !!data.dataset.abbrev;\r\n    }\r\n    if (!now) { now = new Date(); }\r\n    const diff = now - date;\r\n    const relative = RelativeDates.relative(diff, now, date, abbrev);\r\n    if (isPost) {\r\n      for (var singlePost of [data].concat(data.clones)) {\r\n        singlePost.nodes.date.firstChild.textContent = relative;\r\n      }\r\n    } else {\r\n      data.firstChild.textContent = relative;\r\n    }\r\n    return RelativeDates.setOwnTimeout(diff, data);\r\n  },\r\n\r\n  setOwnTimeout(diff, data) {\r\n    const delay = diff < MINUTE ?\r\n      SECOND - ((diff + (SECOND / 2)) % SECOND)\r\n    : diff < HOUR ?\r\n      MINUTE - ((diff + (MINUTE / 2)) % MINUTE)\r\n    : diff < DAY ?\r\n      HOUR - ((diff + (HOUR / 2)) % HOUR)\r\n    :\r\n      DAY - ((diff + (DAY / 2)) % DAY);\r\n    return setTimeout(RelativeDates.markStale, delay, data);\r\n  },\r\n\r\n  markStale(data) {\r\n    if (RelativeDates.stale.includes(data)) { return; } // We can call RelativeDates.update() multiple times.\r\n    if (data instanceof Post && !g.posts.get(data.fullID)) { return; } // collected post.\r\n    if (data instanceof Element && !doc.contains(data)) { return; } // removed catalog reply.\r\n    return RelativeDates.stale.push(data);\r\n  }\r\n};\r\nexport default RelativeDates;\r\n","import Notice from \"../classes/Notice\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { dict, HOUR } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar BoardConfig = {\r\n  cbs: [],\r\n\r\n  init() {\r\n    let middle;\r\n    if (g.SITE.software !== 'yotsuba') { return; }\r\n    const now = Date.now();\r\n    if (now - (2 * HOUR) >= ((middle = Conf['boardConfig'].lastChecked || 0)) || middle > now) {\r\n      return $.ajax(`${location.protocol}//a.4cdn.org/boards.json`,\r\n        {onloadend: this.load});\r\n    } else {\r\n      const {boards} = Conf['boardConfig'];\r\n      return this.set(boards);\r\n    }\r\n  },\r\n\r\n  load() {\r\n    let boards;\r\n    if ((this.status === 200) && this.response && this.response.boards) {\r\n      boards = dict();\r\n      for (var board of this.response.boards) {\r\n        boards[board.board] = board;\r\n      }\r\n      $.set('boardConfig', {boards, lastChecked: Date.now()});\r\n    } else {\r\n      ({boards} = Conf['boardConfig']);\r\n      const err = (() => { switch (this.status) {\r\n        case 0:   return 'Connection Error';\r\n        case 200: return 'Invalid Data';\r\n        default:          return `Error ${this.statusText} (${this.status})`;\r\n      } })();\r\n      new Notice('warning', `Failed to load board configuration. ${err}`, 20);\r\n    }\r\n    return BoardConfig.set(boards);\r\n  },\r\n\r\n  set(boards) {\r\n    this.boards = boards;\r\n    for (var ID in g.boards) {\r\n      var board = g.boards[ID];\r\n      board.config = this.boards[ID] || {};\r\n    }\r\n    for (var cb of this.cbs) {\r\n      $.queueTask(cb);\r\n    }\r\n  },\r\n\r\n  ready(cb) {\r\n    if (this.boards) {\r\n      return cb();\r\n    } else {\r\n      return this.cbs.push(cb);\r\n    }\r\n  },\r\n\r\n  sfwBoards(sfw) {\r\n    return (() => {\r\n      const result = [];\r\n      const object = this.boards || Conf['boardConfig'].boards;\r\n      for (var board in object) {\r\n        var data = object[board];\r\n        if (!!data.ws_board === sfw) {\r\n          result.push(board);\r\n        }\r\n      }\r\n      return result;\r\n    })();\r\n  },\r\n\r\n  isSFW(board) {\r\n    return !!(this.boards || Conf['boardConfig'].boards)[board]?.ws_board;\r\n  },\r\n\r\n  domain(board) {\r\n    return `boards.${BoardConfig.isSFW(board) ? '4channel' : '4chan'}.org`;\r\n  },\r\n\r\n  isArchived(board) {\r\n    // assume archive exists if no data available to prevent cleaning of archived threads\r\n    const data = (this.boards || Conf['boardConfig'].boards)[board];\r\n    return !data || data.is_archived;\r\n  },\r\n\r\n  noAudio(boardID) {\r\n    if (g.SITE.software !== 'yotsuba') { return false; }\r\n    const boards = this.boards || Conf['boardConfig'].boards;\r\n    return boards && boards[boardID] && !boards[boardID].webm_audio;\r\n  },\r\n\r\n  title(boardID) {\r\n    return (this.boards || Conf['boardConfig'].boards)?.[boardID]?.title || '';\r\n  }\r\n};\r\nexport default BoardConfig;\r\n","import BoardConfig from \"../General/BoardConfig\";\r\nimport { d, g } from \"../globals/globals\";\r\nimport SimpleDict from \"./SimpleDict\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nexport default class Board {\r\n  toString() { return this.ID; }\r\n\r\n  constructor(ID) {\r\n    this.ID = ID;\r\n    this.boardID = this.ID;\r\n    this.siteID  = g.SITE.ID;\r\n    this.threads = new SimpleDict();\r\n    this.posts   = new SimpleDict();\r\n    this.config  = BoardConfig.boards?.[this.ID] || {};\r\n\r\n    g.boards[this] = this;\r\n  }\r\n\r\n  cooldowns() {\r\n    const c2 = (this.config || {}).cooldowns || {};\r\n    const c = {\r\n      thread: c2.threads || 0,\r\n      reply:  c2.replies || 0,\r\n      image:  c2.images  || 0,\r\n      thread_global: 300 // inter-board thread cooldown\r\n    };\r\n    // Pass users have reduced cooldowns.\r\n    if (d.cookie.indexOf('pass_enabled=1') >= 0) {\r\n      for (var key of ['reply', 'image']) {\r\n        c[key] = Math.ceil(c[key] / 2);\r\n      }\r\n    }\r\n    return c;\r\n  }\r\n}\r\n","import { d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst PostRedirect = {\r\n  init() {\r\n    return $.on(d, 'QRPostSuccessful', e => {\r\n      if (!e.detail.redirect) { return; }\r\n      this.event = e;\r\n      this.delays = 0;\r\n      return $.queueTask(() => {\r\n        if ((e === this.event) && (this.delays === 0)) {\r\n          return location.href = e.detail.redirect;\r\n        }\r\n      });\r\n    });\r\n  },\r\n\r\n  delays: 0,\r\n\r\n  delay() {\r\n    if (!this.event) { return null; }\r\n    const e = this.event;\r\n    this.delays++;\r\n    return () => {\r\n      if (e !== this.event) { return; }\r\n      this.delays--;\r\n      if (this.delays === 0) {\r\n        return location.href = e.detail.redirect;\r\n      }\r\n    };\r\n  }\r\n};\r\nexport default PostRedirect;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Get from \"../General/Get\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ExpandComment = {\r\n  init() {\r\n    if ((g.VIEW !== 'index') || !Conf['Comment Expansion'] || Conf['JSON Index']) { return; }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Comment Expansion',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    let a;\r\n    if (a = $('.abbr > a:not([onclick])', this.nodes.comment)) {\r\n      return $.on(a, 'click', ExpandComment.cb);\r\n    }\r\n  },\r\n\r\n  callbacks: [],\r\n\r\n  cb(e) {\r\n    e.preventDefault();\r\n    return ExpandComment.expand(Get.postFromNode(this));\r\n  },\r\n\r\n  expand(post) {\r\n    let a;\r\n    if (post.nodes.longComment && !post.nodes.longComment.parentNode) {\r\n      $.replace(post.nodes.shortComment, post.nodes.longComment);\r\n      post.nodes.comment = post.nodes.longComment;\r\n      return;\r\n    }\r\n    if (!(a = $('.abbr > a', post.nodes.comment))) { return; }\r\n    a.textContent = `Post No.${post} Loading...`;\r\n    return $.cache(g.SITE.urls.threadJSON({boardID: post.boardID, threadID: post.threadID}), function() { return ExpandComment.parse(this, a, post); });\r\n  },\r\n\r\n  contract(post) {\r\n    if (!post.nodes.shortComment) { return; }\r\n    const a = $('.abbr > a', post.nodes.shortComment);\r\n    a.textContent = 'here';\r\n    $.replace(post.nodes.longComment, post.nodes.shortComment);\r\n    return post.nodes.comment = post.nodes.shortComment;\r\n  },\r\n\r\n  parse(req, a, post) {\r\n    let postObj, spoilerRange;\r\n    const {status} = req;\r\n    if (![200, 304].includes(status)) {\r\n      a.textContent = status ? `Error ${req.statusText} (${status})` : 'Connection Error';\r\n      return;\r\n    }\r\n\r\n    const {\r\n      posts\r\n    } = req.response;\r\n    if (spoilerRange = posts[0].custom_spoiler) {\r\n      g.SITE.Build.spoilerRange[g.BOARD] = spoilerRange;\r\n    }\r\n\r\n    for (postObj of posts) {\r\n      if (postObj.no === post.ID) { break; }\r\n    }\r\n    if (postObj.no !== post.ID) {\r\n      a.textContent = `Post No.${post} not found.`;\r\n      return;\r\n    }\r\n\r\n    const {comment} = post.nodes;\r\n    const clone = comment.cloneNode(false);\r\n    clone.innerHTML = postObj.com;\r\n    // Fix pathnames\r\n    for (var quote of $$('.quotelink', clone)) {\r\n      var href = quote.getAttribute('href');\r\n      if (href[0] === '/') { continue; } // Cross-board quote, or board link\r\n      if (href[0] === '#') {\r\n        quote.href = `${a.pathname.split(/\\/+/).splice(0,4).join('/')}${href}`;\r\n      } else {\r\n        quote.href = `${a.pathname.split(/\\/+/).splice(0,3).join('/')}/${href}`;\r\n      }\r\n    }\r\n    post.nodes.shortComment = comment;\r\n    $.replace(comment, clone);\r\n    post.nodes.comment = (post.nodes.longComment = clone);\r\n    post.parseComment();\r\n    post.parseQuotes();\r\n\r\n    for (var callback of ExpandComment.callbacks) {\r\n      callback.call(post);\r\n    }\r\n  }\r\n};\r\nexport default ExpandComment;;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport DataBoard from \"../classes/DataBoard\";\r\nimport Notice from \"../classes/Notice\";\r\nimport Get from \"../General/Get\";\r\nimport Header from \"../General/Header\";\r\nimport { Conf, d, doc, g } from \"../globals/globals\";\r\nimport Menu from \"../Menu/Menu\";\r\nimport ExpandComment from \"../Miscellaneous/ExpandComment\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport PostRedirect from \"../Posting/PostRedirect\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar QuoteYou = {\r\n  init() {\r\n    if (!Conf['Remember Your Posts']) { return; }\r\n\r\n    this.db = new DataBoard('yourPosts');\r\n    $.sync('Remember Your Posts', enabled => Conf['Remember Your Posts'] = enabled);\r\n    $.on(d, 'QRPostSuccessful', function(e) {\r\n      const cb = PostRedirect.delay();\r\n      return $.get('Remember Your Posts', Conf['Remember Your Posts'], function(items) {\r\n        if (!items['Remember Your Posts']) { return; }\r\n        const {boardID, threadID, postID} = e.detail;\r\n        return QuoteYou.db.set({boardID, threadID, postID, val: true}, cb);\r\n      });\r\n    });\r\n\r\n    if (!['index', 'thread', 'archive'].includes(g.VIEW)) { return; }\r\n\r\n    if (Conf['Highlight Own Posts']) {\r\n      $.addClass(doc, 'highlight-own');\r\n    }\r\n\r\n    if (Conf['Highlight Posts Quoting You']) {\r\n      $.addClass(doc, 'highlight-you');\r\n    }\r\n\r\n    if (Conf['Comment Expansion']) {\r\n      ExpandComment.callbacks.push(this.node);\r\n    }\r\n\r\n    // \\u00A0 is nbsp\r\n    this.mark = $.el('span', {\r\n      textContent: '\\u00A0(You)',\r\n      className:   'qmark-you'\r\n    }\r\n    );\r\n    Callbacks.Post.push({\r\n      name: 'Mark Quotes of You',\r\n      cb:   this.node\r\n    });\r\n\r\n    return QuoteYou.menu.init();\r\n  },\r\n\r\n  isYou(post) {\r\n    return !!QuoteYou.db?.get({\r\n      boardID:  post.boardID,\r\n      threadID: post.threadID,\r\n      postID:   post.ID\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone) { return; }\r\n\r\n    if (QuoteYou.isYou(this)) {\r\n      $.addClass(this.nodes.root, 'yourPost');\r\n    }\r\n\r\n    // Stop there if there's no quotes in that post.\r\n    if (!this.quotes.length) { return; }\r\n\r\n    for (var quotelink of this.nodes.quotelinks) {\r\n      if (QuoteYou.db.get(Get.postDataFromLink(quotelink))) {\r\n        if (Conf['Mark Quotes of You']) { $.add(quotelink, QuoteYou.mark.cloneNode(true)); }\r\n        $.addClass(quotelink, 'you');\r\n        $.addClass(this.nodes.root, 'quotesYou');\r\n      }\r\n    }\r\n  },\r\n\r\n  menu: {\r\n    init() {\r\n      const label = $.el('label',\r\n        {className: 'toggle-you'}\r\n      ,\r\n        {innerHTML: '<input type=\"checkbox\"> You'});\r\n      const input = $('input', label);\r\n      $.on(input, 'change', QuoteYou.menu.toggle);\r\n      return Menu.menu?.addEntry({\r\n        el: label,\r\n        order: 80,\r\n        open(post) {\r\n          QuoteYou.menu.post = (post.origin || post);\r\n          input.checked = QuoteYou.isYou(post);\r\n          return true;\r\n        }\r\n      });\r\n    },\r\n\r\n    toggle() {\r\n      const {post} = QuoteYou.menu;\r\n      const data = {boardID: post.board.ID, threadID: post.thread.ID, postID: post.ID, val: true};\r\n      if (this.checked) {\r\n        QuoteYou.db.set(data);\r\n      } else {\r\n        QuoteYou.db.delete(data);\r\n      }\r\n      for (var clone of [post].concat(post.clones)) {\r\n        clone.nodes.root.classList.toggle('yourPost', this.checked);\r\n      }\r\n      for (var quotelink of Get.allQuotelinksLinkingTo(post)) {\r\n        if (this.checked) {\r\n          if (Conf['Mark Quotes of You']) { $.add(quotelink, QuoteYou.mark.cloneNode(true)); }\r\n        } else {\r\n          $.rm($('.qmark-you', quotelink));\r\n        }\r\n        quotelink.classList.toggle('you', this.checked);\r\n        if ($.hasClass(quotelink, 'quotelink')) {\r\n          var quoter = Get.postFromNode(quotelink).nodes.root;\r\n          quoter.classList.toggle('quotesYou', !!$('.quotelink.you', quoter));\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  cb: {\r\n    seek(type) {\r\n      let highlighted, post;\r\n      let result;\r\n      const {highlight} = g.SITE.classes;\r\n      if (highlighted = $(`.${highlight}`)) { $.rmClass(highlighted, highlight); }\r\n\r\n      if (!QuoteYou.lastRead || !doc.contains(QuoteYou.lastRead) || !$.hasClass(QuoteYou.lastRead, 'quotesYou')) {\r\n        if (!(post = (QuoteYou.lastRead = $('.quotesYou')))) {\r\n          new Notice('warning', 'No posts are currently quoting you, loser.', 20);\r\n          return;\r\n        }\r\n        if (QuoteYou.cb.scroll(post)) { return; }\r\n      } else {\r\n        post = QuoteYou.lastRead;\r\n      }\r\n\r\n      const str = `${type}::div[contains(@class,'quotesYou')]`;\r\n\r\n      while (post = (result = $.X(str, post)).snapshotItem(type === 'preceding' ? result.snapshotLength - 1 : 0)) {\r\n        if (QuoteYou.cb.scroll(post)) { return; }\r\n      }\r\n\r\n      const posts = $$('.quotesYou');\r\n      return QuoteYou.cb.scroll(posts[type === 'following' ? 0 : posts.length - 1]);\r\n    },\r\n\r\n    scroll(root) {\r\n      const post = Get.postFromRoot(root);\r\n      if (!post.nodes.post.getBoundingClientRect().height) {\r\n        return false;\r\n      } else {\r\n        QuoteYou.lastRead = root;\r\n        location.href = Get.url('post', post);\r\n        Header.scrollTo(post.nodes.post);\r\n        if (post.isReply) {\r\n          const sel = `${g.SITE.selectors.postContainer}${g.SITE.selectors.highlightable.reply}`;\r\n          let node = post.nodes.root;\r\n          if (!node.matches(sel)) { node = $(sel, node); }\r\n          $.addClass(node, g.SITE.classes.highlight);\r\n        }\r\n        return true;\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default QuoteYou;\r\n","/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nexport default class RandomAccessList {\r\n  constructor(items) {\r\n    this.length = 0;\r\n    if (items) { for (var item of items) { this.push(item); } }\r\n  }\r\n\r\n  push(data) {\r\n    let item;\r\n    let {ID} = data;\r\n    if (!ID) { ID = data.id; }\r\n    if (this[ID]) { return; }\r\n    const {last} = this;\r\n    this[ID] = (item = {\r\n      prev: last,\r\n      next: null,\r\n      data,\r\n      ID\r\n    });\r\n    item.prev = last;\r\n    this.last = last ?\r\n      (last.next = item)\r\n    :\r\n      (this.first = item);\r\n    return this.length++;\r\n  }\r\n\r\n  before(root, item) {\r\n    if ((item.next === root) || (item === root)) { return; }\r\n\r\n    this.rmi(item);\r\n\r\n    const {prev} = root;\r\n    root.prev = item;\r\n    item.next = root;\r\n    item.prev = prev;\r\n    if (prev) {\r\n      return prev.next = item;\r\n    } else {\r\n      return this.first = item;\r\n    }\r\n  }\r\n\r\n  after(root, item) {\r\n    if ((item.prev === root) || (item === root)) { return; }\r\n\r\n    this.rmi(item);\r\n\r\n    const {next} = root;\r\n    root.next = item;\r\n    item.prev = root;\r\n    item.next = next;\r\n    if (next) {\r\n      return next.prev = item;\r\n    } else {\r\n      return this.last = item;\r\n    }\r\n  }\r\n\r\n  prepend(item) {\r\n    const {first} = this;\r\n    if ((item === first) || !this[item.ID]) { return; }\r\n    this.rmi(item);\r\n    item.next  = first;\r\n    if (first) {\r\n      first.prev = item;\r\n    } else {\r\n      this.last = item;\r\n    }\r\n    this.first = item;\r\n    return delete item.prev;\r\n  }\r\n\r\n  shift() {\r\n    return this.rm(this.first.ID);\r\n  }\r\n\r\n  order() {\r\n    let item;\r\n    const order = [(item = this.first)];\r\n    while ((item = item.next)) { order.push(item); }\r\n    return order;\r\n  }\r\n\r\n  rm(ID) {\r\n    const item = this[ID];\r\n    if (!item) { return; }\r\n    delete this[ID];\r\n    this.length--;\r\n    this.rmi(item);\r\n    delete item.next;\r\n    return delete item.prev;\r\n  }\r\n\r\n  rmi(item) {\r\n    const {prev, next} = item;\r\n    if (prev) {\r\n      prev.next = next;\r\n    } else {\r\n      this.first = next;\r\n    }\r\n    if (next) {\r\n      return next.prev = prev;\r\n    } else {\r\n      return this.last = prev;\r\n    }\r\n  }\r\n}\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport DataBoard from \"../classes/DataBoard\";\r\nimport RandomAccessList from \"../classes/RandomAccessList\";\r\nimport Get from \"../General/Get\";\r\nimport Header from \"../General/Header\";\r\nimport { g, Conf, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { debounce, SECOND } from \"../platform/helpers\";\r\nimport QuoteYou from \"../Quotelinks/QuoteYou\";\r\nimport Favicon from \"./Favicon\";\r\nimport ThreadWatcher from \"./ThreadWatcher\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Unread = {\r\n  init() {\r\n    if ((g.VIEW !== 'thread') || (\r\n      !Conf['Unread Count'] &&\r\n      !Conf['Unread Favicon'] &&\r\n      !Conf['Unread Line'] &&\r\n      !Conf['Remember Last Read Post'] &&\r\n      !Conf['Desktop Notifications'] &&\r\n      !Conf['Quote Threading']\r\n    )) { return; }\r\n\r\n    if (Conf['Remember Last Read Post']) {\r\n      $.sync('Remember Last Read Post', enabled => Conf['Remember Last Read Post'] = enabled);\r\n      this.db = new DataBoard('lastReadPosts', this.sync);\r\n    }\r\n\r\n    this.hr = $.el('hr', {\r\n      id: 'unread-line',\r\n      className: 'unread-line'\r\n    }\r\n    );\r\n    this.posts = new Set();\r\n    this.postsQuotingYou = new Set();\r\n    this.order = new RandomAccessList();\r\n    this.position = null;\r\n\r\n    Callbacks.Thread.push({\r\n      name: 'Unread',\r\n      cb:   this.node\r\n    });\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Unread',\r\n      cb:   this.addPost\r\n    });\r\n  },\r\n\r\n  node() {\r\n    Unread.thread = this;\r\n    Unread.title  = d.title;\r\n    Unread.lastReadPost = Unread.db?.get({\r\n      boardID: this.board.ID,\r\n      threadID: this.ID\r\n    }) || 0;\r\n    Unread.readCount = 0;\r\n    for (var ID of this.posts.keys) { if (+ID <= Unread.lastReadPost) { Unread.readCount++; } }\r\n    $.one(d, '4chanXInitFinished', Unread.ready);\r\n    $.on(d, 'PostsInserted',      Unread.onUpdate);\r\n    $.on(d, 'ThreadUpdate',       function(e) { if (e.detail[404]) { return Unread.update(); } });\r\n    const resetLink = $.el('a', {\r\n      href: 'javascript:;',\r\n      className: 'unread-reset',\r\n      textContent: 'Mark all unread'\r\n    }\r\n    );\r\n    $.on(resetLink, 'click', Unread.reset);\r\n    return Header.menu.addEntry({\r\n      el: resetLink,\r\n      order: 70\r\n    });\r\n  },\r\n\r\n  ready() {\r\n    if (Conf['Remember Last Read Post'] && Conf['Scroll to Last Read Post']) { Unread.scroll(); }\r\n    Unread.setLine(true);\r\n    Unread.read();\r\n    Unread.update();\r\n    $.on(d, 'scroll visibilitychange', Unread.read);\r\n    if (Conf['Unread Line']) { return $.on(d, 'visibilitychange',        Unread.setLine); }\r\n  },\r\n\r\n  positionPrev() {\r\n    if (Unread.position) { return Unread.position.prev; } else { return Unread.order.last; }\r\n  },\r\n\r\n  scroll() {\r\n    // Let the header's onload callback handle it.\r\n    let hash;\r\n    if ((hash = location.hash.match(/\\d+/)) && hash[0] in Unread.thread.posts) { return; }\r\n\r\n    let position = Unread.positionPrev();\r\n    while (position) {\r\n      var {bottom} = position.data.nodes;\r\n      if (!bottom.getBoundingClientRect().height) {\r\n        // Don't try to scroll to posts with display: none\r\n        position = position.prev;\r\n      } else {\r\n        Header.scrollToIfNeeded(bottom, true);\r\n        break;\r\n      }\r\n    }\r\n  },\r\n\r\n  reset() {\r\n    if (Unread.lastReadPost == null) { return; }\r\n\r\n    Unread.posts = new Set();\r\n    Unread.postsQuotingYou = new Set();\r\n    Unread.order = new RandomAccessList();\r\n    Unread.position = null;\r\n    Unread.lastReadPost = 0;\r\n    Unread.readCount = 0;\r\n    Unread.thread.posts.forEach(post => Unread.addPost.call(post));\r\n\r\n    $.forceSync('Remember Last Read Post');\r\n    if (Conf['Remember Last Read Post'] && (!Unread.thread.isDead || Unread.thread.isArchived)) {\r\n      Unread.db.set({\r\n        boardID:  Unread.thread.board.ID,\r\n        threadID: Unread.thread.ID,\r\n        val:      0\r\n      });\r\n    }\r\n\r\n    Unread.updatePosition();\r\n    Unread.setLine();\r\n    return Unread.update();\r\n  },\r\n\r\n  sync() {\r\n    if (Unread.lastReadPost == null) { return; }\r\n    const lastReadPost = Unread.db.get({\r\n      boardID: Unread.thread.board.ID,\r\n      threadID: Unread.thread.ID,\r\n      defaultValue: 0\r\n    });\r\n    if (Unread.lastReadPost >= lastReadPost) { return; }\r\n    Unread.lastReadPost = lastReadPost;\r\n\r\n    const postIDs = Unread.thread.posts.keys;\r\n    for (let i = Unread.readCount, end = postIDs.length; i < end; i++) {\r\n      var ID = +postIDs[i];\r\n      if (!Unread.thread.posts.get(ID).isFetchedQuote) {\r\n        if (ID > Unread.lastReadPost) { break; }\r\n        Unread.posts.delete(ID);\r\n        Unread.postsQuotingYou.delete(ID);\r\n      }\r\n      Unread.readCount++;\r\n    }\r\n\r\n    Unread.updatePosition();\r\n    Unread.setLine();\r\n    return Unread.update();\r\n  },\r\n\r\n  addPost() {\r\n    if (this.isFetchedQuote || this.isClone) { return; }\r\n    Unread.order.push(this);\r\n    if ((this.ID <= Unread.lastReadPost) || this.isHidden || QuoteYou.isYou(this)) { return; }\r\n    Unread.posts.add((Unread.posts.last = this.ID));\r\n    Unread.addPostQuotingYou(this);\r\n    return Unread.position != null ? Unread.position : (Unread.position = Unread.order[this.ID]);\r\n  },\r\n\r\n  addPostQuotingYou(post) {\r\n    for (var quotelink of post.nodes.quotelinks) {\r\n      if (QuoteYou.db?.get(Get.postDataFromLink(quotelink))) {\r\n        Unread.postsQuotingYou.add((Unread.postsQuotingYou.last = post.ID));\r\n        Unread.openNotification(post);\r\n        return;\r\n      }\r\n    }\r\n  },\r\n\r\n  openNotification(post, predicate=' replied to you') {\r\n    if (!Header.areNotificationsEnabled) { return; }\r\n    const notif = new Notification(`${post.info.nameBlock}${predicate}`, {\r\n      body: post.commentDisplay(),\r\n      icon: Favicon.logo\r\n    }\r\n    );\r\n    notif.onclick = function() {\r\n      Header.scrollToIfNeeded(post.nodes.bottom, true);\r\n      return window.focus();\r\n    };\r\n    return notif.onshow = () => setTimeout(() => notif.close()\r\n    , 7 * SECOND);\r\n  },\r\n\r\n  onUpdate() {\r\n    return $.queueTask(function() { // ThreadUpdater may scroll immediately after inserting posts\r\n      Unread.setLine();\r\n      Unread.read();\r\n      return Unread.update();\r\n    });\r\n  },\r\n\r\n  readSinglePost(post) {\r\n    const {ID} = post;\r\n    if (!Unread.posts.has(ID)) { return; }\r\n    Unread.posts.delete(ID);\r\n    Unread.postsQuotingYou.delete(ID);\r\n    Unread.updatePosition();\r\n    Unread.saveLastReadPost();\r\n    return Unread.update();\r\n  },\r\n\r\n  read: debounce(100, function(e) {\r\n    // Update the lastReadPost when hidden posts are added to the thread.\r\n    if (!Unread.posts.size && (Unread.readCount !== Unread.thread.posts.keys.length)) {\r\n      Unread.saveLastReadPost();\r\n    }\r\n\r\n    if (d.hidden || !Unread.posts.size) { return; }\r\n\r\n    let count = 0;\r\n    while (Unread.position) {\r\n      var {ID, data} = Unread.position;\r\n      var {bottom} = data.nodes;\r\n      if (!!bottom.getBoundingClientRect().height && // post has been hidden\r\n        (Header.getBottomOf(bottom) <= -1)) { break; }                      // post is completely read\r\n      count++;\r\n      Unread.posts.delete(ID);\r\n      Unread.postsQuotingYou.delete(ID);\r\n      Unread.position = Unread.position.next;\r\n    }\r\n\r\n    if (!count) { return; }\r\n    Unread.updatePosition();\r\n    Unread.saveLastReadPost();\r\n    if (e) { return Unread.update(); }\r\n  }),\r\n\r\n  updatePosition() {\r\n    while (Unread.position && !Unread.posts.has(Unread.position.ID)) {\r\n      Unread.position = Unread.position.next;\r\n    }\r\n  },\r\n\r\n  saveLastReadPost: debounce(2 * SECOND, function() {\r\n    let ID;\r\n    $.forceSync('Remember Last Read Post');\r\n    if (!Conf['Remember Last Read Post'] || !Unread.db) { return; }\r\n    const postIDs = Unread.thread.posts.keys;\r\n    for (let i = Unread.readCount, end = postIDs.length; i < end; i++) {\r\n      ID = +postIDs[i];\r\n      if (!Unread.thread.posts.get(ID).isFetchedQuote) {\r\n        if (Unread.posts.has(ID)) { break; }\r\n        Unread.lastReadPost = ID;\r\n      }\r\n      Unread.readCount++;\r\n    }\r\n    if (Unread.thread.isDead && !Unread.thread.isArchived) { return; }\r\n    return Unread.db.set({\r\n      boardID:  Unread.thread.board.ID,\r\n      threadID: Unread.thread.ID,\r\n      val:      Unread.lastReadPost\r\n    });\r\n  }),\r\n\r\n  setLine(force) {\r\n    if (!Conf['Unread Line']) { return; }\r\n    if (Unread.hr.hidden || d.hidden || (force === true)) {\r\n      const oldPosition = Unread.linePosition;\r\n      if (Unread.linePosition = Unread.positionPrev()) {\r\n        if (Unread.linePosition !== oldPosition) {\r\n          let node = Unread.linePosition.data.nodes.bottom;\r\n          if (node.nextSibling?.tagName === 'BR') { node = node.nextSibling; }\r\n          $.after(node, Unread.hr);\r\n        }\r\n      } else {\r\n        $.rm(Unread.hr);\r\n      }\r\n    }\r\n    return Unread.hr.hidden = Unread.linePosition === Unread.order.last;\r\n  },\r\n\r\n  update() {\r\n    const count = Unread.posts.size;\r\n    const countQuotingYou = Unread.postsQuotingYou.size;\r\n\r\n    if (Conf['Unread Count']) {\r\n      const titleQuotingYou = Conf['Quoted Title'] && countQuotingYou ? '(!) ' : '';\r\n      const titleCount = count || !Conf['Hide Unread Count at (0)'] ? `(${count}) ` : '';\r\n      const titleDead = Unread.thread.isDead ?\r\n        Unread.title.replace('-', (Unread.thread.isArchived ? '- Archived -' : '- 404 -'))\r\n      :\r\n        Unread.title;\r\n      d.title = `${titleQuotingYou}${titleCount}${titleDead}`;\r\n    }\r\n\r\n    Unread.saveThreadWatcherCount();\r\n\r\n    if (Conf['Unread Favicon'] && (g.SITE.software === 'yotsuba')) {\r\n      const {isDead} = Unread.thread;\r\n      return Favicon.set((\r\n        countQuotingYou ?\r\n          (isDead ? 'unreadDeadY' : 'unreadY')\r\n        : count ?\r\n          (isDead ? 'unreadDead' : 'unread')\r\n        :\r\n          (isDead ? 'dead' : 'default')\r\n      )\r\n      );\r\n    }\r\n  },\r\n\r\n  saveThreadWatcherCount: debounce(2 * SECOND, function() {\r\n    $.forceSync('Remember Last Read Post');\r\n    if (Conf['Remember Last Read Post'] && (!Unread.thread.isDead || Unread.thread.isArchived)) {\r\n      let posts;\r\n      const quotingYou = !Conf['Require OP Quote Link'] && QuoteYou.isYou(Unread.thread.OP) ? Unread.posts : Unread.postsQuotingYou;\r\n      if (!quotingYou.size) {\r\n        quotingYou.last = 0;\r\n      } else if (!quotingYou.has(quotingYou.last)) {\r\n        quotingYou.last = 0;\r\n        posts = Unread.thread.posts.keys;\r\n        for (let i = posts.length - 1; i >= 0; i--) {\r\n          if (quotingYou.has(+posts[i])) {\r\n            quotingYou.last = posts[i];\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      return ThreadWatcher.update(g.SITE.ID, Unread.thread.board.ID, Unread.thread.ID, {\r\n        last: Unread.thread.lastPost,\r\n        isDead: Unread.thread.isDead,\r\n        isArchived: Unread.thread.isArchived,\r\n        unread: Unread.posts.size,\r\n        quotingYou: (quotingYou.last || 0)\r\n      }\r\n      );\r\n    }\r\n  })\r\n};\r\nexport default Unread;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Post from \"../classes/Post\";\r\nimport Get from \"../General/Get\";\r\nimport Index from \"../General/Index\";\r\nimport { g, Conf, d } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ExpandThread = {\r\n  statuses: dict(),\r\n  init() {\r\n    if (!((g.VIEW === 'index') && Conf['Thread Expansion'])) { return; }\r\n    if (Conf['JSON Index']) {\r\n      return $.on(d, 'IndexRefreshInternal', this.onIndexRefresh);\r\n    } else {\r\n      return Callbacks.Thread.push({\r\n        name: 'Expand Thread',\r\n        cb() { return ExpandThread.setButton(this); }\r\n      });\r\n    }\r\n  },\r\n\r\n  setButton(thread) {\r\n    let a;\r\n    if (!(thread.nodes.root && (a = $('.summary', thread.nodes.root)))) { return; }\r\n    a.textContent = g.SITE.Build.summaryText('+', ...Array.from(a.textContent.match(/\\d+/g)));\r\n    a.style.cursor = 'pointer';\r\n    return $.on(a, 'click', ExpandThread.cbToggle);\r\n  },\r\n  \r\n  disconnect(refresh) {\r\n    if ((g.VIEW === 'thread') || !Conf['Thread Expansion']) { return; }\r\n    for (var threadID in ExpandThread.statuses) {\r\n      var oldReq;\r\n      var status = ExpandThread.statuses[threadID];\r\n      if (oldReq = status.req) {\r\n        delete status.req;\r\n        oldReq.abort();\r\n      }\r\n      delete ExpandThread.statuses[threadID];\r\n    }\r\n\r\n    if (!refresh) { return $.off(d, 'IndexRefreshInternal', this.onIndexRefresh); }\r\n  },\r\n\r\n  onIndexRefresh() {\r\n    ExpandThread.disconnect(true);\r\n    return g.BOARD.threads.forEach(thread => ExpandThread.setButton(thread));\r\n  },\r\n\r\n  cbToggle(e) {\r\n    if ($.modifiedClick(e)) { return; }\r\n    e.preventDefault();\r\n    return ExpandThread.toggle(Get.threadFromNode(this));\r\n  },\r\n\r\n  cbToggleBottom(e) {\r\n    if ($.modifiedClick(e)) { return; }\r\n    e.preventDefault();\r\n    const thread = Get.threadFromNode(this);\r\n    $.rm(this); // remove before fixing bottom of thread position\r\n    const {bottom} = thread.nodes.root.getBoundingClientRect();\r\n    ExpandThread.toggle(thread);\r\n    return window.scrollBy(0, (thread.nodes.root.getBoundingClientRect().bottom - bottom));\r\n  },\r\n\r\n  toggle(thread) {\r\n    let a;\r\n    if (!(thread.nodes.root && (a = $('.summary', thread.nodes.root)))) { return; }\r\n    if (thread.ID in ExpandThread.statuses) {\r\n      return ExpandThread.contract(thread, a, thread.nodes.root);\r\n    } else {\r\n      return ExpandThread.expand(thread, a);\r\n    }\r\n  },\r\n\r\n  expand(thread, a) {\r\n    let status;\r\n    ExpandThread.statuses[thread] = (status = {});\r\n    a.textContent = g.SITE.Build.summaryText('...', ...Array.from(a.textContent.match(/\\d+/g)));\r\n    status.req = $.cache(g.SITE.urls.threadJSON({boardID: thread.board.ID, threadID: thread.ID}), function() {\r\n      if (this !== status.req) { return; } // aborted\r\n      delete status.req;\r\n      return ExpandThread.parse(this, thread, a);\r\n    });\r\n    return status.numReplies = $$(g.SITE.selectors.replyOriginal, thread.nodes.root).length;\r\n  },\r\n\r\n  contract(thread, a, threadRoot) {\r\n    let oldReq;\r\n    const status = ExpandThread.statuses[thread];\r\n    delete ExpandThread.statuses[thread];\r\n    if (oldReq = status.req) {\r\n      delete status.req;\r\n      oldReq.abort();\r\n      if (a) { a.textContent = g.SITE.Build.summaryText('+', ...Array.from(a.textContent.match(/\\d+/g))); }\r\n      return;\r\n    }\r\n\r\n    let replies = $$('.thread > .replyContainer', threadRoot);\r\n    if (status.numReplies) { replies = replies.slice(0, (-status.numReplies)); }\r\n    let postsCount = 0;\r\n    let filesCount = 0;\r\n    for (var reply of replies) {\r\n      // rm clones\r\n      if (Conf['Quote Inlining']) { var inlined;\r\n      while ((inlined = $('.inlined', reply))) { inlined.click(); } }\r\n      postsCount++;\r\n      if ('file' in Get.postFromRoot(reply)) { filesCount++; }\r\n      $.rm(reply);\r\n    }\r\n    if (Index.enabled) { // otherwise handled by Main.addPosts\r\n      $.event('PostsRemoved', null, a.parentNode);\r\n    }\r\n    a.textContent = g.SITE.Build.summaryText('+', postsCount, filesCount);\r\n    return $.rm($('.summary-bottom', threadRoot));\r\n  },\r\n\r\n  parse(req, thread, a) {\r\n    let root;\r\n    if (![200, 304].includes(req.status)) {\r\n      a.textContent = req.status ? `Error ${req.statusText} (${req.status})` : 'Connection Error';\r\n      return;\r\n    }\r\n\r\n    g.SITE.Build.spoilerRange[thread.board] = req.response.posts[0].custom_spoiler;\r\n\r\n    const posts      = [];\r\n    const postsRoot  = [];\r\n    let filesCount = 0;\r\n    for (var postData of req.response.posts) {\r\n      var post;\r\n      if (postData.no === thread.ID) { continue; }\r\n      if ((post = thread.posts.get(postData.no)) && !post.isFetchedQuote) {\r\n        if ('file' in post) { filesCount++; }\r\n        ({root} = post.nodes);\r\n        postsRoot.push(root);\r\n        continue;\r\n      }\r\n      root = g.SITE.Build.postFromObject(postData, thread.board.ID);\r\n      post = new Post(root, thread, thread.board);\r\n      if ('file' in post) { filesCount++; }\r\n      posts.push(post);\r\n      postsRoot.push(root);\r\n    }\r\n    Main.callbackNodes('Post', posts);\r\n    $.after(a, postsRoot);\r\n    $.event('PostsInserted', null, a.parentNode);\r\n\r\n    const postsCount    = postsRoot.length;\r\n    a.textContent = g.SITE.Build.summaryText('-', postsCount, filesCount);\r\n\r\n    if (root) {\r\n      const a2 = a.cloneNode(true);\r\n      a2.classList.add('summary-bottom');\r\n      $.on(a2, 'click', ExpandThread.cbToggleBottom);\r\n      return $.after(root, a2);\r\n    }\r\n  }\r\n};\r\nexport default ExpandThread;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport DataBoard from \"../classes/DataBoard\";\r\nimport Get from \"../General/Get\";\r\nimport Header from \"../General/Header\";\r\nimport Index from \"../General/Index\";\r\nimport { g, Conf, d } from \"../globals/globals\";\r\nimport ExpandThread from \"../Miscellaneous/ExpandThread\";\r\nimport $ from \"../platform/$\";\r\nimport { dict } from \"../platform/helpers\";\r\nimport QuoteYou from \"../Quotelinks/QuoteYou\";\r\nimport ThreadWatcher from \"./ThreadWatcher\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar UnreadIndex = {\r\n  lastReadPost: dict(),\r\n  hr:           dict(),\r\n  markReadLink: dict(),\r\n\r\n  init() {\r\n    if ((g.VIEW !== 'index') || !Conf['Remember Last Read Post'] || !Conf['Unread Line in Index']) { return; }\r\n\r\n    this.enabled = true;\r\n    this.db = new DataBoard('lastReadPosts', this.sync);\r\n\r\n    Callbacks.Thread.push({\r\n      name: 'Unread Line in Index',\r\n      cb:   this.node\r\n    });\r\n\r\n    $.on(d, 'IndexRefreshInternal', this.onIndexRefresh);\r\n    return $.on(d, 'PostsInserted PostsRemoved', this.onPostsInserted);\r\n  },\r\n\r\n  node() {\r\n    UnreadIndex.lastReadPost[this.fullID] = UnreadIndex.db.get({\r\n      boardID: this.board.ID,\r\n      threadID: this.ID\r\n    }) || 0;\r\n    if (!Index.enabled) { // let onIndexRefresh handle JSON Index\r\n      return UnreadIndex.update(this);\r\n    }\r\n  },\r\n\r\n  onIndexRefresh(e) {\r\n    if (e.detail.isCatalog) { return; }\r\n    return (() => {\r\n      const result = [];\r\n      for (var threadID of e.detail.threadIDs) {\r\n        var thread = g.threads.get(threadID);\r\n        result.push(UnreadIndex.update(thread));\r\n      }\r\n      return result;\r\n    })();\r\n  },\r\n\r\n  onPostsInserted(e) {\r\n    if (e.target === Index.root) { return; } // onIndexRefresh handles this case\r\n    const thread = Get.threadFromNode(e.target);\r\n    if (!thread || (thread.nodes.root !== e.target)) { return; }\r\n    const wasVisible = !!UnreadIndex.hr[thread.fullID]?.parentNode;\r\n    UnreadIndex.update(thread);\r\n    if (Conf['Scroll to Last Read Post'] && (e.type === 'PostsInserted') && !wasVisible && !!UnreadIndex.hr[thread.fullID]?.parentNode) {\r\n      return Header.scrollToIfNeeded(UnreadIndex.hr[thread.fullID], true);\r\n    }\r\n  },\r\n\r\n  sync() {\r\n    return g.threads.forEach(function(thread) {\r\n      const lastReadPost = UnreadIndex.db.get({\r\n        boardID: thread.board.ID,\r\n        threadID: thread.ID\r\n      }) || 0;\r\n      if (lastReadPost !== UnreadIndex.lastReadPost[thread.fullID]) {\r\n        UnreadIndex.lastReadPost[thread.fullID] = lastReadPost;\r\n        if (thread.nodes.root?.parentNode) {\r\n          return UnreadIndex.update(thread);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  update(thread) {\r\n    let divider;\r\n    const lastReadPost = UnreadIndex.lastReadPost[thread.fullID];\r\n    let repliesShown = 0;\r\n    let repliesRead = 0;\r\n    let firstUnread = null;\r\n    thread.posts.forEach(function(post) {\r\n      if (post.isReply && thread.nodes.root.contains(post.nodes.root)) {\r\n        repliesShown++;\r\n        if (post.ID <= lastReadPost) {\r\n          return repliesRead++;\r\n        } else if ((!firstUnread || (post.ID < firstUnread.ID)) && !post.isHidden && !QuoteYou.isYou(post)) {\r\n          return firstUnread = post;\r\n        }\r\n      }\r\n    });\r\n\r\n    let hr = UnreadIndex.hr[thread.fullID];\r\n    if (firstUnread && (repliesRead || ((lastReadPost === thread.OP.ID) && (!$(g.SITE.selectors.summary, thread.nodes.root) || thread.ID in ExpandThread.statuses)))) {\r\n      if (!hr) {\r\n        hr = (UnreadIndex.hr[thread.fullID] = $.el('hr',\r\n          {className: 'unread-line'}));\r\n      }\r\n      $.before(firstUnread.nodes.root, hr);\r\n    } else {\r\n      $.rm(hr);\r\n    }\r\n\r\n    const hasUnread = repliesShown ?\r\n      firstUnread || !repliesRead\r\n    : Index.enabled ?\r\n      thread.lastPost > lastReadPost\r\n    :\r\n      thread.OP.ID > lastReadPost;\r\n    thread.nodes.root.classList.toggle('unread-thread', hasUnread);\r\n\r\n    let link = UnreadIndex.markReadLink[thread.fullID];\r\n    if (!link) {\r\n      link = (UnreadIndex.markReadLink[thread.fullID] = $.el('a', {\r\n        className: 'unread-mark-read brackets-wrap',\r\n        href: 'javascript:;',\r\n        textContent: 'Mark Read'\r\n      }\r\n      ));\r\n      $.on(link, 'click', UnreadIndex.markRead);\r\n    }\r\n    if (divider = $(g.SITE.selectors.threadDivider, thread.nodes.root)) { // divider inside thread as in Tinyboard\r\n      return $.before(divider, link);\r\n    } else {\r\n      return $.add(thread.nodes.root, link);\r\n    }\r\n  },\r\n\r\n  markRead() {\r\n    const thread = Get.threadFromNode(this);\r\n    UnreadIndex.lastReadPost[thread.fullID] = thread.lastPost;\r\n    UnreadIndex.db.set({\r\n      boardID:  thread.board.ID,\r\n      threadID: thread.ID,\r\n      val:      thread.lastPost\r\n    });\r\n    $.rm(UnreadIndex.hr[thread.fullID]);\r\n    thread.nodes.root.classList.remove('unread-thread');\r\n    return ThreadWatcher.update(g.SITE.ID, thread.board.ID, thread.ID, {\r\n      last: thread.lastPost,\r\n      unread: 0,\r\n      quotingYou: 0\r\n    }\r\n    );\r\n  }\r\n};\r\nexport default UnreadIndex;\r\n","import ThreadWatcherPage from './ThreadWatcher/ThreadWatcher.html';\r\nimport $ from \"../platform/$\";\r\nimport Board from '../classes/Board';\r\nimport Callbacks from '../classes/Callbacks';\r\nimport DataBoard from '../classes/DataBoard';\r\nimport Thread from '../classes/Thread';\r\nimport Filter from '../Filtering/Filter';\r\nimport Main from '../main/Main';\r\nimport $$ from '../platform/$$';\r\nimport Config from '../config/Config';\r\nimport CrossOrigin from '../platform/CrossOrigin';\r\nimport PostRedirect from '../Posting/PostRedirect';\r\nimport QuoteYou from '../Quotelinks/QuoteYou';\r\nimport Unread from './Unread';\r\nimport UnreadIndex from './UnreadIndex';\r\nimport Header from '../General/Header';\r\nimport Index from '../General/Index';\r\nimport { Conf, d, doc, g } from '../globals/globals';\r\nimport Menu from '../Menu/Menu';\r\nimport UI from '../General/UI';\r\nimport Get from '../General/Get';\r\nimport { dict, HOUR, MINUTE } from '../platform/helpers';\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n\r\nvar ThreadWatcher = {\r\n  init() {\r\n    let sc;\r\n    if (!(this.enabled = Conf['Thread Watcher'])) { return; }\r\n\r\n    this.shortcut = (sc = $.el('a', {\r\n      id:          'watcher-link',\r\n      textContent: '',\r\n      title:       'Thread Watcher',\r\n      href:        'javascript:;',\r\n    }\r\n    ));\r\n\r\n    this.db     = new DataBoard('watchedThreads', this.refresh, true);\r\n    this.dbLM   = new DataBoard('watcherLastModified', null, true);\r\n    this.dialog = UI.dialog('thread-watcher', { innerHTML: ThreadWatcherPage });\r\n    this.status = $('#watcher-status', this.dialog);\r\n    this.list   = this.dialog.lastElementChild;\r\n    this.refreshButton = $('.refresh', this.dialog);\r\n    this.closeButton = $('.move > .close', this.dialog);\r\n    this.unreaddb = Unread.db || UnreadIndex.db || new DataBoard('lastReadPosts');\r\n    this.unreadEnabled = Conf['Remember Last Read Post'];\r\n\r\n    $.on(d, 'QRPostSuccessful',   this.cb.post);\r\n    $.on(sc, 'click', this.toggleWatcher);\r\n    $.on(this.refreshButton, 'click', this.buttonFetchAll);\r\n    $.on(this.closeButton, 'click', this.toggleWatcher);\r\n\r\n    this.menu.addHeaderMenuEntry();\r\n    $.onExists(doc, 'body', this.addDialog);\r\n\r\n    switch (g.VIEW) {\r\n      case 'index':\r\n        $.on(d, 'IndexUpdate', this.cb.onIndexUpdate);\r\n        break;\r\n      case 'thread':\r\n        $.on(d, 'ThreadUpdate', this.cb.onThreadRefresh);\r\n        break;\r\n    }\r\n\r\n    if (Conf['Fixed Thread Watcher']) {\r\n      $.addClass(doc, 'fixed-watcher');\r\n    }\r\n    if (!Conf['Persistent Thread Watcher']) {\r\n      $.addClass(ThreadWatcher.shortcut, 'disabled');\r\n      this.dialog.hidden = true;\r\n    }\r\n\r\n    Header.addShortcut('watcher', sc, 510);\r\n\r\n    ThreadWatcher.initLastModified();\r\n    ThreadWatcher.fetchAuto();\r\n    $.on(window, 'visibilitychange focus', () => $.queueTask(ThreadWatcher.fetchAuto));\r\n\r\n    if (Conf['Menu'] && Index.enabled) {\r\n      Menu.menu.addEntry({\r\n        el: $.el('a', {\r\n          href:      'javascript:;',\r\n          className: 'has-shortcut-text'\r\n        }\r\n        , {innerHTML: '<span></span><span class=\"shortcut-text\">Alt+click</span>'}),\r\n        order: 6,\r\n        open({thread}) {\r\n          if (Conf['Index Mode'] !== 'catalog') { return false; }\r\n          this.el.firstElementChild.textContent = ThreadWatcher.isWatched(thread) ?\r\n            'Unwatch'\r\n          :\r\n            'Watch';\r\n          if (this.cb) { $.off(this.el, 'click', this.cb); }\r\n          this.cb = function() {\r\n            $.event('CloseMenu');\r\n            return ThreadWatcher.toggle(thread);\r\n          };\r\n          $.on(this.el, 'click', this.cb);\r\n          return true;\r\n        }\r\n      });\r\n    }\r\n\r\n    if (!['index', 'thread'].includes(g.VIEW)) { return; }\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Thread Watcher',\r\n      cb:   this.node\r\n    });\r\n    return Callbacks.CatalogThread.push({\r\n      name: 'Thread Watcher',\r\n      cb:   this.catalogNode\r\n    });\r\n  },\r\n\r\n  isWatched(thread) {\r\n    return !!ThreadWatcher.db?.get({boardID: thread.board.ID, threadID: thread.ID});\r\n  },\r\n\r\n  isWatchedRaw(boardID, threadID) {\r\n    return !!ThreadWatcher.db?.get({boardID, threadID});\r\n  },\r\n\r\n  setToggler(toggler, isWatched) {\r\n    toggler.classList.toggle('watched', isWatched);\r\n    return toggler.title = `${isWatched ? 'Unwatch' : 'Watch'} Thread`;\r\n  },\r\n\r\n  node() {\r\n    let toggler;\r\n    if (this.isReply) { return; }\r\n    if (this.isClone) {\r\n      toggler = $('.watch-thread-link', this.nodes.info);\r\n    } else {\r\n      toggler = $.el('a', {\r\n        href: 'javascript:;',\r\n        className: 'watch-thread-link'\r\n      }\r\n      );\r\n      $.before($('input', this.nodes.info), toggler);\r\n    }\r\n    const siteID = g.SITE.ID;\r\n    const boardID = this.board.ID;\r\n    const threadID = this.thread.ID;\r\n    const data = ThreadWatcher.db.get({siteID, boardID, threadID});\r\n    ThreadWatcher.setToggler(toggler, !!data);\r\n    $.on(toggler, 'click', ThreadWatcher.cb.toggle);\r\n    // Add missing excerpt for threads added by Auto Watch\r\n    if (data && (data.excerpt == null)) {\r\n      return $.queueTask(() => {\r\n        return ThreadWatcher.update(siteID, boardID, threadID, {excerpt: Get.threadExcerpt(this.thread)});\r\n    });\r\n    }\r\n  },\r\n\r\n  catalogNode() {\r\n    if (ThreadWatcher.isWatched(this.thread)) { $.addClass(this.nodes.root, 'watched'); }\r\n    return $.on(this.nodes.root, 'mousedown click', e => {\r\n      if ((e.button !== 0) || !e.altKey) { return; }\r\n      if (e.type === 'click') { ThreadWatcher.toggle(this.thread); }\r\n      return e.preventDefault();\r\n    });\r\n  }, // Also on mousedown to prevent highlighting thumbnail in Firefox.\r\n\r\n  addDialog() {\r\n    if (!Main.isThisPageLegit()) { return; }\r\n    ThreadWatcher.build();\r\n    return $.prepend(d.body, ThreadWatcher.dialog);\r\n  },\r\n\r\n  toggleWatcher() {\r\n    $.toggleClass(ThreadWatcher.shortcut, 'disabled');\r\n    return ThreadWatcher.dialog.hidden = !ThreadWatcher.dialog.hidden;\r\n  },\r\n\r\n  cb: {\r\n    openAll() {\r\n      if ($.hasClass(this, 'disabled')) { return; }\r\n      for (var a of $$('a.watcher-link', ThreadWatcher.list)) {\r\n        $.open(a.href);\r\n      }\r\n      return $.event('CloseMenu');\r\n    },\r\n    openUnread() {\r\n      if ($.hasClass(this, 'disabled')) { return; }\r\n      for (var a of $$('.replies-unread > a.watcher-link', ThreadWatcher.list)) {\r\n        $.open(a.href);\r\n      }\r\n      return $.event('CloseMenu');\r\n    },\r\n    openDeads() {\r\n      if ($.hasClass(this, 'disabled')) { return; }\r\n      for (var a of $$('.dead-thread > a.watcher-link', ThreadWatcher.list)) {\r\n        $.open(a.href);\r\n      }\r\n      return $.event('CloseMenu');\r\n    },\r\n    pruneDeads() {\r\n      if ($.hasClass(this, 'disabled')) { return; }\r\n      for (var {siteID, boardID, threadID, data} of ThreadWatcher.getAll()) {\r\n        if (data.isDead) {\r\n          ThreadWatcher.db.delete({siteID, boardID, threadID});\r\n        }\r\n      }\r\n      ThreadWatcher.refresh();\r\n      return $.event('CloseMenu');\r\n    },\r\n    dismiss() {\r\n      for (var {siteID, boardID, threadID, data} of ThreadWatcher.getAll()) {\r\n        if (data.quotingYou) {\r\n          ThreadWatcher.update(siteID, boardID, threadID, {dismiss: data.quotingYou || 0});\r\n        }\r\n      }\r\n      return $.event('CloseMenu');\r\n    },\r\n    toggle() {\r\n      const {thread} = Get.postFromNode(this);\r\n      return ThreadWatcher.toggle(thread);\r\n    },\r\n    rm() {\r\n      const {siteID} = this.parentNode.dataset;\r\n      const [boardID, threadID] = Array.from(this.parentNode.dataset.fullID.split('.'));\r\n      return ThreadWatcher.rm(siteID, boardID, +threadID);\r\n    },\r\n    post(e) {\r\n      const {boardID, threadID, postID} = e.detail;\r\n      const cb = PostRedirect.delay();\r\n      if (postID === threadID) {\r\n        if (Conf['Auto Watch']) {\r\n          return ThreadWatcher.addRaw(boardID, threadID, {}, cb);\r\n        }\r\n      } else if (Conf['Auto Watch Reply']) {\r\n        return ThreadWatcher.add((g.threads.get(boardID + '.' + threadID) || new Thread(threadID, g.boards[boardID] || new Board(boardID))), cb);\r\n      }\r\n    },\r\n    onIndexUpdate(e) {\r\n      const {db}    = ThreadWatcher;\r\n      const siteID  = g.SITE.ID;\r\n      const boardID = g.BOARD.ID;\r\n      let nKilled = 0;\r\n      for (var threadID in db.data[siteID].boards[boardID]) {\r\n        // Don't prune threads that have yet to appear in index.\r\n        var data = db.data[siteID].boards[boardID][threadID];\r\n        if (!data?.isDead && !e.detail.threads.includes(`${boardID}.${threadID}`)) {\r\n          if (!e.detail.threads.some(fullID => +fullID.split('.')[1] > threadID)) { continue; }\r\n          if (Conf['Auto Prune'] || !(data && (typeof data === 'object'))) { // corrupt data\r\n            db.delete({boardID, threadID});\r\n            nKilled++;\r\n          } else {\r\n            ThreadWatcher.fetchStatus({siteID, boardID, threadID, data});\r\n          }\r\n        }\r\n      }\r\n      if (nKilled) { return ThreadWatcher.refresh(); }\r\n    },\r\n    onThreadRefresh(e) {\r\n      const thread = g.threads.get(e.detail.threadID);\r\n      if (!e.detail[404] || !ThreadWatcher.isWatched(thread)) { return; }\r\n      // Update dead status.\r\n      return ThreadWatcher.add(thread);\r\n    }\r\n  },\r\n\r\n  requests: [],\r\n  fetched:  0,\r\n\r\n  fetch(url, {siteID, force}, args, cb) {\r\n    if (ThreadWatcher.requests.length === 0) {\r\n      ThreadWatcher.status.textContent = '...';\r\n      $.addClass(ThreadWatcher.refreshButton, 'spin');\r\n    }\r\n    const onloadend = function() {\r\n      if (this.finished) { return; }\r\n      this.finished = true;\r\n      ThreadWatcher.fetched++;\r\n      if (ThreadWatcher.fetched === ThreadWatcher.requests.length) {\r\n        ThreadWatcher.clearRequests();\r\n      } else {\r\n        ThreadWatcher.status.textContent = `${Math.round((ThreadWatcher.fetched / ThreadWatcher.requests.length) * 100)}%`;\r\n      }\r\n      return cb.apply(this, args);\r\n    };\r\n    const ajax = siteID === g.SITE.ID ? $.ajax : CrossOrigin.ajax;\r\n    if (force) {\r\n      delete $.lastModified.ThreadWatcher?.[url];\r\n    }\r\n    const req = $.whenModified(\r\n      url,\r\n      'ThreadWatcher',\r\n      onloadend,\r\n      { timeout: MINUTE, ajax }\r\n    );\r\n    return ThreadWatcher.requests.push(req);\r\n  },\r\n\r\n  clearRequests() {\r\n    ThreadWatcher.requests = [];\r\n    ThreadWatcher.fetched = 0;\r\n    ThreadWatcher.status.textContent = '';\r\n    return $.rmClass(ThreadWatcher.refreshButton, 'spin');\r\n  },\r\n\r\n  abort() {\r\n    delete ThreadWatcher.syncing;\r\n    for (var req of ThreadWatcher.requests) {\r\n      if (!req.finished) {\r\n        req.finished = true;\r\n        req.abort();\r\n      }\r\n    }\r\n    return ThreadWatcher.clearRequests();\r\n  },\r\n\r\n  initLastModified() {\r\n    const lm = ($.lastModified['ThreadWatcher'] || ($.lastModified['ThreadWatcher'] = dict()));\r\n    for (var siteID in ThreadWatcher.dbLM.data) {\r\n      var boards = ThreadWatcher.dbLM.data[siteID];\r\n      for (var boardID in boards.boards) {\r\n        var data = boards.boards[boardID];\r\n        if (ThreadWatcher.db.get({siteID, boardID})) {\r\n          for (var url in data) {\r\n            var date = data[url];\r\n            lm[url] = date;\r\n          }\r\n        } else {\r\n          ThreadWatcher.dbLM.delete({siteID, boardID});\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  fetchAuto() {\r\n    let middle;\r\n    clearTimeout(ThreadWatcher.timeout);\r\n    if (!Conf['Auto Update Thread Watcher']) { return; }\r\n    const {db} = ThreadWatcher;\r\n    const interval = Conf['Show Page'] || (ThreadWatcher.unreadEnabled && Conf['Show Unread Count']) ? 5 * MINUTE : 2 * HOUR;\r\n    const now = Date.now();\r\n    if ((now - interval >= ((middle = db.data.lastChecked || 0)) || middle > now) && !d.hidden && !!d.hasFocus()) {\r\n      ThreadWatcher.fetchAllStatus(interval);\r\n    }\r\n    return ThreadWatcher.timeout = setTimeout(ThreadWatcher.fetchAuto, interval);\r\n  },\r\n\r\n  buttonFetchAll() {\r\n    if (ThreadWatcher.syncing || ThreadWatcher.requests.length) {\r\n      return ThreadWatcher.abort();\r\n    } else {\r\n      return ThreadWatcher.fetchAllStatus();\r\n    }\r\n  },\r\n\r\n  fetchAllStatus(interval=0) {\r\n    ThreadWatcher.status.textContent = '...';\r\n    $.addClass(ThreadWatcher.refreshButton, 'spin');\r\n    ThreadWatcher.syncing = true;\r\n    const dbs = [ThreadWatcher.db, ThreadWatcher.unreaddb, QuoteYou.db].filter(x => x);\r\n    let n = 0;\r\n    return dbs.map((dbi) =>\r\n      dbi.forceSync(function() {\r\n        if ((++n) === dbs.length) {\r\n          let middle;\r\n          if (!ThreadWatcher.syncing) { return; } // aborted\r\n          delete ThreadWatcher.syncing;\r\n          if (0 > (middle = Date.now() - (ThreadWatcher.db.data.lastChecked || 0)) || middle >= interval) { // not checked in another tab\r\n            // XXX On vichan boards, last_modified field of threads.json does not account for sage posts.\r\n            // Occasionally check replies field of catalog.json to find these posts.\r\n            let middle1;\r\n            const {db} = ThreadWatcher;\r\n            const now = Date.now();\r\n            const deep = !(now - (2 * HOUR) < ((middle1 = db.data.lastChecked2 || 0)) && middle1 <= now);\r\n            const boards = ThreadWatcher.getAll(true);\r\n            for (var board of boards) {\r\n              ThreadWatcher.fetchBoard(board, deep);\r\n            }\r\n            db.setLastChecked();\r\n            if (deep) { db.setLastChecked('lastChecked2'); }\r\n          }\r\n          if (ThreadWatcher.fetched === ThreadWatcher.requests.length) {\r\n            return ThreadWatcher.clearRequests();\r\n          }\r\n        }\r\n      }));\r\n  },\r\n\r\n  fetchBoard(board, deep) {\r\n    if (!board.some(thread => !thread.data.isDead)) { return; }\r\n    let force = false;\r\n    for (var thread of board) {\r\n      var {data} = thread;\r\n      if (!data.isDead && (data.last !== -1)) {\r\n        if (Conf['Show Page'] && (data.page == null)) { force = true; }\r\n        if ((data.modified == null)) { force = (thread.force = true); }\r\n      }\r\n    }\r\n    const {siteID, boardID} = board[0];\r\n    const site = g.sites[siteID];\r\n    if (!site) { return; }\r\n    const urlF = deep && site.threadModTimeIgnoresSage ? 'catalogJSON' : 'threadsListJSON';\r\n    const url = site.urls[urlF]?.({siteID, boardID});\r\n    if (!url) { return; }\r\n    return ThreadWatcher.fetch(url, {siteID, force}, [board, url], ThreadWatcher.parseBoard);\r\n  },\r\n\r\n  parseBoard(board, url) {\r\n    let page, thread;\r\n    if (this.status !== 200) { return; }\r\n    const {siteID, boardID} = board[0];\r\n    const lmDate = this.getResponseHeader('Last-Modified');\r\n    ThreadWatcher.dbLM.extend({siteID, boardID, val: $.item(url, lmDate)});\r\n    const threads = dict();\r\n    let pageLength = 0;\r\n    let nThreads = 0;\r\n    let oldest = null;\r\n    try {\r\n      pageLength = this.response[0]?.threads.length || 0;\r\n      for (let i = 0; i < this.response.length; i++) {\r\n        page = this.response[i];\r\n        for (var item of page.threads) {\r\n          threads[item.no] = {\r\n            page: i + 1,\r\n            index: nThreads,\r\n            modified: item.last_modified,\r\n            replies: item.replies\r\n          };\r\n          nThreads++;\r\n          if ((oldest == null) || (item.no < oldest)) {\r\n            oldest = item.no;\r\n          }\r\n        }\r\n      }\r\n    } catch (error) {\r\n      for (thread of board) {\r\n        ThreadWatcher.fetchStatus(thread);\r\n      }\r\n    }\r\n    for (thread of board) {\r\n      var {threadID, data} = thread;\r\n      if (threads[threadID]) {\r\n        var index, modified, replies;\r\n        ({page, index, modified, replies} = threads[threadID]);\r\n        if (Conf['Show Page']) {\r\n          var lastPage = g.sites[siteID].isPrunedByAge?.({siteID, boardID}) ?\r\n            threadID === oldest\r\n          :\r\n            index >= (nThreads - pageLength);\r\n          ThreadWatcher.update(siteID, boardID, threadID, {page, lastPage});\r\n        }\r\n        if (ThreadWatcher.unreadEnabled && Conf['Show Unread Count']) {\r\n          if ((modified !== data.modified) || ((replies != null) && (replies !== data.replies))) {\r\n            (thread.newData || (thread.newData = {})).modified = modified;\r\n            ThreadWatcher.fetchStatus(thread);\r\n          }\r\n        }\r\n      } else {\r\n        ThreadWatcher.fetchStatus(thread);\r\n      }\r\n    }\r\n  },\r\n\r\n  fetchStatus(thread) {\r\n    const {siteID, boardID, threadID, data, force} = thread;\r\n    const url = g.sites[siteID]?.urls.threadJSON?.({siteID, boardID, threadID});\r\n    if (!url) { return; }\r\n    if (data.isDead && !force) { return; }\r\n    if (data.last === -1) { return; } // 404 or no JSON API\r\n    return ThreadWatcher.fetch(url, {siteID, force}, [thread], ThreadWatcher.parseStatus);\r\n  },\r\n\r\n  parseStatus(thread, isArchiveURL) {\r\n    let isDead, last;\r\n    let {siteID, boardID, threadID, data, newData, force} = thread;\r\n    const site = g.sites[siteID];\r\n    if ((this.status === 200) && this.response) {\r\n      let isArchived;\r\n      last = this.response.posts[this.response.posts.length-1].no;\r\n      const replies = this.response.posts.length-1;\r\n      isDead = (isArchived = !!(this.response.posts[0].archived || isArchiveURL));\r\n      if (isDead && Conf['Auto Prune']) {\r\n        ThreadWatcher.rm(siteID, boardID, threadID);\r\n        return;\r\n      }\r\n\r\n      if ((last === data.last) && (isDead === data.isDead) && (isArchived === data.isArchived)) { return; }\r\n\r\n      const lastReadPost = ThreadWatcher.unreaddb.get({siteID, boardID, threadID, defaultValue: 0});\r\n      let unread = data.unread || 0;\r\n      let quotingYou = data.quotingYou || 0;\r\n      const youOP = !!QuoteYou.db?.get({siteID, boardID, threadID, postID: threadID});\r\n\r\n      for (var postObj of this.response.posts) {\r\n        if ((postObj.no <= (data.last || 0)) || (postObj.no <= lastReadPost)) { continue; }\r\n        if (QuoteYou.db?.get({siteID, boardID, threadID, postID: postObj.no})) { continue; }\r\n\r\n        var quotesYou = false;\r\n        if (!Conf['Require OP Quote Link'] && youOP) {\r\n          quotesYou = true;\r\n        } else if (QuoteYou.db && postObj.com) {\r\n          var match;\r\n          var regexp = site.regexp.quotelinkHTML;\r\n          regexp.lastIndex = 0;\r\n          while (match = regexp.exec(postObj.com)) {\r\n            if (QuoteYou.db.get({\r\n              siteID,\r\n              boardID:  match[1] ? encodeURIComponent(match[1]) : boardID,\r\n              threadID: match[2] || threadID,\r\n              postID:   match[3] || match[2] || threadID\r\n            })) {\r\n              quotesYou = true;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (!unread || (!quotingYou && quotesYou)) {\r\n          if (Filter.isHidden(site.Build.parseJSON(postObj, {siteID, boardID}))) { continue; }\r\n        }\r\n\r\n        unread++;\r\n        if (quotesYou) { quotingYou = postObj.no; }\r\n      }\r\n\r\n      if (!newData) { newData = {}; }\r\n      $.extend(newData, {last, replies, isDead, isArchived, unread, quotingYou});\r\n      return ThreadWatcher.update(siteID, boardID, threadID, newData);\r\n\r\n    } else if (this.status === 404) {\r\n      const archiveURL = g.sites[siteID]?.urls.archivedThreadJSON?.({siteID, boardID, threadID});\r\n      if (!isArchiveURL && archiveURL) {\r\n        return ThreadWatcher.fetch(archiveURL, {siteID, force}, [thread, true], ThreadWatcher.parseStatus);\r\n      } else if (site.mayLackJSON && (data.last == null)) {\r\n        return ThreadWatcher.update(siteID, boardID, threadID, {last: -1});\r\n      } else {\r\n        return ThreadWatcher.update(siteID, boardID, threadID, {isDead: true});\r\n      }\r\n    }\r\n  },\r\n\r\n  getAll(groupByBoard) {\r\n    const all = [];\r\n    for (var siteID in ThreadWatcher.db.data) {\r\n      var boards = ThreadWatcher.db.data[siteID];\r\n      for (var boardID in boards.boards) {\r\n        var cont;\r\n        var threads = boards.boards[boardID];\r\n        if (Conf['Current Board'] && ((siteID !== g.SITE.ID) || (boardID !== g.BOARD.ID))) {\r\n          continue;\r\n        }\r\n        if (groupByBoard) {\r\n          all.push((cont = []));\r\n        }\r\n        for (var threadID in threads) {\r\n          var data = threads[threadID];\r\n          if (data && (typeof data === 'object')) {\r\n            (groupByBoard ? cont : all).push({siteID, boardID, threadID, data});\r\n          }\r\n        }\r\n      }\r\n    }\r\n    return all;\r\n  },\r\n\r\n  makeLine(siteID, boardID, threadID, data) {\r\n    let page;\r\n    const x = $.el('a', {\r\n      textContent: '',\r\n      href: 'javascript:;'\r\n    }\r\n    );\r\n    $.on(x, 'click', ThreadWatcher.cb.rm);\r\n\r\n    let {excerpt, isArchived} = data;\r\n    if (!excerpt) { excerpt = `/${boardID}/ - No.${threadID}`; }\r\n    if (Conf['Show Site Prefix']) { excerpt = ThreadWatcher.prefixes[siteID] + excerpt; }\r\n\r\n    const link = $.el('a', {\r\n      href: g.sites[siteID]?.urls.thread({siteID, boardID, threadID}, isArchived) || '',\r\n      title: excerpt,\r\n      className: 'watcher-link'\r\n    }\r\n    );\r\n\r\n    if (Conf['Show Page'] && (data.page != null)) {\r\n      page = $.el('span', {\r\n        textContent: `[${data.page}]`,\r\n        className: 'watcher-page'\r\n      }\r\n      );\r\n      $.add(link, page);\r\n    }\r\n\r\n    if (ThreadWatcher.unreadEnabled && Conf['Show Unread Count'] && (data.unread != null)) {\r\n      const count = $.el('span', {\r\n        textContent: `(${data.unread})`,\r\n        className: 'watcher-unread'\r\n      }\r\n      );\r\n      $.add(link, count);\r\n    }\r\n\r\n    const title = $.el('span', {\r\n      textContent: excerpt,\r\n      className: 'watcher-title'\r\n    }\r\n    );\r\n    $.add(link, title);\r\n\r\n    const div = $.el('div');\r\n    const fullID = `${boardID}.${threadID}`;\r\n    div.dataset.fullID = fullID;\r\n    div.dataset.siteID = siteID;\r\n    if ((g.VIEW === 'thread') && (fullID === `${g.BOARD}.${g.THREADID}`)) { $.addClass(div, 'current'); }\r\n    if (data.isDead) { $.addClass(div, 'dead-thread'); }\r\n    if (Conf['Show Page']) {\r\n      if (data.lastPage) { $.addClass(div, 'last-page'); }\r\n      if (data.page != null) { div.dataset.page = data.page; }\r\n    }\r\n    if (ThreadWatcher.unreadEnabled && Conf['Show Unread Count']) {\r\n      if (data.unread === 0) { $.addClass(div, 'replies-read'); }\r\n      if (data.unread) { $.addClass(div, 'replies-unread'); }\r\n      if ((data.quotingYou || 0) > (data.dismiss || 0)) { $.addClass(div, 'replies-quoting-you'); }\r\n    }\r\n    $.add(div, [x, $.tn(' '), link]);\r\n    return div;\r\n  },\r\n\r\n  setPrefixes(threads) {\r\n    const prefixes = dict();\r\n    for (var {siteID} of threads) {\r\n      if (siteID in prefixes) { continue; }\r\n      var len = 0;\r\n      var prefix = '';\r\n      var conflicts = Object.keys(prefixes);\r\n      while (conflicts.length > 0) {\r\n        len++;\r\n        prefix = siteID.slice(0, len);\r\n        var conflicts2 = [];\r\n        for (var siteID2 of conflicts) {\r\n          if (siteID2.slice(0, len) === prefix) {\r\n            conflicts2.push(siteID2);\r\n          } else if (prefixes[siteID2].length < len) {\r\n            prefixes[siteID2] = siteID2.slice(0, len);\r\n          }\r\n        }\r\n        conflicts = conflicts2;\r\n      }\r\n      prefixes[siteID] = prefix;\r\n    }\r\n    return ThreadWatcher.prefixes = prefixes;\r\n  },\r\n\r\n  build() {\r\n    const nodes = [];\r\n    const threads = ThreadWatcher.getAll();\r\n    ThreadWatcher.setPrefixes(threads);\r\n    for (var {siteID, boardID, threadID, data} of threads) {\r\n      // Add missing excerpt for threads added by Auto Watch\r\n      var thread;\r\n      if ((data.excerpt == null) && (siteID === g.SITE.ID) && (thread = g.threads.get(`${boardID}.${threadID}`)) && thread.OP) {\r\n        ThreadWatcher.db.extend({boardID, threadID, val: {excerpt: Get.threadExcerpt(thread)}});\r\n      }\r\n      nodes.push(ThreadWatcher.makeLine(siteID, boardID, threadID, data));\r\n    }\r\n    const {list} = ThreadWatcher;\r\n    $.rmAll(list);\r\n    $.add(list, nodes);\r\n\r\n    return ThreadWatcher.refreshIcon();\r\n  },\r\n\r\n  refresh() {\r\n    ThreadWatcher.build();\r\n\r\n    g.threads.forEach(function(thread) {\r\n      const isWatched = ThreadWatcher.isWatched(thread);\r\n      if (thread.OP) {\r\n        for (var post of [thread.OP, ...Array.from(thread.OP.clones)]) {\r\n          var toggler;\r\n          if (toggler = $('.watch-thread-link', post.nodes.info)) {\r\n            ThreadWatcher.setToggler(toggler, isWatched);\r\n          }\r\n        }\r\n      }\r\n      if (thread.catalogView) { return thread.catalogView.nodes.root.classList.toggle('watched', isWatched); }\r\n    });\r\n\r\n    if (Conf['Pin Watched Threads']) {\r\n      return $.event('SortIndex', {deferred: Conf['Index Mode'] !== 'catalog'});\r\n    }\r\n  },\r\n\r\n  refreshIcon() {\r\n    for (var className of ['replies-unread', 'replies-quoting-you']) {\r\n      ThreadWatcher.shortcut.classList.toggle(className, !!$(`.${className}`, ThreadWatcher.dialog));\r\n    }\r\n  },\r\n\r\n  update(siteID, boardID, threadID, newData) {\r\n    let data, key, line, val;\r\n    if (!(data = ThreadWatcher.db?.get({siteID, boardID, threadID}))) { return; }\r\n    if (newData.isDead && Conf['Auto Prune']) {\r\n      ThreadWatcher.rm(siteID, boardID, threadID);\r\n      return;\r\n    }\r\n    if (newData.isDead || (newData.last === -1)) {\r\n      for (key of ['isArchived', 'page', 'lastPage', 'unread', 'quotingyou']) {\r\n        if (!(key in newData)) {\r\n          newData[key] = undefined;\r\n        }\r\n      }\r\n    }\r\n    if ((newData.last != null) && (newData.last < data.last)) {\r\n      newData.modified = undefined;\r\n    }\r\n    let n = 0;\r\n    for (key in newData) { val = newData[key]; if (data[key] !== val) { n++; } }\r\n    if (!n) { return; }\r\n    ThreadWatcher.db.extend({siteID, boardID, threadID, val: newData});\r\n    if (line = $(`#watched-threads > [data-site-i-d='${siteID}'][data-full-i-d='${boardID}.${threadID}']`, ThreadWatcher.dialog)) {\r\n      const newLine = ThreadWatcher.makeLine(siteID, boardID, threadID, data);\r\n      $.replace(line, newLine);\r\n      return ThreadWatcher.refreshIcon();\r\n    } else {\r\n      return ThreadWatcher.refresh();\r\n    }\r\n  },\r\n\r\n  set404(boardID, threadID, cb) {\r\n    let data;\r\n    if (!(data = ThreadWatcher.db?.get({boardID, threadID}))) { return cb(); }\r\n    if (Conf['Auto Prune']) {\r\n      ThreadWatcher.db.delete({boardID, threadID});\r\n      return cb();\r\n    }\r\n    if (data.isDead && !((data.isArchived != null) || (data.page != null) || (data.lastPage != null) || (data.unread != null) || (data.quotingYou != null))) { return cb(); }\r\n    return ThreadWatcher.db.extend({boardID, threadID, val: {isDead: true, isArchived: undefined, page: undefined, lastPage: undefined, unread: undefined, quotingYou: undefined}}, cb);\r\n  },\r\n\r\n  toggle(thread) {\r\n    const siteID   = g.SITE.ID;\r\n    const boardID  = thread.board.ID;\r\n    const threadID = thread.ID;\r\n    if (ThreadWatcher.db.get({boardID, threadID})) {\r\n      return ThreadWatcher.rm(siteID, boardID, threadID);\r\n    } else {\r\n      return ThreadWatcher.add(thread);\r\n    }\r\n  },\r\n\r\n  add(thread, cb) {\r\n    const data     = {};\r\n    const siteID   = g.SITE.ID;\r\n    const boardID  = thread.board.ID;\r\n    const threadID = thread.ID;\r\n    if (thread.isDead) {\r\n      if (Conf['Auto Prune'] && ThreadWatcher.db.get({boardID, threadID})) {\r\n        ThreadWatcher.rm(siteID, boardID, threadID, cb);\r\n        return;\r\n      }\r\n      data.isDead = true;\r\n    }\r\n    if (thread.OP) { data.excerpt = Get.threadExcerpt(thread); }\r\n    return ThreadWatcher.addRaw(boardID, threadID, data, cb);\r\n  },\r\n\r\n  addRaw(boardID, threadID, data, cb) {\r\n    const oldData = ThreadWatcher.db.get({ boardID, threadID, defaultValue: dict() });\r\n    delete oldData.last;\r\n    delete oldData.modified;\r\n    $.extend(oldData, data);\r\n    ThreadWatcher.db.set({boardID, threadID, val: oldData}, cb);\r\n    ThreadWatcher.refresh();\r\n    const thread = {siteID: g.SITE.ID, boardID, threadID, data, force: true};\r\n    if (Conf['Show Page'] && !data.isDead) {\r\n      return ThreadWatcher.fetchBoard([thread]);\r\n    } else if (ThreadWatcher.unreadEnabled && Conf['Show Unread Count']) {\r\n      return ThreadWatcher.fetchStatus(thread);\r\n    }\r\n  },\r\n\r\n  rm(siteID, boardID, threadID, cb) {\r\n    ThreadWatcher.db.delete({siteID, boardID, threadID}, cb);\r\n    return ThreadWatcher.refresh();\r\n  },\r\n\r\n  menu: {\r\n    init() {\r\n      if (!Conf['Thread Watcher']) { return; }\r\n      const menu = (this.menu = new UI.Menu('thread watcher'));\r\n      $.on($('.menu-button', ThreadWatcher.dialog), 'click', function(e) {\r\n        return menu.toggle(e, this, ThreadWatcher);\r\n      });\r\n      return this.addMenuEntries();\r\n    },\r\n\r\n    addHeaderMenuEntry() {\r\n      if (g.VIEW !== 'thread') { return; }\r\n      const entryEl = $.el('a',\r\n        {href: 'javascript:;'});\r\n      Header.menu.addEntry({\r\n        el: entryEl,\r\n        order: 60,\r\n        open() {\r\n          const [addClass, rmClass, text] = Array.from(!!ThreadWatcher.db.get({boardID: g.BOARD.ID, threadID: g.THREADID}) ?\r\n            ['unwatch-thread', 'watch-thread', 'Unwatch thread']\r\n          :\r\n            ['watch-thread', 'unwatch-thread', 'Watch thread']);\r\n          $.addClass(entryEl, addClass);\r\n          $.rmClass(entryEl, rmClass);\r\n          entryEl.textContent = text;\r\n          return true;\r\n        }\r\n      });\r\n      return $.on(entryEl, 'click', () => ThreadWatcher.toggle(g.threads.get(`${g.BOARD}.${g.THREADID}`)));\r\n    },\r\n\r\n    addMenuEntries() {\r\n      const entries = [];\r\n\r\n      // `Open all` entry\r\n      entries.push({\r\n        text: 'Open all threads',\r\n        cb: ThreadWatcher.cb.openAll,\r\n        open() {\r\n          this.el.classList.toggle('disabled', !ThreadWatcher.list.firstElementChild);\r\n          return true;\r\n        }\r\n      });\r\n\r\n      // `Open Unread` entry\r\n      entries.push({\r\n        text: 'Open unread threads',\r\n        cb: ThreadWatcher.cb.openUnread,\r\n        open() {\r\n          this.el.classList.toggle('disabled', !$('.replies-unread', ThreadWatcher.list));\r\n          return true;\r\n        }\r\n      });\r\n\r\n      // `Open dead threads` entry\r\n      entries.push({\r\n        text: 'Open dead threads',\r\n        cb: ThreadWatcher.cb.openDeads,\r\n        open() {\r\n          this.el.classList.toggle('disabled', !$('.dead-thread', ThreadWatcher.list));\r\n          return true;\r\n        }\r\n      });\r\n\r\n      // `Prune dead threads` entry\r\n      entries.push({\r\n        text: 'Prune dead threads',\r\n        cb: ThreadWatcher.cb.pruneDeads,\r\n        open() {\r\n          this.el.classList.toggle('disabled', !$('.dead-thread', ThreadWatcher.list));\r\n          return true;\r\n        }\r\n      });\r\n\r\n      // `Dismiss posts quoting you` entry\r\n      entries.push({\r\n        text: 'Dismiss posts quoting you',\r\n        title: 'Unhighlight the thread watcher icon and threads until there are new replies quoting you.',\r\n        cb: ThreadWatcher.cb.dismiss,\r\n        open() {\r\n          this.el.classList.toggle('disabled', !$.hasClass(ThreadWatcher.shortcut, 'replies-quoting-you'));\r\n          return true;\r\n        }\r\n      });\r\n\r\n      for (var {text, title, cb, open} of entries) {\r\n        var entry = {\r\n          el: $.el('a', {\r\n            textContent: text,\r\n            href: 'javascript:;'\r\n          }\r\n          )\r\n        };\r\n        if (title) { entry.el.title = title; }\r\n        $.on(entry.el, 'click', cb);\r\n        entry.open = open.bind(entry);\r\n        this.menu.addEntry(entry);\r\n      }\r\n\r\n      // Settings checkbox entries:\r\n      for (var name in Config.threadWatcher) {\r\n        var conf = Config.threadWatcher[name];\r\n        this.addCheckbox(name, conf[1]);\r\n      }\r\n\r\n    },\r\n\r\n    addCheckbox(name, desc) {\r\n      const entry = {\r\n        type: 'thread watcher',\r\n        el: UI.checkbox(name, name.replace(' Thread Watcher', ''))\r\n      };\r\n      entry.el.title = desc;\r\n      const input = entry.el.firstElementChild;\r\n      if ((name === 'Show Unread Count') && !ThreadWatcher.unreadEnabled) {\r\n        input.disabled = true;\r\n        $.addClass(entry.el, 'disabled');\r\n        entry.el.title += '\\n[Remember Last Read Post is disabled.]';\r\n      }\r\n      $.on(input, 'change', $.cb.checked);\r\n      if (['Current Board', 'Show Page', 'Show Unread Count', 'Show Site Prefix'].includes(name)) { $.on(input, 'change', ThreadWatcher.refresh); }\r\n      if (['Show Page', 'Show Unread Count', 'Auto Update Thread Watcher'].includes(name)) { $.on(input, 'change', ThreadWatcher.fetchAuto); }\r\n      return this.menu.addEntry(entry);\r\n    }\r\n  }\r\n};\r\nexport default ThreadWatcher;\r\n","import Redirect from \"../Archive/Redirect\";\r\nimport Board from \"./Board\";\r\nimport Post from \"./Post\";\r\nimport Thread from \"./Thread\";\r\nimport $ from \"../platform/$\";\r\nimport Main from \"../main/Main\";\r\nimport Index from \"../General/Index\";\r\nimport { E, g, Conf, d } from \"../globals/globals\";\r\nimport ImageHost from \"../Images/ImageHost\";\r\nimport CrossOrigin from \"../platform/CrossOrigin\";\r\nimport Get from \"../General/Get\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * DS206: Consider reworking classes to avoid initClass\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nexport default class Fetcher {\r\n  static initClass() {\r\n  \r\n    this.prototype.archiveTags = {\r\n      '\\n':         {innerHTML: \"<br>\"},\r\n      '[b]':        {innerHTML: \"<b>\"},\r\n      '[/b]':       {innerHTML: \"</b>\"},\r\n      '[spoiler]':  {innerHTML: \"<s>\"},\r\n      '[/spoiler]': {innerHTML: \"</s>\"},\r\n      '[code]':     {innerHTML: \"<pre class=\\\"prettyprint\\\">\"},\r\n      '[/code]':    {innerHTML: \"</pre>\"},\r\n      '[moot]':     {innerHTML: \"<div style=\\\"padding:5px;margin-left:.5em;border-color:#faa;border:2px dashed rgba(255,0,0,.1);border-radius:2px\\\">\"},\r\n      '[/moot]':    {innerHTML: \"</div>\"},\r\n      '[banned]':   {innerHTML: \"<strong style=\\\"color: red;\\\">\"},\r\n      '[/banned]':  {innerHTML: \"</strong>\"},\r\n      '[fortune]'(text) { return {innerHTML: \"<span class=\\\"fortune\\\" style=\\\"color:\" + E(text.match(/#\\w+|$/)[0]) + \"\\\"><b>\"}; },\r\n      '[/fortune]': {innerHTML: \"</b></span>\"},\r\n      '[i]':        {innerHTML: \"<span class=\\\"mu-i\\\">\"},\r\n      '[/i]':       {innerHTML: \"</span>\"},\r\n      '[red]':      {innerHTML: \"<span class=\\\"mu-r\\\">\"},\r\n      '[/red]':     {innerHTML: \"</span>\"},\r\n      '[green]':    {innerHTML: \"<span class=\\\"mu-g\\\">\"},\r\n      '[/green]':   {innerHTML: \"</span>\"},\r\n      '[blue]':     {innerHTML: \"<span class=\\\"mu-b\\\">\"},\r\n      '[/blue]':    {innerHTML: \"</span>\"}\r\n    };\r\n  }\r\n  constructor(boardID, threadID, postID, root, quoter) {\r\n    let post, thread;\r\n    this.boardID = boardID;\r\n    this.threadID = threadID;\r\n    this.postID = postID;\r\n    this.root = root;\r\n    this.quoter = quoter;\r\n    if (post = g.posts.get(`${this.boardID}.${this.postID}`)) {\r\n      this.insert(post);\r\n      return;\r\n    }\r\n\r\n    // 4chan X catalog data\r\n    if ((post = Index.replyData?.[`${this.boardID}.${this.postID}`]) && (thread = g.threads.get(`${this.boardID}.${this.threadID}`))) {\r\n      const board  = g.boards[this.boardID];\r\n      post = new Post(g.SITE.Build.postFromObject(post, this.boardID), thread, board, {isFetchedQuote: true});\r\n      Main.callbackNodes('Post', [post]);\r\n      this.insert(post);\r\n      return;\r\n    }\r\n\r\n    this.root.textContent = `Loading post No.${this.postID}...`;\r\n    if (this.threadID) {\r\n      const that = this;\r\n      $.cache(g.SITE.urls.threadJSON({boardID: this.boardID, threadID: this.threadID}), function({isCached}) {\r\n        return that.fetchedPost(this, isCached);\r\n      });\r\n    } else {\r\n      this.archivedPost();\r\n    }\r\n  }\r\n\r\n  insert(post) {\r\n    // Stop here if the container has been removed while loading.\r\n    if (!this.root.parentNode) { return; }\r\n    if (!this.quoter) { this.quoter = post; }\r\n    const clone = post.addClone(this.quoter.context, ($.hasClass(this.root, 'dialog')));\r\n    Main.callbackNodes('Post', [clone]);\r\n\r\n    // Get rid of the side arrows/stubs.\r\n    const {nodes} = clone;\r\n    $.rmAll(nodes.root);\r\n    $.add(nodes.root, nodes.post);\r\n\r\n    // Indicate links to the containing post.\r\n    const quotes = [...clone.nodes.quotelinks, ...clone.nodes.backlinks];\r\n    for (var quote of quotes) {\r\n      var {boardID, postID} = Get.postDataFromLink(quote);\r\n      if ((postID === this.quoter.ID) && (boardID === this.quoter.board.ID)) {\r\n        $.addClass(quote, 'forwardlink');\r\n      }\r\n    }\r\n\r\n    // Set up flag CSS for cross-board links to boards with flags\r\n    if (clone.nodes.flag && !(Fetcher.flagCSS || (Fetcher.flagCSS = $('link[href^=\"//s.4cdn.org/css/flags.\"]')))) {\r\n      const cssVersion = $('link[href^=\"//s.4cdn.org/css/\"]')?.href.match(/\\d+(?=\\.css$)|$/)[0] || Date.now();\r\n      Fetcher.flagCSS = $.el('link', {\r\n        rel: 'stylesheet',\r\n        href: `//s.4cdn.org/css/flags.${cssVersion}.css`\r\n      }\r\n      );\r\n      $.add(d.head, Fetcher.flagCSS);\r\n    }\r\n\r\n    $.rmAll(this.root);\r\n    $.add(this.root, nodes.root);\r\n    return $.event('PostsInserted', null, this.root);\r\n  }\r\n\r\n  fetchedPost(req, isCached) {\r\n    // In case of multiple callbacks for the same request,\r\n    // don't parse the same original post more than once.\r\n    let post;\r\n    if (post = g.posts.get(`${this.boardID}.${this.postID}`)) {\r\n      this.insert(post);\r\n      return;\r\n    }\r\n\r\n    const {status} = req;\r\n    if (status !== 200) {\r\n      // The thread can die by the time we check a quote.\r\n      if (status && this.archivedPost()) { return; }\r\n\r\n      $.addClass(this.root, 'warning');\r\n      this.root.textContent =\r\n        status === 404 ?\r\n          `Thread No.${this.threadID} 404'd.`\r\n        : !status ?\r\n          'Connection Error'\r\n        :\r\n          `Error ${req.statusText} (${req.status}).`;\r\n      return;\r\n    }\r\n\r\n    const {posts} = req.response;\r\n    g.SITE.Build.spoilerRange[this.boardID] = posts[0].custom_spoiler;\r\n    for (post of posts) {\r\n      if (post.no === this.postID) { break; }\r\n    } // we found it!\r\n\r\n    if (post.no !== this.postID) {\r\n      // Cached requests can be stale and must be rechecked.\r\n      if (isCached) {\r\n        const api = g.SITE.urls.threadJSON({boardID: this.boardID, threadID: this.threadID});\r\n        $.cleanCache(url => url === api);\r\n        const that = this;\r\n        $.cache(api, function() {\r\n          return that.fetchedPost(this, false);\r\n        });\r\n        return;\r\n      }\r\n\r\n      // The post can be deleted by the time we check a quote.\r\n      if (this.archivedPost()) { return; }\r\n\r\n      $.addClass(this.root, 'warning');\r\n      this.root.textContent = `Post No.${this.postID} was not found.`;\r\n      return;\r\n    }\r\n\r\n    const board = g.boards[this.boardID] ||\r\n      new Board(this.boardID);\r\n    const thread = g.threads.get(`${this.boardID}.${this.threadID}`) ||\r\n      new Thread(this.threadID, board);\r\n    post = new Post(g.SITE.Build.postFromObject(post, this.boardID), thread, board, {isFetchedQuote: true});\r\n    Main.callbackNodes('Post', [post]);\r\n    return this.insert(post);\r\n  }\r\n\r\n  archivedPost() {\r\n    let url;\r\n    if (!Conf['Resurrect Quotes']) { return false; }\r\n    if (!(url = Redirect.to('post', {boardID: this.boardID, postID: this.postID}))) { return false; }\r\n    const archive = Redirect.data.post[this.boardID];\r\n    const encryptionOK = /^https:\\/\\//.test(url) || (location.protocol === 'http:');\r\n    if (encryptionOK || Conf['Exempt Archives from Encryption']) {\r\n      const that = this;\r\n      CrossOrigin.cache(url, function() {\r\n        if (!encryptionOK && this.response?.media) {\r\n          const {media} = this.response;\r\n          for (var key in media) {\r\n            // Image/thumbnail URLs loaded over HTTP can be modified in transit.\r\n            // Require them to be from an HTTP host so that no referrer is sent to them from an HTTPS page.\r\n            if (/_link$/.test(key)) {\r\n              if (!$.getOwn(media, key)?.match(/^http:\\/\\//)) { delete media[key]; }\r\n            }\r\n          }\r\n        }\r\n        return that.parseArchivedPost(this.response, url, archive);\r\n      });\r\n      return true;\r\n    }\r\n    return false;\r\n  }\r\n\r\n  parseArchivedPost(data, url, archive) {\r\n    // In case of multiple callbacks for the same request,\r\n    // don't parse the same original post more than once.\r\n    let post;\r\n    if (post = g.posts.get(`${this.boardID}.${this.postID}`)) {\r\n      this.insert(post);\r\n      return;\r\n    }\r\n\r\n    if (data == null) {\r\n      $.addClass(this.root, 'warning');\r\n      this.root.textContent = `Error fetching Post No.${this.postID} from ${archive.name}.`;\r\n      return;\r\n    }\r\n\r\n    if (data.error) {\r\n      $.addClass(this.root, 'warning');\r\n      this.root.textContent = data.error;\r\n      return;\r\n    }\r\n\r\n    // https://github.com/eksopl/asagi/blob/v0.4.0b74/src/main/java/net/easymodo/asagi/YotsubaAbstract.java#L82-L129\r\n    // https://github.com/FoolCode/FoolFuuka/blob/800bd090835489e7e24371186db6e336f04b85c0/src/Model/Comment.php#L368-L428\r\n    // https://github.com/bstats/b-stats/blob/6abe7bffaf6e5f523498d760e54b110df5331fbb/inc/classes/Yotsuba.php#L157-L168\r\n    let comment = (data.comment || '').split(/(\\n|\\[\\/?(?:b|spoiler|code|moot|banned|fortune(?: color=\"#\\w+\")?|i|red|green|blue)\\])/);\r\n    comment = (() => {\r\n      const result = [];\r\n      for (let i = 0; i < comment.length; i++) {\r\n        var text = comment[i];\r\n        if ((i % 2) === 1) {\r\n          var tag = Fetcher.archiveTags[text.replace(/\\ .*\\]/, ']')];\r\n          if (typeof tag === 'function') { result.push(tag(text)); } else { result.push(tag); }\r\n        } else {\r\n          var greentext = text[0] === '>';\r\n          text = text.replace(/(\\[\\/?[a-z]+):lit(\\])/g, '$1$2');\r\n          text = text.split(/(>>(?:>\\/[a-z\\d]+\\/)?\\d+)/g).map((text2, j) =>\r\n            {innerHTML: ((j % 2) ? \"<span class=\\\"deadlink\\\">\" + E(text2) + \"</span>\" : E(text2));});\r\n          text = {innerHTML: ((greentext) ? \"<span class=\\\"quote\\\">\" + E.cat(text) + \"</span>\" : E.cat(text))};\r\n          result.push(text);\r\n        }\r\n      }\r\n      return result;\r\n    })();\r\n    comment = {innerHTML: E.cat(comment)};\r\n\r\n    this.threadID = +data.thread_num;\r\n    const o = {\r\n      ID:       this.postID,\r\n      threadID: this.threadID,\r\n      boardID:  this.boardID,\r\n      isReply:  this.postID !== this.threadID\r\n    };\r\n    o.info = {\r\n      subject:  data.title,\r\n      email:    data.email,\r\n      name:     data.name || '',\r\n      tripcode: data.trip,\r\n      capcode:  (() => { switch (data.capcode) {\r\n        // https://github.com/pleebe/FoolFuuka/blob/bf4224eed04637a4d0bd4411c2bf5f9945dfec0b/assets/themes/foolz/foolfuuka-theme-fuuka/src/Partial/Board.php#L77\r\n        case 'M': return 'Mod';\r\n        case 'A': return 'Admin';\r\n        case 'D': return 'Developer';\r\n        case 'V': return 'Verified';\r\n        case 'F': return 'Founder';\r\n        case 'G': return 'Manager';\r\n      } })(),\r\n      uniqueID: data.poster_hash,\r\n      flagCode: data.poster_country,\r\n      flagCodeTroll: data.troll_country_code,\r\n      flag:     data.poster_country_name || data.troll_country_name,\r\n      dateUTC:  data.timestamp,\r\n      dateText: data.fourchan_date,\r\n      commentHTML: comment\r\n    };\r\n    if (o.info.capcode) { delete o.info.uniqueID; }\r\n    if (data.media && !!+data.media.banned) {\r\n      o.fileDeleted = true;\r\n    } else if (data.media?.media_filename) {\r\n      let {thumb_link} = data.media;\r\n      // Fix URLs missing origin\r\n      if (thumb_link?.[0] === '/') { thumb_link = url.split('/', 3).join('/') + thumb_link; }\r\n      if (!Redirect.securityCheck(thumb_link)) { thumb_link = ''; }\r\n      let media_link = Redirect.to('file', {boardID: this.boardID, filename: data.media.media_orig});\r\n      if (!Redirect.securityCheck(media_link)) { media_link = ''; }\r\n      o.file = {\r\n        name:      data.media.media_filename,\r\n        url:       media_link ||\r\n                     (this.boardID === 'f' ?\r\n                       `${location.protocol}//${ImageHost.flashHost()}/${this.boardID}/${encodeURIComponent(E(data.media.media_filename))}`\r\n                     :\r\n                       `${location.protocol}//${ImageHost.host()}/${this.boardID}/${data.media.media_orig}`),\r\n        height:    data.media.media_h,\r\n        width:     data.media.media_w,\r\n        MD5:       data.media.media_hash,\r\n        size:      $.bytesToString(data.media.media_size),\r\n        thumbURL:  thumb_link || `${location.protocol}//${ImageHost.thumbHost()}/${this.boardID}/${data.media.preview_orig}`,\r\n        theight:   data.media.preview_h,\r\n        twidth:    data.media.preview_w,\r\n        isSpoiler: data.media.spoiler === '1'\r\n      };\r\n      if (!/\\.pdf$/.test(o.file.url)) { o.file.dimensions = `${o.file.width}x${o.file.height}`; }\r\n      if ((this.boardID === 'f') && data.media.exif) { o.file.tag = JSON.parse(data.media.exif).Tag; }\r\n    }\r\n    o.extra = dict();\r\n\r\n    const board = g.boards[this.boardID] ||\r\n      new Board(this.boardID);\r\n    const thread = g.threads.get(`${this.boardID}.${this.threadID}`) ||\r\n      new Thread(this.threadID, board);\r\n    post = new Post(g.SITE.Build.post(o), thread, board, {isFetchedQuote: true});\r\n    post.kill();\r\n    if (post.file) { post.file.thumbURL = o.file.thumbURL; }\r\n    Main.callbackNodes('Post', [post]);\r\n    return this.insert(post);\r\n  }\r\n}\r\nFetcher.initClass();\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Fetcher from \"../classes/Fetcher\";\r\nimport Get from \"../General/Get\";\r\nimport Header from \"../General/Header\";\r\nimport UI from \"../General/UI\";\r\nimport { Conf, d, g } from \"../globals/globals\";\r\nimport ExpandComment from \"../Miscellaneous/ExpandComment\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar QuotePreview = {\r\n  init() {\r\n    if (!Conf['Quote Previewing']) { return; }\r\n\r\n    if (g.VIEW === 'archive') {\r\n      $.on(d, 'mouseover', function(e) {\r\n        if ((e.target.nodeName === 'A') && $.hasClass(e.target, 'quotelink')) {\r\n          return QuotePreview.mouseover.call(e.target, e);\r\n        }\r\n      });\r\n    }\r\n\r\n    if (!['index', 'thread'].includes(g.VIEW)) { return; }\r\n\r\n    if (Conf['Comment Expansion']) {\r\n      ExpandComment.callbacks.push(this.node);\r\n    }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Quote Previewing',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    for (var link of this.nodes.quotelinks.concat([...Array.from(this.nodes.backlinks)], this.nodes.archivelinks)) {\r\n      $.on(link, 'mouseover', QuotePreview.mouseover);\r\n    }\r\n  },\r\n\r\n  mouseover(e) {\r\n    let origin;\r\n    if (($.hasClass(this, 'inlined') && !$.hasClass(doc, 'catalog-mode')) || !d.contains(this)) { return; }\r\n\r\n    const {boardID, threadID, postID} = Get.postDataFromLink(this);\r\n\r\n    const qp = $.el('div', {\r\n      id: 'qp',\r\n      className: 'dialog'\r\n    }\r\n    );\r\n\r\n    $.add(Header.hover, qp);\r\n    new Fetcher(boardID, threadID, postID, qp, Get.postFromNode(this));\r\n\r\n    UI.hover({\r\n      root: this,\r\n      el: qp,\r\n      latestEvent: e,\r\n      endEvents: 'mouseout click',\r\n      cb: QuotePreview.mouseout\r\n    });\r\n\r\n    if (Conf['Quote Highlighting'] && (origin = g.posts.get(`${boardID}.${postID}`))) {\r\n      const posts = [origin].concat(origin.clones);\r\n      // Remove the clone that's in the qp from the array.\r\n      posts.pop();\r\n      for (var post of posts) {\r\n        $.addClass(post.nodes.post, 'qphl');\r\n      }\r\n    }\r\n  },\r\n\r\n  mouseout() {\r\n    // Stop if it only contains text.\r\n    let root;\r\n    if (!(root = this.el.firstElementChild)) { return; }\r\n\r\n    $.event('PostsRemoved', null, Header.hover);\r\n\r\n    const clone = Get.postFromRoot(root);\r\n    let post  = clone.origin;\r\n    post.rmClone(root.dataset.clone);\r\n\r\n    if (!Conf['Quote Highlighting']) { return; }\r\n    for (post of [post].concat(post.clones)) {\r\n      $.rmClass(post.nodes.post, 'qphl');\r\n    }\r\n  }\r\n};\r\nexport default QuotePreview;\r\n","/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nimport Callbacks from '../classes/Callbacks';\r\nimport CatalogThread from '../classes/CatalogThread';\r\nimport Notice from '../classes/Notice';\r\nimport Post from '../classes/Post';\r\nimport Thread from '../classes/Thread';\r\nimport Config from '../config/Config';\r\nimport Filter from '../Filtering/Filter';\r\nimport PostHiding from '../Filtering/PostHiding';\r\nimport ThreadHiding from '../Filtering/ThreadHiding';\r\nimport Main from '../main/Main';\r\nimport CatalogLinks from '../Miscellaneous/CatalogLinks';\r\nimport RelativeDates from '../Miscellaneous/RelativeDates';\r\nimport ThreadWatcher from '../Monitoring/ThreadWatcher';\r\nimport $$ from '../platform/$$';\r\nimport $ from '../platform/$';\r\nimport QuotePreview from '../Quotelinks/QuotePreview';\r\nimport { c, Conf, d, doc, g } from '../globals/globals';\r\nimport Header from './Header';\r\nimport UI from './UI';\r\nimport Menu from '../Menu/Menu';\r\n\r\nimport NavLinksPage from './Index/NavLinks.html';\r\nimport PageList from './Index/PageList.html';\r\nimport BoardConfig from './BoardConfig';\r\nimport Get from './Get';\r\nimport { dict, SECOND } from '../platform/helpers';\r\n\r\nvar Index = {\r\n  showHiddenThreads: false,\r\n  changed: {},\r\n\r\n  enabledOn({siteID, boardID}) {\r\n    return Conf['JSON Index'] && (g.sites[siteID].software === 'yotsuba') && (boardID !== 'f');\r\n  },\r\n\r\n  init() {\r\n    let input, inputs, name;\r\n    if (g.VIEW !== 'index') { return; }\r\n\r\n    // For IndexRefresh events\r\n    $.one(d, '4chanXInitFinished', this.cb.initFinished);\r\n    $.on(d, 'PostsInserted', this.cb.postsInserted);\r\n\r\n    if (!this.enabledOn(g.BOARD)) { return; }\r\n\r\n    this.enabled = true;\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Index Page Numbers',\r\n      cb:   this.node\r\n    });\r\n    Callbacks.CatalogThread.push({\r\n      name: 'Catalog Features',\r\n      cb:   this.catalogNode\r\n    });\r\n\r\n    this.search = history.state?.searched || '';\r\n    if (history.state?.mode) {\r\n      Conf['Index Mode'] = history.state?.mode;\r\n    }\r\n    this.currentSort = history.state?.sort;\r\n    if (!this.currentSort) { this.currentSort = typeof Conf['Index Sort'] === 'object' ? (\r\n        Conf['Index Sort'][g.BOARD.ID] || 'bump'\r\n      ) : (\r\n        Conf['Index Sort']\r\n      ); }\r\n    this.currentPage = this.getCurrentPage();\r\n    this.processHash();\r\n\r\n    $.addClass(doc, 'index-loading', `${Conf['Index Mode'].replace(/\\ /g, '-')}-mode`);\r\n    $.on(window, 'popstate', this.cb.popstate);\r\n    $.on(d, 'scroll', this.scroll);\r\n    $.on(d, 'SortIndex', this.cb.resort);\r\n\r\n    // Header refresh button\r\n    this.button = $.el('a', {\r\n      title: 'Refresh',\r\n      href: 'javascript:;',\r\n      textContent: ''\r\n    }\r\n    );\r\n    $.on(this.button, 'click', () => Index.update());\r\n    Header.addShortcut('index-refresh', this.button, 590);\r\n\r\n    // Header \"Index Navigation\" submenu\r\n    const entries = [];\r\n    this.inputs = (inputs = dict());\r\n    for (name in Config.Index) {\r\n      var arr = Config.Index[name];\r\n      if (arr instanceof Array) {\r\n        var label = UI.checkbox(name, `${name[0]}${name.slice(1).toLowerCase()}`);\r\n        label.title = arr[1];\r\n        entries.push({el: label});\r\n        input = label.firstChild;\r\n        $.on(input, 'change', $.cb.checked);\r\n        inputs[name] = input;\r\n      }\r\n    }\r\n    $.on(inputs['Show Replies'], 'change', this.cb.replies);\r\n    $.on(inputs['Catalog Hover Expand'], 'change', this.cb.hover);\r\n    $.on(inputs['Pin Watched Threads'], 'change', this.cb.resort);\r\n    $.on(inputs['Anchor Hidden Threads'], 'change', this.cb.resort);\r\n\r\n    const watchSettings = function(e) {\r\n      if (input = $.getOwn(inputs, e.target.name)) {\r\n        input.checked = e.target.checked;\r\n        return $.event('change', null, input);\r\n      }\r\n    };\r\n    $.on(d, 'OpenSettings', () => $.on($.id('fourchanx-settings'), 'change', watchSettings));\r\n\r\n    const sortEntry = UI.checkbox('Per-Board Sort Type', 'Per-board sort type', (typeof Conf['Index Sort'] === 'object'));\r\n    sortEntry.title = 'Set the sorting order of each board independently.';\r\n    $.on(sortEntry.firstChild, 'change', this.cb.perBoardSort);\r\n    entries.splice(3, 0, {el: sortEntry});\r\n\r\n    Header.menu.addEntry({\r\n      el: $.el('span',\r\n        {textContent: 'Index Navigation'}),\r\n      order: 100,\r\n      subEntries: entries\r\n    });\r\n\r\n    // Navigation links at top of index\r\n    this.navLinks = $.el('div', {className: 'navLinks json-index'});\r\n    $.extend(this.navLinks, {innerHTML: NavLinksPage});\r\n    $('.cataloglink a', this.navLinks).href = CatalogLinks.catalog();\r\n    if (!BoardConfig.isArchived(g.BOARD.ID)) { $('.archlistlink', this.navLinks).hidden = true; }\r\n    $.on($('#index-last-refresh a', this.navLinks), 'click', this.cb.refreshFront);\r\n\r\n    // Search field\r\n    this.searchInput = $('#index-search', this.navLinks);\r\n    this.setupSearch();\r\n    $.on(this.searchInput, 'input', this.onSearchInput);\r\n    $.on($('#index-search-clear', this.navLinks), 'click', this.clearSearch);\r\n\r\n    // Hidden threads toggle\r\n    this.hideLabel = $('#hidden-label', this.navLinks);\r\n    $.on($('#hidden-toggle a', this.navLinks), 'click', this.cb.toggleHiddenThreads);\r\n\r\n    // Drop-down menus and reverse sort toggle\r\n    this.selectRev   = $('#index-rev',  this.navLinks);\r\n    this.selectMode  = $('#index-mode', this.navLinks);\r\n    this.selectSort  = $('#index-sort', this.navLinks);\r\n    this.selectSize  = $('#index-size', this.navLinks);\r\n    $.on(this.selectRev,  'change', this.cb.sort);\r\n    $.on(this.selectMode, 'change', this.cb.mode);\r\n    $.on(this.selectSort, 'change', this.cb.sort);\r\n    $.on(this.selectSize, 'change', $.cb.value);\r\n    $.on(this.selectSize, 'change', this.cb.size);\r\n    for (var select of [this.selectMode, this.selectSize]) {\r\n      select.value = Conf[select.name];\r\n    }\r\n    this.selectRev.checked = /-rev$/.test(Index.currentSort);\r\n    this.selectSort.value  = Index.currentSort.replace(/-rev$/, '');\r\n\r\n    // Last Long Reply options\r\n    this.lastLongOptions = $('#lastlong-options', this.navLinks);\r\n    this.lastLongInputs = $$('input', this.lastLongOptions);\r\n    this.lastLongThresholds = [0, 0];\r\n    this.lastLongOptions.hidden = (this.selectSort.value !== 'lastlong');\r\n    for (let i = 0; i < this.lastLongInputs.length; i++) {\r\n      input = this.lastLongInputs[i];\r\n      $.on(input, 'change', this.cb.lastLongThresholds);\r\n      var tRaw = Conf[`Last Long Reply Thresholds ${i}`];\r\n      input.value = (this.lastLongThresholds[i] =\r\n        typeof tRaw === 'object' ? (tRaw[g.BOARD.ID] ?? 100) : tRaw);\r\n    }\r\n\r\n    // Thread container\r\n    this.root = $.el('div', {className: 'board json-index'});\r\n    $.on(this.root, 'click', this.cb.hoverToggle);\r\n    this.cb.size();\r\n    this.cb.hover();\r\n\r\n    // Page list\r\n    this.pagelist = $.el('div', {className: 'pagelist json-index'});\r\n    $.extend(this.pagelist, {innerHTML: PageList});\r\n    $('.cataloglink a', this.pagelist).href = CatalogLinks.catalog();\r\n    $.on(this.pagelist, 'click', this.cb.pageNav);\r\n\r\n    this.update(true);\r\n\r\n    $.onExists(doc, 'title + *', () => d.title = d.title.replace(/\\ -\\ Page\\ \\d+/, ''));\r\n\r\n    $.onExists(doc, '.board > .thread > .postContainer, .board + *', function() {\r\n      let el;\r\n      g.SITE.Build.hat = $('.board > .thread > img:first-child');\r\n      if (g.SITE.Build.hat) {\r\n        g.BOARD.threads.forEach(function(thread) {\r\n          if (thread.nodes.root) {\r\n            return $.prepend(thread.nodes.root, g.SITE.Build.hat.cloneNode(false));\r\n          }\r\n        });\r\n        $.addClass(doc, 'hats-enabled');\r\n        $.addStyle(`.catalog-thread::after {background-image: url(${g.SITE.Build.hat.src});}`);\r\n      }\r\n\r\n      const board = $('.board');\r\n      $.replace(board, Index.root);\r\n      if (Index.loaded) {\r\n        $.event('PostsInserted', null, Index.root);\r\n      }\r\n      // Hacks:\r\n      // - When removing an element from the document during page load,\r\n      //   its ancestors will still be correctly created inside of it.\r\n      // - Creating loadable elements inside of an origin-less document\r\n      //   will not download them.\r\n      // - Combine the two and you get a download canceller!\r\n      //   Does not work on Firefox unfortunately. bugzil.la/939713\r\n      try {\r\n        d.implementation.createDocument(null, null, null).appendChild(board);\r\n      } catch (error) {}\r\n\r\n      for (el of $$('.navLinks')) { $.rm(el); }\r\n      $.rm($.id('ctrl-top'));\r\n      const topNavPos = $.id('delform').previousElementSibling;\r\n      $.before(topNavPos, $.el('hr'));\r\n      $.before(topNavPos, Index.navLinks);\r\n      const timeEl = $('#index-last-refresh time', Index.navLinks);\r\n      if (timeEl.dataset.utc) { return RelativeDates.update(timeEl); }\r\n    });\r\n\r\n    return Main.ready(function() {\r\n      let pagelist;\r\n      if (pagelist = $('.pagelist')) {\r\n        $.replace(pagelist, Index.pagelist);\r\n      }\r\n      return $.rmClass(doc, 'index-loading');\r\n    });\r\n  },\r\n\r\n  scroll() {\r\n    if (Index.req || !Index.liveThreadData || (Conf['Index Mode'] !== 'infinite') || (window.scrollY <= (doc.scrollHeight - (300 + window.innerHeight)))) { return; }\r\n    if (Index.pageNum == null) { Index.pageNum = Index.currentPage; } // Avoid having to pushState to keep track of the current page\r\n\r\n    const pageNum = ++Index.pageNum;\r\n    if (pageNum > Index.pagesNum) { return Index.endNotice(); }\r\n\r\n    const threadIDs = Index.threadsOnPage(pageNum);\r\n    return Index.buildStructure(threadIDs);\r\n  },\r\n\r\n  endNotice: (function() {\r\n    let notify = false;\r\n    const reset = () => notify = false;\r\n    return function() {\r\n      if (notify) { return; }\r\n      notify = true;\r\n      new Notice('info', \"Last page reached.\", 2);\r\n      return setTimeout(reset, 3 * SECOND);\r\n    };\r\n  })(),\r\n\r\n  menu: {\r\n    init() {\r\n      if ((g.VIEW !== 'index') || !Conf['Menu'] || !Conf['Thread Hiding Link'] || !Index.enabledOn(g.BOARD)) { return; }\r\n\r\n      return Menu.menu.addEntry({\r\n        el: $.el('a', {\r\n          href:      'javascript:;',\r\n          className: 'has-shortcut-text'\r\n        }\r\n        , {innerHTML: \"<span></span><span class=\\\"shortcut-text\\\">Shift+click</span>\"}),\r\n        order: 20,\r\n        open({thread}) {\r\n          if (Conf['Index Mode'] !== 'catalog') { return false; }\r\n          this.el.firstElementChild.textContent = thread.isHidden ?\r\n            'Unhide'\r\n          :\r\n            'Hide';\r\n          if (this.cb) { $.off(this.el, 'click', this.cb); }\r\n          this.cb = function() {\r\n            $.event('CloseMenu');\r\n            return Index.toggleHide(thread);\r\n          };\r\n          $.on(this.el, 'click', this.cb);\r\n          return true;\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  node() {\r\n    if (this.isReply || this.isClone || (Index.threadPosition[this.ID] == null)) { return; }\r\n    return this.thread.setPage(Math.floor(Index.threadPosition[this.ID] / Index.threadsNumPerPage) + 1);\r\n  },\r\n\r\n  catalogNode() {\r\n    return $.on(this.nodes.root, 'mousedown click', e => {\r\n      if ((e.button !== 0) || !e.shiftKey) { return; }\r\n      if (e.type === 'click') { Index.toggleHide(this.thread); }\r\n      return e.preventDefault();\r\n    });\r\n  }, // Also on mousedown to prevent highlighting text.\r\n\r\n  toggleHide(thread) {\r\n    if (Index.showHiddenThreads) {\r\n      ThreadHiding.show(thread);\r\n      if (!ThreadHiding.db.get({boardID: thread.board.ID, threadID: thread.ID})) { return; }\r\n      // Don't save when un-hiding filtered threads.\r\n    } else {\r\n      ThreadHiding.hide(thread);\r\n    }\r\n    return ThreadHiding.saveHiddenState(thread);\r\n  },\r\n\r\n  cycleSortType() {\r\n    let i;\r\n    const types = [...Array.from(Index.selectSort.options)].filter(option => !option.disabled);\r\n    for (i = 0; i < types.length; i++) {\r\n      var type = types[i];\r\n      if (type.selected) { break; }\r\n    }\r\n    types[(i + 1) % types.length].selected = true;\r\n    return $.event('change', null, Index.selectSort);\r\n  },\r\n\r\n  cb: {\r\n    initFinished() {\r\n      Index.initFinishedFired = true;\r\n      return $.queueTask(() => Index.cb.postsInserted());\r\n    },\r\n\r\n    postsInserted() {\r\n      if (!Index.initFinishedFired) { return; }\r\n      let n = 0;\r\n      g.posts.forEach(function(post) {\r\n        if (!post.isFetchedQuote && !post.indexRefreshSeen && doc.contains(post.nodes.root)) {\r\n          post.indexRefreshSeen = true;\r\n          return n++;\r\n        }\r\n      });\r\n      if (n) { return $.event('IndexRefresh'); }\r\n    },\r\n\r\n    toggleHiddenThreads() {\r\n      $('#hidden-toggle a', Index.navLinks).textContent = (Index.showHiddenThreads = !Index.showHiddenThreads) ?\r\n        'Hide'\r\n      :\r\n        'Show';\r\n      Index.sort();\r\n      return Index.buildIndex();\r\n    },\r\n\r\n    mode() {\r\n      Index.pushState({mode: this.value});\r\n      return Index.pageLoad(false);\r\n    },\r\n\r\n    sort() {\r\n      const value = Index.selectRev.checked ? Index.selectSort.value + \"-rev\" : Index.selectSort.value;\r\n      Index.pushState({sort: value});\r\n      return Index.pageLoad(false);\r\n    },\r\n\r\n    resort(e) {\r\n      Index.changed.order = true;\r\n      if (!e?.detail?.deferred) { return Index.pageLoad(false); }\r\n    },\r\n\r\n    perBoardSort() {\r\n      Conf['Index Sort'] = this.checked ? dict() : '';\r\n      Index.saveSort();\r\n      for (let i = 0; i < 2; i++) {\r\n        Conf[`Last Long Reply Thresholds ${i}`] = this.checked ? dict() : '';\r\n        Index.saveLastLongThresholds(i);\r\n      }\r\n    },\r\n\r\n    lastLongThresholds() {\r\n      const i = [...Array.from(this.parentNode.children)].indexOf(this);\r\n      const value = +this.value;\r\n      if (!Number.isFinite(value)) {\r\n        this.value = Index.lastLongThresholds[i];\r\n        return;\r\n      }\r\n      Index.lastLongThresholds[i] = value;\r\n      Index.saveLastLongThresholds(i);\r\n      Index.changed.order = true;\r\n      return Index.pageLoad(false);\r\n    },\r\n\r\n    size(e) {\r\n      if (Conf['Index Mode'] !== 'catalog') {\r\n        $.rmClass(Index.root, 'catalog-small');\r\n        $.rmClass(Index.root, 'catalog-large');\r\n      } else if (Conf['Index Size'] === 'small') {\r\n        $.addClass(Index.root, 'catalog-small');\r\n        $.rmClass(Index.root,  'catalog-large');\r\n      } else {\r\n        $.addClass(Index.root, 'catalog-large');\r\n        $.rmClass(Index.root,  'catalog-small');\r\n      }\r\n      if (e) { return Index.buildIndex(); }\r\n    },\r\n\r\n    replies() {\r\n      return Index.buildIndex();\r\n    },\r\n\r\n    hover() {\r\n      return doc.classList.toggle('catalog-hover-expand', Conf['Catalog Hover Expand']);\r\n    },\r\n\r\n    hoverToggle(e) {\r\n      if (Conf['Catalog Hover Toggle'] && $.hasClass(doc, 'catalog-mode') && !$.modifiedClick(e) && !$.x('ancestor-or-self::a', e.target)) {\r\n        let thread;\r\n        const input = Index.inputs['Catalog Hover Expand'];\r\n        input.checked = !input.checked;\r\n        $.event('change', null, input);\r\n        if (thread = Get.threadFromNode(e.target)) {\r\n          Index.cb.catalogReplies.call(thread);\r\n          return Index.cb.hoverAdjust.call(thread.OP.nodes);\r\n        }\r\n      }\r\n    },\r\n\r\n    popstate(e) {\r\n      if (e?.state) {\r\n        const {searched, mode, sort} = e.state;\r\n        const page = Index.getCurrentPage();\r\n        Index.setState({search: searched, mode, sort, page});\r\n        return Index.pageLoad(false);\r\n      } else {\r\n        // page load or hash change\r\n        const nCommands = Index.processHash();\r\n        if (Conf['Refreshed Navigation'] && nCommands) {\r\n          return Index.update();\r\n        } else {\r\n          return Index.pageLoad();\r\n        }\r\n      }\r\n    },\r\n\r\n    pageNav(e) {\r\n      let a;\r\n      if ($.modifiedClick(e)) { return; }\r\n      switch (e.target.nodeName) {\r\n        case 'BUTTON':\r\n          e.target.blur();\r\n          a = e.target.parentNode;\r\n          break;\r\n        case 'A':\r\n          a = e.target;\r\n          break;\r\n        default:\r\n          return;\r\n      }\r\n      if (a.textContent === 'Catalog') { return; }\r\n      e.preventDefault();\r\n      return Index.userPageNav(+a.pathname.split(/\\/+/)[2] || 1);\r\n    },\r\n\r\n    refreshFront() {\r\n      Index.pushState({page: 1});\r\n      return Index.update();\r\n    },\r\n\r\n    catalogReplies() {\r\n      if (Conf['Show Replies'] && $.hasClass(doc, 'catalog-hover-expand') && !this.catalogView.nodes.replies) {\r\n        return Index.buildCatalogReplies(this);\r\n      }\r\n    },\r\n\r\n    hoverAdjust() {\r\n      // Prevent hovered catalog threads from going offscreen.\r\n      let x;\r\n      if (!$.hasClass(doc, 'catalog-hover-expand')) { return; }\r\n      const rect = this.post.getBoundingClientRect();\r\n      if (x = $.minmax(0, -rect.left, doc.clientWidth - rect.right)) {\r\n        const {style} = this.post;\r\n        style.left = `${x}px`;\r\n        style.right = `${-x}px`;\r\n        return $.one(this.root, 'mouseleave', () => style.left = (style.right = null));\r\n      }\r\n    }\r\n  },\r\n\r\n  scrollToIndex() {\r\n    // Scroll to navlinks, or top of board if navlinks are hidden.\r\n    return Header.scrollToIfNeeded((Index.navLinks.getBoundingClientRect().height ? Index.navLinks : Index.root));\r\n  },\r\n\r\n  getCurrentPage() {\r\n    return +window.location.pathname.split(/\\/+/)[2] || 1;\r\n  },\r\n\r\n  userPageNav(page) {\r\n    Index.pushState({page});\r\n    if (Conf['Refreshed Navigation']) {\r\n      return Index.update();\r\n    } else {\r\n      return Index.pageLoad();\r\n    }\r\n  },\r\n\r\n  hashCommands: {\r\n    mode: {\r\n      'paged':         'paged',\r\n      'infinite-scrolling': 'infinite',\r\n      'infinite':      'infinite',\r\n      'all-threads':   'all pages',\r\n      'all-pages':     'all pages',\r\n      'catalog':       'catalog'\r\n    },\r\n    sort: {\r\n      'bump-order':        'bump',\r\n      'last-reply':        'lastreply',\r\n      'last-long-reply':   'lastlong',\r\n      'creation-date':     'birth',\r\n      'reply-count':       'replycount',\r\n      'file-count':        'filecount',\r\n      'posts-per-minute':  'activity'\r\n    }\r\n  },\r\n\r\n  processHash() {\r\n    // XXX https://bugzilla.mozilla.org/show_bug.cgi?id=483304\r\n    let hash = location.href.match(/#.*/)?.[0] || '';\r\n    const state =\r\n      {replace: true};\r\n    const commands = hash.slice(1).split('/');\r\n    const leftover = [];\r\n    for (var command of commands) {\r\n      var mode, sort;\r\n      if (mode = $.getOwn(Index.hashCommands.mode, command)) {\r\n        state.mode = mode;\r\n      } else if (command === 'index') {\r\n        state.mode = Conf['Previous Index Mode'];\r\n        state.page = 1;\r\n      } else if (sort = $.getOwn(Index.hashCommands.sort, command.replace(/-rev$/, ''))) {\r\n        state.sort = sort;\r\n        if (/-rev$/.test(command)) { state.sort += '-rev'; }\r\n      } else if (/^s=/.test(command)) {\r\n        state.search = decodeURIComponent(command.slice(2)).replace(/\\+/g, ' ').trim();\r\n      } else {\r\n        leftover.push(command);\r\n      }\r\n    }\r\n    hash = leftover.join('/');\r\n    if (hash) { state.hash = `#${hash}`; }\r\n    Index.pushState(state);\r\n    return commands.length - leftover.length;\r\n  },\r\n\r\n  pushState(state) {\r\n    let {search, hash, replace} = state;\r\n    let pageBeforeSearch = history.state?.oldpage;\r\n    if ((search != null) && (search !== Index.search)) {\r\n      state.page = search ? 1 : (pageBeforeSearch || 1);\r\n      if (!search) {\r\n        pageBeforeSearch = undefined;\r\n      } else if (!Index.search) {\r\n        pageBeforeSearch = Index.currentPage;\r\n      }\r\n    }\r\n    Index.setState(state);\r\n    const pathname = Index.currentPage === 1 ? `/${g.BOARD}/` : `/${g.BOARD}/${Index.currentPage}`;\r\n    if (!hash) { hash = ''; }\r\n    return history[replace ? 'replaceState' : 'pushState']({\r\n      mode:     Conf['Index Mode'],\r\n      sort:     Index.currentSort,\r\n      searched: Index.search,\r\n      oldpage:  pageBeforeSearch\r\n    }\r\n    , '', `${location.protocol}//${location.host}${pathname}${hash}`);\r\n  },\r\n\r\n  setState({search, mode, sort, page, hash}) {\r\n    if ((search != null) && (search !== Index.search)) {\r\n      Index.changed.search = true;\r\n      Index.search = search;\r\n    }\r\n    if ((mode != null) && (mode !== Conf['Index Mode'])) {\r\n      Index.changed.mode = true;\r\n      Conf['Index Mode'] = mode;\r\n      $.set('Index Mode', mode);\r\n      if ((mode !== 'catalog') && (Conf['Previous Index Mode'] !== mode)) {\r\n        Conf['Previous Index Mode'] = mode;\r\n        $.set('Previous Index Mode', mode);\r\n      }\r\n    }\r\n    if ((sort != null) && (sort !== Index.currentSort)) {\r\n      Index.changed.sort = true;\r\n      Index.currentSort = sort;\r\n      Index.saveSort();\r\n    }\r\n    if (['all pages', 'catalog'].includes(Conf['Index Mode'])) { page = 1; }\r\n    if ((page != null) && (page !== Index.currentPage)) {\r\n      Index.changed.page = true;\r\n      Index.currentPage = page;\r\n    }\r\n    if (hash != null) {\r\n      return Index.changed.hash = true;\r\n    }\r\n  },\r\n\r\n  savePerBoard(key, value) {\r\n    if (typeof Conf[key] === 'object') {\r\n      Conf[key][g.BOARD.ID] = value;\r\n    } else {\r\n      Conf[key] = value;\r\n    }\r\n    return $.set(key, Conf[key]);\r\n  },\r\n\r\n  saveSort() {\r\n    return Index.savePerBoard('Index Sort', Index.currentSort);\r\n  },\r\n\r\n  saveLastLongThresholds(i) {\r\n    return Index.savePerBoard(`Last Long Reply Thresholds ${i}`, Index.lastLongThresholds[i]);\r\n  },\r\n\r\n  pageLoad(scroll=true) {\r\n    if (!Index.liveThreadData) { return; }\r\n    let {threads, order, search, mode, sort, page, hash} = Index.changed;\r\n    if (!threads) { threads = search; }\r\n    if (!order) { order = sort; }\r\n    if (threads || order) { Index.sort(); }\r\n    if (threads) { Index.buildPagelist(); }\r\n    if (search) { Index.setupSearch(); }\r\n    if (mode) { Index.setupMode(); }\r\n    if (sort) { Index.setupSort(); }\r\n    if (threads || mode || page || order) { Index.buildIndex(); }\r\n    if (threads || page) { Index.setPage(); }\r\n    if (scroll && !hash) { Index.scrollToIndex(); }\r\n    if (hash) { Header.hashScroll(); }\r\n    return Index.changed = {};\r\n  },\r\n\r\n  setupMode() {\r\n    for (var mode of ['paged', 'infinite', 'all pages', 'catalog']) {\r\n      $[mode === Conf['Index Mode'] ? 'addClass' : 'rmClass'](doc, `${mode.replace(/\\ /g, '-')}-mode`);\r\n    }\r\n    Index.selectMode.value = Conf['Index Mode'];\r\n    Index.cb.size();\r\n    Index.showHiddenThreads = false;\r\n    return $('#hidden-toggle a', Index.navLinks).textContent = 'Show';\r\n  },\r\n\r\n  setupSort() {\r\n    Index.selectRev.checked = /-rev$/.test(Index.currentSort);\r\n    Index.selectSort.value  = Index.currentSort.replace(/-rev$/, '');\r\n    return Index.lastLongOptions.hidden = (Index.selectSort.value !== 'lastlong');\r\n  },\r\n\r\n  getPagesNum() {\r\n    if (Index.search) {\r\n      return Math.ceil(Index.sortedThreadIDs.length / Index.threadsNumPerPage);\r\n    } else {\r\n      return Index.pagesNum;\r\n    }\r\n  },\r\n\r\n  getMaxPageNum() {\r\n    return Math.max(1, Index.getPagesNum());\r\n  },\r\n\r\n  buildPagelist() {\r\n    const pagesRoot = $('.pages', Index.pagelist);\r\n    const maxPageNum = Index.getMaxPageNum();\r\n    if (pagesRoot.childElementCount !== maxPageNum) {\r\n      const nodes = [];\r\n      for (let i = 1, end = maxPageNum; i <= end; i++) {\r\n        var a = $.el('a', {\r\n          textContent: i,\r\n          href: i === 1 ? './' : i\r\n        }\r\n        );\r\n        nodes.push($.tn('['), a, $.tn('] '));\r\n      }\r\n      $.rmAll(pagesRoot);\r\n      return $.add(pagesRoot, nodes);\r\n    }\r\n  },\r\n\r\n  setPage() {\r\n    let a, strong;\r\n    const pageNum    = Index.currentPage;\r\n    const maxPageNum = Index.getMaxPageNum();\r\n    const pagesRoot  = $('.pages', Index.pagelist);\r\n\r\n    // Previous/Next buttons\r\n    const prev = pagesRoot.previousElementSibling.firstElementChild;\r\n    const next = pagesRoot.nextElementSibling.firstElementChild;\r\n    let href = Math.max(pageNum - 1, 1);\r\n    prev.href = href === 1 ? './' : href;\r\n    prev.firstElementChild.disabled = href === pageNum;\r\n    href = Math.min(pageNum + 1, maxPageNum);\r\n    next.href = href === 1 ? './' : href;\r\n    next.firstElementChild.disabled = href === pageNum;\r\n\r\n    // <strong> current page\r\n    if (strong = $('strong', pagesRoot)) {\r\n      if (+strong.textContent === pageNum) { return; }\r\n      $.replace(strong, strong.firstChild);\r\n    } else {\r\n      strong = $.el('strong');\r\n    }\r\n\r\n    if (a = pagesRoot.children[pageNum - 1]) {\r\n      $.before(a, strong);\r\n      return $.add(strong, a);\r\n    }\r\n  },\r\n\r\n  updateHideLabel() {\r\n    if (!Index.hideLabel) { return; }\r\n    let hiddenCount = 0;\r\n    for (var threadID of Index.liveThreadIDs) {\r\n      if (Index.isHidden(threadID)) {\r\n        hiddenCount++;\r\n      }\r\n    }\r\n    if (!hiddenCount) {\r\n      Index.hideLabel.hidden = true;\r\n      if (Index.showHiddenThreads) { Index.cb.toggleHiddenThreads(); }\r\n      return;\r\n    }\r\n    Index.hideLabel.hidden = false;\r\n    return $('#hidden-count', Index.navLinks).textContent = hiddenCount === 1 ?\r\n      '1 hidden thread'\r\n    :\r\n      `${hiddenCount} hidden threads`;\r\n  },\r\n\r\n  update(firstTime) {\r\n    let oldReq;\r\n    if (oldReq = Index.req) {\r\n      delete Index.req;\r\n      oldReq.abort();\r\n    }\r\n\r\n    if (Conf['Index Refresh Notifications']) {\r\n      // Optional notification for manual refreshes\r\n      if (!Index.notice) { Index.notice = new Notice('info', 'Refreshing index...'); }\r\n      if (!Index.nTimeout) { Index.nTimeout = setTimeout(() => {\r\n          if (Index.notice) {\r\n            Index.notice.el.lastElementChild.textContent += ' (disable JSON Index if this takes too long)';\r\n          }\r\n        }\r\n        , 3 * SECOND); }\r\n    } else {\r\n      // Also display notice if Index Refresh is taking too long\r\n      if (!Index.nTimeout) { Index.nTimeout = setTimeout(() => Index.notice || (Index.notice = new Notice('info', 'Refreshing index... (disable JSON Index if this takes too long)'))\r\n      , 3 * SECOND); }\r\n    }\r\n\r\n    // Hard refresh in case of incomplete page load.\r\n    if (!firstTime && (d.readyState !== 'loading') && !$('.board + *')) {\r\n      location.reload();\r\n      return;\r\n    }\r\n\r\n    Index.req = $.whenModified(\r\n      g.SITE.urls.catalogJSON({boardID: g.BOARD.ID}),\r\n      'Index',\r\n      Index.load\r\n    );\r\n    return $.addClass(Index.button, 'spin');\r\n  },\r\n\r\n  load() {\r\n    let err;\r\n    if (this !== Index.req) { return; } // aborted\r\n\r\n    $.rmClass(Index.button, 'spin');\r\n    const {notice, nTimeout} = Index;\r\n    if (nTimeout) { clearTimeout(nTimeout); }\r\n    delete Index.nTimeout;\r\n    delete Index.req;\r\n    delete Index.notice;\r\n\r\n    if (![200, 304].includes(this.status)) {\r\n      err = `Index refresh failed. ${this.status ? `Error ${this.statusText} (${this.status})` : 'Connection Error'}`;\r\n      if (notice) {\r\n        notice.setType('warning');\r\n        notice.el.lastElementChild.textContent = err;\r\n        setTimeout(notice.close, SECOND);\r\n      } else {\r\n        new Notice('warning', err, 1);\r\n      }\r\n      return;\r\n    }\r\n\r\n    try {\r\n      if (this.status === 200) {\r\n        Index.parse(this.response);\r\n      } else if (this.status === 304) {\r\n        Index.pageLoad();\r\n      }\r\n    } catch (error) {\r\n      err = error;\r\n      c.error(`Index failure: ${err.message}`, err.stack);\r\n      if (notice) {\r\n        notice.setType('error');\r\n        notice.el.lastElementChild.textContent = 'Index refresh failed.';\r\n        setTimeout(notice.close, SECOND);\r\n      } else {\r\n        new Notice('error', 'Index refresh failed.', 1);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (notice) {\r\n      if (Conf['Index Refresh Notifications']) {\r\n        notice.setType('success');\r\n        notice.el.lastElementChild.textContent = 'Index refreshed!';\r\n        setTimeout(notice.close, SECOND);\r\n      } else {\r\n        notice.close();\r\n      }\r\n    }\r\n\r\n    const timeEl = $('#index-last-refresh time', Index.navLinks);\r\n    timeEl.dataset.utc = Date.parse(this.getResponseHeader('Last-Modified'));\r\n    return RelativeDates.update(timeEl);\r\n  },\r\n\r\n  parse(pages) {\r\n    $.cleanCache(url => /^https?:\\/\\/a\\.4cdn\\.org\\//.test(url));\r\n    Index.parseThreadList(pages);\r\n    Index.changed.threads = true;\r\n    return Index.pageLoad();\r\n  },\r\n\r\n  parseThreadList(pages) {\r\n    Index.pagesNum          = pages.length;\r\n    Index.threadsNumPerPage = pages[0]?.threads.length || 1;\r\n    Index.liveThreadData    = pages.reduce(((arr, next) => arr.concat(next.threads)), []);\r\n    Index.liveThreadIDs     = Index.liveThreadData.map(data => data.no);\r\n    Index.liveThreadDict    = dict();\r\n    Index.threadPosition    = dict();\r\n    Index.parsedThreads     = dict();\r\n    Index.replyData         = dict();\r\n    for (let i = 0; i < Index.liveThreadData.length; i++) {\r\n      var obj, results;\r\n      var data = Index.liveThreadData[i];\r\n      Index.liveThreadDict[data.no] = data;\r\n      Index.threadPosition[data.no] = i;\r\n      Index.parsedThreads[data.no] = (obj = g.SITE.Build.parseJSON(data, g.BOARD));\r\n      obj.filterResults = (results = Filter.test(obj));\r\n      obj.isOnTop  = results.top;\r\n      obj.isHidden = results.hide || ThreadHiding.isHidden(obj.boardID, obj.threadID);\r\n      if (data.last_replies) {\r\n        for (var reply of data.last_replies) {\r\n          Index.replyData[`${g.BOARD}.${reply.no}`] = reply;\r\n        }\r\n      }\r\n    }\r\n    if (Index.liveThreadData[0]) {\r\n      g.SITE.Build.spoilerRange[g.BOARD.ID] = Index.liveThreadData[0].custom_spoiler;\r\n    }\r\n    g.BOARD.threads.forEach(function(thread) {\r\n      if (!Index.liveThreadIDs.includes(thread.ID)) { return thread.collect(); }\r\n    });\r\n    $.event('IndexUpdate',\r\n      {threads: ((Index.liveThreadIDs.map((ID) => `${g.BOARD}.${ID}`)))});\r\n  },\r\n\r\n  isHidden(threadID) {\r\n    let thread;\r\n    if ((thread = g.BOARD.threads.get(threadID)) && thread.OP && !thread.OP.isFetchedQuote) {\r\n      return thread.isHidden;\r\n    } else {\r\n      return Index.parsedThreads[threadID].isHidden;\r\n    }\r\n  },\r\n\r\n  isHiddenReply(threadID, replyData) {\r\n    return PostHiding.isHidden(g.BOARD.ID, threadID, replyData.no) || Filter.isHidden(g.SITE.Build.parseJSON(replyData, g.BOARD));\r\n  },\r\n\r\n  buildThreads(threadIDs, isCatalog, withReplies) {\r\n    let errors;\r\n    const threads    = [];\r\n    const newThreads = [];\r\n    let newPosts   = [];\r\n    for (var ID of threadIDs) {\r\n      var opRoot, thread;\r\n      try {\r\n        var OP;\r\n        var threadData = Index.liveThreadDict[ID];\r\n\r\n        if (thread = g.BOARD.threads.get(ID)) {\r\n          var isStale = (thread.json !== threadData) && (JSON.stringify(thread.json) !== JSON.stringify(threadData));\r\n          if (isStale) {\r\n            thread.setCount('post', threadData.replies + 1,                threadData.bumplimit);\r\n            thread.setCount('file', threadData.images  + !!threadData.ext, threadData.imagelimit);\r\n            thread.setStatus('Sticky', !!threadData.sticky);\r\n            thread.setStatus('Closed', !!threadData.closed);\r\n          }\r\n          if (thread.catalogView) {\r\n            $.rm(thread.catalogView.nodes.replies);\r\n            thread.catalogView.nodes.replies = null;\r\n          }\r\n        } else {\r\n          thread = new Thread(ID, g.BOARD);\r\n          newThreads.push(thread);\r\n        }\r\n        var lastPost = threadData.last_replies && threadData.last_replies.length ? threadData.last_replies[threadData.last_replies.length - 1].no : ID;\r\n        if (lastPost > thread.lastPost) { thread.lastPost = lastPost; }\r\n        thread.json = threadData;\r\n        threads.push(thread);\r\n\r\n        if ((OP = thread.OP) && !OP.isFetchedQuote) {\r\n          OP.setCatalogOP(isCatalog);\r\n          thread.setPage(Math.floor(Index.threadPosition[ID] / Index.threadsNumPerPage) + 1);\r\n        } else {\r\n          var obj = Index.parsedThreads[ID];\r\n          opRoot = g.SITE.Build.post(obj);\r\n          OP = new Post(opRoot, thread, g.BOARD);\r\n          OP.filterResults = obj.filterResults;\r\n          newPosts.push(OP);\r\n        }\r\n\r\n        if (!isCatalog || !thread.nodes.root) {\r\n          g.SITE.Build.thread(thread, threadData, withReplies);\r\n        }\r\n      } catch (err) {\r\n        // Skip posts that we failed to parse.\r\n        if (!errors) { errors = []; }\r\n        errors.push({\r\n          message: `Parsing of Thread No.${thread} failed. Thread will be skipped.`,\r\n          error: err,\r\n          html: opRoot?.outerHTML\r\n        });\r\n      }\r\n    }\r\n    if (errors) { Main.handleErrors(errors); }\r\n\r\n    if (withReplies) {\r\n      newPosts = newPosts.concat(Index.buildReplies(threads));\r\n    }\r\n\r\n    Main.callbackNodes('Thread', newThreads);\r\n    Main.callbackNodes('Post',   newPosts);\r\n    Index.updateHideLabel();\r\n    $.event('IndexRefreshInternal', {threadIDs: (threads.map((t) => t.fullID)), isCatalog});\r\n\r\n    return threads;\r\n  },\r\n\r\n  buildReplies(threads) {\r\n    let errors;\r\n    const posts = [];\r\n    for (var thread of threads) {\r\n      var lastReplies;\r\n      if (!(lastReplies = Index.liveThreadDict[thread.ID].last_replies)) { continue; }\r\n      var nodes = [];\r\n      for (var data of lastReplies) {\r\n        var node, post;\r\n        if ((post = thread.posts.get(data.no)) && !post.isFetchedQuote) {\r\n          nodes.push(post.nodes.root);\r\n          continue;\r\n        }\r\n        nodes.push(node = g.SITE.Build.postFromObject(data, thread.board.ID));\r\n        try {\r\n          posts.push(new Post(node, thread, thread.board));\r\n        } catch (err) {\r\n          // Skip posts that we failed to parse.\r\n          if (!errors) { errors = []; }\r\n          errors.push({\r\n            message: `Parsing of Post No.${data.no} failed. Post will be skipped.`,\r\n            error: err,\r\n            html: node?.outerHTML\r\n          });\r\n        }\r\n      }\r\n      $.add(thread.nodes.root, nodes);\r\n    }\r\n\r\n    if (errors) { Main.handleErrors(errors); }\r\n    return posts;\r\n  },\r\n\r\n  buildCatalogViews(threads) {\r\n    const catalogThreads = [];\r\n    for (var thread of threads) {\r\n      if (!thread.catalogView) {\r\n        var {ID} = thread;\r\n        var page = Math.floor(Index.threadPosition[ID] / Index.threadsNumPerPage) + 1;\r\n        var root = g.SITE.Build.catalogThread(thread, Index.liveThreadDict[ID], page);\r\n        catalogThreads.push(new CatalogThread(root, thread));\r\n      }\r\n    }\r\n    Main.callbackNodes('CatalogThread', catalogThreads);\r\n  },\r\n\r\n  sizeCatalogViews(threads) {\r\n    // XXX When browsers support CSS3 attr(), use it instead.\r\n    const size = Conf['Index Size'] === 'small' ? 150 : 250;\r\n    for (var thread of threads) {\r\n      var {thumb} = thread.catalogView.nodes;\r\n      var {width, height} = thumb.dataset;\r\n      if (!width) { continue; }\r\n      var ratio = size / Math.max(width, height);\r\n      thumb.style.width  = (width  * ratio) + 'px';\r\n      thumb.style.height = (height * ratio) + 'px';\r\n    }\r\n  },\r\n\r\n  buildCatalogReplies(thread) {\r\n    let lastReplies;\r\n    const {nodes} = thread.catalogView;\r\n    if (!(lastReplies = Index.liveThreadDict[thread.ID].last_replies)) { return; }\r\n\r\n    const replies = [];\r\n    for (var data of lastReplies) {\r\n      if (Index.isHiddenReply(thread.ID, data)) { continue; }\r\n      var reply = g.SITE.Build.catalogReply(thread, data);\r\n      RelativeDates.update($('time', reply));\r\n      $.on($('.catalog-reply-preview', reply), 'mouseover', QuotePreview.mouseover);\r\n      replies.push(reply);\r\n    }\r\n\r\n    nodes.replies = $.el('div', {className: 'catalog-replies'});\r\n    $.add(nodes.replies, replies);\r\n    $.add(thread.OP.nodes.post, nodes.replies);\r\n  },\r\n\r\n  sort() {\r\n    let threadIDs;\r\n    const {liveThreadIDs, liveThreadData} = Index;\r\n    if (!liveThreadData) { return; }\r\n    const tmp_time = new Date().getTime()/1000;\r\n    const sortType = Index.currentSort.replace(/-rev$/, '');\r\n    Index.sortedThreadIDs = (() => { switch (sortType) {\r\n      case 'lastreply': case 'lastlong':\r\n        var repliesAvailable = liveThreadData.some(thread => thread.last_replies?.length);\r\n        var lastlong = function(thread) {\r\n          if (!repliesAvailable) {\r\n            return thread.last_modified;\r\n          }\r\n          const iterable = thread.last_replies || [];\r\n          for (let i = iterable.length - 1; i >= 0; i--) {\r\n            var r = iterable[i];\r\n            if (Index.isHiddenReply(thread.no, r)) { continue; }\r\n            if (sortType === 'lastreply') {\r\n              return r;\r\n            }\r\n            var len = r.com ? g.SITE.Build.parseComment(r.com).replace(/[^a-z]/ig, '').length : 0;\r\n            if (len >= Index.lastLongThresholds[+!!r.ext]) {\r\n              return r;\r\n            }\r\n          }\r\n          if (thread.omitted_posts && thread.last_replies?.length) { return thread.last_replies[0]; } else { return thread; }\r\n        };\r\n        var lastlongD = dict();\r\n        for (var thread of liveThreadData) {\r\n          lastlongD[thread.no] = lastlong(thread).no;\r\n        }\r\n        return [...Array.from(liveThreadData)].sort((a, b) => lastlongD[b.no] - lastlongD[a.no]).map(post => post.no);\r\n      case 'bump':       return liveThreadIDs;\r\n      case 'birth':      return [...Array.from(liveThreadIDs) ].sort((a, b) => b - a);\r\n      case 'replycount': return [...Array.from(liveThreadData)].sort((a, b) => b.replies - a.replies).map(post => post.no);\r\n      case 'filecount':  return [...Array.from(liveThreadData)].sort((a, b) => b.images  - a.images).map(post => post.no);\r\n      case 'activity':   return [...Array.from(liveThreadData)].sort((a, b) => ((tmp_time-a.time)/(a.replies+1)) - ((tmp_time-b.time)/(b.replies+1))).map(post => post.no);\r\n      default: return liveThreadIDs;\r\n    } })();\r\n    if (/-rev$/.test(Index.currentSort)) {\r\n      Index.sortedThreadIDs = [...Array.from(Index.sortedThreadIDs)].reverse();\r\n    }\r\n    if (Index.search && (threadIDs = Index.querySearch(Index.search))) {\r\n      Index.sortedThreadIDs = threadIDs;\r\n    }\r\n    // Sticky threads\r\n    Index.sortOnTop(obj => obj.isSticky);\r\n    // Highlighted threads\r\n    Index.sortOnTop(obj => obj.isOnTop || (Conf['Pin Watched Threads'] && ThreadWatcher.isWatchedRaw(obj.boardID, obj.threadID)));\r\n    // Non-hidden threads\r\n    if (Conf['Anchor Hidden Threads']) { return Index.sortOnTop(obj => !Index.isHidden(obj.threadID)); }\r\n  },\r\n\r\n  sortOnTop(match) {\r\n    const topThreads    = [];\r\n    const bottomThreads = [];\r\n    for (var ID of Index.sortedThreadIDs) {\r\n      (match(Index.parsedThreads[ID]) ? topThreads : bottomThreads).push(ID);\r\n    }\r\n    return Index.sortedThreadIDs = topThreads.concat(bottomThreads);\r\n  },\r\n\r\n  buildIndex() {\r\n    let threadIDs;\r\n    if (!Index.liveThreadData) { return; }\r\n    switch (Conf['Index Mode']) {\r\n      case 'all pages':\r\n        threadIDs = Index.sortedThreadIDs;\r\n        break;\r\n      case 'catalog':\r\n        threadIDs = Index.sortedThreadIDs.filter(ID => !Index.isHidden(ID) !== Index.showHiddenThreads);\r\n        break;\r\n      default:\r\n        threadIDs = Index.threadsOnPage(Index.currentPage);\r\n    }\r\n    delete Index.pageNum;\r\n    $.rmAll(Index.root);\r\n    $.rmAll(Header.hover);\r\n    if (Index.loaded && Index.root.parentNode) {\r\n      $.event('PostsRemoved', null, Index.root);\r\n    }\r\n    if (Conf['Index Mode'] === 'catalog') {\r\n      Index.buildCatalog(threadIDs);\r\n    } else {\r\n      Index.buildStructure(threadIDs);\r\n    }\r\n  },\r\n\r\n  threadsOnPage(pageNum) {\r\n    const nodesPerPage = Index.threadsNumPerPage;\r\n    const offset = nodesPerPage * (pageNum - 1);\r\n    return Index.sortedThreadIDs.slice(offset ,  offset + nodesPerPage);\r\n  },\r\n\r\n  buildStructure(threadIDs) {\r\n    const threads = Index.buildThreads(threadIDs, false, Conf['Show Replies']);\r\n    const nodes = [];\r\n    for (var thread of threads) {\r\n      nodes.push(thread.nodes.root, $.el('hr'));\r\n    }\r\n    $.add(Index.root, nodes);\r\n    if (Index.root.parentNode) {\r\n      $.event('PostsInserted', null, Index.root);\r\n    }\r\n    Index.loaded = true;\r\n  },\r\n\r\n  buildCatalog(threadIDs) {\r\n    let i = 0;\r\n    const n = threadIDs.length;\r\n    let node0 = null;\r\n    var fn = function() {\r\n      if (node0 && !node0.parentNode) { return; } // Index.root cleared\r\n      const j = (i > 0) && Index.root.parentNode ? n : i + 30;\r\n      node0 = Index.buildCatalogPart(threadIDs.slice(i, j))[0];\r\n      i = j;\r\n      if (i < n) {\r\n        return $.queueTask(fn);\r\n      } else {\r\n        if (Index.root.parentNode) {\r\n          $.event('PostsInserted', null, Index.root);\r\n        }\r\n        return Index.loaded = true;\r\n      }\r\n    };\r\n    fn();\r\n  },\r\n\r\n  buildCatalogPart(threadIDs) {\r\n    const threads = Index.buildThreads(threadIDs, true);\r\n    Index.buildCatalogViews(threads);\r\n    Index.sizeCatalogViews(threads);\r\n    const nodes = [];\r\n    for (var thread of threads) {\r\n      thread.OP.setCatalogOP(true);\r\n      $.add(thread.catalogView.nodes.root, thread.OP.nodes.root);\r\n      nodes.push(thread.catalogView.nodes.root);\r\n      $.on(thread.catalogView.nodes.root, 'mouseenter', Index.cb.catalogReplies.bind(thread));\r\n      $.on(thread.OP.nodes.root, 'mouseenter', Index.cb.hoverAdjust.bind(thread.OP.nodes));\r\n    }\r\n    $.add(Index.root, nodes);\r\n    return nodes;\r\n  },\r\n\r\n  clearSearch() {\r\n    Index.searchInput.value = '';\r\n    Index.onSearchInput();\r\n    return Index.searchInput.focus();\r\n  },\r\n\r\n  setupSearch() {\r\n    Index.searchInput.value = Index.search;\r\n    if (Index.search) {\r\n      return Index.searchInput.dataset.searching = 1;\r\n    } else {\r\n      // XXX https://bugzilla.mozilla.org/show_bug.cgi?id=1021289\r\n      return Index.searchInput.removeAttribute('data-searching');\r\n    }\r\n  },\r\n\r\n  onSearchInput() {\r\n    const search = Index.searchInput.value.trim();\r\n    if (search === Index.search) { return; }\r\n    Index.pushState({\r\n      search,\r\n      replace: !!search === !!Index.search\r\n    });\r\n    return Index.pageLoad(false);\r\n  },\r\n\r\n  querySearch(query) {\r\n    let keywords, match;\r\n    if (match = query.match(/^([\\w+]+):\\/(.*)\\/(\\w*)$/)) {\r\n      let regexp;\r\n      try {\r\n        regexp = RegExp(match[2], match[3]);\r\n      } catch (error) {\r\n        return [];\r\n      }\r\n      return Index.sortedThreadIDs.filter(ID => regexp.test(Filter.values(match[1], Index.parsedThreads[ID]).join('\\n')));\r\n    }\r\n    if (!(keywords = query.toLowerCase().match(/\\S+/g))) { return; }\r\n    return Index.sortedThreadIDs.filter(ID => Index.searchMatch(Index.parsedThreads[ID], keywords));\r\n  },\r\n\r\n  searchMatch(obj, keywords) {\r\n    const {info, file} = obj;\r\n    if (info.comment == null) { info.comment = g.SITE.Build.parseComment(info.commentHTML.innerHTML); }\r\n    let text = [];\r\n    for (var key of ['comment', 'subject', 'name', 'tripcode']) {\r\n      if (key in info) { text.push(info[key]); }\r\n    }\r\n    if (file) { text.push(file.name); }\r\n    text = text.join(' ').toLowerCase();\r\n    for (var keyword of keywords) {\r\n      if (-1 === text.indexOf(keyword)) { return false; }\r\n    }\r\n    return true;\r\n  }\r\n};\r\nexport default Index;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport DataBoard from \"../classes/DataBoard\";\r\nimport Thread from \"../classes/Thread\";\r\nimport Index from \"../General/Index\";\r\nimport UI from \"../General/UI\";\r\nimport { g, Conf, d, doc } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport Menu from \"../Menu/Menu\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ThreadHiding = {\r\n  init() {\r\n    if (!['index', 'catalog'].includes(g.VIEW) || (!Conf['Thread Hiding Buttons'] && !(Conf['Menu'] && Conf['Thread Hiding Link']) && !Conf['JSON Index'])) { return; }\r\n    this.db = new DataBoard('hiddenThreads');\r\n    if (g.VIEW === 'catalog') { return this.catalogWatch(); }\r\n    this.catalogSet(g.BOARD);\r\n    $.on(d, 'IndexRefreshInternal', this.onIndexRefresh);\r\n    if (Conf['Thread Hiding Buttons']) {\r\n      $.addClass(doc, 'thread-hide');\r\n    }\r\n    return Callbacks.Post.push({\r\n      name: 'Thread Hiding',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  catalogSet(board) {\r\n    if (!$.hasStorage || (g.SITE.software !== 'yotsuba')) { return; }\r\n    const hiddenThreads = ThreadHiding.db.get({\r\n      boardID: board.ID,\r\n      defaultValue: dict()\r\n    });\r\n    for (var threadID in hiddenThreads) { hiddenThreads[threadID] = true; }\r\n    return localStorage.setItem(`4chan-hide-t-${board}`, JSON.stringify(hiddenThreads));\r\n  },\r\n\r\n  catalogWatch() {\r\n    if (!$.hasStorage || (g.SITE.software !== 'yotsuba')) { return; }\r\n    this.hiddenThreads = JSON.parse(localStorage.getItem(`4chan-hide-t-${g.BOARD}`)) || {};\r\n    return Main.ready(() => // 4chan's catalog sets the style to \"display: none;\" when hiding or unhiding a thread.\r\n    new MutationObserver(ThreadHiding.catalogSave).observe($.id('threads'), {\r\n      attributes: true,\r\n      subtree: true,\r\n      attributeFilter: ['style']\r\n    }));\r\n  },\r\n\r\n  catalogSave() {\r\n    let threadID;\r\n    const hiddenThreads2 = JSON.parse(localStorage.getItem(`4chan-hide-t-${g.BOARD}`)) || {};\r\n    for (threadID in hiddenThreads2) {\r\n      if (!$.hasOwn(ThreadHiding.hiddenThreads, threadID)) {\r\n        ThreadHiding.db.set({\r\n          boardID:  g.BOARD.ID,\r\n          threadID,\r\n          val:      {makeStub: Conf['Stubs']}});\r\n      }\r\n    }\r\n    for (threadID in ThreadHiding.hiddenThreads) {\r\n      if (!$.hasOwn(hiddenThreads2, threadID)) {\r\n        ThreadHiding.db.delete({\r\n          boardID:  g.BOARD.ID,\r\n          threadID\r\n        });\r\n      }\r\n    }\r\n    return ThreadHiding.hiddenThreads = hiddenThreads2;\r\n  },\r\n\r\n  isHidden(boardID, threadID) {\r\n    return !!(ThreadHiding.db && ThreadHiding.db.get({boardID, threadID}));\r\n  },\r\n\r\n  node() {\r\n    let data;\r\n    if (this.isReply || this.isClone || this.isFetchedQuote) { return; }\r\n\r\n    if (Conf['Thread Hiding Buttons']) {\r\n      $.prepend(this.nodes.root, ThreadHiding.makeButton(this.thread, 'hide'));\r\n    }\r\n\r\n    if (data = ThreadHiding.db.get({boardID: this.board.ID, threadID: this.ID})) {\r\n      return ThreadHiding.hide(this.thread, data.makeStub);\r\n    }\r\n  },\r\n\r\n  onIndexRefresh() {\r\n    return g.BOARD.threads.forEach(function(thread) {\r\n      const {root} = thread.nodes;\r\n      if (thread.isHidden && thread.stub && !root.contains(thread.stub)) {\r\n        return ThreadHiding.makeStub(thread, root);\r\n      }\r\n    });\r\n  },\r\n\r\n  menu: {\r\n    init() {\r\n      if ((g.VIEW !== 'index') || !Conf['Menu'] || !Conf['Thread Hiding Link']) { return; }\r\n\r\n      let div = $.el('div', {\r\n        className: 'hide-thread-link',\r\n        textContent: 'Hide'\r\n      }\r\n      );\r\n\r\n      const apply = $.el('a', {\r\n        textContent: 'Apply',\r\n        href: 'javascript:;'\r\n      }\r\n      );\r\n      $.on(apply, 'click', ThreadHiding.menu.hide);\r\n\r\n      const makeStub = UI.checkbox('Stubs', 'Make stub');\r\n\r\n      Menu.menu.addEntry({\r\n        el: div,\r\n        order: 20,\r\n        open({thread, isReply}) {\r\n          if (isReply || thread.isHidden || (Conf['JSON Index'] && (Conf['Index Mode'] === 'catalog'))) {\r\n            return false;\r\n          }\r\n          ThreadHiding.menu.thread = thread;\r\n          return true;\r\n        },\r\n        subEntries: [{el: apply}, {el: makeStub}]});\r\n\r\n      div = $.el('a', {\r\n        className: 'show-thread-link',\r\n        textContent: 'Show',\r\n        href: 'javascript:;'\r\n      }\r\n      );\r\n      $.on(div, 'click', ThreadHiding.menu.show);\r\n\r\n      Menu.menu.addEntry({\r\n        el: div,\r\n        order: 20,\r\n        open({thread, isReply}) {\r\n          if (isReply || !thread.isHidden || (Conf['JSON Index'] && (Conf['Index Mode'] === 'catalog'))) {\r\n            return false;\r\n          }\r\n          ThreadHiding.menu.thread = thread;\r\n          return true;\r\n        }\r\n      });\r\n\r\n      const hideStubLink = $.el('a', {\r\n        textContent: 'Hide stub',\r\n        href: 'javascript:;'\r\n      }\r\n      );\r\n      $.on(hideStubLink, 'click', ThreadHiding.menu.hideStub);\r\n\r\n      return Menu.menu.addEntry({\r\n        el: hideStubLink,\r\n        order: 15,\r\n        open({thread, isReply}) {\r\n          if (isReply || !thread.isHidden || (Conf['JSON Index'] && (Conf['Index Mode'] === 'catalog'))) {\r\n            return false;\r\n          }\r\n          return ThreadHiding.menu.thread = thread;\r\n        }\r\n      });\r\n    },\r\n\r\n    hide() {\r\n      const makeStub = $('input', this.parentNode).checked;\r\n      const {thread} = ThreadHiding.menu;\r\n      ThreadHiding.hide(thread, makeStub);\r\n      ThreadHiding.saveHiddenState(thread, makeStub);\r\n      return $.event('CloseMenu');\r\n    },\r\n\r\n    show() {\r\n      const {thread} = ThreadHiding.menu;\r\n      ThreadHiding.show(thread);\r\n      ThreadHiding.saveHiddenState(thread);\r\n      return $.event('CloseMenu');\r\n    },\r\n\r\n    hideStub() {\r\n      const {thread} = ThreadHiding.menu;\r\n      ThreadHiding.show(thread);\r\n      ThreadHiding.hide(thread, false);\r\n      ThreadHiding.saveHiddenState(thread, false);\r\n      $.event('CloseMenu');\r\n    }\r\n  },\r\n\r\n  makeButton(thread, type) {\r\n    const a = $.el('a', {\r\n      className: `${type}-thread-button`,\r\n      href:      'javascript:;'\r\n    }\r\n    );\r\n    $.extend(a, {textContent: type === \"hide\" ? '' : '' });\r\n    a.dataset.fullID = thread.fullID;\r\n    $.on(a, 'click', ThreadHiding.toggle);\r\n    return a;\r\n  },\r\n\r\n  makeStub(thread, root) {\r\n    let summary, threadDivider;\r\n    let numReplies  = $$(g.SITE.selectors.replyOriginal, root).length;\r\n    if (summary = $(g.SITE.selectors.summary, root)) { numReplies += +summary.textContent.match(/\\d+/); }\r\n\r\n    const a = ThreadHiding.makeButton(thread, 'show');\r\n    $.add(a, $.tn(` ${thread.OP.info.nameBlock} (${numReplies === 1 ? '1 reply' : `${numReplies} replies`})`));\r\n    thread.stub = $.el('div',\r\n      {className: 'stub'});\r\n    if (Conf['Menu']) {\r\n      $.add(thread.stub, [a, Menu.makeButton(thread.OP)]);\r\n    } else {\r\n      $.add(thread.stub, a);\r\n    }\r\n    $.prepend(root, thread.stub);\r\n\r\n    // Prevent hiding of thread divider on sites that put it inside the thread\r\n    if (threadDivider = $(g.SITE.selectors.threadDivider, root)) {\r\n      return $.addClass(threadDivider, 'threadDivider');\r\n    }\r\n  },\r\n\r\n  saveHiddenState(thread, makeStub) {\r\n    if (thread.isHidden) {\r\n      ThreadHiding.db.set({\r\n        boardID:  thread.board.ID,\r\n        threadID: thread.ID,\r\n        val: {makeStub}});\r\n    } else {\r\n      ThreadHiding.db.delete({\r\n        boardID:  thread.board.ID,\r\n        threadID: thread.ID\r\n      });\r\n    }\r\n    return ThreadHiding.catalogSet(thread.board);\r\n  },\r\n\r\n  toggle(thread) {\r\n    if (!(thread instanceof Thread)) {\r\n      thread = g.threads.get(this.dataset.fullID);\r\n    }\r\n    if (thread.isHidden) {\r\n      ThreadHiding.show(thread);\r\n    } else {\r\n      ThreadHiding.hide(thread);\r\n    }\r\n    return ThreadHiding.saveHiddenState(thread);\r\n  },\r\n\r\n  hide(thread, makeStub=Conf['Stubs']) {\r\n    if (thread.isHidden) { return; }\r\n    const threadRoot = thread.nodes.root;\r\n    thread.isHidden = true;\r\n    Index.updateHideLabel();\r\n    if (thread.catalogView && !Index.showHiddenThreads) {\r\n      $.rm(thread.catalogView.nodes.root);\r\n      $.event('PostsRemoved', null, Index.root);\r\n    }\r\n\r\n    if (!makeStub) { return threadRoot.hidden = true; }\r\n\r\n    return ThreadHiding.makeStub(thread, threadRoot);\r\n  },\r\n\r\n  show(thread) {\r\n    if (thread.stub) {\r\n      $.rm(thread.stub);\r\n      delete thread.stub;\r\n    }\r\n    const threadRoot = thread.nodes.root;\r\n    threadRoot.hidden = (thread.isHidden = false);\r\n    Index.updateHideLabel();\r\n    if (thread.catalogView && Index.showHiddenThreads) {\r\n      $.rm(thread.catalogView.nodes.root);\r\n      return $.event('PostsRemoved', null, Index.root);\r\n    }\r\n  }\r\n};\r\nexport default ThreadHiding;\r\n",null,null,null,null,"export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAitJREFUOE9jYCAWKJWwavr0KyXWb/FIbDtUFFyzJx6nVofE2Xo5nXsj0rqPNSR0nVkR2Hjmgmfd+U9Otdf+m5Vf/6+SfeU/R9ChVVgNYDRtlfJuuPA/rPfe/4QpD/6nznj0P27Kw/9unff/69Xf+69c/+C/SO7N/0z+OAxgMmmRCe++/r9i3ev/KWvf/vdY8PK/bt/9/wrNV3/IN5y/IVt1YqNg4pGTTP4HsbuA2bhZ2qvpyn+xjIObxAp3VwqlrgngLFyryVy5nhPmZJHANS2cwYexG8BmVC/pWn3hP4NZlzWuQDJI3dIiFnUUuwEsQAOcq87jNcC7fHeLUtJxHF4AGmBWeAavAWH1+1rUUk7giAWjOknllON4DXAs2NEiG4/DBQxAF/CFHfrPYI4jDFSLuJVjNrUJhB/B7gIGo1pJRt99GAZYJK7wLJ1z7Xzl4vu/7aqv/GRBj0bjqAX2qb0nJ7mXH17C4HcUxQA+hymWtSue/C5a9up/9Ozn/7Vr7v1nRY7GqMb91T3b3v6vWvPmf/S0p/9ZQk+DDLCBRSOz06Jqk+o7/21nvfqvsebDf7kZL/5zBaxphkezd+OFn7HzXvz3Wvjmv9a8N//5Ek//ZTBpVYUrMG2X5wjcdl68+uI/wa5Lr3hSNjczGFeywOVZ/bbcVGp//F9izfv/Ql03f3P4LC/HSEQquYwMFnUCDJ7dzBhyjGZNQpye89M5gpfnMvtNUyE2h4PUAQBovvT7lyNljwAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAgY0hSTQAAeiYAAICEAAD6AAAAgOgAAHUwAADqYAAAOpgAABdwnLpRPAAAAadQTFRFAAAAwzw8xDs7cY6O0iws0ysrtF9f0Sws1CwsyzU1zTIy1igoyzQ01icnY7i4t0hI0S4u0ysr1Soq1ikp1ikp1Soq0ysr0S4uu0VFzjEx1Csr1ygo2Ccn2Ccn1ygo1CoqzjExzjAw1Skp2Ccn2Ccn1ikp0TAwxzY21Soq1SoqyzQ00iws1ygo1ygo0yws1Soq1Skp1igo1igo1igo1igo1igo1igo1Coq1Soq0C0t1ygo1ygo0S4unV5e1Csr1ygo1ygo1CsruUdHxzg41Skp1ygo1CsryTU10C4u1igo1ycn1ygo0i0txjo60S0t1ikp1ygo1ikp1Cws1Coq1Coq0yws0S0tyzQ00iws1Soq0ysr0i0txDs72Ccn2CUl2CYm2CQk3EFB2S8v2zw82jY24FZW3D0931FR3EBA3UND8LS04FVV7qys4V9f4WBg+erq766u9t7e7qqq2Ckp54KC9+Pj6pSU+Ojo5XNz9NHR6YqK8bu765ub5G5u9M3N6ImJ88vL5XV165eX3UVF6pWV3UhI2Soq2jU12Coq2jQ02Cgo2Sws////FaxLuAAAAF10Uk5TAAAAAAAAAAAAAAAAAAAAASJnoLy9oWolAhBz1vr72XgTGKf8/a4cCpuiDVvz9mS6xOvy9vzg6aGsPOToRAFv9fh2Awm07XgIMd765UEDOsfemVhhY00nBommbCkEI8horgAAAL5JREFUKBUFwbFKA0EUQNF7387sMq4EmzRpLSSdIBYKFv6Af2prnSYkRT4gWFgkCBJQ0EIFdcZzBCeqqh4qdk7VW2ChPusw02sAYKU7z7wEAAA2piQKFbrWSHazc1J0XWs5pdxPDykcVX+7Y9UxUsSo+s7PibqPFBRV/C5qi4i/UkrJrc7L47Bt4ZWnUaMCAE9GSrtKBQD2fR+bnAEAeOn7dUTOwApe35bDsPz0zsniQlV98IN0tJ3f6P0XAMA/kxou7OXCdnoAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAwUExURTSY22ey5E2l4KbS75rM7Y3F64C/6f///8zl9nS45r/f9PL5/UGe3bPY8Vqr4v///wNjrzUAAAABYktHRA8YugDZAAAAB3RJTUUH4AINEi85AIH95AAAAE9JREFUCNdjYMAGGBWgDGYHCM2a3hkAZmi0dzSBaKaO9o5moCqmLiCjYzNQyw4QowIodQzI6E0AKcpo72gE6+Jyb1kAMehUA9RktgdYbQYAjGIVNGGXBJkAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAABGdBTUEAALGPC/xhBQAAAAFzUkdCAK7OHOkAAAAnUExURQBk3ff6/trp+kKO5wZt3xx54q7P9Ozz/IS17zOG5WKh653E8sbc9/GbbcoAAABZSURBVAjXY2BAASyhDhAGc9oECMOjyAAiESEEYrBYpLWBGcwHxcvBjDDxHelghpF0yDQwY3kVgweEUeEQDWbMEepqAjO8FMsLIeYsU8o+BrbCdWboTAe4AwALXxWGjW41FwAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAjVBMVEWn3gCo3gSr3w2t4BSu4Bav4Ri35C+45DK45DO55DXA50rA50vB50zC6E/D6FTF6VjG6VvL62vN7G/P7XbQ7XfW74vY8JDa8ZTe8qDe8qLf86Pi9Kzj9K7k9LHp9sDp98Lq98Ps+Mr0++L5/O75/fD6/fH6/fL6/fP7/fT7/fb8/ff8/vj8/vn+/v7///91X4cfAAAAcklEQVR42o3M2xKBUACF4aVQckrIuRJK6H//x2sme4/MuPDfre9i6c/Cc3U5Dj87BuAxsXvGu6JvIIXEHRWwNHCHQNrCzkAFkbSBg4EM8i+Yw7PXBa3zRfuxVyf/Bis7nKwGKAcWxgC8prI5Sc315OlnDfzpDar2S9/oAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABblBMVEXc3NykpKTW1tbb29ugoKCdnZ0AAAACAgIEDRcKCgoMDAwODg4QIzYRDAoTExMUDwwVAg0WICsaEw8aGhoiCBklGxUmERwwKCQ7LSU7Ozs8LSZFLyNINi1JNyxJNy1KSklMOi5VR1FXV1daQTRkZGRseYZwU0F4eHh7dnR8bWV/YE6IdGiKcGCKkJaNgYeNjY2RdGOScWCUcWCZmZmhoaGkpKSoqKirfmaurq6xsbG1tbW6urq+vr7AbmzBb23CwsLGxsbHx8fHyMjJycnJysrMzMzOiYbPi4fQ0NDRoYbT09PU1NTW1tbY2NjZqIzZ2dnb29vd3d3f39/i4uLktZrk5OTl5eXm5ubn5+fo6Ojq6urs7OzttKLu7u7wuqbw8PDx8fHz8/P4+Pj5+fn7uZj8vpz9ya79ybD/tZf/upr/wZ//w6H/xKH/xaL/xrH/yqj/y7T/zqv/z7D/07D/17n/2Lv/2Lz/3L//38n/4Mk3Q/ZuAAAABnRSTlMSFcbGzc5MNKFvAAAA1klEQVQoz2NgYPZHAswMDEwRSclwkBTBxOARn4gE4j0YXBOiJNUDg7y8Ar1UlOITXBkcY73Z2Li42dg42dn4wmIdGeyjQ7nZoEA4PNqewSZKlw0O9KJsGKwjBdl4ZeWkJGQUhNjEIq0ZrMI5+D0ri7Jz8itCRAXCrRgsQ3mUy+xicrPSbfO0REItGSyCVaVL3ONSU9LcCtQUgy0YzIJ85M1LizMzCsv9xF2CzBhMAwN99TV1DI0MtDWcAgNNGUycA5CAswkDi5kDwrMOZiwMjKzGSICVEQDhZj0UQV7PewAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAs5JREFUOE+lk/tvi1EYx98/xT8gW4REIpGFMEQWl2FiM9ZMZhm2xRAyOsmujFFmdFRHu0tWm87UypxStr69zPauN5e5rHVp3IYhbOvHy+wHEQlxkm+ek+d8nm9OznkeSfrfldmgJC7QyUlTymsJTfuTZ25z4HdWYwyLreYhtpgekGPw0+kKvo1Eo+IXRSIiEhkWZuc9tqnsJD9EqTUopCxjSGTpB0iueczSo1HyW8cpsExQ1DbxI2pt45j9cXpexul4FEd79RnZphAa/SD7WvuFtO6UItbU9LC+YQxNI2w0wwYT5LRAdhOU3oBTIXC9gXP3oUSGgz2vST3gYHejR0jptT1C332f8yrUEYHrz8CgxDnpm6DKCUfc0KnmXa/AEVPPwnDcD0cvetA2uYRk67Ive/lpjO7YBO1PPuF8Df3vwf4cbNE4tqdw7YVq8HYyHx6FvhE1hkMEg8HDUqvFkjT4aIjMqkqyqkswDSrcfBfH+Q561YLAZ/B+BLda6FXlU/cPv0AoEPhuoP1h4Av7Wbh9E/Py15NWWUjeSR3nZDfeN+N0DY9hG/7K1eGP3P0S5/EYRFUF/IOTBrUXHPm9fT6mr1xEwupkZqxbzLyiDJYUZ5NSnkdqdSHpxyrYdFpPgdmAsdfJwPMI/Yr65bf7tZLGGBQ7DNdJWFtIYvoOZmbuZE7OXpIKKli86zAr9p9gTVktWTVnKTI2U95uRWe3U2IJUDbVB5p6hVm5x5m9Vc/cnedZUNzC8lILaQesZBy6hEZ3maKzgvJWFzVWD9XtXvVGQbSWASFtMATVRlJIKbOTWtlJXaeXepuPM1f6MNp9GLt8mLvvYLmp0OhQ2Fwvk6m7xaqDTvY0eYWUVtcnllXfYlGpnfklVuraHHg8HjxuN+6fktUHlWWZPaZeUo/ILK0UKttBcbNbSB9GP0yLxWJJUxoZGUn80zD9C/vXQ/4NHY10h3M1zmQAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAABcVBMVEUAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAB3dIYAAAAAAAAAAAAbGh4BBAcCBgoBBgoCBwsCCQ/QzucCCA7MyuXZ1eUBBQmTh8fo5/i9svIAAADh3vQAAAACCA0CCQ8CCQ4DDBQbGCUDChDr6vgAAAAAAAAREBIDCxK6tdfe2fTv7/cDCxIDDBQEDRUHDhgMJjXk4PZdXWdLUFoUNEYOKDgSMUMRLUBneI4eTGj08/QmW3onW3rTzvfOx/giU3IiVHMkWHdEaYJobHv3+PokWHpua6TNy9xZgZ+1quz8/foQKj0XPFInWn0nW38tZ4o6fqg8gq48grA9hrU/i7pAhrNAiLdBjLtEjr1FksNIjr5Il8pImMtKWnNqhL97odKFqti5q/q5rPq60+nCt/vLw/vPx/jV0vHY0/rc1/rg2/vh3fzn4fzu6/vx8vf19Pv19Pz49/v5+Pv8/Pv8/fr9/vv+/frziVtUAAAAT3RSTlMABQYHCAoNDhARGRobL0ZOV1xdXV5fYGBmZnB0eX2MjZSaoaGio6mqqqustLq7zubo6Ojo6evt7u/x8fLy9/f4+Pj5+vr6+vr6+/39/v7+XKgUSwAAAMhJREFUKM9jYGDg4OZmZgABKINT1dBAhBHIYFMxMBIDisjbhoZbCTExsCu5hoeY8DEwcOkEx8fY6MqpucTGB0izglVEplcU5/gmRYWBVQDNMK+s0hN3SvMyBpsBNJxXw0NfwTEjVQZqHQMHj5RfWW5mliSEC7TPzK6yJD/bXZQRzGdXcisqLy309okA2Q4Eis4peQWmstqBCdGW/CABraC45ERBBs3A6Fh/AbAKTwsHa34QZW8NVsGuLqwswQSjQICTmYMFQaEDAAF8JHLfKGswAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAlNJREFUGBkFwU2LVmUYAODrPu8Z5x1xSpRBXQyFoLsBE+wfiO5atJOgnf9DUPwFgtGinUgEaQsRhHYuMtpEiEWuG5iNjuOcj+c8z911xXcXL/68c3Dw1fzhg0QgEQAAEYGUKXFie9vxlSs/xk/rdavjGEkmkWSih65z4osv9GfOiK6LzEyZ2uGh4dUrmzs72ddlUUhkoiMr4PT167589Mh6c1N0nSRlqrX67dat+PDyZXRT19m5edPnt28rGFHxMcJ6d9fprS1/37tneP3aemPD1uamUydPOru3p5DdGOH0tWsu3LhhxIQJM2qEpRT/Pn3q/du3AhARSmvGTH0lplKMrVkiYpVpQaJlighzhDkzhmEA0fcWoqAfyaFW4zTlgCABxlrNmY4ylUzLsiREprFWc0T2M+ZSjKWY0AEaltZUjJixZJIpuk5pTWlNP2BYFvOyKJkCAKU1tTXHrZlqVWolUxdhxsfVSj9FmJfFMM9GdICGGa01HyMstYpMIFPJVNDPmYZSTOPoOEKHzNRlKpmWWh1j6TpLa2SKTKVWU6Z+Qolwdm/P9QcPZKa2LH69e9eIMs+WCL/cv2/98CGZPrt61am+V9APq1X89eyZ/968obVYaiXT4dGREgG+vnPHeHgYMsH2+fP+efEihtVKv7SWw/6+9/v7KYLMhIywTJPamvOXLomukyRsrNf+ePzYkpl9dJ3SWgSCSCQCfz5/7pMLF2yfO6eLiAQcHRz4/cmT+HR7O+Ob3d0fNt69+7a2BiICQCJbA0EgE5lpvbXl1OXL3/8Pfax4+6SjSukAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAB1FBMVEUAAAAAAAAAAABWYWwAAABbY3BbYm5dZnFdZXJeZnMEBAQHCAhYYGpdZnFdZnBgaHIlJyomKCooKi09QkdESU5eZGtdYmhdYmleY2lrcXdqb3Rqb3Rqb3SSmJ+SlJeWmJutr7GtrrCWm6ChpKhbW1tmZmZvb290dHR3d3d4eHh5eXl6enp8fHx+gIJ/f3+CgoKDg4OEhISFhYWHh4eKioqKjI2Li4uMjIyOjo6Pj4+QkJCRkZGSkpKUlJSVl5mWlpaYmZqZm52ampqbm5ucnJydnZ2enp6fn5+hoaGioqKkpKSkpaalpaWmp6mmp6qnqauoqKioqquoqq2qqqqrrK2srKysra6srrCsrrGurq6vr6+wsLCxsbGysrKztLa0tLS1t7m2tra3t7e4uLi5ubm6urq7u7u8vLy9vb2+vr7AwMDAwsTBwcHExcfFxcXFxsnGxsbHx8fIyMjJycnMzMzNzc3Ozs7O0NLPz8/Q0NDR0dHR09XT09PV1dXV1dbV1tfV19rW1tbX19fX19jY2tzZ2dnZ2tva2tra3N3a3N7c3Nze3t7f39/f4OHg4ODi4uLl5+jm5ubs7Ozs7e3u7u7v7+/v8PDw8PDx8fHy8vLz8/P29vYSoLMZAAAAJHRSTlMABAUGCwsNHCAiLzMzMzZEYGJwgIuOnJycnqmqq9bc3+/w8fkZ0N/uAAAA/klEQVQoU2NgYGDl5YMDdgYGBmZZ3964CYFtIR3e9Q7K/AwMHI55KfaFmcHWMy3K3MwlGRg4wz0zdYpcorRbNbL0LaWAAp3ts2umV8wo6MupTauQBgqUG03VL7W3sfZSb1erAgm02M+yzYrVCXUy6zapAQlUx/dEdyX3J3ZHVUYVywAF8o2rDNN1Go2jzGLMokAC2QbuSc42mXmaOXop9iAtCXrJ5qXWjT59Abl2ESJAAX/tSIMMiyrrqQ3T6uS5gQK6kSqpqkUermGTexQFmYACflqR+hlWZSamzQpCLEDPsSmVVDT1TJw0JUhOAMRnYOARFRMTE5cQF+ZiBPIAII5B3EVG0b4AAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABIFBMVEUhHyAAAABzPBnxaA3CWBEnJSYbGRptbW16enpzc3PTayWhb04hHyAhHyAhHyAhHyAhHyAhHyAhHyAhHyAhHyAhHyAhHyAhHyAhHyAhHyApIh+0UhMfHiBWMhvsZg7zaQ0hHyAhHyAXHCHzaQ3xaA3xaA3xaA3xaA0hHyAhHyDxaA3xaA3xaA3xaA3xaA3xaA0oJickIiMdGxwUEhPxaA3xaA3xaA1sbGxwcHB3d3eFhYXxaA3xaA3xaA1zc3Nzc3Nzc3Nzc3Nzc3PxaA3xaA3xaA1zc3Nzc3NtdHjxaA3xaA1yc3STcFnvaA/yaAxzc3N4c2/FbDFzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3Nzc3MhHyDxaA1zc3MAAAAfljyVAAAAXHRSTlMAAAAAAAAAAAAAAAAZkjMBHOLXYArj8p0u2VsJ1XaGL/OhKyXc1WEN2gwk2/SjKgEYiS4B/tYFGosqAdleAxzj12ML9Z8s850rJWbYeYMs1F8Koiri1V0MGZY0AYbIBFIAAAABYktHRAH/Ai3eAAAACXBIWXMAAA3XAAAN1wFCKJt4AAAAB3RJTUUH4wYXFBUVX81QWQAAAKxJREFUGNNVz9UWgkAQANDBtdbu7lZsxe7ubpH//wxBPKDzNvdMAmi0Oj0QQgAYjCazBX7BStvsDqHoAzTtdLklf+Dx+vwICRAIhsKRaCyOvpAwJ6Up8pXOZHOIAFm+UCzJEQuvMhWrIFBUa/WGkodmq40Ad7q9/kDFwnA05lpYYCbT2ZykFvxQDhhmuVpvcvxaHra7vfp72KflcMSYEOB0vlyx+By+3R9PMSfe+P0enM1454kAAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMDYtMjRUMDM6MjE6MjEtMDc6MDDse6MAAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTA2LTI0VDAzOjIxOjIxLTA3OjAwnSYbvAAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAABsklEQVQ4y5WTy2pUQRCGv2rbzDjJeAlIBmOyipGIIJqFEBDElwh4yULGeRFXPoEIBl/AvQ/gC2RnxCAoxijiwks852S6+3dxzslcHJCpTXVX11/Xv0097gLPgVNMJxnQNfX4zsqleWbnpoMf/oa9d988MM9MC/rp+E0a+A0dsVobMNMCOO8B6McRoABJI+A6gJmN3D2A8jgEBCEkSEMBrcrsDAzDWWn3AjgKFaDMmgRqniGFgsaDp1jrLOngDf1XT1D+A1dFc4MKAkkiCVKjjVu7g9+4Rzx4i1u6hjXbuMWr0O5QPNvCu7IaCZwEKQukLGDrm5x8uI0tr6MkiGlkiv7yLfzN+6S5i6QsIMABkEfcxhbWWYMkVAOjxvYAjc3HNHrbKI9VBQBFwF25XQKSBjqIf1YBuAurEMrczgDygD6/x2LCpFLXLUyQ+PoldphhBhYfIX09XU1+Flaukz7uYqs3SHs7cG4BmTsmkBUF9mmXEwa28BNLPaQPLepuNcbGSWQquQC2/Kdcox1FUGkcB0ykck1nA2+wTzMs8stGnP4rbWGw74EuS/GFQWfK7/wF6P4F7fzIAYkdmdEAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAABXFBMVEUPkPoNj/qExv0PkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoNj/oPkPoNj/oNj/qExv0PkPpruvwPkPornfoVk/opnPpnufwPkPqExv0Nj/oPkPoNj/oPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoPkPoOj/opnPsVk/oMjvoOkPoTkfo6pPsblfo3ovva7v7////v9/5Sr/whmPry+f5htvze8P7W7P5itvyl1v0imPu84P3o9P50v/zN6P73+/8lmvs8pfs+pfsKjvr9/v9EqfsNj/oom/v8/v9nufxAp/tJq/sQkPrb7v6t2f0IjPoclvr6/f9luPwUkvrp9f7h8f5ruvy/4f4kmftpuvwxoPum1v32+/8jmfpMrPvu9/7z+f9UsPs7pPv8/f/4/P9oufwalfpDqPsMj/ounvtVsPsnm/qzfQQ9AAAALXRSTlMAAAAggMzw0IYkBPb4iAamsgZ+jPwogpDO1vTYlPoulL4KivyUCiqO1PL01i67tUAWAAAAAWJLR0Q4oAel1gAAAAd0SU1FB+MGFxMuDXVcMbIAAADdSURBVBjTY2AAAmYWVjY2dg5OBgZGJiCXi4VbFwx4ePlAAlz8unAgIAgUENJFAsJMDMw8unp6+gaGRsYmpoa6IqIMYrp6ZuYWllbW5hY2toZ64gwSurp29g6OTs4urm7uHrqSDGy6nhZeet5WPr5+/gGBelJAgSCLYL+Q0LBw3YjIKKAAu250TGxcvE1CYlJySqquNAOHrl9aukVGZla2RU6uoZ4MA6esrl9evnWBYWFRMdBaOQYGXmSHyQNdyieA4CsogjzHpyQL4SqrqIJ9y8Cgpq6hqaWtogPyPgDmvSxRxBWM9AAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wNi0yNFQwMjo0NjoxMy0wNzowMCKUvXUAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDYtMjRUMDI6NDY6MTMtMDc6MDBTyQXJAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQBAMAAADt3eJSAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAAYUExURf///2RBpWRBpWRBpWRBpWRBpWRBpf///+zQyUYAAAAGdFJOUwFdZX0lTzs4r5oAAAABYktHRAcWYYjrAAAAB3RJTUUH4AINEi42iSXRNAAAAD1JREFUCNdjYEiDAAZGGIMtjQEEUBlMCWoEGci6mGEMsxQgIy0BiB3AjLS0FAYQIw0kwABipoI1AhkBQBIAFCIXxiHgq80AAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAEsUExURf///1Cf21Gg3FGi31Gh3VKj4FGh3lKj4VKk4lKl41Ol5FOn51Sp6VSo6FOn5lCf21Gg3FGh3VGi31Gi31Gh3lGg3FGg3FGg3FGg3FGh3lGg3FGi31Kk4lKj4FGh3lGi31Kk4lGh3lGg3FGh3lOm5FOm5VGi31Kj4VSo6FGi31Gh3VGg3FKj4FOn51Gi31So6FWr7VOl5FGi31On51Sq6lKk4lOo51Sp6VOm5FSq61Ws7VOn51Oo51Sq61Ol5FOm5FSq61Wr7VOo51On51Sr7FWs7VSp6lGg3FGh3VOm5FWr7VSp6lKj4VOm5FSo6FSr7FWs7VWs7VWr7VSq6lOo51Om5FOo51So6FOm5VOl5FSq61Ws7VSr7FSp6lSp6VWs7lWr7VKk4lSq6v///6E3MNsAAABVdFJOUwAAAAAAAAAAAAAAAAAAAB0Ii+3xnBVTJhfsMKb+qTEp9GwBF/7lLAbo0m4pLkUTdvk2Ev3+EZnOBo/3Z8ffCRzH/D0OqPxiLnvx3UI8m9n1++GwXQZNS29BAAAAAWJLR0QAiAUdSAAAAAd0SU1FB+ACDRIwBwy67tEAAADKSURBVBjTY2BAB4xogIGRH8IQEBQSFhEVE2eQkJQC8ZmkQ8PCI2Rk5RjkIxUUlRgZlVWioqNjYlXVGNQ14iI1tbR14qLj4+MTdJkZ9PQNosJCE0OjgPz4KEMWBiPjhPiEmKQokIJ4E1MmBmazhHg4MGdlYmCzsLSC8ROsmRkZmFht4Eps7ViADmOzd4DyHZ2YmYACTOzOLmATXd04mIBOd/eQ9owFCXh5c7KB/MLi4+vnHxAYFBzCwcYEEmBi5uLm4eHl42RmAnsSAMZBLgZiFUQ5AAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABmJLR0QAxgDGAP8nNqN7AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH3gMZBjQQLEEqGwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAA5SURBVDjLY2AYaMDIwMDwn1JD/lPCZhpwL+B1wf///ykzgBhDiAoDfIYQZQAjIyP5BuDTPJqQqAQAvW0ZAMk8+EEAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAACvlBMVEUCWv8HXf8AWv8AAAD///8AVP+bqP8AWv8AVO4AOqUAGkgAyf8APa0AL4QABAsASdEAVv8AUv8AUv8AVP8AWP8BWv8JXv8RYv8QYv8DW/8DXP8xdv9RiP9Af/8IXf8AKP8KXv8JXf8NYf8aaf8ATP0UZP0AVf8AT/8AT/8AVv8ATedvnPVAf/8AT/sYZvl0o/8PYf8udf8aa/8FXf8AVf8AOrRBe/Nvn/8AUv0aaPkXZ/8ATv8AKYQZYuwIXf8ca/wTZP8ASP8AED0HUNwZaf8xdPwDWv8AAAAAQMRcjvQAU/8AMZssb/Jmmf8AU/8AJXsRW+dSif8AUv8AAAAASdQtdP8ATv8AQ/8AQv8APbtKgfQud/8XZ/8TZP8FXP8AKIIcZO4wdP8AF08KU95tnv4gafhZi/Rnl/ZzofcocP8AAAAAQ8Q4efRwnvVmlvVcjvgrcfsAQsQAOK0APrwAQcUEStMLXPgDWv8AHE8APLEARdIAQ80ASeEAVf8AOJkAAAAAAAAAAAAABBMAJJIAY/9rmP+vxv90n/+buPv29/7C1P+zx/n///2Crv/7+fjs8f++z/f///3l6fX9/f/L2fj9/P5ilv9Nh/3h6f6vyf/D0vT///2lwP/Z5Pf3+P9OiP9klvr9/Puzyf+QsPX//fnW4v/k6vfv8/86ev94pfj///uRtf/y8vby9f9Fgv9EgPzt7/jj7f8mcf+eufj///x1pP/Z4fT///52pf9Uivv09fnV4v8ncf64yvj7+/6vxPX///yyyf9ynvr6+vvG1/8ocv3O2/fz9v53ofX8+/nb5v+YuPz//vy0yv8vdP3e5/fn7v/p7PX09//b5P7///6eu/9Df/zq7vjc5//I1vT//v3+/v////9+q/9Tivnn6fPy8/rW4fzI1/2qwv6YtPT8+fX39/jz9PqJrveTsvqfpuxrAAAAhXRSTlMAAAAAAAAAAAAAAAAAAAAABSlERA45nrSzP3TZ7e12Ao2LusMcrJYhFwaR/uhCwP/x5tZzBWHy+n3OvA8u17jmpwgPrOz5jAF2+3FA7PdYG8fuPQaX5jAGAV/39MCmdy/e/RGz/vj5/f/rAXj4//z13n52i5qmmFQ1lqOQaTgIBAYKEAYAKGjtAgAAAKNJREFUGBkFwT0uRGEYBtD3ZJ77uT8iGrXCAixCr7OCyRA2oCKqiUYkOgoJwhqUbMAKLEChVYhk4pxswvcWfFGVEbYtuJutqir9Ibc0uh0+V+mf5gY69yN2PzKJiTjCg8qa3uLRAJpKM9AMoL1VOi9zJ4CQ9z0jwHX+RAwAURUxAMSB/L7u35wCGlKaHrDkPGVmwhlc6FN6l1iHKxupn+djAPgHrEwa+qrzy0oAAAAASUVORK5CYII=';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAYFBMVEUAAAAIdZUKh6sLlLkLmr4LmsAMp88NrdYVW3MZj7Acstkrt9s1e5E7vN5EfI9JvdtKwuBijp5kpbl30eiDt8aG1uqRr7qTyNehxM+k4PCy3enB3OTg6Ovv9PXw+fz////L9U5WAAAAAXRSTlMAQObYZgAAAIFJREFUeNplz90OwiAMBWAQpAoyxclkP3je/y0H2AQXz0WT8100rRD6kNI9/cRroemQL3hXhoujZYj4OHoAmBvYGcBISwbWBvfXCrytnIDUQMkbsBpagMA7zhtQdyTFQAmIG7IkYniiZuh3XGsPqoOZkMOJOpAcLqUzNFGGu/57fwc1hgtp0mVSyQAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAMAAAAoLQ9TAAAAIGNIUk0AAHomAACAhAAA+gAAAIDoAAB1MAAA6mAAADqYAAAXcJy6UTwAAAHCUExURQAAAAC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+jwC+j////54tRLAAAACUdFJOUwAAAEK+9/e+QQIDAwEqzskfUZmUNHz2mrT++V1w+f5tCanNFUDwfEjtjAyyvg027Hki27QMBJzaHE/1+FkNsN0iZvv6bxyAlB589lQeyud0KB8PQO+ZBUrc+eXgcRG/3CoATe316Wxw/P6BAgBt+fp4IAwh0d4zM9q7Fm76qi605EMSrvfX/PRtAivF9IAJNMLxhA2KYlJ9AAAAAWJLR0SVCGB6gwAAAAd0SU1FB+ACDRI2MOJd7FgAAADrSURBVBjTLY9VWwJgGEPfiYWBha2YYHcHditgd3d3odjdivvBfgK727nYsyPiCrw03j6+fv6AaAMCgyAI1lElJBQSFh6hBxDJqOiY2Lh4SEKiIQlITmFqWrqRJkhGJrOA7Bzm5uUXsBBSVMySUpSVs6KyqrqmFmKuY30D0NjU3NLa1t6h9jvZ1Q30WGi19fb1KzAwyKFhYGSUY+MTkwpMTXNmFpibX+Di0rICWFldW9/A5tb2zu7ePtTrg0MeHePklPYzuDRw7uDF5RWvbwC32O0d7x8en55f4DHF6xv5/vHp6f/k6/vH+evuf1LAObptvSvrAAAAAElFTkSuQmCC';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAadEVYdFNvZnR3YXJlAFBhaW50Lk5FVCB2My41LjEwMPRyoQAAAw9JREFUOE9jYMABuMwYmCyTJKUCGlSnFSy02TTzeOyCiQcDViX26qVz2TAyYtWmEMwuoZ3M7V40LcB79pHkc0svpvzY8jD//87nxf+3Pyn8v/ZO8v+VNyP/2mZJumI1QCWSI8232Hjumitlfw5+qPp/9l8TCt76JP//xkdx/wsXWCzjtWFkwTCkbWFe9plPk/+ga4Txz/xt/D/hkN//gMXif21a+NbyWjIwoRiy6GDT5rP/mlFsPfyp5n/NpOj/22+0gMUXXIz/H7hC/L/bFKFbPDZMrHAD5H35OPt2J9zacDv/f3V7xv9FhwrBGubsT/1//Pjx/1GJ/mD+/nfl/1v3Ovy3KRJNQbHdOlXCvOO03/+pm1P/v3v37n90hhtYw9HPtf8Xb2v937cmHswHeWPRxYj/LvkK3igGKARwicTO07118H3V/5kbi/4vPZMJtK3s/6YH2f+Pfq1B8VbjWrdnMu5s4nAD9CNFhKwz5DTUvLl419zKvAcLtG1P84BRl/b/5M/6/6f/NPzf/qzo84yj0Uus0xUU4Zor54bm9+4OfZG02OCuoAMTb9ZkC9ull1Nvrr2Z+XvRpaRfc65H/68F+jl9svEhzyLFWoccWVc+eyTHq/twydjlKRln7jX9bNMkMJnbhoFRL1xCqmKx6/yi2fYXa/c5/e846PV/5fW0/7OPx/yfcjzop34ulxdGGvDuU8mMXaX507lBuiN6ueadmQeT/p/93vf/1O+G//sP5fw/eL3o/5JLif8zVxs+Tlir9S26UyeFQQvJGBE7FvaFZ9LfN+1y+WjbItSb3GmXvXd15v8zroH/HxgE/D+aGPx/18vi/z07PeZNPRKxe/Kh0Ae8toxscCO4zBkYXArk9C1SxJUYjBkYPPIVtbbuTftz3cz//2O9wP/75iSAXdO72/dt2HL5F6YlfBW4MiJYXMiBiW3t7azHBx+V/t89N+H/8a+1//e9K/9attDp5LQjYX8SuvVL8RoAkmxa65299Erq1FnHo0qrl7t4BddriIs4MrM3rfWcFd+pGwVSAwBZ0bKP8yrZPAAAAABJRU5ErkJggg==';","export default 'iVBORw0KGgoAAAANSUhEUgAAABAAAAAMCAYAAABr5z2BAAABIklEQVQoz53LvUrDUBjG8bOoOammSf1IoBSvoCB4JeIqOHgBLt6AIMRBBQelWurQ2kERnMRBsBUcIp5FJSBI5oQsJVkkUHh8W0o5nhaFHvjBgef/Mq+Q46RJBMkI/vE+aOus956tnEswIZe1LV0QyJ5sE2GzgZfVMtRNIdiDpccEssdlB1mW4bvTwdvWJtRdErM7U+8S/FJykCRJX5qm+KpVce8UMNLRLbulz4iSjTAMh6Iowsd5BeNadp3nUF0VlxAEwZBotXC0Usa4ll3meZdA1iguwvf9vpvDA2wvmKgYGtSud8suDB4TyGr2PF49D/vra9jRZ1BVdknMzgwuCGSnZEObwu6sBnVTCHZiaC7BhFx2PKdxUidiAH/4lLo9Mv0DELVs9qsOHXwAAAAASUVORK5CYII=';","import $ from \"../platform/$\";\r\nimport CSS from \"../css/CSS\";\r\nimport { Conf } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst CustomCSS = {\r\n  init() {\r\n    if (!Conf['Custom CSS']) { return; }\r\n    return this.addStyle();\r\n  },\r\n\r\n  addStyle() {\r\n    return this.style = $.addStyle(CSS.sub(Conf['usercss']), 'custom-css', '#fourchanx-css');\r\n  },\r\n\r\n  rmStyle() {\r\n    if (this.style) {\r\n      $.rm(this.style);\r\n      return delete this.style;\r\n    }\r\n  },\r\n\r\n  update() {\r\n    if (!this.style) {\r\n      return this.addStyle();\r\n    }\r\n    return this.style.textContent = CSS.sub(Conf['usercss']);\r\n  }\r\n};\r\nexport default CustomCSS;\r\n","import { Conf, d } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst SWTinyboard = {\r\n  isOPContainerThread: true,\r\n  mayLackJSON: true,\r\n  threadModTimeIgnoresSage: true,\r\n\r\n  disabledFeatures: [\r\n    'Resurrect Quotes',\r\n    'Quick Reply Personas',\r\n    'Quick Reply',\r\n    'Cooldown',\r\n    'Report Link',\r\n    'Delete Link',\r\n    'Edit Link',\r\n    'Quote Inlining',\r\n    'Quote Previewing',\r\n    'Quote Backlinks',\r\n    'File Info Formatting',\r\n    'Image Expansion',\r\n    'Image Expansion (Menu)',\r\n    'Comment Expansion',\r\n    'Thread Expansion',\r\n    'Favicon',\r\n    'Quote Threading',\r\n    'Thread Updater',\r\n    'Banner',\r\n    'Flash Features',\r\n    'Reply Pruning'\r\n  ],\r\n\r\n  detect() {\r\n    for (var script of $$('script:not([src])', d.head)) {\r\n      var m;\r\n      if (m = script.textContent.match(/\\bvar configRoot=(\".*?\")/)) {\r\n        var properties = dict();\r\n        try {\r\n          var root = JSON.parse(m[1]);\r\n          if (root[0] === '/') {\r\n            properties.root = location.origin + root;\r\n          } else if (/^https?:/.test(root)) {\r\n            properties.root = root;\r\n          }\r\n        } catch (error) {}\r\n        return properties;\r\n      }\r\n    }\r\n    return false;\r\n  },\r\n\r\n  awaitBoard(cb) {\r\n    let reactUI;\r\n    if (reactUI = $.id('react-ui')) {\r\n      const s = (this.selectors = Object.create(this.selectors));\r\n      s.boardFor = {index: '.page-container'};\r\n      s.thread = 'div[id^=\"thread_\"]';\r\n      return Main.mounted(cb);\r\n    } else {\r\n      return cb();\r\n    }\r\n  },\r\n\r\n  urls: {\r\n    thread({siteID, boardID, threadID}, isArchived) {\r\n      return `${Conf['siteProperties'][siteID]?.root || `http://${siteID}/`}${boardID}/${isArchived ? 'archive/' : ''}res/${threadID}.html`;\r\n    },\r\n    post({postID})                   { return `#${postID}`; },\r\n    index({siteID, boardID})          { return `${Conf['siteProperties'][siteID]?.root || `http://${siteID}/`}${boardID}/`; },\r\n    catalog({siteID, boardID})          { return `${Conf['siteProperties'][siteID]?.root || `http://${siteID}/`}${boardID}/catalog.html`; },\r\n    threadJSON({siteID, boardID, threadID}, isArchived) {\r\n      const root = Conf['siteProperties'][siteID]?.root;\r\n      if (root) { return `${root}${boardID}/${isArchived ? 'archive/' : ''}res/${threadID}.json`; } else { return ''; }\r\n    },\r\n    archivedThreadJSON(thread) {\r\n      return SWTinyboard.urls.threadJSON(thread, true);\r\n    },\r\n    threadsListJSON({siteID, boardID}) {\r\n      const root = Conf['siteProperties'][siteID]?.root;\r\n      if (root) { return `${root}${boardID}/threads.json`; } else { return ''; }\r\n    },\r\n    archiveListJSON({siteID, boardID}) {\r\n      const root = Conf['siteProperties'][siteID]?.root;\r\n      if (root) { return `${root}${boardID}/archive/archive.json`; } else { return ''; }\r\n    },\r\n    catalogJSON({siteID, boardID}) {\r\n      const root = Conf['siteProperties'][siteID]?.root;\r\n      if (root) { return `${root}${boardID}/catalog.json`; } else { return ''; }\r\n    },\r\n    file({siteID, boardID}, filename) {\r\n      return `${Conf['siteProperties'][siteID]?.root || `http://${siteID}/`}${boardID}/${filename}`;\r\n    },\r\n    thumb(board, filename) {\r\n      return SWTinyboard.urls.file(board, filename);\r\n    }\r\n  },\r\n\r\n  selectors: {\r\n    board:         'form[name=\"postcontrols\"]',\r\n    thread:        'input[name=\"board\"] ~ div[id^=\"thread_\"]',\r\n    threadDivider: 'div[id^=\"thread_\"] > hr:last-child',\r\n    summary:       '.omitted',\r\n    postContainer: 'div[id^=\"reply_\"]:not(.hidden)', // postContainer is thread for OP\r\n    opBottom:      '.op',\r\n    replyOriginal: 'div[id^=\"reply_\"]:not(.hidden)',\r\n    infoRoot:      '.intro',\r\n    info: {\r\n      subject:   '.subject',\r\n      name:      '.name',\r\n      email:     '.email',\r\n      tripcode:  '.trip',\r\n      uniqueID:  '.poster_id',\r\n      capcode:   '.capcode',\r\n      flag:      '.flag',\r\n      date:      'time',\r\n      nameBlock: 'label',\r\n      quote:     'a[href*=\"#q\"]',\r\n      reply:     'a[href*=\"/res/\"]:not([href*=\"#\"])'\r\n    },\r\n    icons: {\r\n      isSticky:   '.fa-thumb-tack',\r\n      isClosed:   '.fa-lock'\r\n    },\r\n    file: {\r\n      text:  '.fileinfo',\r\n      link:  '.fileinfo > a',\r\n      thumb: 'a > .post-image'\r\n    },\r\n    thumbLink: '.file > a',\r\n    multifile: '.files > .file',\r\n    highlightable: {\r\n      op:      ' > .op',\r\n      reply:   '.reply',\r\n      catalog: ' > .thread'\r\n    },\r\n    comment:   '.body',\r\n    spoiler:   '.spoiler',\r\n    quotelink: 'a[onclick*=\"highlightReply(\"]',\r\n    catalog: {\r\n      board:  '#Grid',\r\n      thread: '.mix',\r\n      thumb:  '.thread-image'\r\n    },\r\n    boardList: '.boardlist',\r\n    boardListBottom: '.boardlist.bottom',\r\n    styleSheet: '#stylesheet',\r\n    psa:       '.blotter',\r\n    nav: {\r\n      prev: '.pages > form > [value=Previous]',\r\n      next: '.pages > form > [value=Next]'\r\n    }\r\n  },\r\n\r\n  classes: {\r\n    highlight: 'highlighted'\r\n  },\r\n\r\n  xpath: {\r\n    thread:         'div[starts-with(@id,\"thread_\")]',\r\n    postContainer:  'div[starts-with(@id,\"reply_\") or starts-with(@id,\"thread_\")]',\r\n    replyContainer: 'div[starts-with(@id,\"reply_\")]'\r\n  },\r\n\r\n  regexp: {\r\n    quotelink:\r\n      new RegExp(`\\\r\n/\\\r\n([^/]+)\\\r\n/res/\\\r\n(\\\\d+)\\\r\n(?:\\\\.\\\\w+)?#\\\r\n(\\\\d+)\\\r\n$\\\r\n`),\r\n    quotelinkHTML:\r\n      /<a [^>]*\\bhref=\"[^\"]*\\/([^\\/]+)\\/res\\/(\\d+)(?:\\.\\w+)?#(\\d+)\"/g\r\n  },\r\n\r\n  Build: {\r\n    parseJSON(data, board) {\r\n      const o = this.parseJSON(data, board);\r\n      if (data.ext === 'deleted') {\r\n        delete o.file;\r\n        $.extend(o, {\r\n          files: [],\r\n          fileDeleted: true,\r\n          filesDeleted: [0]\r\n        });\r\n      }\r\n      if (data.extra_files) {\r\n        let file;\r\n        for (let i = 0; i < data.extra_files.length; i++) {\r\n          var extra_file = data.extra_files[i];\r\n          if (extra_file.ext === 'deleted') {\r\n            o.filesDeleted.push(i);\r\n          } else {\r\n            file = this.parseJSONFile(data, board);\r\n            o.files.push(file);\r\n          }\r\n        }\r\n        if (o.files.length) {\r\n          o.file = o.files[0];\r\n        }\r\n      }\r\n      return o;\r\n    },\r\n\r\n    parseComment(html) {\r\n      html = html\r\n        .replace(/<br\\b[^<]*>/gi, '\\n')\r\n        .replace(/<[^>]*>/g, '');\r\n      return $.unescape(html);\r\n    }\r\n  },\r\n\r\n  bgColoredEl() {\r\n    return $.el('div', {className: 'post reply'});\r\n  },\r\n\r\n  isFileURL(url) {\r\n    return /\\/src\\/[^\\/]+/.test(url.pathname);\r\n  },\r\n\r\n  preParsingFixes(board) {\r\n    // fixes effects of unclosed link in announcement\r\n    let broken;\r\n    if (broken = $('a > input[name=\"board\"]', board)) {\r\n      return $.before(broken.parentNode, broken);\r\n    }\r\n  },\r\n\r\n  parseNodes(post, nodes) {\r\n    // Add vichan's span.poster_id around the ID if not already present.\r\n    let m;\r\n    if (nodes.uniqueID) { return; }\r\n    let text = '';\r\n    let node = nodes.nameBlock.nextSibling;\r\n    while (node && (node.nodeType === 3)) {\r\n      text += node.textContent;\r\n      node = node.nextSibling;\r\n    }\r\n    if (m = text.match(/(\\s*ID:\\s*)(\\S+)/)) {\r\n      let uniqueID;\r\n      nodes.info.normalize();\r\n      let {nextSibling} = nodes.nameBlock;\r\n      nextSibling = nextSibling.splitText(m[1].length);\r\n      nextSibling.splitText(m[2].length);\r\n      nodes.uniqueID = (uniqueID = $.el('span', {className: 'poster_id'}));\r\n      $.replace(nextSibling, uniqueID);\r\n      return $.add(uniqueID, nextSibling);\r\n    }\r\n  },\r\n\r\n  parseDate(node) {\r\n    let date = Date.parse(node.getAttribute('datetime')?.trim());\r\n    if (!isNaN(date)) { return new Date(date); }\r\n    date = Date.parse(node.textContent.trim() + ' UTC'); // e.g. onesixtwo.club\r\n    if (!isNaN(date)) { return new Date(date); }\r\n    return undefined;\r\n  },\r\n\r\n  parseFile(post, file) {\r\n    let info, infoNode;\r\n    const {text, link, thumb} = file;\r\n    if ($.x(`ancestor::${this.xpath.postContainer}[1]`, text) !== post.nodes.root) { return false; } // file belongs to a reply\r\n    if (!(infoNode = link.nextSibling?.textContent.includes('(') ? link.nextSibling : link.nextElementSibling)) { return false; }\r\n    if (!(info = infoNode.textContent.match(/\\((.*,\\s*)?([\\d.]+ ?[KMG]?B).*\\)/))) { return false; }\r\n    const nameNode = $('.postfilename', text);\r\n    $.extend(file, {\r\n      name:       nameNode ? (nameNode.title || nameNode.textContent) : link.pathname.match(/[^/]*$/)[0],\r\n      size:       info[2],\r\n      dimensions: info[0].match(/\\d+x\\d+/)?.[0]\r\n    });\r\n    if (thumb) {\r\n      $.extend(file, {\r\n        thumbURL:  /\\/static\\//.test(thumb.src) && $.isImage(link.href) ? link.href : thumb.src,\r\n        isSpoiler: /^Spoiler/i.test(info[1] || '') || (link.textContent === 'Spoiler Image')\r\n      }\r\n      );\r\n    }\r\n    return true;\r\n  },\r\n\r\n  isThumbExpanded(file) {\r\n    // Detect old Tinyboard image expansion that changes src attribute on thumbnail.\r\n    return $.hasClass(file.thumb.parentNode, 'expanded') || (file.thumb.parentNode.dataset.expanded === 'true');\r\n  },\r\n\r\n  isLinkified(link) {\r\n    return /\\bnofollow\\b/.test(link.rel);\r\n  },\r\n\r\n  catalogPin(threadRoot) {\r\n    return threadRoot.dataset.sticky = 'true';\r\n  }\r\n};\r\nexport default SWTinyboard;\r\n",null,"import { Conf, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport PassMessagePage from './PassMessage/PassMessageHtml';\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n\r\nconst PassMessage = {\r\n  init() {\r\n    if (Conf['passMessageClosed']) { return; }\r\n    const msg = $.el('div',\r\n      {className: 'box-outer top-box'}\r\n    ,\r\n      PassMessagePage);\r\n    msg.style.cssText = 'padding-bottom: 0;';\r\n    const close = $('a', msg);\r\n    $.on(close, 'click', function() {\r\n      $.rm(msg);\r\n      return $.set('passMessageClosed', true);\r\n    });\r\n    return $.ready(function() {\r\n      let hd;\r\n      if (hd = $.id('hd')) {\r\n        return $.after(hd, msg);\r\n      } else {\r\n        return $.prepend(d.body, msg);\r\n      }\r\n    });\r\n  }\r\n};\r\nexport default PassMessage;\r\n","import Redirect from \"../Archive/Redirect\";\r\nimport $ from \"../platform/$\";\r\nimport ReportPage from './Report/ArchiveReport.html';\r\nimport CSS from \"../css/CSS\";\r\nimport Captcha from \"../Posting/Captcha\";\r\nimport { Conf, d, g } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n\r\nvar Report = {\r\n  init() {\r\n    let match;\r\n    if (!(match = location.search.match(/\\bno=(\\d+)/))) { return; }\r\n    Captcha.replace.init();\r\n    this.postID = +match[1];\r\n    return $.ready(this.ready);\r\n  },\r\n\r\n  ready() {\r\n    $.addStyle(CSS.report);\r\n\r\n    if (Conf['Archive Report']) { Report.archive(); }\r\n\r\n    new MutationObserver(function() {\r\n      Report.fit('iframe[src^=\"https://www.google.com/recaptcha/api2/frame\"]');\r\n      return Report.fit('body');\r\n    }).observe(d.body, {\r\n      childList:  true,\r\n      attributes: true,\r\n      subtree:    true\r\n    }\r\n    );\r\n    return Report.fit('body');\r\n  },\r\n\r\n  fit(selector) {\r\n    let el;\r\n    if (!((el = $(selector, doc)) && (getComputedStyle(el).visibility !== 'hidden'))) { return; }\r\n    const dy = (el.getBoundingClientRect().bottom - doc.clientHeight) + 8;\r\n    if (dy > 0) { return window.resizeBy(0, dy); }\r\n  },\r\n\r\n  archive() {\r\n    let match, urls;\r\n    if (!(urls = Redirect.report(g.BOARD.ID)).length) { return; }\r\n\r\n    const form    = $('form');\r\n    const types   = $.id('reportTypes');\r\n    const message = $('h3');\r\n\r\n    const fieldset = $.el('fieldset', {\r\n      id: 'archive-report',\r\n      hidden: true\r\n    }\r\n    ,\r\n      { innerHTML: ReportPage });\r\n    const enabled = $('#archive-report-enabled', fieldset);\r\n    const reason  = $('#archive-report-reason',  fieldset);\r\n    const submit  = $('#archive-report-submit',  fieldset);\r\n\r\n    $.on(enabled, 'change', function() {\r\n      return reason.disabled = !this.checked;\r\n    });\r\n\r\n    if (form && types) {\r\n      fieldset.hidden = !$('[value=\"31\"]', types).checked;\r\n      $.on(types, 'change', function(e) {\r\n        fieldset.hidden = (e.target.value !== '31');\r\n        return Report.fit('body');\r\n      });\r\n      $.after(types, fieldset);\r\n      Report.fit('body');\r\n      $.one(form, 'submit', function(e) {\r\n        if (!fieldset.hidden && enabled.checked) {\r\n          e.preventDefault();\r\n          return Report.archiveSubmit(urls, reason.value, results => {\r\n            this.action = '#archiveresults=' + encodeURIComponent(JSON.stringify(results));\r\n            return this.submit();\r\n          });\r\n        }\r\n      });\r\n    } else if (message) {\r\n      fieldset.hidden = /Report submitted!/.test(message.textContent);\r\n      $.on(enabled, 'change', function() {\r\n        return submit.hidden = !this.checked;\r\n      });\r\n      $.after(message, fieldset);\r\n      $.on(submit, 'click', () => Report.archiveSubmit(urls, reason.value, Report.archiveResults));\r\n    }\r\n\r\n    if (match = location.hash.match(/^#archiveresults=(.*)$/)) {\r\n      try {\r\n        return Report.archiveResults(JSON.parse(decodeURIComponent(match[1])));\r\n      } catch (error) {}\r\n    }\r\n  },\r\n\r\n  archiveSubmit(urls, reason, cb) {\r\n    const form = $.formData({\r\n      board:  g.BOARD.ID,\r\n      num:    Report.postID,\r\n      reason\r\n    });\r\n    const results = [];\r\n    for (var [name, url] of urls) {\r\n      (function(name, url) {\r\n        return $.ajax(url, {\r\n          onloadend() {\r\n            results.push([name, this.response || {error: ''}]);\r\n            if (results.length === urls.length) {\r\n              return cb(results);\r\n            }\r\n          },\r\n          form\r\n        });\r\n      })(name, url);\r\n    }\r\n  },\r\n\r\n  archiveResults(results) {\r\n    const fieldset = $.id('archive-report');\r\n    for (var [name, response] of results) {\r\n      var line = $.el('h3',\r\n        {className: 'archive-report-response'});\r\n      if ('success' in response) {\r\n        $.addClass(line, 'archive-report-success');\r\n        line.textContent = `${name}: ${response.success}`;\r\n      } else {\r\n        $.addClass(line, 'archive-report-error');\r\n        line.textContent = `${name}: ${response.error || 'Error reporting post.'}`;\r\n      }\r\n      if (fieldset) {\r\n        $.before(fieldset, line);\r\n      } else {\r\n        $.add(d.body, line);\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default Report;\r\n","import DataBoard from \"../classes/DataBoard\";\r\nimport { Conf, d, g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst PostSuccessful = {\r\n  init() {\r\n    if (!Conf['Remember Your Posts']) { return; }\r\n    return $.ready(this.ready);\r\n  },\r\n\r\n  ready() {\r\n    if (d.title !== 'Post successful!') { return; }\r\n\r\n    let [_, threadID, postID] = Array.from($('h1').nextSibling.textContent.match(/thread:(\\d+),no:(\\d+)/));\r\n    postID   = +postID;\r\n    threadID = +threadID || postID;\r\n\r\n    const db = new DataBoard('yourPosts');\r\n    return db.set({\r\n      boardID: g.BOARD.ID,\r\n      threadID,\r\n      postID,\r\n      val: true\r\n    });\r\n  }\r\n};\r\nexport default PostSuccessful;\r\n",null,null,null,null,"import SWTinyboard from \"./SW.tinyboard\";\r\nimport SWYotsuba from \"./SW.yotsuba\";\r\n\r\nconst SW = { tinyboard: SWTinyboard, yotsuba: SWYotsuba };\r\nexport default SW;\r\n",null,"import $ from \"../platform/$\";\r\nimport Callbacks from \"../classes/Callbacks\";\r\nimport { g, Conf } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Time = {\r\n  init() {\r\n    if (!['index', 'thread', 'archive'].includes(g.VIEW) || !Conf['Time Formatting']) { return; }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Time Formatting',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (!this.info.date || this.isClone) { return; }\r\n    const {textContent} = this.nodes.date;\r\n    return this.nodes.date.textContent = textContent.match(/^\\s*/)[0] + Time.format(Conf['time'], this.info.date) + textContent.match(/\\s*$/)[0];\r\n  },\r\n\r\n  format(formatString, date) {\r\n    return formatString.replace(/%(.)/g, function(s, c) {\r\n      if ($.hasOwn(Time.formatters, c)) {\r\n        return Time.formatters[c].call(date);\r\n      } else {\r\n        return s;\r\n      }\r\n    });\r\n  },\r\n\r\n  day: [\r\n    'Sunday',\r\n    'Monday',\r\n    'Tuesday',\r\n    'Wednesday',\r\n    'Thursday',\r\n    'Friday',\r\n    'Saturday'\r\n  ],\r\n\r\n  month: [\r\n    'January',\r\n    'February',\r\n    'March',\r\n    'April',\r\n    'May',\r\n    'June',\r\n    'July',\r\n    'August',\r\n    'September',\r\n    'October',\r\n    'November',\r\n    'December'\r\n  ],\r\n\r\n  localeFormat(date, options, defaultValue) {\r\n    if (Conf['timeLocale']) {\r\n      try {\r\n        return Intl.DateTimeFormat(Conf['timeLocale'], options).format(date);\r\n      } catch (error) {}\r\n    }\r\n    return defaultValue;\r\n  },\r\n\r\n  localeFormatPart(date, options, part, defaultValue) {\r\n    if (Conf['timeLocale']) {\r\n      try {\r\n        const parts = Intl.DateTimeFormat(Conf['timeLocale'], options).formatToParts(date);\r\n        return parts.map(function(x) { if (x.type === part) { return x.value; } else { return ''; } }).join('');\r\n      } catch (error) {}\r\n    }\r\n    return defaultValue;\r\n  },\r\n\r\n  zeroPad(n) { if (n < 10) { return `0${n}`; } else { return n; } },\r\n\r\n  formatters: {\r\n    a() { return Time.localeFormat(this, {weekday: 'short'}, Time.day[this.getDay()].slice(0, 3)); },\r\n    A() { return Time.localeFormat(this, {weekday: 'long'},  Time.day[this.getDay()]); },\r\n    b() { return Time.localeFormat(this, {month:   'short'}, Time.month[this.getMonth()].slice(0, 3)); },\r\n    B() { return Time.localeFormat(this, {month:   'long'},  Time.month[this.getMonth()]); },\r\n    d() { return Time.zeroPad(this.getDate()); },\r\n    e() { return this.getDate(); },\r\n    H() { return Time.zeroPad(this.getHours()); },\r\n    I() { return Time.zeroPad((this.getHours() % 12) || 12); },\r\n    k() { return this.getHours(); },\r\n    l() { return (this.getHours() % 12) || 12; },\r\n    m() { return Time.zeroPad(this.getMonth() + 1); },\r\n    M() { return Time.zeroPad(this.getMinutes()); },\r\n    p() { return Time.localeFormatPart(this, {hour: 'numeric', hour12: true}, 'dayperiod', (this.getHours() < 12 ? 'AM' : 'PM')); },\r\n    P() { return Time.formatters.p.call(this).toLowerCase(); },\r\n    S() { return Time.zeroPad(this.getSeconds()); },\r\n    y() { return this.getFullYear().toString().slice(2); },\r\n    Y() { return this.getFullYear(); },\r\n    '%'() { return '%'; }\r\n  }\r\n};\r\nexport default Time;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Header from \"../General/Header\";\r\nimport UI from \"../General/UI\";\r\nimport { g, Conf, E, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport QuoteThreading from \"../Quotelinks/QuoteThreading\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ReplyPruning = {\r\n  init() {\r\n    if ((g.VIEW !== 'thread') || !Conf['Reply Pruning']) { return; }\r\n\r\n    this.container = $.frag();\r\n\r\n    this.summary = $.el('span', {\r\n      hidden:    true,\r\n      className: 'summary'\r\n    }\r\n    );\r\n    this.summary.style.cursor = 'pointer';\r\n    $.on(this.summary, 'click', () => {\r\n      this.inputs.enabled.checked = !this.inputs.enabled.checked;\r\n      return $.event('change', null, this.inputs.enabled);\r\n    });\r\n\r\n    const label = UI.checkbox('Prune Replies', 'Show Last', Conf['Prune All Threads']);\r\n    const el = $.el('span',\r\n      {title: 'Maximum number of replies to show.'}\r\n    ,\r\n      {innerHTML: \" <input type=\\\"number\\\" name=\\\"Max Replies\\\" min=\\\"0\\\" step=\\\"1\\\" value=\\\"\" + E(Conf[\"Max Replies\"]) + \"\\\" class=\\\"field\\\">\"});\r\n    $.prepend(el, label);\r\n\r\n    this.inputs = {\r\n      enabled: label.firstElementChild,\r\n      replies: el.lastElementChild\r\n    };\r\n\r\n    this.setEnabled.call(this.inputs.enabled);\r\n    $.on(this.inputs.enabled, 'change', this.setEnabled);\r\n    $.on(this.inputs.replies, 'change', $.cb.value);\r\n\r\n    Header.menu.addEntry({\r\n      el,\r\n      order: 190\r\n    });\r\n\r\n    return Callbacks.Thread.push({\r\n      name: 'Reply Pruning',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  position: 0,\r\n  hidden: 0,\r\n  hiddenFiles: 0,\r\n  total: 0,\r\n  totalFiles: 0,\r\n\r\n  setEnabled() {\r\n    const other = QuoteThreading.input;\r\n    if (this.checked && other?.checked) {\r\n      other.checked = false;\r\n      $.event('change', null, other);\r\n    }\r\n    return ReplyPruning.active = this.checked;\r\n  },\r\n\r\n  showIfHidden(id) {\r\n    if (ReplyPruning.container && $(`#${id}`, ReplyPruning.container)) {\r\n      ReplyPruning.inputs.enabled.checked = false;\r\n      return $.event('change', null, ReplyPruning.inputs.enabled);\r\n    }\r\n  },\r\n\r\n  node() {\r\n    let middle;\r\n    ReplyPruning.thread = this;\r\n\r\n    if (this.isSticky) {\r\n      ReplyPruning.active = (ReplyPruning.inputs.enabled.checked = true);\r\n      if (QuoteThreading.input) {\r\n        // Disable Quote Threading for this thread but don't save the setting.\r\n        Conf['Thread Quotes'] = (QuoteThreading.input.checked = false);\r\n      }\r\n    }\r\n\r\n    this.posts.forEach(function(post) {\r\n      if (post.isReply) {\r\n        ReplyPruning.total++;\r\n        if (post.file) { return ReplyPruning.totalFiles++; }\r\n      }\r\n    });\r\n\r\n    // If we're linked to a post that we would hide, don't hide the posts in the first place.\r\n    if (\r\n      ReplyPruning.active &&\r\n      /^#p\\d+$/.test(location.hash) &&\r\n      (1 <= (middle = this.posts.keys.indexOf(location.hash.slice(2))) && middle < 1 + Math.max(ReplyPruning.total - +Conf[\"Max Replies\"], 0))\r\n    ) {\r\n      ReplyPruning.active = (ReplyPruning.inputs.enabled.checked = false);\r\n    }\r\n\r\n    $.after(this.OP.nodes.root, ReplyPruning.summary);\r\n\r\n    $.on(ReplyPruning.inputs.enabled, 'change', ReplyPruning.update);\r\n    $.on(ReplyPruning.inputs.replies, 'change', ReplyPruning.update);\r\n    $.on(d, 'ThreadUpdate', ReplyPruning.updateCount);\r\n    $.on(d, 'ThreadUpdate', ReplyPruning.update);\r\n\r\n    return ReplyPruning.update();\r\n  },\r\n\r\n  updateCount(e) {\r\n    if (e.detail[404]) { return; }\r\n    for (var fullID of e.detail.newPosts) {\r\n      ReplyPruning.total++;\r\n      if (g.posts.get(fullID).file) { ReplyPruning.totalFiles++; }\r\n    }\r\n  },\r\n\r\n  update() {\r\n    let boardTop, node, post;\r\n    const hidden1 = ReplyPruning.hidden;\r\n    const hidden2 = ReplyPruning.active ?\r\n      Math.max(ReplyPruning.total - +Conf[\"Max Replies\"], 0)\r\n    :\r\n      0;\r\n\r\n    // Record position from bottom of document\r\n    const oldPos = d.body.clientHeight - window.scrollY;\r\n\r\n    const {posts} = ReplyPruning.thread;\r\n\r\n    if (ReplyPruning.hidden < hidden2) {\r\n      while ((ReplyPruning.hidden < hidden2) && (ReplyPruning.position < posts.keys.length)) {\r\n        post = posts.get(posts.keys[ReplyPruning.position++]);\r\n        if (post.isReply && !post.isFetchedQuote) {\r\n          while ((node = ReplyPruning.summary.nextSibling) && (node !== post.nodes.root)) { $.add(ReplyPruning.container, node); }\r\n          $.add(ReplyPruning.container, post.nodes.root);\r\n          ReplyPruning.hidden++;\r\n          if (post.file) { ReplyPruning.hiddenFiles++; }\r\n        }\r\n      }\r\n\r\n    } else if (ReplyPruning.hidden > hidden2) {\r\n      const frag = $.frag();\r\n      while ((ReplyPruning.hidden > hidden2) && (ReplyPruning.position > 0)) {\r\n        post = posts.get(posts.keys[--ReplyPruning.position]);\r\n        if (post.isReply && !post.isFetchedQuote) {\r\n          while ((node = ReplyPruning.container.lastChild) && (node !== post.nodes.root)) { $.prepend(frag, node); }\r\n          $.prepend(frag, post.nodes.root);\r\n          ReplyPruning.hidden--;\r\n          if (post.file) { ReplyPruning.hiddenFiles--; }\r\n        }\r\n      }\r\n      $.after(ReplyPruning.summary, frag);\r\n      $.event('PostsInserted', null, ReplyPruning.summary.parentNode);\r\n    }\r\n\r\n    ReplyPruning.summary.textContent = ReplyPruning.active ?\r\n      g.SITE.Build.summaryText('+', ReplyPruning.hidden, ReplyPruning.hiddenFiles)\r\n    :\r\n      g.SITE.Build.summaryText('-', ReplyPruning.total, ReplyPruning.totalFiles);\r\n    ReplyPruning.summary.hidden = (ReplyPruning.total <= +Conf[\"Max Replies\"]);\r\n\r\n    // Maintain position in thread when posts are added/removed above\r\n    if ((hidden1 !== hidden2) && ((boardTop = Header.getTopOf($('.board'))) < 0)) {\r\n      return window.scrollBy(0, Math.max(d.body.clientHeight - oldPos, window.scrollY + boardTop) - window.scrollY);\r\n    }\r\n  }\r\n};\r\nexport default ReplyPruning;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport RandomAccessList from \"../classes/RandomAccessList\";\r\nimport Header from \"../General/Header\";\r\nimport { Conf, d, g } from \"../globals/globals\";\r\nimport ReplyPruning from \"../Monitoring/ReplyPruning\";\r\nimport Unread from \"../Monitoring/Unread\";\r\nimport $ from \"../platform/$\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n/*\r\n  <3 aeosynth\r\n*/\r\n\r\nvar QuoteThreading = {\r\n  init() {\r\n    if (!Conf['Quote Threading'] || (g.VIEW !== 'thread')) { return; }\r\n\r\n    this.controls = $.el('label',\r\n      {innerHTML: \"<input id=\\\"threadingControl\\\" name=\\\"Thread Quotes\\\" type=\\\"checkbox\\\"> Threading\"});\r\n\r\n    this.threadNewLink = $.el('span', {\r\n      className: 'brackets-wrap threadnewlink',\r\n      hidden: true\r\n    }\r\n    );\r\n    $.extend(this.threadNewLink, {innerHTML: \"<a href=\\\"javascript:;\\\">Thread New Posts</a>\"});\r\n\r\n    this.input = $('input', this.controls);\r\n    this.input.checked = Conf['Thread Quotes'];\r\n\r\n    $.on(this.input, 'change', this.setEnabled);\r\n    $.on(this.input, 'change', this.rethread);\r\n    $.on(this.threadNewLink.firstElementChild, 'click', this.rethread);\r\n    $.on(d, '4chanXInitFinished', () => { return this.ready = true; });\r\n\r\n    Header.menu.addEntry(this.entry = {\r\n      el:    this.controls,\r\n      order: 99\r\n    }\r\n    );\r\n\r\n    Callbacks.Thread.push({\r\n      name: 'Quote Threading',\r\n      cb:   this.setThread\r\n    });\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Quote Threading',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  parent:   dict(),\r\n  children: dict(),\r\n  inserted: dict(),\r\n\r\n  toggleThreading() {\r\n    return this.setThreadingState(!Conf['Thread Quotes']);\r\n  },\r\n\r\n  setThreadingState(enabled) {\r\n    this.input.checked = enabled;\r\n    this.setEnabled.call(this.input);\r\n    return this.rethread.call(this.input);\r\n  },\r\n\r\n  setEnabled() {\r\n    if (this.checked) {\r\n      $.set('Prune All Threads', false);\r\n      const other = ReplyPruning.inputs?.enabled;\r\n      if (other?.checked) {\r\n        other.checked = false;\r\n        $.event('change', null, other);\r\n      }\r\n    }\r\n    return $.cb.checked.call(this);\r\n  },\r\n\r\n  setThread() {\r\n    QuoteThreading.thread = this;\r\n    return $.asap((() => !Conf['Thread Updater'] || $('.navLinksBot > .updatelink')), function() {\r\n      let navLinksBot;\r\n      if (navLinksBot = $('.navLinksBot')) { return $.add(navLinksBot, [$.tn(' '), QuoteThreading.threadNewLink]); }\r\n    });\r\n  },\r\n\r\n  node() {\r\n    let parent;\r\n    if (this.isFetchedQuote || this.isClone || !this.isReply) { return; }\r\n\r\n    const parents = new Set();\r\n    let lastParent = null;\r\n    for (var quote of this.quotes) {\r\n      if ((parent = g.posts.get(quote))) {\r\n        if (!parent.isFetchedQuote && parent.isReply && (parent.ID < this.ID)) {\r\n          parents.add(parent.ID);\r\n          if (!lastParent || (parent.ID > lastParent.ID)) { lastParent = parent; }\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!lastParent) { return; }\r\n\r\n    let ancestor = lastParent;\r\n    while ((ancestor = QuoteThreading.parent[ancestor.fullID])) {\r\n      parents.delete(ancestor.ID);\r\n    }\r\n\r\n    if (parents.size === 1) {\r\n      return QuoteThreading.parent[this.fullID] = lastParent;\r\n    }\r\n  },\r\n\r\n  descendants(post) {\r\n    let children;\r\n    let posts = [post];\r\n    if (children = QuoteThreading.children[post.fullID]) {\r\n      for (var child of children) {\r\n        posts = posts.concat(QuoteThreading.descendants(child));\r\n      }\r\n    }\r\n    return posts;\r\n  },\r\n\r\n  insert(post) {\r\n    let parent, x;\r\n    if (!(\r\n      Conf['Thread Quotes'] &&\r\n      (parent = QuoteThreading.parent[post.fullID]) &&\r\n      !QuoteThreading.inserted[post.fullID]\r\n    )) { return false; }\r\n\r\n    const descendants = QuoteThreading.descendants(post);\r\n    if (!Unread.posts.has(parent.ID)) {\r\n      if ((function() { for (var x of descendants) { if (Unread.posts.has(x.ID)) { return true; } } })()) {\r\n        QuoteThreading.threadNewLink.hidden = false;\r\n        return false;\r\n      }\r\n    }\r\n\r\n    const {order} = Unread;\r\n    const children = (QuoteThreading.children[parent.fullID] || (QuoteThreading.children[parent.fullID] = []));\r\n    const threadContainer = parent.nodes.threadContainer || $.el('div', {className: 'threadContainer'});\r\n    const nodes = [post.nodes.root];\r\n    if (post.nodes.threadContainer) { nodes.push(post.nodes.threadContainer); }\r\n\r\n    let i = children.length;\r\n    for (let j = children.length - 1; j >= 0; j--) { var child = children[j]; if (child.ID >= post.ID) { i--; } }\r\n    if (i !== children.length) {\r\n      const next = children[i];\r\n      for (x of descendants) { order.before(order[next.ID], order[x.ID]); }\r\n      children.splice(i, 0, post);\r\n      $.before(next.nodes.root, nodes);\r\n    } else {\r\n      let prev2;\r\n      let prev = parent;\r\n      while ((prev2 = QuoteThreading.children[prev.fullID]) && prev2.length) {\r\n        prev = prev2[prev2.length-1];\r\n      }\r\n      for (let k = descendants.length - 1; k >= 0; k--) { x = descendants[k]; order.after(order[prev.ID], order[x.ID]); }\r\n      children.push(post);\r\n      $.add(threadContainer, nodes);\r\n    }\r\n\r\n    QuoteThreading.inserted[post.fullID] = true;\r\n\r\n    if (!parent.nodes.threadContainer) {\r\n      parent.nodes.threadContainer = threadContainer;\r\n      $.addClass(parent.nodes.root, 'threadOP');\r\n      $.after(parent.nodes.root, threadContainer);\r\n    }\r\n\r\n    return true;\r\n  },\r\n\r\n  rethread() {\r\n    if (!QuoteThreading.ready) { return; }\r\n    const {thread} = QuoteThreading;\r\n    const {posts} = thread;\r\n\r\n    QuoteThreading.threadNewLink.hidden = true;\r\n\r\n    if (Conf['Thread Quotes']) {\r\n      posts.forEach(QuoteThreading.insert);\r\n    } else {\r\n      const nodes = [];\r\n      Unread.order = new RandomAccessList();\r\n      QuoteThreading.inserted = dict();\r\n      posts.forEach(function(post) {\r\n        if (post.isFetchedQuote) { return; }\r\n        Unread.order.push(post);\r\n        if (post.isReply) { nodes.push(post.nodes.root); }\r\n        if (QuoteThreading.children[post.fullID]) {\r\n          delete QuoteThreading.children[post.fullID];\r\n          $.rmClass(post.nodes.root, 'threadOP');\r\n          $.rm(post.nodes.threadContainer);\r\n          return delete post.nodes.threadContainer;\r\n        }\r\n      });\r\n      $.add(thread.nodes.root, nodes);\r\n    }\r\n\r\n    Unread.position = Unread.order.first;\r\n    Unread.updatePosition();\r\n    Unread.setLine(true);\r\n    Unread.read();\r\n    return Unread.update();\r\n  }\r\n};\r\nexport default QuoteThreading;\r\n","import Beep from './ThreadUpdater/beep.wav';\r\nimport $ from \"../platform/$\";\r\nimport Callbacks from '../classes/Callbacks';\r\nimport Notice from '../classes/Notice';\r\nimport Post from '../classes/Post';\r\nimport Main from '../main/Main';\r\nimport Config from '../config/Config';\r\nimport Settings from '../General/Settings';\r\nimport QuoteThreading from '../Quotelinks/QuoteThreading';\r\nimport Unread from './Unread';\r\nimport Header from '../General/Header';\r\nimport { g, Conf, d, doc } from '../globals/globals';\r\nimport UI from '../General/UI';\r\nimport { MINUTE, SECOND } from '../platform/helpers';\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS201: Simplify complex destructure assignments\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n\r\nvar ThreadUpdater = {\r\n  init() {\r\n    let el, name, sc;\r\n    if ((g.VIEW !== 'thread') || !Conf['Thread Updater']) { return; }\r\n    this.enabled = true;\r\n\r\n    // Chromium won't play audio created in an inactive tab until the tab has been focused, so set it up now.\r\n    // XXX Sometimes the loading stalls in Firefox, esp. when opening in private browsing window followed by normal window.\r\n    // Don't let it keep the loading icon on indefinitely.\r\n    this.audio = $.el('audio');\r\n    if ($.engine !== 'gecko') { this.audio.src = this.beep; }\r\n\r\n    if (Conf['Updater and Stats in Header']) {\r\n      this.dialog = (sc = $.el('span',\r\n        {id:        'updater'}));\r\n      $.extend(sc, {innerHTML: '<span id=\"update-status\" class=\"empty\"></span><span id=\"update-timer\" class=\"empty\" title=\"Update now\"></span>'});\r\n      Header.addShortcut('updater', sc, 100);\r\n    } else {\r\n      this.dialog = (sc = UI.dialog('updater',\r\n        {innerHTML: '<div class=\"move\"></div><span id=\"update-status\" class=\"empty\"></span><span id=\"update-timer\" class=\"empty\" title=\"Update now\"></span>'}));\r\n      $.addClass(doc, 'float');\r\n      $.ready(() => $.add(d.body, sc));\r\n    }\r\n\r\n    this.checkPostCount = 0;\r\n\r\n    this.timer  = $('#update-timer', sc);\r\n    this.status = $('#update-status', sc);\r\n\r\n    $.on(this.timer,  'click', this.update);\r\n    $.on(this.status, 'click', this.update);\r\n\r\n    const updateLink = $.el('span',\r\n      {className: 'brackets-wrap updatelink'});\r\n    $.extend(updateLink, {innerHTML: '<a href=\"javascript:;\">Update</a>'});\r\n    Main.ready(function() {\r\n      let navLinksBot;\r\n      if (navLinksBot = $('.navLinksBot')) { return $.add(navLinksBot, [$.tn(' '), updateLink]); }\r\n    });\r\n    $.on(updateLink.firstElementChild, 'click', this.update);\r\n\r\n    const subEntries = [];\r\n    for (name in Config.updater.checkbox) {\r\n      var conf = Config.updater.checkbox[name];\r\n      el = UI.checkbox(name, name);\r\n      el.title = conf[1];\r\n      var input = el.firstElementChild;\r\n      $.on(input, 'change', $.cb.checked);\r\n      if (input.name === 'Scroll BG') {\r\n        $.on(input, 'change', this.cb.scrollBG);\r\n        this.cb.scrollBG();\r\n      } else if (input.name === 'Auto Update') {\r\n        $.on(input, 'change', this.setInterval);\r\n      }\r\n      subEntries.push({el});\r\n    }\r\n\r\n    this.settings = $.el('span',\r\n      {innerHTML: '<a href=\"javascript:;\">Interval</a>'});\r\n\r\n    $.on(this.settings, 'click', this.intervalShortcut);\r\n\r\n    subEntries.push({el: this.settings});\r\n\r\n    Header.menu.addEntry(this.entry = {\r\n      el: $.el('span',\r\n        {textContent: 'Updater'}),\r\n      order: 110,\r\n      subEntries\r\n    }\r\n    );\r\n\r\n    return Callbacks.Thread.push({\r\n      name: 'Thread Updater',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    ThreadUpdater.thread       = this;\r\n    ThreadUpdater.root         = this.nodes.root;\r\n    ThreadUpdater.outdateCount = 0;\r\n\r\n    // We must keep track of our own list of live posts/files\r\n    // to provide an accurate deletedPosts/deletedFiles on update\r\n    // as posts may be `kill`ed elsewhere.\r\n    ThreadUpdater.postIDs = [];\r\n    ThreadUpdater.fileIDs = [];\r\n    this.posts.forEach(function(post) {\r\n      ThreadUpdater.postIDs.push(post.ID);\r\n      if (post.file) { return ThreadUpdater.fileIDs.push(post.ID); }\r\n    });\r\n\r\n    ThreadUpdater.cb.interval.call($.el('input', {value: Conf['Interval']}));\r\n\r\n    $.on(d,      'QRPostSuccessful', ThreadUpdater.cb.checkpost);\r\n    $.on(d,      'visibilitychange', ThreadUpdater.cb.visibility);\r\n\r\n    return ThreadUpdater.setInterval();\r\n  },\r\n\r\n  /*\r\n  http://freesound.org/people/pierrecartoons1979/sounds/90112/\r\n  cc-by-nc-3.0\r\n  */\r\n  beep: `data:audio/wav;base64,${Beep}`,\r\n\r\n  playBeep() {\r\n    const {audio} = ThreadUpdater;\r\n    if (!audio.src) { audio.src = ThreadUpdater.beep; }\r\n    if (audio.paused) {\r\n      return audio.play();\r\n    } else {\r\n      return $.one(audio, 'ended', ThreadUpdater.playBeep);\r\n    }\r\n  },\r\n\r\n  cb: {\r\n    checkpost(e) {\r\n      if (e.detail.threadID !== ThreadUpdater.thread.ID) { return; }\r\n      ThreadUpdater.postID = e.detail.postID;\r\n      ThreadUpdater.checkPostCount = 0;\r\n      ThreadUpdater.outdateCount = 0;\r\n      return ThreadUpdater.setInterval();\r\n    },\r\n\r\n    visibility() {\r\n      if (d.hidden) { return; }\r\n      // Reset the counter when we focus this tab.\r\n      ThreadUpdater.outdateCount = 0;\r\n      if (ThreadUpdater.seconds > ThreadUpdater.interval) {\r\n        return ThreadUpdater.setInterval();\r\n      }\r\n    },\r\n\r\n    scrollBG() {\r\n      return ThreadUpdater.scrollBG = Conf['Scroll BG'] ?\r\n        () => true\r\n      :\r\n        () => !d.hidden;\r\n    },\r\n\r\n    interval(e) {\r\n      let val = parseInt(this.value, 10);\r\n      if (val < 1) { val = 1; }\r\n      ThreadUpdater.interval = (this.value = val);\r\n      if (e) { return $.cb.value.call(this); }\r\n    },\r\n\r\n    load() {\r\n      if (this !== ThreadUpdater.req) { return; } // aborted\r\n      switch (this.status) {\r\n        case 200:\r\n          ThreadUpdater.parse(this);\r\n          if (ThreadUpdater.thread.isArchived) {\r\n            return ThreadUpdater.kill();\r\n          } else {\r\n            return ThreadUpdater.setInterval();\r\n          }\r\n        case 404:\r\n          // XXX workaround for 4chan sending false 404s\r\n          return $.ajax(g.SITE.urls.catalogJSON({boardID: ThreadUpdater.thread.board.ID}), { onloadend() {\r\n            let confirmed;\r\n            if (this.status === 200) {\r\n              confirmed = true;\r\n              for (var page of this.response) {\r\n                for (var thread of page.threads) {\r\n                  if (thread.no === ThreadUpdater.thread.ID) {\r\n                    confirmed = false;\r\n                    break;\r\n                  }\r\n                }\r\n              }\r\n            } else {\r\n              confirmed = false;\r\n            }\r\n            if (confirmed) {\r\n              return ThreadUpdater.kill();\r\n            } else {\r\n              return ThreadUpdater.error(this);\r\n            }\r\n          }\r\n        }\r\n          );\r\n        default:\r\n          return ThreadUpdater.error(this);\r\n      }\r\n    }\r\n  },\r\n\r\n  kill() {\r\n    ThreadUpdater.thread.kill();\r\n    ThreadUpdater.setInterval();\r\n    return $.event('ThreadUpdate', {\r\n      404: true,\r\n      threadID: ThreadUpdater.thread.fullID\r\n    }\r\n    );\r\n  },\r\n\r\n  error(req) {\r\n    if (req.status === 304) {\r\n      ThreadUpdater.set('status', '');\r\n    }\r\n    ThreadUpdater.setInterval();\r\n    if (!req.status) {\r\n      return ThreadUpdater.set('status', 'Connection Error', 'warning');\r\n    } else if (req.status !== 304) {\r\n      return ThreadUpdater.set('status', `${req.statusText} (${req.status})`, 'warning');\r\n    }\r\n  },\r\n\r\n  setInterval() {\r\n    clearTimeout(ThreadUpdater.timeoutID);\r\n\r\n    if (ThreadUpdater.thread.isDead) {\r\n      ThreadUpdater.set('status', (ThreadUpdater.thread.isArchived ? 'Archived' : '404'), 'warning');\r\n      ThreadUpdater.set('timer', '');\r\n      return;\r\n    }\r\n\r\n    // Fetching your own posts after posting\r\n    if (ThreadUpdater.postID && (ThreadUpdater.checkPostCount < 5)) {\r\n      ThreadUpdater.set('timer', '...', 'loading');\r\n      ThreadUpdater.timeoutID = setTimeout(ThreadUpdater.update, ++ThreadUpdater.checkPostCount * SECOND);\r\n      return;\r\n    }\r\n\r\n    if (!Conf['Auto Update']) {\r\n      ThreadUpdater.set('timer', 'Update');\r\n      return;\r\n    }\r\n\r\n    const {interval} = ThreadUpdater;\r\n    if (Conf['Optional Increase']) {\r\n      // Lower the max refresh rate limit on visible tabs.\r\n      const limit = d.hidden ? 10 : 5;\r\n      const j     = Math.min(ThreadUpdater.outdateCount, limit);\r\n\r\n      // 1 second to 100, 30 to 300.\r\n      const cur = (Math.floor(interval * 0.1) || 1) * j * j;\r\n      ThreadUpdater.seconds = $.minmax(cur, interval, 300);\r\n    } else {\r\n      ThreadUpdater.seconds = interval;\r\n    }\r\n\r\n    return ThreadUpdater.timeout();\r\n  },\r\n\r\n  intervalShortcut() {\r\n    Settings.open('Advanced');\r\n    const settings = $.id('fourchanx-settings');\r\n    return $('input[name=Interval]', settings).focus();\r\n  },\r\n\r\n  set(name, text, klass) {\r\n    let node;\r\n    const el = ThreadUpdater[name];\r\n    if ((node = el.firstChild)) {\r\n      // Prevent the creation of a new DOM Node\r\n      // by setting the text node's data.\r\n      node.data = text;\r\n    } else {\r\n      el.textContent = text;\r\n    }\r\n    return el.className = klass ?? (text === '' ? 'empty' : '');\r\n  },\r\n\r\n  timeout() {\r\n    if (ThreadUpdater.seconds) {\r\n      ThreadUpdater.set('timer', ThreadUpdater.seconds);\r\n      ThreadUpdater.timeoutID = setTimeout(ThreadUpdater.timeout, 1000);\r\n    } else {\r\n      ThreadUpdater.outdateCount++;\r\n      ThreadUpdater.update();\r\n    }\r\n    return ThreadUpdater.seconds--;\r\n  },\r\n\r\n  update() {\r\n    let oldReq;\r\n    clearTimeout(ThreadUpdater.timeoutID);\r\n    ThreadUpdater.set('timer', '...', 'loading');\r\n    if (oldReq = ThreadUpdater.req) {\r\n      delete ThreadUpdater.req;\r\n      oldReq.abort();\r\n    }\r\n    return ThreadUpdater.req = $.whenModified(\r\n      g.SITE.urls.threadJSON({boardID: ThreadUpdater.thread.board.ID, threadID: ThreadUpdater.thread.ID}),\r\n      'ThreadUpdater',\r\n      ThreadUpdater.cb.load,\r\n      { timeout: MINUTE }\r\n    );\r\n  },\r\n\r\n  updateThreadStatus(type, status) {\r\n    let hasChanged;\r\n    if (!(hasChanged = ThreadUpdater.thread[`is${type}`] !== status)) { return; }\r\n    ThreadUpdater.thread.setStatus(type, status);\r\n    if ((type === 'Closed') && ThreadUpdater.thread.isArchived) { return; }\r\n    const change = type === 'Sticky' ?\r\n      status ?\r\n        'now a sticky'\r\n      :\r\n        'not a sticky anymore'\r\n    :\r\n      status ?\r\n        'now closed'\r\n      :\r\n        'not closed anymore';\r\n    return new Notice('info', `The thread is ${change}.`, 30);\r\n  },\r\n\r\n  parse(req) {\r\n    let ID, ipCountEl, post;\r\n    const postObjects = req.response.posts;\r\n    const OP = postObjects[0];\r\n    const {thread} = ThreadUpdater;\r\n    const {board} = thread;\r\n    const lastPost = ThreadUpdater.postIDs[ThreadUpdater.postIDs.length - 1];\r\n\r\n    // XXX Reject updates that falsely delete the last post.\r\n    if ((postObjects[postObjects.length-1].no < lastPost) &&\r\n      ((new Date(req.getResponseHeader('Last-Modified')) - thread.posts.get(lastPost).info.date) < (30 * SECOND))) { return; }\r\n\r\n    g.SITE.Build.spoilerRange[board] = OP.custom_spoiler;\r\n    thread.setStatus('Archived', !!OP.archived);\r\n    ThreadUpdater.updateThreadStatus('Sticky', !!OP.sticky);\r\n    ThreadUpdater.updateThreadStatus('Closed', !!OP.closed);\r\n    thread.postLimit = !!OP.bumplimit;\r\n    thread.fileLimit = !!OP.imagelimit;\r\n    if (OP.unique_ips != null) { thread.ipCount   = OP.unique_ips; }\r\n\r\n    const posts    = []; // new post objects\r\n    const index    = []; // existing posts\r\n    const files    = []; // existing files\r\n    const newPosts = []; // new post fullID list for API\r\n\r\n    // Build the index, create posts.\r\n    for (var postObject of postObjects) {\r\n      ID = postObject.no;\r\n      index.push(ID);\r\n      if (postObject.fsize) { files.push(ID); }\r\n\r\n      // Insert new posts, not older ones.\r\n      if (ID <= lastPost) { continue; }\r\n\r\n      // XXX Resurrect wrongly deleted posts.\r\n      if ((post = thread.posts.get(ID)) && !post.isFetchedQuote) {\r\n        post.resurrect();\r\n        continue;\r\n      }\r\n\r\n      newPosts.push(`${board}.${ID}`);\r\n      var node = g.SITE.Build.postFromObject(postObject, board.ID);\r\n      posts.push(new Post(node, thread, board));\r\n      // Fetching your own posts after posting\r\n      if (ThreadUpdater.postID === ID) { delete ThreadUpdater.postID; }\r\n    }\r\n\r\n    // Check for deleted posts.\r\n    const deletedPosts = [];\r\n    for (ID of ThreadUpdater.postIDs) {\r\n      if (!index.includes(ID)) {\r\n        thread.posts.get(ID).kill();\r\n        deletedPosts.push(`${board}.${ID}`);\r\n      }\r\n    }\r\n    ThreadUpdater.postIDs = index;\r\n\r\n    // Check for deleted files.\r\n    const deletedFiles = [];\r\n    for (ID of ThreadUpdater.fileIDs) {\r\n      if (!(files.includes(ID) || deletedPosts.includes(`${board}.${ID}`))) {\r\n        thread.posts.get(ID).kill(true);\r\n        deletedFiles.push(`${board}.${ID}`);\r\n      }\r\n    }\r\n    ThreadUpdater.fileIDs = files;\r\n\r\n    if (!posts.length) {\r\n      ThreadUpdater.set('status', '');\r\n    } else {\r\n      ThreadUpdater.set('status', `+${posts.length}`, 'new');\r\n      ThreadUpdater.outdateCount = 0;\r\n\r\n      const unreadCount   = Unread.posts?.size;\r\n      const unreadQYCount = Unread.postsQuotingYou?.size;\r\n\r\n      Main.callbackNodes('Post', posts);\r\n\r\n      if (d.hidden || !d.hasFocus()) {\r\n        if (Conf['Beep Quoting You'] && (Unread.postsQuotingYou?.size > unreadQYCount)) {\r\n          ThreadUpdater.playBeep();\r\n          if (Conf['Beep']) { ThreadUpdater.playBeep(); }\r\n        } else if (Conf['Beep'] && (Unread.posts?.size > 0) && (unreadCount === 0)) {\r\n          ThreadUpdater.playBeep();\r\n        }\r\n      }\r\n\r\n      const scroll = Conf['Auto Scroll'] && ThreadUpdater.scrollBG() &&\r\n        ((ThreadUpdater.root.getBoundingClientRect().bottom - doc.clientHeight) < 25);\r\n\r\n      let firstPost = null;\r\n      for (post of posts) {\r\n        if (!QuoteThreading.insert(post)) {\r\n          if (!firstPost) { firstPost = post.nodes.root; }\r\n          $.add(ThreadUpdater.root, post.nodes.root);\r\n        }\r\n      }\r\n      $.event('PostsInserted', null, ThreadUpdater.root);\r\n\r\n      if (scroll) {\r\n        if (Conf['Bottom Scroll']) {\r\n          window.scrollTo(0, d.body.clientHeight);\r\n        } else {\r\n          if (firstPost) { Header.scrollTo(firstPost); }\r\n        }\r\n      }\r\n    }\r\n\r\n    // Update IP count in original post form.\r\n    if ((OP.unique_ips != null) && (ipCountEl = $.id('unique-ips'))) {\r\n      ipCountEl.textContent = OP.unique_ips;\r\n      ipCountEl.previousSibling.textContent = ipCountEl.previousSibling.textContent.replace(/\\b(?:is|are)\\b/, OP.unique_ips === 1 ? 'is' : 'are');\r\n      ipCountEl.nextSibling.textContent = ipCountEl.nextSibling.textContent.replace(/\\bposters?\\b/, OP.unique_ips === 1 ? 'poster' : 'posters');\r\n    }\r\n\r\n    return $.event('ThreadUpdate', {\r\n      404: false,\r\n      threadID: thread.fullID,\r\n      newPosts,\r\n      deletedPosts,\r\n      deletedFiles,\r\n      postCount: OP.replies + 1,\r\n      fileCount: OP.images + !!OP.fsize,\r\n      ipCount: OP.unique_ips\r\n    }\r\n    );\r\n  }\r\n};\r\nexport default ThreadUpdater;\r\n",null,"import Callbacks from \"../classes/Callbacks\";\r\nimport Header from \"../General/Header\";\r\nimport UI from \"../General/UI\";\r\nimport { Conf, doc, g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar FappeTyme = {\r\n  init() {\r\n    if ((!Conf['Fappe Tyme'] && !Conf['Werk Tyme']) || !['index', 'thread', 'archive'].includes(g.VIEW)) { return; }\r\n\r\n    this.nodes = {};\r\n    this.enabled = {\r\n      fappe: false,\r\n      werk:  Conf['werk']\r\n    };\r\n\r\n    for (var type of [\"Fappe\", \"Werk\"]) {\r\n      if (Conf[`${type} Tyme`]) {\r\n        var lc = type.toLowerCase();\r\n        var el = UI.checkbox(lc, `${type} Tyme`, false);\r\n        el.title = `${type} Tyme`;\r\n\r\n        this.nodes[lc] = el.firstElementChild;\r\n        if (Conf[lc]) { this.set(lc, true); }\r\n        $.on(this.nodes[lc], 'change', this.toggle.bind(this, lc));\r\n\r\n        Header.menu.addEntry({\r\n          el,\r\n          order: 97\r\n        });\r\n\r\n        var indicator = $.el('span', {\r\n          className: 'indicator',\r\n          textContent: type[0],\r\n          title: `${type} Tyme active`\r\n        }\r\n        );\r\n        $.on(indicator, 'click', function() {\r\n          const check = $.getOwn(FappeTyme.nodes, this.parentNode.id.replace('shortcut-', ''));\r\n          check.checked = !check.checked;\r\n          return $.event('change', null, check);\r\n        });\r\n        Header.addShortcut(lc, indicator, 410);\r\n      }\r\n    }\r\n\r\n    if (Conf['Werk Tyme']) {\r\n      $.sync('werk', this.set.bind(this, 'werk'));\r\n    }\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Fappe Tyme',\r\n      cb:   this.node\r\n    });\r\n\r\n    return Callbacks.CatalogThread.push({\r\n      name: 'Werk Tyme',\r\n      cb:   this.catalogNode\r\n    });\r\n  },\r\n\r\n  node() {\r\n    return this.nodes.root.classList.toggle('noFile', !this.files.length);\r\n  },\r\n\r\n  catalogNode() {\r\n    const file = this.thread.OP.files[0];\r\n    if (!file) { return; }\r\n    const filename = $.el('div', {\r\n      textContent: file.name,\r\n      className:   'werkTyme-filename'\r\n    }\r\n    );\r\n    return $.add(this.nodes.thumb.parentNode, filename);\r\n  },\r\n\r\n  set(type, enabled) {\r\n    this.enabled[type] = (this.nodes[type].checked = enabled);\r\n    return $[`${enabled ? 'add' : 'rm'}Class`](doc, `${type}Tyme`);\r\n  },\r\n\r\n  toggle(type) {\r\n    this.set(type, !this.enabled[type]);\r\n    if (type === 'werk') { return $.cb.checked.call(this.nodes[type]); }\r\n  }\r\n};\r\nexport default FappeTyme;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Notice from \"../classes/Notice\";\r\nimport Filter from \"../Filtering/Filter\";\r\nimport { g, Conf, doc } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * DS204: Change includes calls to have a more natural evaluation order\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Sauce = {\r\n  init() {\r\n    let link;\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Sauce']) { return; }\r\n    $.addClass(doc, 'show-sauce');\r\n\r\n    const links = [];\r\n    for (link of Conf['sauces'].split('\\n')) {\r\n      var linkData;\r\n      if ((link[0] !== '#') && (linkData = this.parseLink(link))) {\r\n        links.push(linkData);\r\n      }\r\n    }\r\n    if (!links.length) { return; }\r\n\r\n    this.links = links;\r\n    this.link  = $.el('a', {\r\n      target:    '_blank',\r\n      className: 'sauce'\r\n    }\r\n    );\r\n    return Callbacks.Post.push({\r\n      name: 'Sauce',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  parseLink(link) {\r\n    if (!(link = link.trim())) { return null; }\r\n    const parts = dict();\r\n    const iterable = link.split(/;(?=(?:text|boards|types|regexp|sandbox):?)/);\r\n    for (let i = 0; i < iterable.length; i++) {\r\n      var part = iterable[i];\r\n      if (i === 0) {\r\n        parts['url'] = part;\r\n      } else {\r\n        var m = part.match(/^(\\w*):?(.*)$/);\r\n        parts[m[1]] = m[2];\r\n      }\r\n    }\r\n    if (!parts['text']) { parts['text'] = parts['url'].match(/(\\w+)\\.\\w+\\//)?.[1] || '?'; }\r\n    if ('boards' in parts) {\r\n      parts['boards'] = Filter.parseBoards(parts['boards']);\r\n    }\r\n    if ('regexp' in parts) {\r\n      try {\r\n        let regexp;\r\n        if (regexp = parts['regexp'].match(/^\\/(.*)\\/(\\w*)$/)) {\r\n          parts['regexp'] = RegExp(regexp[1], regexp[2]);\r\n        } else {\r\n          parts['regexp'] = RegExp(parts['regexp']);\r\n        }\r\n      } catch (err) {\r\n        new Notice('warning', [\r\n          $.tn(\"Invalid regexp for Sauce link:\"),\r\n          $.el('br'),\r\n          $.tn(link),\r\n          $.el('br'),\r\n          $.tn(err.message)\r\n        ], 60);\r\n        return null;\r\n      }\r\n    }\r\n    return parts;\r\n  },\r\n\r\n  createSauceLink(link, post, file) {\r\n    let a, matches, needle;\r\n    const ext = file.url.match(/[^.]*$/)[0];\r\n    const parts = dict();\r\n    $.extend(parts, link);\r\n\r\n    if (!!parts['boards'] && !parts['boards'][`${post.siteID}/${post.boardID}`] && !parts['boards'][`${post.siteID}/*`]) { return null; }\r\n    if (!!parts['types']  && (needle = ext, !parts['types'].split(',').includes(needle))) { return null; }\r\n    if (!!parts['regexp'] && (!(matches = file.name.match(parts['regexp'])))) { return null; }\r\n\r\n    const missing = [];\r\n    for (var key of ['url', 'text']) {\r\n      parts[key] = parts[key].replace(/%(T?URL|IMG|[sh]?MD5|board|name|%|semi|\\$\\d+)/g, function(orig, parameter) {\r\n        let type;\r\n        if (parameter[0] === '$') {\r\n          if (!matches) { return orig; }\r\n          type = matches[parameter.slice(1)] || '';\r\n        } else {\r\n          type = Sauce.formatters[parameter](post, file, ext);\r\n          if ((type == null)) {\r\n            missing.push(parameter);\r\n            return '';\r\n          }\r\n        }\r\n\r\n        if ((key === 'url') && !['%', 'semi'].includes(parameter)) {\r\n          if (/^javascript:/i.test(parts['url'])) { type = JSON.stringify(type); }\r\n          type = encodeURIComponent(type);\r\n        }\r\n        return type;\r\n      });\r\n    }\r\n\r\n    if (g.SITE.areMD5sDeferred?.(post.board) && missing.length && !missing.filter(x => !/^.?MD5$/.test(x)).length) {\r\n      a = Sauce.link.cloneNode(false);\r\n      a.dataset.skip = '1';\r\n      return a;\r\n    }\r\n\r\n    if (missing.length) { return null; }\r\n\r\n    a = Sauce.link.cloneNode(false);\r\n    a.href = parts['url'];\r\n    a.textContent = parts['text'];\r\n    if (/^javascript:/i.test(parts['url'])) { a.removeAttribute('target'); }\r\n    return a;\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone) { return; }\r\n    for (var file of this.files) {\r\n      Sauce.file(this, file);\r\n    }\r\n  },\r\n\r\n  file(post, file) {\r\n    let link, node;\r\n    const nodes = [];\r\n    const skipped = [];\r\n    for (link of Sauce.links) {\r\n      if (node = Sauce.createSauceLink(link, post, file)) {\r\n        nodes.push($.tn(' '), node);\r\n        if (node.dataset.skip) { skipped.push([link, node]); }\r\n      }\r\n    }\r\n    $.add(file.text, nodes);\r\n\r\n    if (skipped.length) {\r\n      var observer = new MutationObserver(function() {\r\n        if (file.text.dataset.md5) {\r\n          for ([link, node] of skipped) {\r\n            var node2;\r\n            if (node2 = Sauce.createSauceLink(link, post, file)) {\r\n              $.replace(node, node2);\r\n            }\r\n          }\r\n          return observer.disconnect();\r\n        }\r\n      });\r\n      return observer.observe(file.text, {attributes: true});\r\n    }\r\n  },\r\n\r\n  formatters: {\r\n    TURL(post, file) { return file.thumbURL; },\r\n    URL(post, file) { return file.url; },\r\n    IMG(post, file, ext) { if (['gif', 'jpg', 'jpeg', 'png'].includes(ext)) { return file.url; } else { return file.thumbURL; } },\r\n    MD5(post, file) { return file.MD5; },\r\n    sMD5(post, file) { return file.MD5?.replace(/[+/=]/g, c => ({'+': '-', '/': '_', '=': ''})[c]); },\r\n    hMD5(post, file) { if (file.MD5) { return (atob(file.MD5).map((c) => `0${c.charCodeAt(0).toString(16)}`.slice(-2))).join(''); } },\r\n    board(post) { return post.board.ID; },\r\n    name(post, file) { return file.name; },\r\n    '%'() { return '%'; },\r\n    semi() { return ';'; }\r\n  }\r\n};\r\nexport default Sauce;\r\n","/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nimport galleryPage from './Gallery/Gallery.html';\r\nimport $ from '../platform/$';\r\nimport Callbacks from '../classes/Callbacks';\r\nimport Notice from '../classes/Notice';\r\nimport Main from '../main/Main';\r\nimport Keybinds from '../Miscellaneous/Keybinds';\r\nimport $$ from '../platform/$$';\r\nimport ImageCommon from './ImageCommon';\r\nimport Sauce from './Sauce';\r\nimport Volume from './Volume';\r\nimport Header from '../General/Header';\r\nimport { Conf, d, doc, g } from '../globals/globals';\r\nimport UI from '../General/UI';\r\nimport Get from '../General/Get';\r\nimport { debounce, dict, SECOND } from '../platform/helpers';\r\n\r\nvar Gallery = {\r\n  init() {\r\n    if (!(this.enabled = Conf['Gallery'] && ['index', 'thread'].includes(g.VIEW))) { return; }\r\n\r\n    this.delay = Conf['Slide Delay'];\r\n\r\n    const el = $.el('a', {\r\n      href: 'javascript:;',\r\n      title: 'Gallery',\r\n      textContent: '',\r\n    });\r\n\r\n    $.on(el, 'click', this.cb.toggle);\r\n\r\n    Header.addShortcut('gallery', el, 530);\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Gallery',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    return (() => {\r\n      const result = [];\r\n      for (var file of this.files) {\r\n        if (file.thumb) {\r\n          if (Gallery.nodes) {\r\n            Gallery.generateThumb(this, file);\r\n            Gallery.nodes.total.textContent = Gallery.images.length;\r\n          }\r\n\r\n          if (!Conf['Image Expansion'] && ((g.SITE.software !== 'tinyboard') || !Main.jsEnabled)) {\r\n            result.push($.on(file.thumbLink, 'click', Gallery.cb.image));\r\n          } else {\r\n            result.push(undefined);\r\n          }\r\n        }\r\n      }\r\n      return result;\r\n    })();\r\n  },\r\n\r\n  build(image) {\r\n    let dialog, thumb;\r\n    const {cb} = Gallery;\r\n\r\n    if (Conf['Fullscreen Gallery']) {\r\n      $.one(d, 'fullscreenchange mozfullscreenchange webkitfullscreenchange', () => $.on(d, 'fullscreenchange mozfullscreenchange webkitfullscreenchange', cb.close));\r\n      doc.mozRequestFullScreen?.();\r\n      doc.webkitRequestFullScreen?.(Element.ALLOW_KEYBOARD_INPUT);\r\n    }\r\n\r\n    Gallery.images  = [];\r\n    const nodes = (Gallery.nodes = {});\r\n    Gallery.fileIDs = dict();\r\n    Gallery.slideshow = false;\r\n\r\n    nodes.el = (dialog = $.el('div',\r\n      {id: 'a-gallery'}));\r\n    $.extend(dialog, {innerHTML: galleryPage });\r\n\r\n    const object = {\r\n      buttons: '.gal-buttons',\r\n      frame:   '.gal-image',\r\n      name:    '.gal-name',\r\n      count:   '.count',\r\n      total:   '.total',\r\n      sauce:   '.gal-sauce',\r\n      thumbs:  '.gal-thumbnails',\r\n      next:    '.gal-image a',\r\n      current: '.gal-image img'\r\n    };\r\n    for (var key in object) { var value = object[key]; nodes[key] = $(value, dialog); }\r\n\r\n    const menuButton = $('.menu-button', dialog);\r\n    nodes.menu = new UI.Menu('gallery');\r\n\r\n    $.on(nodes.frame, 'click', cb.blank);\r\n    if (Conf['Mouse Wheel Volume']) { $.on(nodes.frame, 'wheel', Volume.wheel); }\r\n    $.on(nodes.next,  'click', cb.click);\r\n    $.on(nodes.name,  'click', ImageCommon.download);\r\n\r\n    $.on($('.gal-prev',  dialog), 'click', cb.prev);\r\n    $.on($('.gal-next',  dialog), 'click', cb.next);\r\n    $.on($('.gal-start', dialog), 'click', cb.start);\r\n    $.on($('.gal-stop',  dialog), 'click', cb.stop);\r\n    $.on($('.gal-close', dialog), 'click', cb.close);\r\n\r\n    $.on(menuButton, 'click', function(e) {\r\n      return nodes.menu.toggle(e, this, g);\r\n    });\r\n\r\n    for (var entry of Gallery.menu.createSubEntries()) {\r\n      entry.order = 0;\r\n      nodes.menu.addEntry(entry);\r\n    }\r\n\r\n    $.on(d, 'keydown', cb.keybinds);\r\n    if (Conf['Keybinds']) { $.off(d, 'keydown', Keybinds.keydown); }\r\n\r\n    $.on(window, 'resize', Gallery.cb.setHeight);\r\n\r\n    for (var postThumb of $$(g.SITE.selectors.file.thumb)) {\r\n      var post;\r\n      if (!(post = Get.postFromNode(postThumb))) { continue; }\r\n      for (var file of post.files) {\r\n        if (file.thumb) {\r\n          Gallery.generateThumb(post, file);\r\n          // If no image to open is given, pick image we have scrolled to.\r\n          if (!image && Gallery.fileIDs[`${post.fullID}.${file.index}`]) {\r\n            var candidate = file.thumbLink;\r\n            if ((Header.getTopOf(candidate) + candidate.getBoundingClientRect().height) >= 0) {\r\n              image = candidate;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n    $.addClass(doc, 'gallery-open');\r\n\r\n    $.add(d.body, dialog);\r\n\r\n    nodes.thumbs.scrollTop = 0;\r\n    nodes.current.parentElement.scrollTop = 0;\r\n\r\n    if (image) { thumb = $(`[href='${image.href}']`, nodes.thumbs); }\r\n    if (!thumb) { thumb = Gallery.images[Gallery.images.length-1]; }\r\n    if (thumb) { Gallery.open(thumb); }\r\n\r\n    doc.style.overflow = 'hidden';\r\n    return nodes.total.textContent = Gallery.images.length;\r\n  },\r\n\r\n  generateThumb(post, file) {\r\n    if (post.isClone || post.isHidden) { return; }\r\n    if (!file || !file.thumb || (!file.isImage && !file.isVideo && !Conf['PDF in Gallery'])) { return; }\r\n    if (Gallery.fileIDs[`${post.fullID}.${file.index}`]) { return; }\r\n\r\n    Gallery.fileIDs[`${post.fullID}.${file.index}`] = true;\r\n\r\n    const thumb = $.el('a', {\r\n      className: 'gal-thumb',\r\n      href:      file.url,\r\n      target:    '_blank',\r\n      title:     file.name\r\n    }\r\n    );\r\n\r\n    thumb.dataset.id   = Gallery.images.length;\r\n    thumb.dataset.post = post.fullID;\r\n    thumb.dataset.file = file.index;\r\n\r\n    const thumbImg = file.thumb.cloneNode(false);\r\n    thumbImg.style.cssText = '';\r\n    $.add(thumb, thumbImg);\r\n\r\n    $.on(thumb, 'click', Gallery.cb.open);\r\n\r\n    Gallery.images.push(thumb);\r\n    return $.add(Gallery.nodes.thumbs, thumb);\r\n  },\r\n\r\n  load(thumb, errorCB) {\r\n    const ext = thumb.href.match(/\\w*$/);\r\n    const elType = $.getOwn({'webm': 'video', 'mp4': 'video', 'ogv': 'video', 'pdf': 'iframe'}, ext) || 'img';\r\n    const file = $.el(elType);\r\n    $.extend(file.dataset, thumb.dataset);\r\n    $.on(file, 'error', errorCB);\r\n    file.src = thumb.href;\r\n    return file;\r\n  },\r\n\r\n  open(thumb) {\r\n    let el, file, post;\r\n    const {nodes} = Gallery;\r\n    const oldID = +nodes.current.dataset.id;\r\n    const newID = +thumb.dataset.id;\r\n\r\n    // Highlight, center selected thumbnail\r\n    if (el = Gallery.images[oldID]) { $.rmClass(el,    'gal-highlight'); }\r\n    $.addClass(thumb, 'gal-highlight');\r\n    nodes.thumbs.scrollTop = (thumb.offsetTop + (thumb.offsetHeight/2)) - (nodes.thumbs.clientHeight/2);\r\n\r\n    // Load image or use preloaded image\r\n    if (Gallery.cache?.dataset.id === (''+newID)) {\r\n      file = Gallery.cache;\r\n      $.off(file, 'error', Gallery.cacheError);\r\n      $.on(file, 'error', Gallery.error);\r\n    } else {\r\n      file = Gallery.load(thumb, Gallery.error);\r\n    }\r\n\r\n    // Replace old image with new one\r\n    $.off(nodes.current, 'error', Gallery.error);\r\n    ImageCommon.pause(nodes.current);\r\n    $.replace(nodes.current, file);\r\n    nodes.current = file;\r\n\r\n    if (file.nodeName === 'VIDEO') {\r\n      file.loop = true;\r\n      Volume.setup(file);\r\n      if (Conf['Autoplay']) { file.play(); }\r\n      if (Conf['Show Controls']) { ImageCommon.addControls(file); }\r\n    }\r\n\r\n    doc.classList.toggle('gal-pdf', file.nodeName === 'IFRAME');\r\n    Gallery.cb.setHeight();\r\n    nodes.count.textContent = +thumb.dataset.id + 1;\r\n    nodes.name.download     = (nodes.name.textContent = thumb.title);\r\n    nodes.name.href         = thumb.href;\r\n    nodes.frame.scrollTop   = 0;\r\n    nodes.next.focus();\r\n\r\n    // Set sauce links\r\n    $.rmAll(nodes.sauce);\r\n    if (Conf['Sauce'] && Sauce.links && (post = g.posts.get(file.dataset.post))) {\r\n      const sauces = [];\r\n      for (var link of Sauce.links) {\r\n        var node;\r\n        if (node = Sauce.createSauceLink(link, post, post.files[+file.dataset.file])) {\r\n          sauces.push($.tn(' '), node);\r\n        }\r\n      }\r\n      $.add(nodes.sauce, sauces);\r\n    }\r\n\r\n    // Continue slideshow if moving forward, stop otherwise\r\n    if (Gallery.slideshow && ((newID > oldID) || ((oldID === (Gallery.images.length-1)) && (newID === 0)))) {\r\n      Gallery.setupTimer();\r\n    } else {\r\n      Gallery.cb.stop();\r\n    }\r\n\r\n    // Scroll to post\r\n    if (Conf['Scroll to Post'] && (post = g.posts.get(file.dataset.post))) {\r\n      Header.scrollTo(post.nodes.root);\r\n    }\r\n\r\n    // Preload next image\r\n    if (isNaN(oldID) || (newID === ((oldID + 1) % Gallery.images.length))) {\r\n      return Gallery.cache = Gallery.load(Gallery.images[(newID + 1) % Gallery.images.length], Gallery.cacheError);\r\n    }\r\n  },\r\n\r\n  error() {\r\n    if (this.error?.code === MediaError.MEDIA_ERR_DECODE) {\r\n      return new Notice('error', 'Corrupt or unplayable video', 30);\r\n    }\r\n    if (ImageCommon.isFromArchive(this)) { return; }\r\n    const post = g.posts.get(this.dataset.post);\r\n    const file = post.files[+this.dataset.file];\r\n    return ImageCommon.error(this, post, file, null, url => {\r\n      if (!url) { return; }\r\n      Gallery.images[+this.dataset.id].href = url;\r\n      if (Gallery.nodes.current === this) { return this.src = url; }\r\n    });\r\n  },\r\n\r\n  cacheError() {\r\n    return delete Gallery.cache;\r\n  },\r\n\r\n  cleanupTimer() {\r\n    clearTimeout(Gallery.timeoutID);\r\n    const {current} = Gallery.nodes;\r\n    $.off(current, 'canplaythrough load', Gallery.startTimer);\r\n    return $.off(current, 'ended', Gallery.cb.next);\r\n  },\r\n\r\n  startTimer() {\r\n    return Gallery.timeoutID = setTimeout(Gallery.checkTimer, Gallery.delay * SECOND);\r\n  },\r\n\r\n  setupTimer() {\r\n    Gallery.cleanupTimer();\r\n    const {current} = Gallery.nodes;\r\n    const isVideo = current.nodeName === 'VIDEO';\r\n    if (isVideo) { current.play(); }\r\n    if ((isVideo ? current.readyState >= 4 : current.complete) || (current.nodeName === 'IFRAME')) {\r\n      return Gallery.startTimer();\r\n    } else {\r\n      return $.on(current, (isVideo ? 'canplaythrough' : 'load'), Gallery.startTimer);\r\n    }\r\n  },\r\n\r\n  checkTimer() {\r\n    const {current} = Gallery.nodes;\r\n    if ((current.nodeName === 'VIDEO') && !current.paused) {\r\n      $.on(current, 'ended', Gallery.cb.next);\r\n      return current.loop = false;\r\n    } else {\r\n      return Gallery.cb.next();\r\n    }\r\n  },\r\n\r\n  cb: {\r\n    keybinds(e) {\r\n      let key;\r\n      if (!(key = Keybinds.keyCode(e))) { return; }\r\n\r\n      const cb = (() => { switch (key) {\r\n        case Conf['Close']: case Conf['Open Gallery']:\r\n          return Gallery.cb.close;\r\n        case Conf['Next Gallery Image']:\r\n          return Gallery.cb.next;\r\n        case Conf['Advance Gallery']:\r\n          return Gallery.cb.advance;\r\n        case Conf['Previous Gallery Image']:\r\n          return Gallery.cb.prev;\r\n        case Conf['Pause']:\r\n          return Gallery.cb.pause;\r\n        case Conf['Slideshow']:\r\n          return Gallery.cb.toggleSlideshow;\r\n        case Conf['Rotate image anticlockwise']:\r\n          return Gallery.cb.rotateLeft;\r\n        case Conf['Rotate image clockwise']:\r\n          return Gallery.cb.rotateRight;\r\n        case Conf['Download Gallery Image']:\r\n          return Gallery.cb.download;\r\n      } })();\r\n\r\n      if (!cb) { return; }\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n      return cb();\r\n    },\r\n\r\n    open(e) {\r\n      if (e) { e.preventDefault(); }\r\n      if (this) { return Gallery.open(this); }\r\n    },\r\n\r\n    image(e) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n      return Gallery.build(this);\r\n    },\r\n\r\n    prev() {\r\n      return Gallery.cb.open.call(\r\n        Gallery.images[+Gallery.nodes.current.dataset.id - 1] || Gallery.images[Gallery.images.length - 1]\r\n      );\r\n    },\r\n    next() {\r\n      return Gallery.cb.open.call(\r\n        Gallery.images[+Gallery.nodes.current.dataset.id + 1] || Gallery.images[0]\r\n      );\r\n    },\r\n\r\n    click(e) {\r\n      if (ImageCommon.onControls(e)) { return; }\r\n      e.preventDefault();\r\n      return Gallery.cb.advance();\r\n    },\r\n\r\n    advance() { if (!Conf['Autoplay'] && Gallery.nodes.current.paused) { return Gallery.nodes.current.play(); } else { return Gallery.cb.next(); } },\r\n    toggle() { return (Gallery.nodes ? Gallery.cb.close : Gallery.build)(); },\r\n    blank(e) { if (e.target === this) { return Gallery.cb.close(); } },\r\n    toggleSlideshow() {  return Gallery.cb[Gallery.slideshow ? 'stop' : 'start'](); },\r\n\r\n    download() {\r\n      const name = $('.gal-name');\r\n      return name.click();\r\n    },\r\n\r\n    pause() {\r\n      Gallery.cb.stop();\r\n      const {current} = Gallery.nodes;\r\n      if (current.nodeName === 'VIDEO') { return current[current.paused ? 'play' : 'pause'](); }\r\n    },\r\n\r\n    start() {\r\n      $.addClass(Gallery.nodes.buttons, 'gal-playing');\r\n      Gallery.slideshow = true;\r\n      return Gallery.setupTimer();\r\n    },\r\n\r\n    stop() {\r\n      if (!Gallery.slideshow) { return; }\r\n      Gallery.cleanupTimer();\r\n      const {current} = Gallery.nodes;\r\n      if (current.nodeName === 'VIDEO') { current.loop = true; }\r\n      $.rmClass(Gallery.nodes.buttons, 'gal-playing');\r\n      return Gallery.slideshow = false;\r\n    },\r\n\r\n    rotateLeft() { return Gallery.cb.rotate(270); },\r\n    rotateRight() { return Gallery.cb.rotate(90); },\r\n\r\n    rotate: debounce(100, function(delta) {\r\n      const {current} = Gallery.nodes;\r\n      if (current.nodeName === 'IFRAME') { return; }\r\n      current.dataRotate = ((current.dataRotate || 0) + delta) % 360;\r\n      current.style.transform = `rotate(${current.dataRotate}deg)`;\r\n      return Gallery.cb.setHeight();\r\n    }),\r\n\r\n    close() {\r\n      $.off(Gallery.nodes.current, 'error', Gallery.error);\r\n      ImageCommon.pause(Gallery.nodes.current);\r\n      $.rm(Gallery.nodes.el);\r\n      $.rmClass(doc, 'gallery-open');\r\n      if (Conf['Fullscreen Gallery']) {\r\n        $.off(d, 'fullscreenchange mozfullscreenchange webkitfullscreenchange', Gallery.cb.close);\r\n        d.mozCancelFullScreen?.();\r\n        d.webkitExitFullscreen?.();\r\n      }\r\n      delete Gallery.nodes;\r\n      delete Gallery.fileIDs;\r\n      doc.style.overflow = '';\r\n\r\n      $.off(d, 'keydown', Gallery.cb.keybinds);\r\n      if (Conf['Keybinds']) { $.on(d, 'keydown', Keybinds.keydown); }\r\n      $.off(window, 'resize', Gallery.cb.setHeight);\r\n      return clearTimeout(Gallery.timeoutID);\r\n    },\r\n\r\n    setFitness() {\r\n      return (this.checked ? $.addClass : $.rmClass)(doc, `gal-${this.name.toLowerCase().replace(/\\s+/g, '-')}`);\r\n    },\r\n\r\n    setHeight: debounce(100, function () {\r\n      let dim, margin, minHeight;\r\n      const {current, frame} = Gallery.nodes;\r\n      const {style} = current;\r\n\r\n      if (Conf['Stretch to Fit'] && (dim = g.posts.get(current.dataset.post)?.files[+current.dataset.file].dimensions)) {\r\n        const [width, height] = Array.from(dim.split('x'));\r\n        let containerWidth = frame.clientWidth;\r\n        let containerHeight = doc.clientHeight - 25;\r\n        if (((current.dataRotate || 0) % 180) === 90) {\r\n          [containerWidth, containerHeight] = Array.from([containerHeight, containerWidth]);\r\n        }\r\n        minHeight = Math.min(containerHeight, (height / width) * containerWidth);\r\n        style.minHeight = minHeight + 'px';\r\n        style.minWidth = ((width / height) * minHeight) + 'px';\r\n      } else {\r\n        style.minHeight = (style.minWidth = '');\r\n      }\r\n\r\n      if (((current.dataRotate || 0) % 180) === 90) {\r\n        style.maxWidth  = Conf['Fit Height'] ? `${doc.clientHeight - 25}px` : 'none';\r\n        style.maxHeight = Conf['Fit Width']  ? `${frame.clientWidth}px`     : 'none';\r\n        margin = (current.clientWidth - current.clientHeight)/2;\r\n        return style.margin = `${margin}px ${-margin}px`;\r\n      } else {\r\n        return style.maxWidth = (style.maxHeight = (style.margin = ''));\r\n      }\r\n    }),\r\n\r\n    setDelay() { return Gallery.delay = +this.value; }\r\n  },\r\n\r\n  menu: {\r\n    init() {\r\n      if (!Gallery.enabled) { return; }\r\n\r\n      const el = $.el('span', {\r\n        textContent: 'Gallery',\r\n        className: 'gallery-link'\r\n      }\r\n      );\r\n\r\n      return Header.menu.addEntry({\r\n        el,\r\n        order: 105,\r\n        subEntries: Gallery.menu.createSubEntries()\r\n      });\r\n    },\r\n\r\n    createSubEntry(name) {\r\n      const label = UI.checkbox(name, name);\r\n      const input = label.firstElementChild;\r\n      if (['Hide Thumbnails', 'Fit Width', 'Fit Height'].includes(name)) { $.on(input, 'change', Gallery.cb.setFitness); }\r\n      $.event('change', null, input);\r\n      $.on(input, 'change', $.cb.checked);\r\n      if (['Hide Thumbnails', 'Fit Width', 'Fit Height', 'Stretch to Fit'].includes(name)) { $.on(input, 'change', Gallery.cb.setHeight); }\r\n      return {el: label};\r\n    },\r\n\r\n    createSubEntries() {\r\n      const subEntries = (['Hide Thumbnails', 'Fit Width', 'Fit Height', 'Stretch to Fit', 'Scroll to Post'].map((item) => Gallery.menu.createSubEntry(item)));\r\n\r\n      const delayLabel = $.el('label', {innerHTML: 'Slide Delay: <input type=\"number\" name=\"Slide Delay\" min=\"0\" step=\"any\" class=\"field\">'});\r\n      const delayInput = delayLabel.firstElementChild;\r\n      delayInput.value = Gallery.delay;\r\n      $.on(delayInput, 'change', Gallery.cb.setDelay);\r\n      $.on(delayInput, 'change', $.cb.value);\r\n      subEntries.push({el: delayLabel});\r\n\r\n      return subEntries;\r\n    }\r\n  }\r\n};\r\nexport default Gallery;\r\n","import Get from '../General/Get';\r\nimport Header from '../General/Header';\r\nimport UI from '../General/UI';\r\nimport { g, Conf, d, doc, E } from '../globals/globals';\r\nimport ImageHost from '../Images/ImageHost';\r\nimport Main from '../main/Main';\r\nimport $ from '../platform/$';\r\nimport $$ from '../platform/$$';\r\nimport CrossOrigin from '../platform/CrossOrigin';\r\nimport { dict } from '../platform/helpers';\r\nimport EmbeddingPage from './Embedding/Embed.html';\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n\r\nvar Embedding = {\r\n  init() {\r\n    if (!['index', 'thread', 'archive'].includes(g.VIEW) || !Conf['Linkify'] || (!Conf['Embedding'] && !Conf['Link Title'] && !Conf['Cover Preview'])) { return; }\r\n    this.types = dict();\r\n    for (var type of this.ordered_types) { this.types[type.key] = type; }\r\n\r\n    if (Conf['Embedding'] && (g.VIEW !== 'archive')) {\r\n      this.dialog = UI.dialog('embedding',\r\n        { innerHTML: EmbeddingPage });\r\n      this.media = $('#media-embed', this.dialog);\r\n      $.one(d, '4chanXInitFinished', this.ready);\r\n      $.on(d, 'IndexRefreshInternal', () => g.posts.forEach(function(post) {\r\n        for (post of [post, ...Array.from(post.clones)]) {\r\n          for (var embed of post.nodes.embedlinks) {\r\n            Embedding.cb.catalogRemove.call(embed);\r\n          }\r\n        }\r\n      }));\r\n    }\r\n    if (Conf['Link Title']) {\r\n      return $.on(d, '4chanXInitFinished PostsInserted', function() {\r\n        for (var key in Embedding.types) {\r\n          var service = Embedding.types[key];\r\n          if (service.title?.batchSize) {\r\n            Embedding.flushTitles(service.title);\r\n          }\r\n        }\r\n      });\r\n    }\r\n  },\r\n\r\n  events(post) {\r\n    let el, i, items;\r\n    if (g.VIEW === 'archive') { return; }\r\n    if (Conf['Embedding']) {\r\n      i = 0;\r\n      items = (post.nodes.embedlinks = $$('.embedder', post.nodes.comment));\r\n      while ((el = items[i++])) {\r\n        $.on(el, 'click', Embedding.cb.click);\r\n        if ($.hasClass(el, 'embedded')) { Embedding.cb.toggle.call(el); }\r\n      }\r\n    }\r\n    if (Conf['Cover Preview']) {\r\n      i = 0;\r\n      items = $$('.linkify', post.nodes.comment);\r\n      while ((el = items[i++])) {\r\n        var data;\r\n        if (data = Embedding.services(el)) {\r\n          Embedding.preview(data);\r\n        }\r\n      }\r\n      return;\r\n    }\r\n  },\r\n\r\n  process(link, post) {\r\n    let data;\r\n    if (!Conf['Embedding'] && !Conf['Link Title'] && !Conf['Cover Preview']) { return; }\r\n    if ($.x('ancestor::pre', link)) { return; }\r\n    if (data = Embedding.services(link)) {\r\n      data.post = post;\r\n      if (Conf['Embedding'] && (g.VIEW !== 'archive')) { Embedding.embed(data); }\r\n      if (Conf['Link Title']) { Embedding.title(data); }\r\n      if (Conf['Cover Preview'] && (g.VIEW !== 'archive')) { return Embedding.preview(data); }\r\n    }\r\n  },\r\n\r\n  services(link) {\r\n    const {href} = link;\r\n    for (var type of Embedding.ordered_types) {\r\n      var match;\r\n      if (match = type.regExp.exec(href)) {\r\n        return {key: type.key, uid: match[1], options: match[2], link};\r\n      }\r\n    }\r\n  },\r\n\r\n  embed(data) {\r\n    const {key, uid, options, link, post} = data;\r\n    const {href} = link;\r\n\r\n    $.addClass(link, key.toLowerCase());\r\n\r\n    const embed = $.el('a', {\r\n      className:   'embedder',\r\n      href:        'javascript:;'\r\n    }\r\n    ,\r\n      {innerHTML: '(<span>un</span>embed)'});\r\n\r\n    const object = {key, uid, options, href};\r\n    for (var name in object) { var value = object[name]; embed.dataset[name] = value; }\r\n\r\n    $.on(embed, 'click', Embedding.cb.click);\r\n    $.after(link, [$.tn(' '), embed]);\r\n    post.nodes.embedlinks.push(embed);\r\n\r\n    if (Conf['Auto-embed'] && !Conf['Floating Embeds'] && !post.isFetchedQuote) {\r\n      if ($.hasClass(doc, 'catalog-mode')) {\r\n        return $.addClass(embed, 'embed-removed');\r\n      } else {\r\n        return Embedding.cb.toggle.call(embed);\r\n      }\r\n    }\r\n  },\r\n\r\n  ready() {\r\n    if (!Main.isThisPageLegit()) { return; }\r\n    $.addClass(Embedding.dialog, 'empty');\r\n    $.on($('.close', Embedding.dialog), 'click',     Embedding.closeFloat);\r\n    $.on($('.move',  Embedding.dialog), 'mousedown', Embedding.dragEmbed);\r\n    $.on($('.jump',  Embedding.dialog), 'click', function() {\r\n      if (doc.contains(Embedding.lastEmbed)) { return Header.scrollTo(Embedding.lastEmbed); }\r\n    });\r\n    return $.add(d.body, Embedding.dialog);\r\n  },\r\n\r\n  closeFloat() {\r\n    delete Embedding.lastEmbed;\r\n    $.addClass(Embedding.dialog, 'empty');\r\n    return $.replace(Embedding.media.firstChild, $.el('div'));\r\n  },\r\n\r\n  dragEmbed() {\r\n    // only webkit can handle a blocking div\r\n    const {style} = Embedding.media;\r\n    if (Embedding.dragEmbed.mouseup) {\r\n      $.off(d, 'mouseup', Embedding.dragEmbed);\r\n      Embedding.dragEmbed.mouseup = false;\r\n      style.pointerEvents = '';\r\n      return;\r\n    }\r\n    $.on(d, 'mouseup', Embedding.dragEmbed);\r\n    Embedding.dragEmbed.mouseup = true;\r\n    return style.pointerEvents = 'none';\r\n  },\r\n\r\n  title(data) {\r\n    let service;\r\n    const {key, uid, options, link, post} = data;\r\n    if (!(service = Embedding.types[key].title)) { return; }\r\n    $.addClass(link, key.toLowerCase());\r\n    if (service.batchSize) {\r\n      (service.queue || (service.queue = [])).push(data);\r\n      if (service.queue.length >= service.batchSize) {\r\n        return Embedding.flushTitles(service);\r\n      }\r\n    } else {\r\n      return CrossOrigin.cache(service.api(uid), (function() { return Embedding.cb.title(this, data); }));\r\n    }\r\n  },\r\n\r\n  flushTitles(service) {\r\n    let data;\r\n    const {queue} = service;\r\n    if (!queue?.length) { return; }\r\n    service.queue = [];\r\n    const cb = function() {\r\n      for (data of queue) { Embedding.cb.title(this, data); }\r\n    };\r\n    return CrossOrigin.cache(service.api((() => {\r\n      const result = [];\r\n      for (data of queue) {         result.push(data.uid);\r\n      }\r\n      return result;\r\n    })()), cb);\r\n  },\r\n\r\n  preview(data) {\r\n    let service;\r\n    const {key, uid, link} = data;\r\n    if (!(service = Embedding.types[key].preview)) { return; }\r\n    return $.on(link, 'mouseover', function(e) {\r\n      const src = service.url(uid);\r\n      const {height} = service;\r\n      const el = $.el('img', {\r\n        src,\r\n        id: 'ihover'\r\n      }\r\n      );\r\n      $.add(Header.hover, el);\r\n      return UI.hover({\r\n        root: link,\r\n        el,\r\n        latestEvent: e,\r\n        endEvents: 'mouseout click',\r\n        height\r\n      });\r\n    });\r\n  },\r\n\r\n  cb: {\r\n    click(e) {\r\n      e.preventDefault();\r\n      if (!$.hasClass(this, 'embedded') && (Conf['Floating Embeds'] || $.hasClass(doc, 'catalog-mode'))) {\r\n        let div;\r\n        if (!(div = Embedding.media.firstChild)) { return; }\r\n        $.replace(div, Embedding.cb.embed(this));\r\n        Embedding.lastEmbed = Get.postFromNode(this).nodes.root;\r\n        return $.rmClass(Embedding.dialog, 'empty');\r\n      } else {\r\n        return Embedding.cb.toggle.call(this);\r\n      }\r\n    },\r\n\r\n    toggle() {\r\n      if ($.hasClass(this, \"embedded\")) {\r\n        $.rm(this.nextElementSibling);\r\n      } else {\r\n        $.after(this, Embedding.cb.embed(this));\r\n      }\r\n      return $.toggleClass(this, 'embedded');\r\n    },\r\n\r\n    embed(a) {\r\n      // We create an element to embed\r\n      let el, type;\r\n      const container = $.el('div', {className: 'media-embed'});\r\n      $.add(container, (el = (type = Embedding.types[a.dataset.key]).el(a)));\r\n\r\n      // Set style values.\r\n      el.style.cssText = (type.style != null) ?\r\n        type.style\r\n      :\r\n        'border: none; width: 640px; height: 360px;';\r\n\r\n      return container;\r\n    },\r\n\r\n    catalogRemove() {\r\n      const isCatalog = $.hasClass(doc, 'catalog-mode');\r\n      if ((isCatalog && $.hasClass(this, 'embedded')) || (!isCatalog && $.hasClass(this, 'embed-removed'))) {\r\n        Embedding.cb.toggle.call(this);\r\n        return $.toggleClass(this, 'embed-removed');\r\n      }\r\n    },\r\n\r\n    title(req, data) {\r\n      let text;\r\n      const {key, uid, options, link, post} = data;\r\n      const service = Embedding.types[key].title;\r\n\r\n      let {status} = req;\r\n      if ([200, 304].includes(status) && service.status) {\r\n        status = service.status(req.response)[0];\r\n      }\r\n\r\n      if (!status) { return; }\r\n\r\n      text = `[${key}] ${(() => { switch (status) {\r\n        case 200: case 304:\r\n          text = service.text(req.response, uid);\r\n          if (typeof text === 'string') {\r\n            return text;\r\n          } else {\r\n            return text = link.textContent;\r\n          }\r\n        case 404:\r\n          return \"Not Found\";\r\n        case 403: case 401:\r\n          return \"Forbidden or Private\";\r\n        default:\r\n          return `${status}'d`;\r\n      } })()\r\n      }`;\r\n\r\n      link.dataset.original = link.textContent;\r\n      link.textContent = text;\r\n      for (var post2 of post.clones) {\r\n        for (var link2 of $$('a.linkify', post2.nodes.comment)) {\r\n          if (link2.href === link.href) {\r\n            if (link2.dataset.original == null) { link2.dataset.original = link2.textContent; }\r\n            link2.textContent = text;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  ordered_types: [{\r\n      key: 'audio',\r\n      regExp: /^[^?#]+\\.(?:mp3|m4a|oga|wav|flac)(?:[?#]|$)/i,\r\n      style: '',\r\n      el(a) {\r\n        return $.el('audio', {\r\n          controls:    true,\r\n          preload:     'auto',\r\n          src:         a.dataset.href\r\n        }\r\n        );\r\n      }\r\n    }\r\n    , {\r\n      key: 'image',\r\n      regExp: /^[^?#]+\\.(?:gif|png|jpg|jpeg|bmp|webp)(?::\\w+)?(?:[?#]|$)/i,\r\n      style: '',\r\n      el(a) {\r\n        const hrefEsc = E(a.dataset.href);\r\n        return $.el('div', { innerHTML: `<a target=\"_blank\" href=\"${hrefEsc}\"><img src=\"${hrefEsc}\" style=\"max-width: 80vw; max-height: 80vh;\"></a>`});\r\n      }\r\n    }\r\n    , {\r\n      key: 'video',\r\n      regExp: /^[^?#]+\\.(?:og[gv]|webm|mp4)(?:[?#]|$)/i,\r\n      style: 'max-width: 80vw; max-height: 80vh;',\r\n      el(a) {\r\n        const el = $.el('video', {\r\n          hidden:   true,\r\n          controls: true,\r\n          preload:  'auto',\r\n          src:      a.dataset.href,\r\n          loop:     ImageHost.test(a.dataset.href.split('/')[2])\r\n        });\r\n        $.on(el, 'loadedmetadata', function() {\r\n          if ((el.videoHeight === 0) && el.parentNode) {\r\n            return $.replace(el, Embedding.types.audio.el(a));\r\n          } else {\r\n            return el.hidden = false;\r\n          }\r\n        });\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'PeerTube',\r\n      regExp: /^(\\w+:\\/\\/[^\\/]+\\/videos\\/watch\\/\\w{8}-\\w{4}-\\w{4}-\\w{4}-\\w{12})(.*)/,\r\n      el(a) {\r\n        let start;\r\n        const options = (start = a.dataset.options.match(/[?&](start=\\w+)/)) ? `?${start[1]}` : '';\r\n        const el = $.el('iframe',\r\n          {src: a.dataset.uid.replace('/videos/watch/', '/videos/embed/') + options});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'BitChute',\r\n      regExp:  /^\\w+:\\/\\/(?:www\\.)?bitchute\\.com\\/video\\/([\\w\\-]+)/,\r\n      el(a) {\r\n        const el = $.el('iframe',\r\n          {src: `https://www.bitchute.com/embed/${a.dataset.uid}/`});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'Clyp',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.)?clyp\\.it\\/(\\w{8})/,\r\n      style: 'border: 0; width: 640px; height: 160px;',\r\n      el(a) {\r\n        return $.el('iframe',\r\n          {src: `https://clyp.it/${a.dataset.uid}/widget`});\r\n      },\r\n      title: {\r\n        api(uid) { return `https://api.clyp.it/oembed?url=https://clyp.it/${uid}`; },\r\n        text(_) { return _.title; }\r\n      }\r\n    }\r\n    , {\r\n      key: 'Dailymotion',\r\n      regExp:  /^\\w+:\\/\\/(?:(?:www\\.)?dailymotion\\.com\\/(?:embed\\/)?video|dai\\.ly)\\/([A-Za-z0-9]+)[^?]*(.*)/,\r\n      el(a) {\r\n        let start;\r\n        const options = (start = a.dataset.options.match(/[?&](start=\\d+)/)) ? `?${start[1]}` : '';\r\n        const el = $.el('iframe',\r\n          {src: `//www.dailymotion.com/embed/video/${a.dataset.uid}${options}`});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      },\r\n      title: {\r\n        api(uid) { return `https://api.dailymotion.com/video/${uid}`; },\r\n        text(_) { return _.title; }\r\n      },\r\n      preview: {\r\n        url(uid) { return `https://www.dailymotion.com/thumbnail/video/${uid}`; },\r\n        height: 240\r\n      }\r\n    }\r\n    , {\r\n      key: 'Gfycat',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.)?gfycat\\.com\\/(?:iframe\\/)?(\\w+)/,\r\n      el(a) {\r\n        const el = $.el('iframe',\r\n          {src: `//gfycat.com/ifr/${a.dataset.uid}`});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'Gist',\r\n      regExp: /^\\w+:\\/\\/gist\\.github\\.com\\/[\\w\\-]+\\/(\\w+)/,\r\n      style: '',\r\n      el: (function() {\r\n        let counter = 0;\r\n        return function(a) {\r\n          const el = $.el('pre', {\r\n            hidden: true,\r\n            id: `gist-embed-${counter++}`\r\n          }\r\n          );\r\n          CrossOrigin.cache(`https://api.github.com/gists/${a.dataset.uid}`, function() {\r\n            el.textContent = Object.values(this.response.files)[0].content;\r\n            el.className = 'prettyprint';\r\n            $.global(() => window.prettyPrint?.((function() {}), document.getElementById(document.currentScript.dataset.id).parentNode)\r\n            , {id: el.id});\r\n            return el.hidden = false;\r\n          });\r\n          return el;\r\n        };\r\n      })(),\r\n      title: {\r\n        api(uid) { return `https://api.github.com/gists/${uid}`; },\r\n        text({files}) {\r\n          for (var file in files) { if (files.hasOwnProperty(file)) { return file; } }\r\n        }\r\n      }\r\n    }\r\n    , {\r\n      key: 'InstallGentoo',\r\n      regExp: /^\\w+:\\/\\/paste\\.installgentoo\\.com\\/view\\/(?:raw\\/|download\\/|embed\\/)?(\\w+)/,\r\n      el(a) {\r\n        return $.el('iframe',\r\n          {src: `https://paste.installgentoo.com/view/embed/${a.dataset.uid}`});\r\n      }\r\n    }\r\n    , {\r\n      key: 'LiveLeak',\r\n      regExp: /^\\w+:\\/\\/(?:\\w+\\.)?liveleak\\.com\\/.*\\?.*[tif]=(\\w+)/,\r\n      el(a) {\r\n        const el = $.el('iframe',\r\n          {src: `https://www.liveleak.com/e/${a.dataset.uid}`,});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'Loopvid',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.)?loopvid.appspot.com\\/#?((?:pf|kd|lv|gd|gh|db|dx|nn|cp|wu|ig|ky|mf|m2|pc|1c|pi|ni|wl|ko|mm|ic|gc)\\/[\\w\\-\\/]+(?:,[\\w\\-\\/]+)*|fc\\/\\w+\\/\\d+|https?:\\/\\/.+)/,\r\n      style: 'max-width: 80vw; max-height: 80vh;',\r\n      el(a) {\r\n        const el = $.el('video', {\r\n          controls: true,\r\n          preload:  'auto',\r\n          loop:     true\r\n        }\r\n        );\r\n        if (/^http/.test(a.dataset.uid)) {\r\n          $.add(el, $.el('source', {src: a.dataset.uid}));\r\n          return el;\r\n        }\r\n        const [_, host, names] = Array.from(a.dataset.uid.match(/(\\w+)\\/(.*)/));\r\n        const types = (() => { switch (host) {\r\n          case 'gd': case 'wu': case 'fc': return [''];\r\n          case 'gc': return ['giant', 'fat', 'zippy'];\r\n          default: return ['.webm', '.mp4'];\r\n        } })();\r\n        for (var name of names.split(',')) {\r\n          for (var type of types) {\r\n            var base = `${name}${type}`;\r\n            var urls = (() => { switch (host) {\r\n              // list from src/common.py at http://loopvid.appspot.com/source.html\r\n              case 'pf': return [`https://kastden.org/_loopvid_media/pf/${base}`, `https://web.archive.org/web/2/http://a.pomf.se/${base}`];\r\n              case 'kd': return [`https://kastden.org/loopvid/${base}`];\r\n              case 'lv': return [`https://lv.kastden.org/${base}`];\r\n              case 'gd': return [`https://docs.google.com/uc?export=download&id=${base}`];\r\n              case 'gh': return [`https://googledrive.com/host/${base}`];\r\n              case 'db': return [`https://dl.dropboxusercontent.com/u/${base}`];\r\n              case 'dx': return [`https://dl.dropboxusercontent.com/${base}`];\r\n              case 'nn': return [`https://kastden.org/_loopvid_media/nn/${base}`];\r\n              case 'cp': return [`https://copy.com/${base}`];\r\n              case 'wu': return [`http://webmup.com/${base}/vid.webm`];\r\n              case 'ig': return [`https://i.imgur.com/${base}`];\r\n              case 'ky': return [`https://kastden.org/_loopvid_media/ky/${base}`];\r\n              case 'mf': return [`https://kastden.org/_loopvid_media/mf/${base}`, `https://web.archive.org/web/2/https://d.maxfile.ro/${base}`];\r\n              case 'm2': return [`https://kastden.org/_loopvid_media/m2/${base}`];\r\n              case 'pc': return [`https://kastden.org/_loopvid_media/pc/${base}`, `https://web.archive.org/web/2/http://a.pomf.cat/${base}`];\r\n              case '1c': return [`http://b.1339.cf/${base}`];\r\n              case 'pi': return [`https://kastden.org/_loopvid_media/pi/${base}`, `https://web.archive.org/web/2/https://u.pomf.is/${base}`];\r\n              case 'ni': return [`https://kastden.org/_loopvid_media/ni/${base}`, `https://web.archive.org/web/2/https://u.nya.is/${base}`];\r\n              case 'wl': return [`http://webm.land/media/${base}`];\r\n              case 'ko': return [`https://kordy.kastden.org/loopvid/${base}`];\r\n              case 'mm': return [`https://kastden.org/_loopvid_media/mm/${base}`, `https://web.archive.org/web/2/https://my.mixtape.moe/${base}`];\r\n              case 'ic': return [`https://media.8ch.net/file_store/${base}`];\r\n              case 'fc': return [`//${ImageHost.host()}/${base}.webm`];\r\n              case 'gc': return [`https://${type}.gfycat.com/${name}.webm`];\r\n            } })();\r\n\r\n            for (var url of urls) {\r\n              $.add(el, $.el('source', {src: url}));\r\n            }\r\n          }\r\n        }\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'Openings.moe',\r\n      regExp: /^\\w+:\\/\\/openings.moe\\/\\?video=([^.&=]+)/,\r\n      style: 'width: 1280px; height: 720px; max-width: 80vw; max-height: 80vh;',\r\n      el(a) {\r\n        const el = $.el('iframe',\r\n          {src: `https://openings.moe/?video=${a.dataset.uid}`,});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'Pastebin',\r\n      regExp: /^\\w+:\\/\\/(?:\\w+\\.)?pastebin\\.com\\/(?!u\\/)(?:[\\w.]+(?:\\/|\\?i\\=))?(\\w+)/,\r\n      el(a) {\r\n        let div;\r\n        return div = $.el('iframe',\r\n          {src: `//pastebin.com/embed_iframe.php?i=${a.dataset.uid}`});\r\n      }\r\n    }\r\n    , {\r\n      key: 'SoundCloud',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.)?(?:soundcloud\\.com\\/|snd\\.sc\\/)([\\w\\-\\/]+)/,\r\n      style: 'border: 0; width: 500px; height: 400px;',\r\n      el(a) {\r\n        return $.el('iframe',\r\n          {src: `https://w.soundcloud.com/player/?visual=true&show_comments=false&url=https%3A%2F%2Fsoundcloud.com%2F${encodeURIComponent(a.dataset.uid)}`});\r\n      },\r\n      title: {\r\n        api(uid) { return `${location.protocol}//soundcloud.com/oembed?format=json&url=https%3A%2F%2Fsoundcloud.com%2F${encodeURIComponent(uid)}`; },\r\n        text(_) { return _.title; }\r\n      }\r\n    }\r\n    , {\r\n      key: 'StrawPoll',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.)?strawpoll\\.me\\/(?:embed_\\d+\\/)?(\\d+(?:\\/r)?)/,\r\n      style: 'border: 0; width: 600px; height: 406px;',\r\n      el(a) {\r\n        return $.el('iframe',\r\n          {src: `https://www.strawpoll.me/embed_1/${a.dataset.uid}`});\r\n      }\r\n    }\r\n    , {\r\n      key: 'Streamable',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.)?streamable\\.com\\/(\\w+)/,\r\n      el(a) {\r\n        const el = $.el('iframe',\r\n          {src: `https://streamable.com/o/${a.dataset.uid}`});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      },\r\n      title: {\r\n        api(uid) { return `https://api.streamable.com/oembed?url=https://streamable.com/${uid}`; },\r\n        text(_) { return _.title; }\r\n      }\r\n    }\r\n    , {\r\n      key: 'TwitchTV',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.|secure\\.|clips\\.|m\\.)?twitch\\.tv\\/(\\w[^#\\&\\?]*)/,\r\n      el(a) {\r\n        let url;\r\n        let m = a.dataset.href.match(/^\\w+:\\/\\/(?:(clips\\.)|\\w+\\.)?twitch\\.tv\\/(?:\\w+\\/)?(clip\\/)?(\\w[^#\\&\\?]*)/);\r\n        if (m[1] || m[2]) {\r\n          url = `//clips.twitch.tv/embed?clip=${m[3]}&parent=${location.hostname}`;\r\n        } else {\r\n          let time;\r\n          m = a.dataset.uid.match(/(\\w+)(?:\\/(?:v\\/)?(\\d+))?/);\r\n          url = `//player.twitch.tv/?${m[2] ? `video=v${m[2]}` : `channel=${m[1]}`}&autoplay=false&parent=${location.hostname}`;\r\n          if (time = a.dataset.href.match(/\\bt=(\\w+)/)) {\r\n            url += `&time=${time[1]}`;\r\n          }\r\n        }\r\n        const el = $.el('iframe',\r\n          {src: url});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'Twitter',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.|mobile\\.)?twitter\\.com\\/(\\w+\\/status\\/\\d+)/,\r\n      style: 'border: none; width: 550px; height: 250px; overflow: hidden; resize: both;',\r\n      el(a) {\r\n        const el = $.el('iframe');\r\n        $.on(el, 'load', function() {\r\n          return this.contentWindow.postMessage({element: 't', query: 'height'}, 'https://twitframe.com');\r\n        });\r\n        var onMessage = function(e) {\r\n          if ((e.source === el.contentWindow) && (e.origin === 'https://twitframe.com')) {\r\n            $.off(window, 'message', onMessage);\r\n            return (cont || el).style.height = `${+$.minmax(e.data.height, 250, 0.8 * doc.clientHeight)}px`;\r\n          }\r\n        };\r\n        $.on(window, 'message', onMessage);\r\n        el.src = `https://twitframe.com/show?url=https://twitter.com/${a.dataset.uid}`;\r\n        if ($.engine === 'gecko') {\r\n          // XXX https://bugzilla.mozilla.org/show_bug.cgi?id=680823\r\n          el.style.cssText = 'border: none; width: 100%; height: 100%;';\r\n          var cont = $.el('div');\r\n          $.add(cont, el);\r\n          return cont;\r\n        } else {\r\n          return el;\r\n        }\r\n      }\r\n    }\r\n    , {\r\n      key: 'VidLii',\r\n      regExp:  /^\\w+:\\/\\/(?:www\\.)?vidlii\\.com\\/watch\\?v=(\\w{11})/,\r\n      style: 'border: none; width: 640px; height: 392px;',\r\n      el(a) {\r\n        const el = $.el('iframe',\r\n          {src: `https://www.vidlii.com/embed?v=${a.dataset.uid}&a=0`});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'Vimeo',\r\n      regExp:  /^\\w+:\\/\\/(?:www\\.)?vimeo\\.com\\/(\\d+)/,\r\n      el(a) {\r\n        const el = $.el('iframe',\r\n          {src: `//player.vimeo.com/video/${a.dataset.uid}?wmode=opaque`});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      },\r\n      title: {\r\n        api(uid) { return `https://vimeo.com/api/oembed.json?url=https://vimeo.com/${uid}`; },\r\n        text(_) { return _.title; }\r\n      }\r\n    }\r\n    , {\r\n      key: 'Vine',\r\n      regExp: /^\\w+:\\/\\/(?:www\\.)?vine\\.co\\/v\\/(\\w+)/,\r\n      style: 'border: none; width: 500px; height: 500px;',\r\n      el(a) {\r\n        return $.el('iframe',\r\n          {src: `https://vine.co/v/${a.dataset.uid}/card`});\r\n      }\r\n    }\r\n    , {\r\n      key: 'Vocaroo',\r\n      regExp: /^\\w+:\\/\\/(?:(?:www\\.|old\\.)?vocaroo\\.com|voca\\.ro)\\/((?:i\\/)?\\w+)/,\r\n      style: '',\r\n      el(a) {\r\n        const el = $.el('iframe');\r\n        el.width = 300;\r\n        el.height = 60;\r\n        el.setAttribute('frameborder', 0);\r\n        el.src = `https://vocaroo.com/embed/${a.dataset.uid.replace(/^i\\//, '')}?autoplay=0`;\r\n        return el;\r\n      }\r\n    }\r\n    , {\r\n      key: 'YouTube',\r\n      regExp: /^\\w+:\\/\\/(?:youtu.be\\/|[\\w.]*youtube[\\w.]*\\/.*(?:v=|\\bembed\\/|\\bv\\/|live\\/))([\\w\\-]{11})(.*)/,\r\n      el(a) {\r\n        let start = a.dataset.options.match(/\\b(?:star)?t\\=(\\w+)/);\r\n        if (start) { start = start[1]; }\r\n        if (start && !/^\\d+$/.test(start)) {\r\n          start += ' 0h0m0s';\r\n          start = (3600 * start.match(/(\\d+)h/)[1]) + (60 * start.match(/(\\d+)m/)[1]) + (1 * start.match(/(\\d+)s/)[1]);\r\n        }\r\n        const el = $.el('iframe',\r\n          {src: `//www.youtube.com/embed/${a.dataset.uid}?rel=0&wmode=opaque${start ? '&start=' + start : ''}`});\r\n        el.setAttribute(\"allowfullscreen\", \"true\");\r\n        return el;\r\n      },\r\n      title: {\r\n        api(uid) { return `https://www.youtube.com/oembed?url=https%3A//www.youtube.com/watch%3Fv%3D${uid}&format=json`; },\r\n        text(_) { return _.title; },\r\n        status(_) {\r\n          if (_.error) {\r\n            const m = _.error.match(/^(\\d*)\\s*(.*)/);\r\n            return [+m[1], m[2]];\r\n          } else {\r\n            return [200, 'OK'];\r\n          }\r\n        }\r\n      },\r\n      preview: {\r\n        url(uid) { return `https://img.youtube.com/vi/${uid}/0.jpg`; },\r\n        height: 360\r\n      }\r\n    }\r\n  ]\r\n};\r\nexport default Embedding;\r\n","import Notice from \"../classes/Notice\";\r\nimport Config from \"../config/Config\";\r\nimport Filter from \"../Filtering/Filter\";\r\nimport ThreadHiding from \"../Filtering/ThreadHiding\";\r\nimport BoardConfig from \"../General/BoardConfig\";\r\nimport Get from \"../General/Get\";\r\nimport Header from \"../General/Header\";\r\nimport Index from \"../General/Index\";\r\nimport Settings from \"../General/Settings\";\r\nimport { Conf, d, g } from \"../globals/globals\";\r\nimport FappeTyme from \"../Images/FappeTyme\";\r\nimport Gallery from \"../Images/Gallery\";\r\nimport ImageExpand from \"../Images/ImageExpand\";\r\nimport Embedding from \"../Linkification/Embedding\";\r\nimport ThreadUpdater from \"../Monitoring/ThreadUpdater\";\r\nimport ThreadWatcher from \"../Monitoring/ThreadWatcher\";\r\nimport UnreadIndex from \"../Monitoring/UnreadIndex\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport QR from \"../Posting/QR\";\r\nimport QuoteThreading from \"../Quotelinks/QuoteThreading\";\r\nimport QuoteYou from \"../Quotelinks/QuoteYou\";\r\nimport CatalogLinks from \"./CatalogLinks\";\r\nimport ExpandThread from \"./ExpandThread\";\r\nimport Nav from \"./Nav\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Keybinds = {\r\n  init() {\r\n    if (!Conf['Keybinds']) { return; }\r\n\r\n    for (var hotkey in Config.hotkeys) {\r\n      $.sync(hotkey, Keybinds.sync);\r\n    }\r\n\r\n    var init = function() {\r\n      $.off(d, '4chanXInitFinished', init);\r\n      $.on(d, 'keydown', Keybinds.keydown);\r\n      for (var node of $$('[accesskey]')) {\r\n        node.removeAttribute('accesskey');\r\n      }\r\n    };\r\n    return $.on(d, '4chanXInitFinished', init);\r\n  },\r\n\r\n  sync(key, hotkey) {\r\n    return Conf[hotkey] = key;\r\n  },\r\n\r\n  keydown(e) {\r\n    let key, thread, threadRoot;\r\n    let catalog, notifications;\r\n    if (!(key = Keybinds.keyCode(e))) { return; }\r\n    const {target} = e;\r\n    if (['INPUT', 'TEXTAREA'].includes(target.nodeName)) {\r\n      if (!/(Esc|Alt|Ctrl|Meta|Shift\\+\\w{2,})/.test(key) || !!/^Alt\\+(\\d|Up|Down|Left|Right)$/.test(key)) { return; }\r\n    }\r\n    if (['index', 'thread'].includes(g.VIEW)) {\r\n      threadRoot = Nav.getThread();\r\n      thread = Get.threadFromRoot(threadRoot);\r\n    }\r\n    switch (key) {\r\n      // QR & Options\r\n      case Conf['Toggle board list']:\r\n        if (!Conf['Custom Board Navigation']) { return; }\r\n        Header.toggleBoardList();\r\n        break;\r\n      case Conf['Toggle header']:\r\n        Header.toggleBarVisibility();\r\n        break;\r\n      case Conf['Open empty QR']:\r\n        if (!QR.postingIsEnabled) { return; }\r\n        Keybinds.qr();\r\n        break;\r\n      case Conf['Open QR']:\r\n        if (!QR.postingIsEnabled || !threadRoot) { return; }\r\n        Keybinds.qr(threadRoot);\r\n        break;\r\n      case Conf['Open settings']:\r\n        Settings.open();\r\n        break;\r\n      case Conf['Close']:\r\n        if (Settings.dialog) {\r\n          Settings.close();\r\n        } else if ((notifications = $$('.notification')).length) {\r\n          for (var notification of notifications) {\r\n            $('.close', notification).click();\r\n          }\r\n        } else if (QR.nodes && !(QR.nodes.el.hidden || (window.getComputedStyle(QR.nodes.form).display === 'none'))) {\r\n          if (Conf['Persistent QR']) {\r\n            QR.hide();\r\n          } else {\r\n            QR.close();\r\n          }\r\n        } else if (Embedding.lastEmbed) {\r\n          Embedding.closeFloat();\r\n        } else {\r\n          return;\r\n        }\r\n        break;\r\n      case Conf['Spoiler tags']:\r\n        if (target.nodeName !== 'TEXTAREA') { return; }\r\n        Keybinds.tags('spoiler', target);\r\n        break;\r\n      case Conf['Code tags']:\r\n        if (target.nodeName !== 'TEXTAREA') { return; }\r\n        Keybinds.tags('code', target);\r\n        break;\r\n      case Conf['Eqn tags']:\r\n        if (target.nodeName !== 'TEXTAREA') { return; }\r\n        Keybinds.tags('eqn', target);\r\n        break;\r\n      case Conf['Math tags']:\r\n        if (target.nodeName !== 'TEXTAREA') { return; }\r\n        Keybinds.tags('math', target);\r\n        break;\r\n      case Conf['SJIS tags']:\r\n        if (target.nodeName !== 'TEXTAREA') { return; }\r\n        Keybinds.tags('sjis', target);\r\n        break;\r\n      case Conf['Toggle sage']:\r\n        if (!QR.nodes || !!QR.nodes.el.hidden) { return; }\r\n        Keybinds.sage();\r\n        break;\r\n      case Conf['Toggle Cooldown']:\r\n        if (!QR.nodes || !!QR.nodes.el.hidden || !$.hasClass(QR.nodes.fileSubmit, 'custom-cooldown')) { return; }\r\n        QR.toggleCustomCooldown();\r\n        break;\r\n      case Conf['Post from URL']:\r\n        if (!QR.postingIsEnabled) { return; }\r\n        QR.handleUrl('');\r\n        break;\r\n      case Conf['Add new post']:\r\n        if (!QR.postingIsEnabled) { return; }\r\n        QR.addPost();\r\n        break;\r\n      case Conf['Submit QR']:\r\n        if (!QR.nodes || !!QR.nodes.el.hidden) { return; }\r\n        if (!QR.status()) { QR.submit(); }\r\n        break;\r\n      // Index/Thread related\r\n      case Conf['Update']:\r\n        switch (g.VIEW) {\r\n          case 'thread':\r\n            if (!ThreadUpdater.enabled) { return; }\r\n            ThreadUpdater.update();\r\n            break;\r\n          case 'index':\r\n            if (!Index.enabled) { return; }\r\n            Index.update();\r\n            break;\r\n          default:\r\n            return;\r\n        }\r\n        break;\r\n      case Conf['Watch']:\r\n        if (!ThreadWatcher.enabled || !thread) { return; }\r\n        ThreadWatcher.toggle(thread);\r\n        break;\r\n      case Conf['Update thread watcher']:\r\n        if (!ThreadWatcher.enabled) { return; }\r\n        ThreadWatcher.buttonFetchAll();\r\n        break;\r\n      case Conf['Toggle thread watcher']:\r\n        if (!ThreadWatcher.enabled) { return; }\r\n        ThreadWatcher.toggleWatcher();\r\n        break;\r\n      case Conf['Toggle threading']:\r\n        if (!QuoteThreading.ready) { return; }\r\n        QuoteThreading.toggleThreading();\r\n        break;\r\n      case Conf['Mark thread read']:\r\n        if ((g.VIEW !== 'index') || !thread || !UnreadIndex.enabled) { return; }\r\n        UnreadIndex.markRead.call(threadRoot);\r\n        break;\r\n      // Images\r\n      case Conf['Expand image']:\r\n        if (!ImageExpand.enabled || !threadRoot) { return; }\r\n        var post = Get.postFromNode(Keybinds.post(threadRoot));\r\n        if (post.file) { ImageExpand.toggle(post); }\r\n        break;\r\n      case Conf['Expand images']:\r\n        if (!ImageExpand.enabled) { return; }\r\n        ImageExpand.cb.toggleAll();\r\n        break;\r\n      case Conf['Open Gallery']:\r\n        if (!Gallery.enabled) { return; }\r\n        Gallery.cb.toggle();\r\n        break;\r\n      case Conf['fappeTyme']:\r\n        if (!FappeTyme.nodes?.fappe) { return; }\r\n        FappeTyme.toggle('fappe');\r\n        break;\r\n      case Conf['werkTyme']:\r\n        if (!FappeTyme.nodes?.werk) { return; }\r\n        FappeTyme.toggle('werk');\r\n        break;\r\n      // Board Navigation\r\n      case Conf['Front page']:\r\n        if (Index.enabled) {\r\n          Index.userPageNav(1);\r\n        } else {\r\n          location.href = `/${g.BOARD}/`;\r\n        }\r\n        break;\r\n      case Conf['Open front page']:\r\n        $.open(`${location.origin}/${g.BOARD}/`);\r\n        break;\r\n      case Conf['Next page']:\r\n        if ((g.VIEW !== 'index') || !!g.SITE.isOnePage?.(g.BOARD)) { return; }\r\n        if (Index.enabled) {\r\n          if (!['paged', 'infinite'].includes(Conf['Index Mode'])) { return; }\r\n          $('.next button', Index.pagelist).click();\r\n        } else {\r\n          $(g.SITE.selectors.nav.next)?.click();\r\n        }\r\n        break;\r\n      case Conf['Previous page']:\r\n        if ((g.VIEW !== 'index') || !!g.SITE.isOnePage?.(g.BOARD)) { return; }\r\n        if (Index.enabled) {\r\n          if (!['paged', 'infinite'].includes(Conf['Index Mode'])) { return; }\r\n          $('.prev button', Index.pagelist).click();\r\n        } else {\r\n          $(g.SITE.selectors.nav.prev)?.click();\r\n        }\r\n        break;\r\n      case Conf['Search form']:\r\n        if (g.VIEW !== 'index') { return; }\r\n        var searchInput = Index.enabled ?\r\n          Index.searchInput\r\n        : g.SITE.selectors.searchBox ?\r\n          $(g.SITE.selectors.searchBox)\r\n        :\r\n          undefined;\r\n        if (!searchInput) { return; }\r\n        Header.scrollToIfNeeded(searchInput);\r\n        searchInput.focus();\r\n        break;\r\n      case Conf['Paged mode']:\r\n        if (!Index.enabledOn(g.BOARD)) { return; }\r\n        location.href = g.VIEW === 'index' ? '#paged' : `/${g.BOARD}/#paged`;\r\n        break;\r\n      case Conf['Infinite scrolling mode']:\r\n        if (!Index.enabledOn(g.BOARD)) { return; }\r\n        location.href = g.VIEW === 'index' ? '#infinite' : `/${g.BOARD}/#infinite`;\r\n        break;\r\n      case Conf['All pages mode']:\r\n        if (!Index.enabledOn(g.BOARD)) { return; }\r\n        location.href = g.VIEW === 'index' ? '#all-pages' : `/${g.BOARD}/#all-pages`;\r\n        break;\r\n      case Conf['Open catalog']:\r\n        if (!(catalog = CatalogLinks.catalog())) { return; }\r\n        location.href = catalog;\r\n        break;\r\n      case Conf['Cycle sort type']:\r\n        if (!Index.enabled) { return; }\r\n        Index.cycleSortType();\r\n        break;\r\n      // Thread Navigation\r\n      case Conf['Next thread']:\r\n        if ((g.VIEW !== 'index') || !threadRoot) { return; }\r\n        Nav.scroll(+1);\r\n        break;\r\n      case Conf['Previous thread']:\r\n        if ((g.VIEW !== 'index') || !threadRoot) { return; }\r\n        Nav.scroll(-1);\r\n        break;\r\n      case Conf['Expand thread']:\r\n        if ((g.VIEW !== 'index') || !threadRoot) { return; }\r\n        ExpandThread.toggle(thread);\r\n        // Keep thread from moving off screen when contracted.\r\n        Header.scrollTo(threadRoot);\r\n        break;\r\n      case Conf['Open thread']:\r\n        if ((g.VIEW !== 'index') || !threadRoot) { return; }\r\n        Keybinds.open(thread);\r\n        break;\r\n      case Conf['Open thread tab']:\r\n        if ((g.VIEW !== 'index') || !threadRoot) { return; }\r\n        Keybinds.open(thread, true);\r\n        break;\r\n      // Reply Navigation\r\n      case Conf['Next reply']:\r\n        if (!threadRoot) { return; }\r\n        Keybinds.hl(+1, threadRoot);\r\n        break;\r\n      case Conf['Previous reply']:\r\n        if (!threadRoot) { return; }\r\n        Keybinds.hl(-1, threadRoot);\r\n        break;\r\n      case Conf['Deselect reply']:\r\n        if (!threadRoot) { return; }\r\n        Keybinds.hl(0, threadRoot);\r\n        break;\r\n      case Conf['Hide']:\r\n        if (!thread || !ThreadHiding.db) { return; }\r\n        Header.scrollTo(threadRoot);\r\n        ThreadHiding.toggle(thread);\r\n        break;\r\n      case Conf['Quick Filter MD5']:\r\n        if (!threadRoot) { return; }\r\n        post = Keybinds.post(threadRoot);\r\n        Keybinds.hl(+1, threadRoot);\r\n        Filter.quickFilterMD5.call(post, e);\r\n        break;\r\n      case Conf['Previous Post Quoting You']:\r\n        if (!threadRoot || !QuoteYou.db) { return; }\r\n        QuoteYou.cb.seek('preceding');\r\n        break;\r\n      case Conf['Next Post Quoting You']:\r\n        if (!threadRoot || !QuoteYou.db) { return; }\r\n        QuoteYou.cb.seek('following');\r\n        break;\r\n      default:\r\n        return;\r\n    }\r\n    e.preventDefault();\r\n    return e.stopPropagation();\r\n  },\r\n\r\n  keyCode(e) {\r\n    let key = (() => { let kc;\r\n    switch ((kc = e.keyCode)) {\r\n      case 8: // return\r\n        return '';\r\n      case 13:\r\n        return 'Enter';\r\n      case 27:\r\n        return 'Esc';\r\n      case 32:\r\n        return 'Space';\r\n      case 37:\r\n        return 'Left';\r\n      case 38:\r\n        return 'Up';\r\n      case 39:\r\n        return 'Right';\r\n      case 40:\r\n        return 'Down';\r\n      case 188:\r\n        return 'Comma';\r\n      case 190:\r\n        return 'Period';\r\n      case 191:\r\n        return 'Slash';\r\n      case 59: case 186:\r\n        return 'Semicolon';\r\n      default:\r\n        if ((48 <= kc && kc <= 57) || (65 <= kc && kc <= 90)) { // 0-9, A-Z\r\n          return String.fromCharCode(kc).toLowerCase();\r\n        } else if (96 <= kc && kc <= 105) { // numpad 0-9\r\n          return String.fromCharCode(kc - 48).toLowerCase();\r\n        } else {\r\n          return null;\r\n        }\r\n    } })();\r\n    if (key) {\r\n      if (e.altKey) {   key = 'Alt+'   + key; }\r\n      if (e.ctrlKey) {  key = 'Ctrl+'  + key; }\r\n      if (e.metaKey) {  key = 'Meta+'  + key; }\r\n      if (e.shiftKey) { key = 'Shift+' + key; }\r\n    }\r\n    return key;\r\n  },\r\n\r\n  post(thread) {\r\n    const s = g.SITE.selectors;\r\n    return (\r\n      $(`${s.postContainer}${s.highlightable.reply}.${g.SITE.classes.highlight}`, thread) ||\r\n      $(`${g.SITE.isOPContainerThread ? s.thread : s.postContainer}${s.highlightable.op}`, thread)\r\n    );\r\n  },\r\n\r\n  qr(thread) {\r\n    QR.open();\r\n    if (thread != null) {\r\n      QR.quote.call(Keybinds.post(thread));\r\n    }\r\n    return QR.nodes.com.focus();\r\n  },\r\n\r\n  tags(tag, ta) {\r\n    BoardConfig.ready(function() {\r\n      const {config} = g.BOARD;\r\n      const supported = (() => { switch (tag) {\r\n        case 'spoiler':     return !!config.spoilers;\r\n        case 'code':        return !!config.code_tags;\r\n        case 'math': case 'eqn': return !!config.math_tags;\r\n        case 'sjis':        return !!config.sjis_tags;\r\n      } })();\r\n      if (!supported) { return new Notice('warning', `[${tag}] tags are not supported on /${g.BOARD}/.`, 20); }\r\n    });\r\n\r\n    const {\r\n      value\r\n    } = ta;\r\n    const selStart = ta.selectionStart;\r\n    const selEnd   = ta.selectionEnd;\r\n\r\n    ta.value =\r\n      value.slice(0, selStart) +\r\n      `[${tag}]` + value.slice(selStart, selEnd) + `[/${tag}]` +\r\n      value.slice(selEnd);\r\n\r\n    // Move the caret to the end of the selection.\r\n    const range = (`[${tag}]`).length + selEnd;\r\n    ta.setSelectionRange(range, range);\r\n\r\n    // Fire the 'input' event\r\n    return $.event('input', null, ta);\r\n  },\r\n\r\n  sage() {\r\n    const isSage  = /sage/i.test(QR.nodes.email.value);\r\n    return QR.nodes.email.value = isSage ?\r\n      \"\"\r\n    : \"sage\";\r\n  },\r\n\r\n  open(thread, tab) {\r\n    if (g.VIEW !== 'index') { return; }\r\n    const url = Get.url('thread', thread);\r\n    if (tab) {\r\n      return $.open(url);\r\n    } else {\r\n      return location.href = url;\r\n    }\r\n  },\r\n\r\n  hl(delta, thread) {\r\n    const replySelector = `${g.SITE.selectors.postContainer}${g.SITE.selectors.highlightable.reply}`;\r\n    const {highlight} = g.SITE.classes;\r\n\r\n    const postEl = $(`${replySelector}.${highlight}`, thread);\r\n\r\n    if (!delta) {\r\n      if (postEl) { $.rmClass(postEl, highlight); }\r\n      return;\r\n    }\r\n\r\n    if (postEl) {\r\n      const {height} = postEl.getBoundingClientRect();\r\n      if ((Header.getTopOf(postEl) >= -height) && (Header.getBottomOf(postEl) >= -height)) { // We're at least partially visible\r\n        let next;\r\n        const {root} = Get.postFromNode(postEl).nodes;\r\n        const axis = delta === +1 ?\r\n          'following'\r\n        :\r\n          'preceding';\r\n        if (!(next = $.x(`${axis}-sibling::${g.SITE.xpath.replyContainer}[not(@hidden) and not(child::div[@class='stub'])][1]`, root))) { return; }\r\n        if (!next.matches(replySelector)) { next = $(replySelector, next); }\r\n        Header.scrollToIfNeeded(next, delta === +1);\r\n        $.addClass(next, highlight);\r\n        $.rmClass(postEl, highlight);\r\n        return;\r\n      }\r\n      $.rmClass(postEl, highlight);\r\n    }\r\n\r\n    const replies = $$(replySelector, thread);\r\n    if (delta === -1) { replies.reverse(); }\r\n    for (var reply of replies) {\r\n      if (((delta === +1) && (Header.getTopOf(reply) > 0)) || ((delta === -1) && (Header.getBottomOf(reply) > 0))) {\r\n        $.addClass(reply, highlight);\r\n        return;\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default Keybinds;\r\n","import $ from \"../platform/$\";\r\nimport CaptchaReplace from \"./Captcha.replace\";\r\nimport CaptchaT from \"./Captcha.t\";\r\nimport meta from '../../package.json';\r\nimport Main from \"../main/Main\";\r\nimport Keybinds from \"../Miscellaneous/Keybinds\";\r\nimport $$ from \"../platform/$$\";\r\nimport QR from \"./QR\";\r\nimport { Conf, d } from \"../globals/globals\";\r\nimport { MINUTE, SECOND } from \"../platform/helpers\";\r\n\r\nconst Captcha = {\r\n  Cache: {\r\n    init() {\r\n      $.on(d, 'SaveCaptcha', e => {\r\n        return this.saveAPI(e.detail);\r\n      });\r\n      return $.on(d, 'NoCaptcha', e => {\r\n        return this.noCaptcha(e.detail);\r\n      });\r\n    },\r\n\r\n    captchas: [],\r\n\r\n    getCount() {\r\n      return this.captchas.length;\r\n    },\r\n\r\n    neededRaw() {\r\n      return !(\r\n        this.haveCookie() || this.captchas.length || QR.req || this.submitCB\r\n      ) && (\r\n          (QR.posts.length > 1) || Conf['Auto-load captcha'] || !QR.posts[0].isOnlyQuotes() || QR.posts[0].file\r\n        );\r\n    },\r\n\r\n    needed() {\r\n      return this.neededRaw() && $.event('LoadCaptcha');\r\n    },\r\n\r\n    prerequest() {\r\n      if (!Conf['Prerequest Captcha']) { return; }\r\n      // Post count temporarily off by 1 when called from QR.post.rm, QR.close, or QR.submit\r\n      return $.queueTask(() => {\r\n        if (\r\n          !this.prerequested &&\r\n          this.neededRaw() &&\r\n          !$.event('LoadCaptcha') &&\r\n          !QR.captcha.occupied() &&\r\n          (QR.cooldown.seconds <= 60) &&\r\n          (QR.selected === QR.posts[QR.posts.length - 1]) &&\r\n          !QR.selected.isOnlyQuotes()\r\n        ) {\r\n          const isReply = (QR.selected.thread !== 'new');\r\n          if (!$.event('RequestCaptcha', { isReply })) {\r\n            this.prerequested = true;\r\n            this.submitCB = captcha => {\r\n              if (captcha) { return this.save(captcha); }\r\n            };\r\n            return this.updateCount();\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    haveCookie() {\r\n      return /\\b_ct=/.test(d.cookie) && (QR.posts[0].thread !== 'new');\r\n    },\r\n\r\n    getOne() {\r\n      let captcha;\r\n      delete this.prerequested;\r\n      this.clear();\r\n      if (captcha = this.captchas.shift()) {\r\n        this.count();\r\n        return captcha;\r\n      } else {\r\n        return null;\r\n      }\r\n    },\r\n\r\n    request(isReply) {\r\n      if (!this.submitCB) {\r\n        if ($.event('RequestCaptcha', { isReply })) { return; }\r\n      }\r\n      return cb => {\r\n        this.submitCB = cb;\r\n        return this.updateCount();\r\n      };\r\n    },\r\n\r\n    abort() {\r\n      if (this.submitCB) {\r\n        delete this.submitCB;\r\n        $.event('AbortCaptcha');\r\n        return this.updateCount();\r\n      }\r\n    },\r\n\r\n    saveAPI(captcha) {\r\n      let cb;\r\n      if (cb = this.submitCB) {\r\n        delete this.submitCB;\r\n        cb(captcha);\r\n        return this.updateCount();\r\n      } else {\r\n        return this.save(captcha);\r\n      }\r\n    },\r\n\r\n    noCaptcha(detail) {\r\n      let cb;\r\n      if (cb = this.submitCB) {\r\n        if (!this.haveCookie() || detail?.error) {\r\n          QR.error(detail?.error || 'Failed to retrieve captcha.');\r\n          QR.captcha.setup(d.activeElement === QR.nodes.status);\r\n        }\r\n        delete this.submitCB;\r\n        cb();\r\n        return this.updateCount();\r\n      }\r\n    },\r\n\r\n    save(captcha) {\r\n      let cb;\r\n      if (cb = this.submitCB) {\r\n        this.abort();\r\n        cb(captcha);\r\n        return;\r\n      }\r\n      this.captchas.push(captcha);\r\n      this.captchas.sort((a, b) => a.timeout - b.timeout);\r\n      return this.count();\r\n    },\r\n\r\n    clear() {\r\n      if (this.captchas.length) {\r\n        let i;\r\n        const now = Date.now();\r\n        for (i = 0; i < this.captchas.length; i++) {\r\n          var captcha = this.captchas[i];\r\n          if (captcha.timeout > now) { break; }\r\n        }\r\n        if (i) {\r\n          this.captchas = this.captchas.slice(i);\r\n          return this.count();\r\n        }\r\n      }\r\n    },\r\n\r\n    count() {\r\n      clearTimeout(this.timer);\r\n      if (this.captchas.length) {\r\n        this.timer = setTimeout(this.clear.bind(this), this.captchas[0].timeout - Date.now());\r\n      }\r\n      return this.updateCount();\r\n    },\r\n\r\n    updateCount() {\r\n      return $.event('CaptchaCount', this.captchas.length);\r\n    }\r\n  }, Replace: CaptchaReplace, t: CaptchaT, v2: {\r\n    lifetime: 2 * MINUTE,\r\n\r\n    init() {\r\n      if (d.cookie.indexOf('pass_enabled=1') >= 0) { return; }\r\n      if (!(this.isEnabled = !!$('#g-recaptcha, #captcha-forced-noscript') || !$.id('postForm'))) { return; }\r\n\r\n      if (this.noscript = Conf['Force Noscript Captcha'] || !Main.jsEnabled) {\r\n        $.addClass(QR.nodes.el, 'noscript-captcha');\r\n      }\r\n\r\n      Captcha.cache.init();\r\n      $.on(d, 'CaptchaCount', this.count.bind(this));\r\n\r\n      const root = $.el('div', { className: 'captcha-root' });\r\n      $.extend(root, {\r\n        innerHTML:\r\n          '<div class=\"captcha-counter\"><a href=\"javascript:;\"></a></div>'\r\n      }\r\n      );\r\n      const counter = $('.captcha-counter > a', root);\r\n      this.nodes = { root, counter };\r\n      this.count();\r\n      $.addClass(QR.nodes.el, 'has-captcha', 'captcha-v2');\r\n      $.after(QR.nodes.com.parentNode, root);\r\n\r\n      $.on(counter, 'click', this.toggle.bind(this));\r\n      $.on(counter, 'keydown', e => {\r\n        if (Keybinds.keyCode(e) !== 'Space') { return; }\r\n        this.toggle();\r\n        e.preventDefault();\r\n        return e.stopPropagation();\r\n      });\r\n      return $.on(window, 'captcha:success', () => {\r\n        // XXX Greasemonkey 1.x workaround to gain access to GM_* functions.\r\n        return $.queueTask(() => this.save(false));\r\n      });\r\n    },\r\n\r\n    timeouts: {},\r\n    prevNeeded: 0,\r\n\r\n    noscriptURL() {\r\n      let lang;\r\n      let url = `https://www.google.com/recaptcha/api/fallback?k=${meta.recaptchaKey}`;\r\n      if (lang = Conf['captchaLanguage'].trim()) {\r\n        url += `&hl=${encodeURIComponent(lang)}`;\r\n      }\r\n      return url;\r\n    },\r\n\r\n    moreNeeded() {\r\n      // Post count temporarily off by 1 when called from QR.post.rm, QR.close, or QR.submit\r\n      return $.queueTask(() => {\r\n        const needed = Captcha.cache.needed();\r\n        if (needed && !this.prevNeeded) {\r\n          this.setup(QR.cooldown.auto && (d.activeElement === QR.nodes.status));\r\n        }\r\n        return this.prevNeeded = needed;\r\n      });\r\n    },\r\n\r\n    toggle() {\r\n      if (this.nodes.container && !this.timeouts.destroy) {\r\n        return this.destroy();\r\n      } else {\r\n        return this.setup(true, true);\r\n      }\r\n    },\r\n\r\n    setup(focus, force) {\r\n      if (!this.isEnabled || (!Captcha.cache.needed() && !force)) { return; }\r\n\r\n      if (focus) {\r\n        $.addClass(QR.nodes.el, 'focus');\r\n        this.nodes.counter.focus();\r\n      }\r\n\r\n      if (this.timeouts.destroy) {\r\n        clearTimeout(this.timeouts.destroy);\r\n        delete this.timeouts.destroy;\r\n        return this.reload();\r\n      }\r\n\r\n      if (this.nodes.container) {\r\n        // XXX https://bugzilla.mozilla.org/show_bug.cgi?id=1226835\r\n        $.queueTask(() => {\r\n          let iframe;\r\n          if (this.nodes.container && (d.activeElement === this.nodes.counter) && (iframe = $('iframe[src^=\"https://www.google.com/recaptcha/\"]', this.nodes.container))) {\r\n            iframe.focus();\r\n            return QR.focus();\r\n          }\r\n        }); // Event handler not fired in Firefox\r\n        return;\r\n      }\r\n\r\n      this.nodes.container = $.el('div', { className: 'captcha-container' });\r\n      $.prepend(this.nodes.root, this.nodes.container);\r\n      new MutationObserver(this.afterSetup.bind(this)).observe(this.nodes.container, {\r\n        childList: true,\r\n        subtree: true\r\n      }\r\n      );\r\n\r\n      if (this.noscript) {\r\n        return this.setupNoscript();\r\n      } else {\r\n        return this.setupJS();\r\n      }\r\n    },\r\n\r\n    setupNoscript() {\r\n      const iframe = $.el('iframe', {\r\n        id: 'qr-captcha-iframe',\r\n        scrolling: 'no',\r\n        src: this.noscriptURL()\r\n      }\r\n      );\r\n      const div = $.el('div');\r\n      const textarea = $.el('textarea');\r\n      $.add(div, textarea);\r\n      return $.add(this.nodes.container, [iframe, div]);\r\n    },\r\n\r\n    setupJS() {\r\n      return $.global(function () {\r\n        const render = function () {\r\n          const { classList } = document.documentElement;\r\n          const container = document.querySelector('#qr .captcha-container');\r\n          return container.dataset.widgetID = window.grecaptcha.render(container, {\r\n            sitekey: meta.recaptchaKey,\r\n            theme: classList.contains('tomorrow') || classList.contains('spooky') || classList.contains('dark-captcha') ? 'dark' : 'light',\r\n            callback(response) {\r\n              return window.dispatchEvent(new CustomEvent('captcha:success', { detail: response }));\r\n            }\r\n          }\r\n          );\r\n        };\r\n        if (window.grecaptcha) {\r\n          return render();\r\n        } else {\r\n          const cbNative = window.onRecaptchaLoaded;\r\n          window.onRecaptchaLoaded = function () {\r\n            render();\r\n            return cbNative();\r\n          };\r\n          if (!document.head.querySelector('script[src^=\"https://www.google.com/recaptcha/api.js\"]')) {\r\n            const script = document.createElement('script');\r\n            script.src = 'https://www.google.com/recaptcha/api.js?onload=onRecaptchaLoaded&render=explicit';\r\n            return document.head.appendChild(script);\r\n          }\r\n        }\r\n      });\r\n    },\r\n\r\n    afterSetup(mutations) {\r\n      for (var mutation of mutations) {\r\n        for (var node of mutation.addedNodes) {\r\n          var iframe, textarea;\r\n          if (iframe = $.x('./descendant-or-self::iframe[starts-with(@src, \"https://www.google.com/recaptcha/\")]', node)) { this.setupIFrame(iframe); }\r\n          if (textarea = $.x('./descendant-or-self::textarea', node)) { this.setupTextArea(textarea); }\r\n        }\r\n      }\r\n    },\r\n\r\n    setupIFrame(iframe) {\r\n      let needle;\r\n      if (!doc.contains(iframe)) { return; }\r\n      Captcha.replace.iframe(iframe);\r\n      $.addClass(QR.nodes.el, 'captcha-open');\r\n      this.fixQRPosition();\r\n      $.on(iframe, 'load', this.fixQRPosition);\r\n      if (d.activeElement === this.nodes.counter) { iframe.focus(); }\r\n      // XXX Make sure scroll on space prevention (see src/css/style.css) doesn't cause scrolling of div\r\n      if (['blink', 'edge'].includes($.engine) && (needle = iframe.parentNode, $$('#qr .captcha-container > div > div:first-of-type').includes(needle))) {\r\n        return $.on(iframe.parentNode, 'scroll', function () { return this.scrollTop = 0; });\r\n      }\r\n    },\r\n\r\n    fixQRPosition() {\r\n      if (QR.nodes.el.getBoundingClientRect().bottom > doc.clientHeight) {\r\n        QR.nodes.el.style.top = '';\r\n        return QR.nodes.el.style.bottom = '0px';\r\n      }\r\n    },\r\n\r\n    setupTextArea(textarea) {\r\n      return $.one(textarea, 'input', () => this.save(true));\r\n    },\r\n\r\n    destroy() {\r\n      if (!this.isEnabled) { return; }\r\n      delete this.timeouts.destroy;\r\n      $.rmClass(QR.nodes.el, 'captcha-open');\r\n      if (this.nodes.container) {\r\n        $.global(function () {\r\n          const container = document.querySelector('#qr .captcha-container');\r\n          return window.grecaptcha.reset(container.dataset.widgetID);\r\n        });\r\n        $.rm(this.nodes.container);\r\n        return delete this.nodes.container;\r\n      }\r\n    },\r\n\r\n    getOne(isReply) {\r\n      return Captcha.cache.getOne(isReply);\r\n    },\r\n\r\n    save(pasted, token) {\r\n      Captcha.cache.save({\r\n        response: token || $('textarea', this.nodes.container).value,\r\n        timeout: Date.now() + this.lifetime\r\n      });\r\n\r\n      const focus = (d.activeElement?.nodeName === 'IFRAME') && /https?:\\/\\/www\\.google\\.com\\/recaptcha\\//.test(d.activeElement.src);\r\n      if (Captcha.cache.needed()) {\r\n        if (focus) {\r\n          if (QR.cooldown.auto || Conf['Post on Captcha Completion']) {\r\n            this.nodes.counter.focus();\r\n          } else {\r\n            QR.nodes.status.focus();\r\n          }\r\n        }\r\n        this.reload();\r\n      } else {\r\n        if (pasted) {\r\n          this.destroy();\r\n        } else {\r\n          if (this.timeouts.destroy == null) { this.timeouts.destroy = setTimeout(this.destroy.bind(this), 3 * SECOND); }\r\n        }\r\n        if (focus) { QR.nodes.status.focus(); }\r\n      }\r\n\r\n      if (Conf['Post on Captcha Completion'] && !QR.cooldown.auto) { return QR.submit(); }\r\n    },\r\n\r\n    count() {\r\n      const count = Captcha.cache.getCount();\r\n      const loading = Captcha.cache.submitCB ? '...' : '';\r\n      this.nodes.counter.textContent = `Captchas: ${count}${loading}`;\r\n      return this.moreNeeded();\r\n    },\r\n\r\n    reload() {\r\n      if ($('iframe[src^=\"https://www.google.com/recaptcha/api/fallback?\"]', this.nodes.container)) {\r\n        this.destroy();\r\n        return this.setup(false, true);\r\n      } else {\r\n        return $.global(function () {\r\n          const container = document.querySelector('#qr .captcha-container');\r\n          return window.grecaptcha.reset(container.dataset.widgetID);\r\n        });\r\n      }\r\n    },\r\n\r\n    occupied() {\r\n      return !!this.nodes.container && !this.timeouts.destroy;\r\n    }\r\n  }\r\n};\r\nexport default Captcha;\r\n","import QuickReplyPage from './QR/QuickReply.html';\r\nimport $ from '../platform/$';\r\nimport Callbacks from '../classes/Callbacks';\r\nimport Notice from '../classes/Notice';\r\nimport Main from '../main/Main';\r\nimport Favicon from '../Monitoring/Favicon';\r\nimport $$ from '../platform/$$';\r\nimport CrossOrigin from '../platform/CrossOrigin';\r\nimport Captcha from './Captcha';\r\nimport meta from '../../package.json';\r\nimport Header from '../General/Header';\r\nimport { Conf, E, d, doc, g } from '../globals/globals';\r\nimport Menu from '../Menu/Menu';\r\nimport UI from '../General/UI';\r\nimport BoardConfig from '../General/BoardConfig';\r\nimport Get from '../General/Get';\r\nimport { DAY, dict, SECOND } from '../platform/helpers';\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS202: Simplify dynamic range loops\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n\r\nvar QR = {\r\n  mimeTypes: ['image/jpeg', 'image/png', 'image/gif', 'application/pdf', 'application/vnd.adobe.flash.movie', 'application/x-shockwave-flash', 'video/webm'],\r\n\r\n  validExtension: /\\.(jpe?g|png|gif|pdf|swf|webm)$/i,\r\n\r\n  typeFromExtension: {\r\n    'jpg':  'image/jpeg',\r\n    'jpeg': 'image/jpeg',\r\n    'png':  'image/png',\r\n    'gif':  'image/gif',\r\n    'pdf':  'application/pdf',\r\n    'swf':  'application/vnd.adobe.flash.movie',\r\n    'webm': 'video/webm'\r\n  },\r\n\r\n  extensionFromType: {\r\n    'image/jpeg': 'jpg',\r\n    'image/png': 'png',\r\n    'image/gif': 'gif',\r\n    'application/pdf': 'pdf',\r\n    'application/vnd.adobe.flash.movie': 'swf',\r\n    'application/x-shockwave-flash': 'swf',\r\n    'video/webm': 'webm'\r\n  },\r\n\r\n  init() {\r\n    let sc;\r\n    if (!Conf['Quick Reply']) { return; }\r\n\r\n    this.posts = [];\r\n\r\n    $.on(d, '4chanXInitFinished', () => BoardConfig.ready(QR.initReady));\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Quick Reply',\r\n      cb:   this.node\r\n    });\r\n\r\n    this.shortcut = (sc = $.el('a', {\r\n      className: 'disabled',\r\n      textContent: '',\r\n      title: 'Quick Reply',\r\n      href: 'javascript:;'\r\n    }\r\n    ));\r\n    $.on(sc, 'click', function() {\r\n      if (!QR.postingIsEnabled) { return; }\r\n      if (Conf['Persistent QR'] || !QR.nodes || QR.nodes.el.hidden) {\r\n        QR.open();\r\n        return QR.nodes.com.focus();\r\n      } else {\r\n        return QR.close();\r\n      }\r\n    });\r\n\r\n    return Header.addShortcut('qr', sc, 540);\r\n  },\r\n\r\n  initReady() {\r\n    let origToggle;\r\n    const captchaVersion = $('#g-recaptcha, #captcha-forced-noscript') ? 'v2' : 't';\r\n    QR.captcha = Captcha[captchaVersion];\r\n    QR.postingIsEnabled = true;\r\n\r\n    const {config} = g.BOARD;\r\n    const prop = (key, def) => +(config[key] ?? def);\r\n\r\n    QR.min_width  = prop('min_image_width',  1);\r\n    QR.min_height = prop('min_image_height', 1);\r\n    QR.max_width  = (QR.max_height = 10000);\r\n\r\n    QR.max_size       = prop('max_filesize',      4194304);\r\n    QR.max_size_video = prop('max_webm_filesize', QR.max_size);\r\n    QR.max_comment    = prop('max_comment_chars', 2000);\r\n\r\n    QR.max_width_video = (QR.max_height_video = 2048);\r\n    QR.max_duration_video = prop('max_webm_duration', 120);\r\n\r\n    QR.forcedAnon = !!config.forced_anon;\r\n    QR.spoiler    = !!config.spoilers;\r\n\r\n    if (origToggle = $.id('togglePostFormLink')) {\r\n      const link = $.el('h1',\r\n        {className: \"qr-link-container\"});\r\n      $.extend(link, {\r\n        innerHTML:\r\n          `<a href=\"javascript:;\" class=\"qr-link\">${g.VIEW === \"thread\" ? \"Reply to Thread\" : \"Start a Thread\"}</a>`\r\n      });\r\n\r\n      QR.link = link.firstElementChild;\r\n      $.on(link.firstChild, 'click', function() {\r\n        QR.open();\r\n        return QR.nodes.com.focus();\r\n      });\r\n\r\n      $.before(origToggle, link);\r\n      origToggle.firstElementChild.textContent = 'Original Form';\r\n    }\r\n\r\n    if (g.VIEW === 'thread') {\r\n      let navLinksBot;\r\n      const linkBot = $.el('div',\r\n        {className: \"brackets-wrap qr-link-container-bottom\"});\r\n      $.extend(linkBot, {innerHTML: '<a href=\"javascript:;\" class=\"qr-link-bottom\">Reply to Thread</a>'});\r\n\r\n      $.on(linkBot.firstElementChild, 'click', function() {\r\n        QR.open();\r\n        return QR.nodes.com.focus();\r\n      });\r\n\r\n      if (navLinksBot = $('.navLinksBot')) { $.prepend(navLinksBot, linkBot); }\r\n    }\r\n\r\n    $.on(d, 'QRGetFile',          QR.getFile);\r\n    $.on(d, 'QRDrawFile',         QR.drawFile);\r\n    $.on(d, 'QRSetFile',          QR.setFile);\r\n\r\n    $.on(d, 'paste',              QR.paste);\r\n    $.on(d, 'dragover',           QR.dragOver);\r\n    $.on(d, 'drop',               QR.dropFile);\r\n    $.on(d, 'dragstart dragend',  QR.drag);\r\n\r\n    $.on(d, 'IndexRefreshInternal', QR.generatePostableThreadsList);\r\n    $.on(d, 'ThreadUpdate', QR.statusCheck);\r\n\r\n    if (!Conf['Persistent QR']) { return; }\r\n    QR.open();\r\n    if (Conf['Auto Hide QR']) { return QR.hide(); }\r\n  },\r\n\r\n  statusCheck() {\r\n    if (!QR.nodes) { return; }\r\n    const {thread} = QR.posts[0];\r\n    if ((thread !== 'new') && g.threads.get(`${g.BOARD}.${thread}`).isDead) {\r\n      return QR.abort();\r\n    } else {\r\n      return QR.status();\r\n    }\r\n  },\r\n\r\n  node() {\r\n    $.on(this.nodes.quote, 'click', QR.quote);\r\n    if (this.isFetchedQuote) { return QR.generatePostableThreadsList(); }\r\n  },\r\n\r\n  open() {\r\n    if (QR.nodes) {\r\n      if (QR.nodes.el.hidden) { QR.captcha.setup(); }\r\n      QR.nodes.el.hidden = false;\r\n      QR.unhide();\r\n    } else {\r\n      try {\r\n        QR.dialog();\r\n      } catch (err) {\r\n        delete QR.nodes;\r\n        Main.handleErrors({\r\n          message: 'Quick Reply dialog creation crashed.',\r\n          error: err\r\n        });\r\n        return;\r\n      }\r\n    }\r\n    return $.rmClass(QR.shortcut, 'disabled');\r\n  },\r\n\r\n  close() {\r\n    if (QR.req) {\r\n      QR.abort();\r\n      return;\r\n    }\r\n    QR.nodes.el.hidden = true;\r\n    QR.cleanNotifications();\r\n    QR.blur();\r\n    $.rmClass(QR.nodes.el, 'dump');\r\n    $.addClass(QR.shortcut, 'disabled');\r\n    new QR.post(true);\r\n    for (var post of QR.posts.splice(0, QR.posts.length - 1)) {\r\n      post.delete();\r\n    }\r\n    QR.cooldown.auto = false;\r\n    QR.status();\r\n    return QR.captcha.destroy();\r\n  },\r\n\r\n  focus() {\r\n    return $.queueTask(function() {\r\n      if (!QR.inBubble()) {\r\n        QR.hasFocus = d.activeElement && QR.nodes.el.contains(d.activeElement);\r\n        return QR.nodes.el.classList.toggle('focus', QR.hasFocus);\r\n      }\r\n    });\r\n  },\r\n\r\n  inBubble() {\r\n    const bubbles = $$('iframe[src^=\"https://www.google.com/recaptcha/api2/frame\"]');\r\n    return bubbles.includes(d.activeElement) || bubbles.some(el => (getComputedStyle(el).visibility !== 'hidden') && (el.getBoundingClientRect().bottom > 0));\r\n  },\r\n\r\n  hide() {\r\n    QR.blur();\r\n    $.addClass(QR.nodes.el, 'autohide');\r\n    return QR.nodes.autohide.checked = true;\r\n  },\r\n\r\n  unhide() {\r\n    $.rmClass(QR.nodes.el, 'autohide');\r\n    return QR.nodes.autohide.checked = false;\r\n  },\r\n\r\n  toggleHide() {\r\n    if (this.checked) {\r\n      return QR.hide();\r\n    } else {\r\n      return QR.unhide();\r\n    }\r\n  },\r\n\r\n  blur() {\r\n    if (QR.nodes.el.contains(d.activeElement)) { return d.activeElement.blur(); }\r\n  },\r\n\r\n  toggleSJIS(e) {\r\n    e.preventDefault();\r\n    Conf['sjisPreview'] = !Conf['sjisPreview'];\r\n    $.set('sjisPreview', Conf['sjisPreview']);\r\n    return QR.nodes.el.classList.toggle('sjis-preview', Conf['sjisPreview']);\r\n  },\r\n\r\n  texPreviewShow() {\r\n    if ($.hasClass(QR.nodes.el, 'tex-preview')) { return QR.texPreviewHide(); }\r\n    $.addClass(QR.nodes.el, 'tex-preview');\r\n    QR.nodes.texPreview.textContent = QR.nodes.com.value;\r\n    return $.event('mathjax', null, QR.nodes.texPreview);\r\n  },\r\n\r\n  texPreviewHide() {\r\n    return $.rmClass(QR.nodes.el, 'tex-preview');\r\n  },\r\n\r\n  addPost() {\r\n    const wasOpen = (QR.nodes && !QR.nodes.el.hidden);\r\n    QR.open();\r\n    if (wasOpen) {\r\n      $.addClass(QR.nodes.el, 'dump');\r\n      new QR.post(true);\r\n    }\r\n    return QR.nodes.com.focus();\r\n  },\r\n\r\n  setCustomCooldown(enabled) {\r\n    Conf['customCooldownEnabled'] = enabled;\r\n    QR.cooldown.customCooldown = enabled;\r\n    return QR.nodes.customCooldown.classList.toggle('disabled', !enabled);\r\n  },\r\n\r\n  toggleCustomCooldown() {\r\n    const enabled = $.hasClass(QR.nodes.customCooldown, 'disabled');\r\n    QR.setCustomCooldown(enabled);\r\n    return $.set('customCooldownEnabled', enabled);\r\n  },\r\n\r\n  error(err, focusOverride) {\r\n    let el;\r\n    QR.open();\r\n    if (typeof err === 'string') {\r\n      el = $.tn(err);\r\n    } else {\r\n      el = err;\r\n      el.removeAttribute('style');\r\n    }\r\n    const notice = new Notice('warning', el);\r\n    QR.notifications.push(notice);\r\n    if (!Header.areNotificationsEnabled) {\r\n      if (d.hidden && !QR.cooldown.auto) { return alert(el.textContent); }\r\n    } else if (d.hidden || !(focusOverride || d.hasFocus())) {\r\n      const notif = new Notification(el.textContent, {\r\n        body: el.textContent,\r\n        icon: Favicon.logo\r\n      }\r\n      );\r\n      notif.onclick = () => window.focus();\r\n      if ($.engine !== 'gecko') {\r\n        // Firefox automatically closes notifications\r\n        // so we can't control the onclose properly.\r\n        notif.onclose = () => notice.close();\r\n        return notif.onshow  = () => setTimeout(function() {\r\n          notif.onclose = null;\r\n          return notif.close();\r\n        }\r\n        , 7 * SECOND);\r\n      }\r\n    }\r\n  },\r\n\r\n  connectionError() {\r\n    return $.el('span',\r\n      { innerHTML:\r\n        'Connection error while posting. ' +\r\n        '[<a href=\"' + meta.faq + '#connection-errors\" target=\"_blank\">More info</a>]'\r\n      }\r\n    );\r\n  },\r\n\r\n  notifications: [],\r\n\r\n  cleanNotifications() {\r\n    for (var notification of QR.notifications) {\r\n      notification.close();\r\n    }\r\n    return QR.notifications = [];\r\n  },\r\n\r\n  status() {\r\n    let disabled, value;\r\n    if (!QR.nodes) { return; }\r\n    const {thread} = QR.posts[0];\r\n    if ((thread !== 'new') && g.threads.get(`${g.BOARD}.${thread}`).isDead) {\r\n      value    = 'Dead';\r\n      disabled = true;\r\n      QR.cooldown.auto = false;\r\n    }\r\n\r\n    value = QR.req ?\r\n      QR.req.progress\r\n    :\r\n      QR.cooldown.seconds || value;\r\n\r\n    const {status} = QR.nodes;\r\n    status.value = !value ?\r\n      'Submit'\r\n    : QR.cooldown.auto ?\r\n      `Auto ${value}`\r\n    :\r\n      value;\r\n    return status.disabled = disabled || false;\r\n  },\r\n\r\n  openPost() {\r\n    QR.open();\r\n    if (QR.selected.isLocked) {\r\n      const index = QR.posts.indexOf(QR.selected);\r\n      (QR.posts[index+1] || new QR.post()).select();\r\n      $.addClass(QR.nodes.el, 'dump');\r\n      return QR.cooldown.auto = true;\r\n    }\r\n  },\r\n\r\n  quote(e) {\r\n    let range;\r\n    e?.preventDefault();\r\n    if (!QR.postingIsEnabled) { return; }\r\n    const sel  = d.getSelection();\r\n    const post = Get.postFromNode(this);\r\n    const {root} = post.nodes;\r\n    const postRange = new Range();\r\n    postRange.selectNode(root);\r\n    let text = post.board.ID === g.BOARD.ID ? `>>${post}\\n` : `>>>/${post.board}/${post}\\n`;\r\n    for (let i = 0, end = sel.rangeCount, asc = 0 <= end; asc ? i < end : i > end; asc ? i++ : i--) {\r\n      try {\r\n        var insideCode, node;\r\n        range = sel.getRangeAt(i);\r\n        // Trim range to be fully inside post\r\n        if (range.compareBoundaryPoints(Range.START_TO_START, postRange) < 0) {\r\n          range.setStartBefore(root);\r\n        }\r\n        if (range.compareBoundaryPoints(Range.END_TO_END, postRange) > 0) {\r\n          range.setEndAfter(root);\r\n        }\r\n\r\n        if (!range.toString().trim()) { continue; }\r\n\r\n        var frag  = range.cloneContents();\r\n        var ancestor = range.commonAncestorContainer;\r\n        // Quoting the insides of a spoiler/code tag.\r\n        if ($.x('ancestor-or-self::*[self::s or contains(@class,\"removed-spoiler\")]', ancestor)) {\r\n          $.prepend(frag, $.tn('[spoiler]'));\r\n          $.add(frag, $.tn('[/spoiler]'));\r\n        }\r\n        if (insideCode = $.x('ancestor-or-self::pre[contains(@class,\"prettyprint\")]', ancestor)) {\r\n          $.prepend(frag, $.tn('[code]'));\r\n          $.add(frag, $.tn('[/code]'));\r\n        }\r\n        for (node of $$((insideCode ? 'br' : '.prettyprint br'), frag)) {\r\n          $.replace(node, $.tn('\\n'));\r\n        }\r\n        for (node of $$('br', frag)) {\r\n          if (node !== frag.lastChild) { $.replace(node, $.tn('\\n>')); }\r\n        }\r\n        g.SITE.insertTags?.(frag);\r\n        for (node of $$('.linkify[data-original]', frag)) {\r\n          $.replace(node, $.tn(node.dataset.original));\r\n        }\r\n        for (node of $$('.embedder', frag)) {\r\n          if (node.previousSibling?.nodeValue === ' ') { $.rm(node.previousSibling); }\r\n          $.rm(node);\r\n        }\r\n        text += `>${frag.textContent.trim()}\\n`;\r\n      } catch (error) { }\r\n    }\r\n\r\n    QR.openPost();\r\n    const {com, thread} = QR.nodes;\r\n    if (!com.value) { thread.value = Get.threadFromNode(this); }\r\n\r\n    const wasOnlyQuotes = QR.selected.isOnlyQuotes();\r\n\r\n    const caretPos = com.selectionStart;\r\n    // Replace selection for text.\r\n    com.value = com.value.slice(0, caretPos) + text + com.value.slice(com.selectionEnd);\r\n    // Move the caret to the end of the new quote.\r\n    range = caretPos + text.length;\r\n    com.setSelectionRange(range, range);\r\n    com.focus();\r\n\r\n    // This allows us to determine if any text other than quotes has been typed.\r\n    if (wasOnlyQuotes) { QR.selected.quotedText = com.value; }\r\n\r\n    QR.selected.save(com);\r\n    return QR.selected.save(thread);\r\n  },\r\n\r\n  characterCount() {\r\n    const counter = QR.nodes.charCount;\r\n    const count   = QR.nodes.com.value.replace(/[\\uD800-\\uDBFF][\\uDC00-\\uDFFF]/g, '_').length;\r\n    counter.textContent = count;\r\n    counter.hidden      = count < (QR.max_comment/2);\r\n    return (count > QR.max_comment ? $.addClass : $.rmClass)(counter, 'warning');\r\n  },\r\n\r\n  getFile() {\r\n    return $.event('QRFile', QR.selected?.file);\r\n  },\r\n\r\n  drawFile(e) {\r\n    const file = QR.selected?.file;\r\n    if (!file || !/^(image|video)\\//.test(file.type)) { return; }\r\n    const isVideo = /^video\\//.test(file);\r\n    const el = $.el((isVideo ? 'video' : 'img'));\r\n    $.on(el, 'error', () => QR.openError());\r\n    $.on(el, (isVideo ? 'loadeddata' : 'load'), function() {\r\n      e.target.getContext('2d').drawImage(el, 0, 0);\r\n      URL.revokeObjectURL(el.src);\r\n      return $.event('QRImageDrawn', null, e.target);\r\n    });\r\n    return el.src = URL.createObjectURL(file);\r\n  },\r\n\r\n  openError() {\r\n    const div = $.el('div');\r\n    $.extend(div, {\r\n      innerHTML:\r\n        'Could not open file. [<a href=\"' + E(meta.faq) + '#error-reading-metadata\" target=\"_blank\">More info</a>]'\r\n    });\r\n    return QR.error(div);\r\n  },\r\n\r\n  setFile(e) {\r\n    const {file, name, source} = e.detail;\r\n    if (name != null) { file.name   = name; }\r\n    if (source != null) { file.source = source; }\r\n    QR.open();\r\n    return QR.handleFiles([file]);\r\n  },\r\n\r\n  drag(e) {\r\n    // Let it drag anything from the page.\r\n    const toggle = e.type === 'dragstart' ? $.off : $.on;\r\n    toggle(d, 'dragover', QR.dragOver);\r\n    return toggle(d, 'drop',     QR.dropFile);\r\n  },\r\n\r\n  dragOver(e) {\r\n    e.preventDefault();\r\n    return e.dataTransfer.dropEffect = 'copy';\r\n  }, // cursor feedback\r\n\r\n  dropFile(e) {\r\n    // Let it only handle files from the desktop.\r\n    if (!e.dataTransfer.files.length) { return; }\r\n    e.preventDefault();\r\n    QR.open();\r\n    return QR.handleFiles(e.dataTransfer.files);\r\n  },\r\n\r\n  paste(e) {\r\n    if (!e.clipboardData.items) { return; }\r\n    let file = null;\r\n    let score = -1;\r\n    for (var item of e.clipboardData.items) {\r\n      var file2;\r\n      if ((item.kind === 'file') && (file2 = item.getAsFile())) {\r\n        var score2 = (2*(file2.size <= QR.max_size)) + (file2.type === 'image/png');\r\n        if (score2 > score) {\r\n          file = file2;\r\n          score = score2;\r\n        }\r\n      }\r\n    }\r\n    if (file) {\r\n      const {type} = file;\r\n      const blob = new Blob([file], {type});\r\n      blob.name = `${Conf['pastedname']}.${$.getOwn(QR.extensionFromType, type) || 'jpg'}`;\r\n      QR.open();\r\n      QR.handleFiles([blob]);\r\n      $.addClass(QR.nodes.el, 'dump');\r\n    }\r\n  },\r\n\r\n  pasteFF() {\r\n    const {pasteArea} = QR.nodes;\r\n    if (!pasteArea.childNodes.length) { return; }\r\n    const images = $$('img', pasteArea);\r\n    $.rmAll(pasteArea);\r\n    for (var img of images) {\r\n      var m;\r\n      var {src} = img;\r\n      if (m = src.match(/data:(image\\/(\\w+));base64,(.+)/)) {\r\n        var bstr = atob(m[3]);\r\n        var arr = new Uint8Array(bstr.length);\r\n        for (var i = 0, end = bstr.length, asc = 0 <= end; asc ? i < end : i > end; asc ? i++ : i--) {\r\n          arr[i] = bstr.charCodeAt(i);\r\n        }\r\n        var blob = new Blob([arr], {type: m[1]});\r\n        blob.name = `${Conf['pastedname']}.${m[2]}`;\r\n        QR.handleFiles([blob]);\r\n      } else if (/^https?:\\/\\//.test(src)) {\r\n        QR.handleUrl(src);\r\n      }\r\n    }\r\n  },\r\n\r\n  handleUrl(urlDefault) {\r\n    QR.open();\r\n    QR.selected.preventAutoPost();\r\n    return CrossOrigin.permission(function() {\r\n      const url = prompt('Enter a URL:', urlDefault);\r\n      if (url === null) { return; }\r\n      QR.nodes.fileButton.focus();\r\n      return CrossOrigin.file(url, function(blob) {\r\n        if (blob && !/^text\\//.test(blob.type)) {\r\n          return QR.handleFiles([blob]);\r\n        } else {\r\n          return QR.error(\"Can't load file.\");\r\n        }\r\n      });\r\n    });\r\n  },\r\n\r\n  handleFiles(files) {\r\n    if (this !== QR) { // file input\r\n      files  = [...Array.from(this.files)];\r\n      this.value = null;\r\n    }\r\n    if (!files.length) { return; }\r\n    QR.cleanNotifications();\r\n    for (var file of files) {\r\n      QR.handleFile(file, files.length);\r\n    }\r\n    if (files.length !== 1) { $.addClass(QR.nodes.el, 'dump'); }\r\n    if ((d.activeElement === QR.nodes.fileButton) && $.hasClass(QR.nodes.fileSubmit, 'has-file')) {\r\n      return QR.nodes.filename.focus();\r\n    }\r\n  },\r\n\r\n  handleFile(file, nfiles) {\r\n    let post;\r\n    const isText = /^text\\//.test(file.type);\r\n    if (nfiles === 1) {\r\n      post = QR.selected;\r\n    } else {\r\n      post = QR.posts[QR.posts.length - 1];\r\n      if (isText ? post.com || post.pasting : post.file) {\r\n        post = new QR.post();\r\n      }\r\n    }\r\n    return post[isText ? 'pasteText' : 'setFile'](file);\r\n  },\r\n\r\n  openFileInput() {\r\n    if (QR.nodes.fileButton.disabled) { return; }\r\n    QR.nodes.fileInput.click();\r\n    return QR.nodes.fileButton.focus();\r\n  },\r\n\r\n  generatePostableThreadsList() {\r\n    if (!QR.nodes) { return; }\r\n    const list    = QR.nodes.thread;\r\n    const options = [list.firstElementChild];\r\n    for (var thread of g.BOARD.threads.keys) {\r\n      options.push($.el('option', {\r\n        value: thread,\r\n        textContent: `Thread ${thread}`\r\n      }\r\n      )\r\n      );\r\n    }\r\n    const val = list.value;\r\n    $.rmAll(list);\r\n    $.add(list, options);\r\n    list.value = val;\r\n    if (list.value === val) { return; }\r\n    // Fix the value if the option disappeared.\r\n    list.value = g.VIEW === 'thread' ?\r\n      g.THREADID\r\n    :\r\n      'new';\r\n    return (g.VIEW === 'thread' ? $.addClass : $.rmClass)(QR.nodes.el, 'reply-to-thread');\r\n  },\r\n\r\n  dialog() {\r\n    let dialog, event, nodes;\r\n    let name;\r\n    QR.nodes = (nodes = {\r\n      el: (dialog = UI.dialog('qr',\r\n        { innerHTML: QuickReplyPage }))\r\n    });\r\n\r\n    const setNode = (name, query) => nodes[name] = $(query, dialog);\r\n\r\n    setNode('move',           '.move');\r\n    setNode('autohide',       '#autohide');\r\n    setNode('close',          '.close');\r\n    setNode('thread',         'select');\r\n    setNode('form',           'form');\r\n    setNode('sjisToggle',     '#sjis-toggle');\r\n    setNode('texButton',      '#tex-preview-button');\r\n    setNode('name',           '[data-name=name]');\r\n    setNode('email',          '[data-name=email]');\r\n    setNode('sub',            '[data-name=sub]');\r\n    setNode('com',            '[data-name=com]');\r\n    setNode('charCount',      '#char-count');\r\n    setNode('texPreview',     '#tex-preview');\r\n    setNode('dumpList',       '#dump-list');\r\n    setNode('addPost',        '#add-post');\r\n    setNode('oekaki',         '.oekaki');\r\n    setNode('drawButton',     '#qr-draw-button');\r\n    setNode('fileSubmit',     '#file-n-submit');\r\n    setNode('fileButton',     '#qr-file-button');\r\n    setNode('noFile',         '#qr-no-file');\r\n    setNode('filename',       '#qr-filename');\r\n    setNode('spoiler',        '#qr-file-spoiler');\r\n    setNode('oekakiButton',   '#qr-oekaki-button');\r\n    setNode('fileRM',         '#qr-filerm');\r\n    setNode('urlButton',      '#url-button');\r\n    setNode('pasteArea',      '#paste-area');\r\n    setNode('customCooldown', '#custom-cooldown-button');\r\n    setNode('dumpButton',     '#dump-button');\r\n    setNode('status',         '[type=submit]');\r\n    setNode('flashTag',       '[name=filetag]');\r\n    setNode('fileInput',      '[type=file]');\r\n\r\n    const {config} = g.BOARD;\r\n    const {classList} = QR.nodes.el;\r\n    classList.toggle('forced-anon',  QR.forcedAnon);\r\n    classList.toggle('has-spoiler',  QR.spoiler);\r\n    classList.toggle('has-sjis',     !!config.sjis_tags);\r\n    classList.toggle('has-math',     !!config.math_tags);\r\n    classList.toggle('sjis-preview', !!config.sjis_tags && Conf['sjisPreview']);\r\n    classList.toggle('show-new-thread-option', Conf['Show New Thread Option in Threads']);\r\n\r\n    if (parseInt(Conf['customCooldown'], 10) > 0) {\r\n      $.addClass(QR.nodes.fileSubmit, 'custom-cooldown');\r\n      $.get('customCooldownEnabled', Conf['customCooldownEnabled'], function({customCooldownEnabled}) {\r\n        QR.setCustomCooldown(customCooldownEnabled);\r\n        return $.sync('customCooldownEnabled', QR.setCustomCooldown);\r\n      });\r\n    }\r\n\r\n    QR.flagsInput();\r\n\r\n    $.on(nodes.autohide,       'change',    QR.toggleHide);\r\n    $.on(nodes.close,          'click',     QR.close);\r\n    $.on(nodes.status,         'click',     QR.submit);\r\n    $.on(nodes.form,           'submit',    QR.submit);\r\n    $.on(nodes.sjisToggle,     'click',     QR.toggleSJIS);\r\n    $.on(nodes.texButton,      'mousedown', QR.texPreviewShow);\r\n    $.on(nodes.texButton,      'mouseup',   QR.texPreviewHide);\r\n    $.on(nodes.addPost,        'click',     () => new QR.post(true));\r\n    $.on(nodes.drawButton,     'click',     QR.oekaki.draw);\r\n    $.on(nodes.fileButton,     'click',     QR.openFileInput);\r\n    $.on(nodes.noFile,         'click',     QR.openFileInput);\r\n    $.on(nodes.filename,       'focus',     function() { return $.addClass(this.parentNode, 'focus'); });\r\n    $.on(nodes.filename,       'blur',      function() { return $.rmClass(this.parentNode, 'focus'); });\r\n    $.on(nodes.spoiler,        'change',    () => QR.selected.nodes.spoiler.click());\r\n    $.on(nodes.oekakiButton,   'click',     QR.oekaki.button);\r\n    $.on(nodes.fileRM,         'click',     () => QR.selected.rmFile());\r\n    $.on(nodes.urlButton,      'click',     () => QR.handleUrl(''));\r\n    $.on(nodes.customCooldown, 'click',     QR.toggleCustomCooldown);\r\n    $.on(nodes.dumpButton,     'click',     () => nodes.el.classList.toggle('dump'));\r\n    $.on(nodes.fileInput,      'change',    QR.handleFiles);\r\n\r\n    window.addEventListener('focus', QR.focus, true);\r\n    window.addEventListener('blur',  QR.focus, true);\r\n    // We don't receive blur events from captcha iframe.\r\n    $.on(d, 'click', QR.focus);\r\n\r\n    // XXX Workaround for image pasting in Firefox, obsolete as of v50.\r\n    // https://bugzilla.mozilla.org/show_bug.cgi?id=906420\r\n    if (($.engine === 'gecko') && !window.DataTransferItemList) {\r\n      nodes.pasteArea.hidden = false;\r\n    }\r\n    new MutationObserver(QR.pasteFF).observe(nodes.pasteArea, {childList: true});\r\n\r\n    // save selected post's data\r\n    const items = ['thread', 'name', 'email', 'sub', 'com', 'filename', 'flag'];\r\n    let i = 0;\r\n    const save = function() { return QR.selected.save(this); };\r\n    while ((name = items[i++])) {\r\n      var node;\r\n      if (!(node = nodes[name])) { continue; }\r\n      event = node.nodeName === 'SELECT' ? 'change' : 'input';\r\n      $.on(nodes[name], event, save);\r\n    }\r\n\r\n    // XXX Blink and WebKit treat width and height of <textarea>s as min-width and min-height\r\n    if (($.engine === 'gecko') && Conf['Remember QR Size']) {\r\n      $.get('QR Size', '', item => nodes.com.style.cssText = item['QR Size']);\r\n      $.on(nodes.com, 'mouseup', function(e) {\r\n        if (e.button !== 0) { return; }\r\n        return $.set('QR Size', this.style.cssText);\r\n      });\r\n    }\r\n\r\n    QR.generatePostableThreadsList();\r\n    QR.persona.load();\r\n    new QR.post(true);\r\n    QR.status();\r\n    QR.cooldown.setup();\r\n    QR.captcha.init();\r\n\r\n    $.add(d.body, dialog);\r\n    QR.captcha.setup();\r\n    QR.oekaki.setup();\r\n\r\n    // Create a custom event when the QR dialog is first initialized.\r\n    // Use it to extend the QR's functionalities, or for XTRM RICE.\r\n    return $.event('QRDialogCreation', null, dialog);\r\n  },\r\n\r\n  flags() {\r\n    const select = $.el('select', {\r\n      name:      'flag',\r\n      className: 'flagSelector'\r\n    }\r\n    );\r\n\r\n    const addFlag = (value, textContent) => $.add(select, $.el('option', {value, textContent}));\r\n\r\n    addFlag('0', (g.BOARD.config.country_flags ? 'Geographic Location' : 'None'));\r\n    for (var value in g.BOARD.config.board_flags) {\r\n      var textContent = g.BOARD.config.board_flags[value];\r\n      addFlag(value, textContent);\r\n    }\r\n\r\n    return select;\r\n  },\r\n\r\n  flagsInput() {\r\n    const {nodes} = QR;\r\n    if (!nodes) { return; }\r\n    if (nodes.flag) {\r\n      $.rm(nodes.flag);\r\n      delete nodes.flag;\r\n    }\r\n\r\n    if (g.BOARD.config.board_flags) {\r\n      const flag = QR.flags();\r\n      flag.dataset.name    = 'flag';\r\n      flag.dataset.default = '0';\r\n      nodes.flag = flag;\r\n      return $.add(nodes.form, flag);\r\n    }\r\n  },\r\n\r\n  submit(e) {\r\n    let captcha, err, filetag;\r\n    e?.preventDefault();\r\n    const force = e?.shiftKey;\r\n\r\n    if (QR.req) {\r\n      QR.abort();\r\n      return;\r\n    }\r\n\r\n    $.forceSync('cooldowns');\r\n    if (QR.cooldown.seconds) {\r\n      if (force) {\r\n        QR.cooldown.clear();\r\n      } else {\r\n        QR.cooldown.auto = !QR.cooldown.auto;\r\n        QR.status();\r\n        return;\r\n      }\r\n    }\r\n\r\n    const post = QR.posts[0];\r\n    delete post.quotedText;\r\n    post.forceSave();\r\n    let threadID = post.thread;\r\n    const thread = g.BOARD.threads.get(threadID);\r\n    if ((g.BOARD.ID === 'f') && (threadID === 'new')) {\r\n      filetag = QR.nodes.flashTag.value;\r\n    }\r\n\r\n    // prevent errors\r\n    if (threadID === 'new') {\r\n      threadID = null;\r\n      if (!!g.BOARD.config.require_subject && !post.sub) {\r\n        err = 'New threads require a subject.';\r\n      } else if (!!!g.BOARD.config.text_only && !post.file) {\r\n        err = 'No file selected.';\r\n      }\r\n    } else if (g.BOARD.threads.get(threadID).isClosed) {\r\n      err = 'You can\\'t reply to this thread anymore.';\r\n    } else if (!post.com && !post.file) {\r\n      err = 'No comment or file.';\r\n    } else if (post.file && thread.fileLimit) {\r\n      err = 'Max limit of image replies has been reached.';\r\n    }\r\n\r\n    if ((g.BOARD.ID === 'r9k') && !post.com?.match(/[a-z-]/i)) {\r\n      if (!err) { err = 'Original comment required.'; }\r\n    }\r\n\r\n    if (QR.captcha.isEnabled && !((QR.captcha === Captcha.v2) && /\\b_ct=/.test(d.cookie) && threadID) && !(err && !force)) {\r\n      captcha = QR.captcha.getOne(!!threadID);\r\n      if (QR.captcha === Captcha.v2) {\r\n        if (!captcha) { captcha = Captcha.cache.request(!!threadID); }\r\n      }\r\n      if (!captcha) {\r\n        err = 'No valid captcha.';\r\n        QR.captcha.setup(!QR.cooldown.auto || (d.activeElement === QR.nodes.status));\r\n      }\r\n    }\r\n\r\n    QR.cleanNotifications();\r\n    if (err && !force) {\r\n      // stop auto-posting\r\n      QR.cooldown.auto = false;\r\n      QR.status();\r\n      QR.error(err);\r\n      return;\r\n    }\r\n\r\n    // Enable auto-posting if we have stuff to post, disable it otherwise.\r\n    QR.cooldown.auto = QR.posts.length > 1;\r\n\r\n    post.lock();\r\n\r\n    const formData = {\r\n      MAX_FILE_SIZE: QR.max_size,\r\n      mode:     'regist',\r\n      pwd:      QR.persona.getPassword(),\r\n      resto:    threadID,\r\n      name:     (!QR.forcedAnon ? post.name : undefined),\r\n      email:    post.email,\r\n      sub:      (!QR.forcedAnon && !threadID ? post.sub : undefined),\r\n      com:      post.com,\r\n      upfile:   post.file,\r\n      filetag,\r\n      spoiler:  post.spoiler,\r\n      flag:     post.flag,\r\n    };\r\n\r\n    const options = {\r\n      responseType: 'document',\r\n      withCredentials: true,\r\n      onloadend: QR.response,\r\n      form: $.formData(formData)\r\n    };\r\n    if (Conf['Show Upload Progress']) {\r\n      options.onprogress = function(e) {\r\n        if (this !== QR.req?.upload) { return; } // aborted\r\n        if (e.loaded < e.total) {\r\n          // Uploading...\r\n          QR.req.progress = `${Math.round((e.loaded / e.total) * 100)}%`;\r\n        } else {\r\n          // Upload done, waiting for server response.\r\n          QR.req.isUploadFinished = true;\r\n          QR.req.progress = '...';\r\n        }\r\n        return QR.status();\r\n      };\r\n    }\r\n\r\n    let cb = function(response) {\r\n      if (response != null) {\r\n        QR.currentCaptcha = response;\r\n        if (QR.captcha === Captcha.v2) {\r\n          if (response.challenge != null) {\r\n            options.form.append('recaptcha_challenge_field', response.challenge);\r\n            options.form.append('recaptcha_response_field', response.response);\r\n          } else {\r\n            options.form.append('g-recaptcha-response', response.response);\r\n          }\r\n        } else {\r\n          for (var key in response) {\r\n            var val = response[key];\r\n            options.form.append(key, val);\r\n          }\r\n        }\r\n      }\r\n      QR.req = $.ajax(`https://sys.${location.hostname.split('.')[1]}.org/${g.BOARD}/post`, options);\r\n      return QR.req.progress = '...';\r\n    };\r\n\r\n    if (typeof captcha === 'function') {\r\n      // Wait for captcha to be verified before submitting post.\r\n      QR.req = {\r\n        progress: '...',\r\n        abort() {\r\n          if (QR.captcha === Captcha.v2) {\r\n            Captcha.cache.abort();\r\n          }\r\n          return cb = null;\r\n        }\r\n      };\r\n      captcha(function(response) {\r\n        if ((QR.captcha === Captcha.v2) && Captcha.cache.haveCookie()) {\r\n          cb?.();\r\n          if (response) { return Captcha.cache.save(response); }\r\n        } else if (response) {\r\n          return cb?.(response);\r\n        } else {\r\n          delete QR.req;\r\n          post.unlock();\r\n          QR.cooldown.auto = !!Captcha.cache.getCount();\r\n          return QR.status();\r\n        }\r\n      });\r\n    } else {\r\n      cb(captcha);\r\n    }\r\n\r\n    // Starting to upload might take some time.\r\n    // Provide some feedback that we're starting to submit.\r\n    return QR.status();\r\n  },\r\n\r\n  response() {\r\n    let connErr, err;\r\n    if (this !== QR.req) { return; } // aborted\r\n    delete QR.req;\r\n\r\n    const post = QR.posts[0];\r\n    post.unlock();\r\n\r\n    if (err = this.response?.getElementById('errmsg')) { // error!\r\n      const el = $('a', err);\r\n      if (el) el.target = '_blank'; // duplicate image link\r\n    } else if (connErr = (!this.response || (this.response.title !== 'Post successful!'))) {\r\n      err = QR.connectionError();\r\n      if ((QR.captcha === Captcha.v2) && QR.currentCaptcha) { Captcha.cache.save(QR.currentCaptcha); }\r\n    } else if (this.status !== 200) {\r\n      err = `Error ${this.statusText} (${this.status})`;\r\n    }\r\n\r\n    if (!connErr) { QR.captcha.setUsed?.(); }\r\n    delete QR.currentCaptcha;\r\n\r\n    if (err) {\r\n      let m;\r\n      QR.errorCount = (QR.errorCount || 0) + 1;\r\n      if (/captcha|verification/i.test(err.textContent) || connErr) {\r\n        // Remove the obnoxious 4chan Pass ad.\r\n        if (/mistyped/i.test(err.textContent)) {\r\n          err = 'You mistyped the CAPTCHA, or the CAPTCHA malfunctioned.';\r\n        } else if (/expired/i.test(err.textContent)) {\r\n          err = 'This CAPTCHA is no longer valid because it has expired.';\r\n        }\r\n        if (QR.errorCount >= 5) {\r\n          // Too many posting errors can ban you. Stop autoposting after 5 errors.\r\n          QR.cooldown.auto = false;\r\n        } else {\r\n          // Something must've gone terribly wrong if you get captcha errors without captchas.\r\n          // Don't auto-post indefinitely in that case.\r\n          QR.cooldown.auto = QR.captcha.isEnabled || connErr;\r\n          // Too many frequent mistyped captchas will auto-ban you!\r\n          // On connection error, the post most likely didn't go through.\r\n          // If the post did go through, it should be stopped by the duplicate reply cooldown.\r\n          QR.cooldown.addDelay(post, 2);\r\n        }\r\n      } else if (err.textContent && (m = err.textContent.match(/\\d+\\s+(?:minute|second)/gi)) && !/duplicate|hour/i.test(err.textContent)) {\r\n        QR.cooldown.auto = !/have\\s+been\\s+muted/i.test(err.textContent);\r\n        let seconds = 0;\r\n        for (var mi of m) {\r\n          seconds += (/minute/i.test(mi) ? 60 : 1) * (+mi.match(/\\d+/)[0]);\r\n        }\r\n        if (/muted/i.test(err.textContent)) {\r\n          QR.cooldown.addMute(seconds);\r\n        } else {\r\n          QR.cooldown.addDelay(post, seconds);\r\n        }\r\n      } else { // stop auto-posting\r\n        QR.cooldown.auto = false;\r\n      }\r\n      QR.captcha.setup(QR.cooldown.auto && [QR.nodes.status, d.body].includes(d.activeElement));\r\n      QR.status();\r\n      QR.error(err);\r\n      return;\r\n    }\r\n\r\n    delete QR.errorCount;\r\n\r\n    const h1 = $('h1', this.response);\r\n\r\n    let [_, threadID, postID] = Array.from(h1.nextSibling.textContent.match(/thread:(\\d+),no:(\\d+)/));\r\n    postID   = +postID;\r\n    threadID = +threadID || postID;\r\n    const isReply  = threadID !== postID;\r\n\r\n    // Post/upload confirmed as successful.\r\n    $.event('QRPostSuccessful', {\r\n      boardID: g.BOARD.ID,\r\n      threadID,\r\n      postID\r\n    });\r\n    // XXX deprecated\r\n    $.event('QRPostSuccessful_', {boardID: g.BOARD.ID, threadID, postID});\r\n\r\n    // Enable auto-posting if we have stuff left to post, disable it otherwise.\r\n    const postsCount = QR.posts.length - 1;\r\n    QR.cooldown.auto = postsCount && isReply;\r\n\r\n    const lastPostToThread = !((function() { for (var p of QR.posts.slice(1)) { if (p.thread === post.thread) { return true; } } })());\r\n\r\n    if (postsCount) {\r\n      post.rm();\r\n      QR.captcha.setup(d.activeElement === QR.nodes.status);\r\n    } else if (Conf['Persistent QR']) {\r\n      post.rm();\r\n      if (Conf['Auto Hide QR']) {\r\n        QR.hide();\r\n      } else {\r\n        QR.blur();\r\n      }\r\n    } else {\r\n      QR.close();\r\n    }\r\n\r\n    QR.cleanNotifications();\r\n    if (Conf['Posting Success Notifications']) {\r\n      QR.notifications.push(new Notice('success', h1.textContent, 5));\r\n    }\r\n\r\n    QR.cooldown.add(threadID, postID);\r\n\r\n    const URL = threadID === postID ? ( // new thread\r\n      `${window.location.origin}/${g.BOARD}/thread/${threadID}`\r\n    ) : (threadID !== g.THREADID) && lastPostToThread && Conf['Open Post in New Tab'] ? ( // replying from the index or a different thread\r\n      `${window.location.origin}/${g.BOARD}/thread/${threadID}#p${postID}`\r\n    ) : undefined;\r\n\r\n    if (URL) {\r\n      const open = Conf['Open Post in New Tab'] || postsCount ?\r\n        () => $.open(URL)\r\n      :\r\n        () => location.href = URL;\r\n\r\n      if (threadID === postID) {\r\n        // XXX 4chan sometimes responds before the thread exists.\r\n        QR.waitForThread(URL, open);\r\n      } else {\r\n        open();\r\n      }\r\n    }\r\n\r\n    return QR.status();\r\n  },\r\n\r\n  waitForThread(url, cb) {\r\n    let attempts = 0;\r\n    var check = function() {\r\n      return $.ajax(url, {\r\n        onloadend() {\r\n          attempts++;\r\n          if ((attempts >= 6) || (this.status === 200)) {\r\n            return cb();\r\n          } else {\r\n            return setTimeout(check, attempts * SECOND);\r\n          }\r\n        },\r\n        responseType: 'text',\r\n        type: 'HEAD'\r\n      }\r\n      );\r\n    };\r\n    return check();\r\n  },\r\n\r\n  abort() {\r\n    let oldReq;\r\n    if ((oldReq = QR.req) && !QR.req.isUploadFinished) {\r\n      delete QR.req;\r\n      oldReq.abort();\r\n      if ((QR.captcha === Captcha.v2) && QR.currentCaptcha) { Captcha.cache.save(QR.currentCaptcha); }\r\n      delete QR.currentCaptcha;\r\n      QR.posts[0].unlock();\r\n      QR.cooldown.auto = false;\r\n      QR.notifications.push(new Notice('info', 'QR upload aborted.', 5));\r\n    }\r\n    return QR.status();\r\n  },\r\n\r\n  cooldown: {\r\n    seconds: 0,\r\n    delays: {\r\n      deletion: 60\r\n    }, // cooldown for deleting posts/files\r\n\r\n    // Called from Main\r\n    init() {\r\n      if (!Conf['Quick Reply']) { return; }\r\n      this.data = Conf['cooldowns'];\r\n      this.changes = dict();\r\n      return $.sync('cooldowns', this.sync);\r\n    },\r\n\r\n    // Called from QR\r\n    setup() {\r\n      // Read cooldown times\r\n      $.extend(QR.cooldown.delays, g.BOARD.cooldowns());\r\n\r\n      // The longest reply cooldown, for use in pruning old reply data\r\n      QR.cooldown.maxDelay = 0;\r\n      for (var type in QR.cooldown.delays) {\r\n        var delay = QR.cooldown.delays[type];\r\n        if (!['thread', 'thread_global'].includes(type)) {\r\n          QR.cooldown.maxDelay = Math.max(QR.cooldown.maxDelay, delay);\r\n        }\r\n      }\r\n\r\n      QR.cooldown.isSetup = true;\r\n      return QR.cooldown.start();\r\n    },\r\n\r\n    start() {\r\n      const { data } = QR.cooldown;\r\n      if (\r\n        !Conf['Cooldown'] ||\r\n        !QR.cooldown.isSetup ||\r\n        !!QR.cooldown.isCounting ||\r\n        ((Object.keys(data[g.BOARD.ID] || {}).length + Object.keys(data.global || {}).length) <= 0)\r\n      ) { return; }\r\n      QR.cooldown.isCounting = true;\r\n      return QR.cooldown.count();\r\n    },\r\n\r\n    sync(data) {\r\n      QR.cooldown.data = data || dict();\r\n      return QR.cooldown.start();\r\n    },\r\n\r\n    add(threadID, postID) {\r\n      if (!Conf['Cooldown']) { return; }\r\n      const start = Date.now();\r\n      const boardID = g.BOARD.ID;\r\n      QR.cooldown.set(boardID, start, { threadID, postID });\r\n      if (threadID === postID) { QR.cooldown.set('global', start, { boardID, threadID, postID }); }\r\n      QR.cooldown.save();\r\n      return QR.cooldown.start();\r\n    },\r\n\r\n    addDelay(post, delay) {\r\n      if (!Conf['Cooldown']) { return; }\r\n      const cooldown = QR.cooldown.categorize(post);\r\n      cooldown.delay = delay;\r\n      QR.cooldown.set(g.BOARD.ID, Date.now(), cooldown);\r\n      QR.cooldown.save();\r\n      return QR.cooldown.start();\r\n    },\r\n\r\n    addMute(delay) {\r\n      if (!Conf['Cooldown']) { return; }\r\n      QR.cooldown.set(g.BOARD.ID, Date.now(), { type: 'mute', delay });\r\n      QR.cooldown.save();\r\n      return QR.cooldown.start();\r\n    },\r\n\r\n    delete(post) {\r\n      let cooldown;\r\n      if (!QR.cooldown.data) { return; }\r\n      const cooldowns = (QR.cooldown.data[post.board.ID] || (QR.cooldown.data[post.board.ID] = dict()));\r\n      for (var id in cooldowns) {\r\n        cooldown = cooldowns[id];\r\n        if ((cooldown.delay == null) && (cooldown.threadID === post.thread.ID) && (cooldown.postID === post.ID)) {\r\n          QR.cooldown.set(post.board.ID, id, null);\r\n        }\r\n      }\r\n      return QR.cooldown.save();\r\n    },\r\n\r\n    secondsDeletion(post) {\r\n      if (!QR.cooldown.data || !Conf['Cooldown']) { return 0; }\r\n      const cooldowns = QR.cooldown.data[post.board.ID] || dict();\r\n      for (var start in cooldowns) {\r\n        var cooldown = cooldowns[start];\r\n        if ((cooldown.delay == null) && (cooldown.threadID === post.thread.ID) && (cooldown.postID === post.ID)) {\r\n          var seconds = QR.cooldown.delays.deletion - Math.floor((Date.now() - start) / SECOND);\r\n          return Math.max(seconds, 0);\r\n        }\r\n      }\r\n      return 0;\r\n    },\r\n\r\n    categorize(post) {\r\n      if (post.thread === 'new') {\r\n        return { type: 'thread' };\r\n      } else {\r\n        return {\r\n          type: !!post.file ? 'image' : 'reply',\r\n          threadID: +post.thread\r\n        };\r\n      }\r\n    },\r\n\r\n    mergeChange(data, scope, id, value) {\r\n      if (value) {\r\n        return (data[scope] || (data[scope] = dict()))[id] = value;\r\n      } else if (scope in data) {\r\n        delete data[scope][id];\r\n        if (Object.keys(data[scope]).length === 0) { return delete data[scope]; }\r\n      }\r\n    },\r\n\r\n    set(scope, id, value) {\r\n      QR.cooldown.mergeChange(QR.cooldown.data, scope, id, value);\r\n      return (QR.cooldown.changes[scope] || (QR.cooldown.changes[scope] = dict()))[id] = value;\r\n    },\r\n\r\n    save() {\r\n      const { changes } = QR.cooldown;\r\n      if (!Object.keys(changes).length) { return; }\r\n      return $.get('cooldowns', dict(), function ({ cooldowns }) {\r\n        for (var scope in QR.cooldown.changes) {\r\n          for (var id in QR.cooldown.changes[scope]) {\r\n            var value = QR.cooldown.changes[scope][id];\r\n            QR.cooldown.mergeChange(cooldowns, scope, id, value);\r\n          }\r\n          QR.cooldown.data = cooldowns;\r\n        }\r\n        return $.set('cooldowns', cooldowns, () => QR.cooldown.changes = dict());\r\n      });\r\n    },\r\n\r\n    clear() {\r\n      QR.cooldown.data = dict();\r\n      QR.cooldown.changes = dict();\r\n      QR.cooldown.auto = false;\r\n      QR.cooldown.update();\r\n      return $.queueTask($.delete, 'cooldowns');\r\n    },\r\n\r\n    update() {\r\n      let cooldown;\r\n      if (!QR.cooldown.isCounting) { return; }\r\n\r\n      let save = false;\r\n      let nCooldowns = 0;\r\n      const now = Date.now();\r\n      const { type, threadID } = QR.cooldown.categorize(QR.posts[0]);\r\n      let seconds = 0;\r\n\r\n      if (Conf['Cooldown']) {\r\n        for (var scope of [g.BOARD.ID, 'global']) {\r\n          var cooldowns = (QR.cooldown.data[scope] || (QR.cooldown.data[scope] = dict()));\r\n\r\n          for (var start in cooldowns) {\r\n            cooldown = cooldowns[start];\r\n            start = +start;\r\n            var elapsed = Math.floor((now - start) / SECOND);\r\n            if (elapsed < 0) { // clock changed since then?\r\n              QR.cooldown.set(scope, start, null);\r\n              save = true;\r\n              continue;\r\n            }\r\n\r\n            // Explicit delays from error messages\r\n            if (cooldown.delay != null) {\r\n              if (cooldown.delay <= elapsed) {\r\n                QR.cooldown.set(scope, start, null);\r\n                save = true;\r\n              } else if (((cooldown.type === type) && (cooldown.threadID === threadID)) || (cooldown.type === 'mute')) {\r\n                // Delays only apply to the given post type and thread.\r\n                seconds = Math.max(seconds, cooldown.delay - elapsed);\r\n              }\r\n              continue;\r\n            }\r\n\r\n            // Clean up expired cooldowns\r\n            var maxDelay = cooldown.threadID !== cooldown.postID ?\r\n              QR.cooldown.maxDelay\r\n              :\r\n              QR.cooldown.delays[scope === 'global' ? 'thread_global' : 'thread'];\r\n            if (QR.cooldown.customCooldown) {\r\n              maxDelay = Math.max(maxDelay, parseInt(Conf['customCooldown'], 10));\r\n            }\r\n            if (maxDelay <= elapsed) {\r\n              QR.cooldown.set(scope, start, null);\r\n              save = true;\r\n              continue;\r\n            }\r\n\r\n            if (((type === 'thread') === (cooldown.threadID === cooldown.postID)) && (cooldown.boardID !== g.BOARD.ID)) {\r\n              // Only cooldowns relevant to this post can set the seconds variable:\r\n              //   reply cooldown with a reply, thread cooldown with a thread.\r\n              // Inter-board thread cooldowns only apply on boards other than the one they were posted on.\r\n              var suffix = scope === 'global' ?\r\n                '_global'\r\n                :\r\n                '';\r\n              seconds = Math.max(seconds, QR.cooldown.delays[type + suffix] - elapsed);\r\n\r\n              // If additional cooldown is enabled, add the configured seconds to the count.\r\n              if (QR.cooldown.customCooldown) {\r\n                seconds = Math.max(seconds, parseInt(Conf['customCooldown'], 10) - elapsed);\r\n              }\r\n            }\r\n          }\r\n\r\n          nCooldowns += Object.keys(cooldowns).length;\r\n        }\r\n      }\r\n\r\n      if (save) { QR.cooldown.save; }\r\n\r\n      if (nCooldowns) {\r\n        clearTimeout(QR.cooldown.timeout);\r\n        QR.cooldown.timeout = setTimeout(QR.cooldown.count, SECOND);\r\n      } else {\r\n        delete QR.cooldown.isCounting;\r\n      }\r\n\r\n      // Update the status when we change posting type.\r\n      // Don't get stuck at some random number.\r\n      // Don't interfere with progress status updates.\r\n      const update = seconds !== QR.cooldown.seconds;\r\n      QR.cooldown.seconds = seconds;\r\n      if (update) { return QR.status(); }\r\n    },\r\n\r\n    count() {\r\n      QR.cooldown.update();\r\n      if ((QR.cooldown.seconds === 0) && QR.cooldown.auto && !QR.req) { return QR.submit(); }\r\n    }\r\n  },\r\n\r\n  oekaki: {\r\n    menu: {\r\n      init() {\r\n        if (!['index', 'thread'].includes(g.VIEW) || !Conf['Menu'] || !Conf['Edit Link'] || !Conf['Quick Reply']) { return; }\r\n\r\n        const a = $.el('a', {\r\n          className: 'edit-link',\r\n          href: 'javascript:;',\r\n          textContent: 'Edit image'\r\n        }\r\n        );\r\n        $.on(a, 'click', this.editFile);\r\n\r\n        return Menu.menu.addEntry({\r\n          el: a,\r\n          order: 90,\r\n          open(post) {\r\n            QR.oekaki.menu.post = post;\r\n            const { file } = post;\r\n            return QR.postingIsEnabled && !!file && (file.isImage || file.isVideo);\r\n          }\r\n        });\r\n      },\r\n\r\n      editFile() {\r\n        const { post } = QR.oekaki.menu;\r\n        QR.quote.call(post.nodes.post);\r\n        const { isVideo } = post.file;\r\n        const currentTime = post.file.fullImage?.currentTime || 0;\r\n        return CrossOrigin.file(post.file.url, function (blob) {\r\n          if (!blob) {\r\n            return QR.error(\"Can't load file.\");\r\n          } else if (isVideo) {\r\n            const video = $.el('video');\r\n            $.on(video, 'loadedmetadata', function () {\r\n              $.on(video, 'seeked', function () {\r\n                const canvas = $.el('canvas', {\r\n                  width: video.videoWidth,\r\n                  height: video.videoHeight\r\n                }\r\n                );\r\n                canvas.getContext('2d').drawImage(video, 0, 0);\r\n                return canvas.toBlob(function (snapshot) {\r\n                  snapshot.name = post.file.name.replace(/\\.\\w+$/, '') + '.png';\r\n                  QR.handleFiles([snapshot]);\r\n                  return QR.oekaki.edit();\r\n                });\r\n              });\r\n              return video.currentTime = currentTime;\r\n            });\r\n            $.on(video, 'error', () => QR.openError());\r\n            return video.src = URL.createObjectURL(blob);\r\n          } else {\r\n            blob.name = post.file.name;\r\n            QR.handleFiles([blob]);\r\n            return QR.oekaki.edit();\r\n          }\r\n        });\r\n      }\r\n    },\r\n\r\n    setup() {\r\n      return $.global(function () {\r\n        const { FCX } = window;\r\n        FCX.oekakiCB = () => window.Tegaki.flatten().toBlob(function (file) {\r\n          const source = `oekaki-${Date.now()}`;\r\n          FCX.oekakiLatest = source;\r\n          return document.dispatchEvent(new CustomEvent('QRSetFile', {\r\n            bubbles: true,\r\n            detail: { file, name: FCX.oekakiName, source }\r\n          }));\r\n        });\r\n        if (window.Tegaki) {\r\n          return document.querySelector('#qr .oekaki').hidden = false;\r\n        }\r\n      });\r\n    },\r\n\r\n    load(cb) {\r\n      if ($('script[src^=\"//s.4cdn.org/js/tegaki\"]', d.head)) {\r\n        return cb();\r\n      } else {\r\n        const style = $.el('link', {\r\n          rel: 'stylesheet',\r\n          href: `//s.4cdn.org/css/tegaki.${Date.now()}.css`\r\n        }\r\n        );\r\n        const script = $.el('script',\r\n          { src: `//s.4cdn.org/js/tegaki.min.${Date.now()}.js` });\r\n        let n = 0;\r\n        const onload = function () {\r\n          if (++n === 2) { return cb(); }\r\n        };\r\n        $.on(style, 'load', onload);\r\n        $.on(script, 'load', onload);\r\n        return $.add(d.head, [style, script]);\r\n      }\r\n    },\r\n\r\n    draw() {\r\n      return $.global(function () {\r\n        const { Tegaki, FCX } = window;\r\n        if (Tegaki.bg) { Tegaki.destroy(); }\r\n        FCX.oekakiName = 'tegaki.png';\r\n        return Tegaki.open({\r\n          onDone: FCX.oekakiCB,\r\n          onCancel() { return Tegaki.bgColor = '#ffffff'; },\r\n          width: +document.querySelector('#qr [name=oekaki-width]').value,\r\n          height: +document.querySelector('#qr [name=oekaki-height]').value,\r\n          bgColor:\r\n            document.querySelector('#qr [name=oekaki-bg]').checked ?\r\n              document.querySelector('#qr [name=oekaki-bgcolor]').value\r\n              :\r\n              'transparent'\r\n        });\r\n      });\r\n    },\r\n\r\n    button() {\r\n      if (QR.selected.file) {\r\n        return QR.oekaki.edit();\r\n      } else {\r\n        return QR.oekaki.toggle();\r\n      }\r\n    },\r\n\r\n    edit() {\r\n      return QR.oekaki.load(() => $.global(function () {\r\n        const { Tegaki, FCX } = window;\r\n        const name = document.getElementById('qr-filename').value.replace(/\\.\\w+$/, '') + '.png';\r\n        const { source } = document.getElementById('file-n-submit').dataset;\r\n        const error = content => document.dispatchEvent(new CustomEvent('CreateNotification', {\r\n          bubbles: true,\r\n          detail: { type: 'warning', content, lifetime: 20 }\r\n        }));\r\n        var cb = function (e) {\r\n          if (e) { this.removeEventListener('QRMetadata', cb, false); }\r\n          const selected = document.getElementById('selected');\r\n          if (!selected?.dataset.type) { return error('No file to edit.'); }\r\n          if (!/^(image|video)\\//.test(selected.dataset.type)) { return error('Not an image.'); }\r\n          if (!selected.dataset.height) { return error('Metadata not available.'); }\r\n          if (selected.dataset.height === 'loading') {\r\n            selected.addEventListener('QRMetadata', cb, false);\r\n            return;\r\n          }\r\n          if (Tegaki.bg) { Tegaki.destroy(); }\r\n          FCX.oekakiName = name;\r\n          Tegaki.open({\r\n            onDone: FCX.oekakiCB,\r\n            onCancel() { return Tegaki.bgColor = '#ffffff'; },\r\n            width: +selected.dataset.width,\r\n            height: +selected.dataset.height,\r\n            bgColor: 'transparent'\r\n          });\r\n          const canvas = document.createElement('canvas');\r\n          canvas.width = (canvas.naturalWidth = +selected.dataset.width);\r\n          canvas.height = (canvas.naturalHeight = +selected.dataset.height);\r\n          canvas.hidden = true;\r\n          document.body.appendChild(canvas);\r\n          canvas.addEventListener('QRImageDrawn', function () {\r\n            this.remove();\r\n            return Tegaki.onOpenImageLoaded.call(this);\r\n          }\r\n            , false);\r\n          return canvas.dispatchEvent(new CustomEvent('QRDrawFile', { bubbles: true }));\r\n        };\r\n        if (Tegaki.bg && (Tegaki.onDoneCb === FCX.oekakiCB) && (source === FCX.oekakiLatest)) {\r\n          FCX.oekakiName = name;\r\n          return Tegaki.resume();\r\n        } else {\r\n          return cb();\r\n        }\r\n      }));\r\n    },\r\n\r\n    toggle() {\r\n      return QR.oekaki.load(() => QR.nodes.oekaki.hidden = !QR.nodes.oekaki.hidden);\r\n    }\r\n  },\r\n\r\n  persona: {\r\n    always: {},\r\n    types: {\r\n      name: [],\r\n      email: [],\r\n      sub: []\r\n    },\r\n\r\n    init() {\r\n      if (!Conf['Quick Reply'] && (!Conf['Menu'] || !Conf['Delete Link'])) { return; }\r\n      for (var item of Conf['QR.personas'].split('\\n')) {\r\n        QR.persona.parseItem(item.trim());\r\n      }\r\n    },\r\n\r\n    parseItem(item) {\r\n      let match, needle, type, val;\r\n      if (item[0] === '#') { return; }\r\n      if (!(match = item.match(/(name|options|email|subject|password):\"(.*)\"/i))) { return; }\r\n      [match, type, val] = Array.from(match);\r\n\r\n      // Don't mix up item settings with val.\r\n      item = item.replace(match, '');\r\n\r\n      const boards = item.match(/boards:([^;]+)/i)?.[1].toLowerCase() || 'global';\r\n      if ((boards !== 'global') && (needle = g.BOARD.ID, !boards.split(',').includes(needle))) { return; }\r\n\r\n\r\n      if (type === 'password') {\r\n        QR.persona.pwd = val;\r\n        return;\r\n      }\r\n\r\n      if (type === 'options') { type = 'email'; }\r\n      if (type === 'subject') { type = 'sub'; }\r\n\r\n      if (/always/i.test(item)) {\r\n        QR.persona.always[type] = val;\r\n      }\r\n\r\n      if (!QR.persona.types[type].includes(val)) {\r\n        return QR.persona.types[type].push(val);\r\n      }\r\n    },\r\n\r\n    load() {\r\n      for (var type in QR.persona.types) {\r\n        var arr = QR.persona.types[type];\r\n        var list = $(`#list-${type}`, QR.nodes.el);\r\n        for (var val of arr) {\r\n          if (val) {\r\n            $.add(list, $.el('option',\r\n              { textContent: val })\r\n            );\r\n          }\r\n        }\r\n      }\r\n    },\r\n\r\n    getPassword() {\r\n      let m;\r\n      if (QR.persona.pwd != null) {\r\n        return QR.persona.pwd;\r\n      } else if (m = d.cookie.match(/4chan_pass=([^;]+)/)) {\r\n        return decodeURIComponent(m[1]);\r\n      } else {\r\n        return '';\r\n      }\r\n    },\r\n\r\n    get(cb) {\r\n      return $.get('QR.persona', {}, ({ 'QR.persona': persona }) => cb(persona));\r\n    },\r\n\r\n    set(post) {\r\n      return $.get('QR.persona', {}, function ({ 'QR.persona': persona }) {\r\n        persona = {\r\n          name: post.name,\r\n          flag: post.flag\r\n        };\r\n        return $.set('QR.persona', persona);\r\n      });\r\n    }\r\n  },\r\n\r\n  post: class {\r\n    constructor(select) {\r\n      this.select = this.select.bind(this);\r\n      const el = $.el('a', {\r\n        className: 'qr-preview',\r\n        draggable: true,\r\n        href: 'javascript:;'\r\n      }\r\n      );\r\n      $.extend(el, { innerHTML: '<a class=\"remove\" title=\"Remove\"></a><label class=\"qr-preview-spoiler\"><input type=\"checkbox\"> Spoiler</label><span></span>' });\r\n\r\n      this.nodes = {\r\n        el,\r\n        rm: el.firstChild,\r\n        spoiler: $('.qr-preview-spoiler input', el),\r\n        span: el.lastChild\r\n      };\r\n\r\n      $.on(el, 'click', this.select);\r\n      $.on(this.nodes.rm, 'click', e => { e.stopPropagation(); return this.rm(); });\r\n      $.on(this.nodes.spoiler, 'change', e => {\r\n        this.spoiler = e.target.checked;\r\n        if (this === QR.selected) { QR.nodes.spoiler.checked = this.spoiler; }\r\n        return this.preventAutoPost();\r\n      });\r\n      for (var label of $$('label', el)) {\r\n        $.on(label, 'click', e => e.stopPropagation());\r\n      }\r\n      $.add(QR.nodes.dumpList, el);\r\n\r\n      for (var event of ['dragStart', 'dragEnter', 'dragLeave', 'dragOver', 'dragEnd', 'drop']) {\r\n        $.on(el, event.toLowerCase(), this[event]);\r\n      }\r\n\r\n      this.thread = g.VIEW === 'thread' ?\r\n        g.THREADID\r\n        :\r\n        'new';\r\n\r\n      const prev = QR.posts[QR.posts.length - 1];\r\n      QR.posts.push(this);\r\n      this.nodes.spoiler.checked = (this.spoiler = prev && Conf['Remember Spoiler'] ?\r\n        prev.spoiler\r\n        :\r\n        false);\r\n      QR.persona.get(persona => {\r\n        this.name = 'name' in QR.persona.always ?\r\n          QR.persona.always.name\r\n          : prev ?\r\n            prev.name\r\n            :\r\n            persona.name;\r\n\r\n        this.email = 'email' in QR.persona.always ?\r\n          QR.persona.always.email\r\n          :\r\n          '';\r\n\r\n        this.sub = 'sub' in QR.persona.always ?\r\n          QR.persona.always.sub\r\n          :\r\n          '';\r\n\r\n        if (QR.nodes.flag) {\r\n          this.flag = (() => {\r\n            if (prev) {\r\n              return prev.flag;\r\n            } else if (persona.flag && persona.flag in g.BOARD.config.board_flags) {\r\n              return persona.flag;\r\n            }\r\n          })();\r\n        }\r\n        if (QR.selected === this) { return this.load(); }\r\n      }); // load persona\r\n      if (select) { this.select(); }\r\n      this.unlock();\r\n      QR.captcha.moreNeeded();\r\n    }\r\n\r\n    rm() {\r\n      this.delete();\r\n      const index = QR.posts.indexOf(this);\r\n      if (QR.posts.length === 1) {\r\n        new QR.post(true);\r\n        $.rmClass(QR.nodes.el, 'dump');\r\n      } else if (this === QR.selected) {\r\n        (QR.posts[index - 1] || QR.posts[index + 1]).select();\r\n      }\r\n      QR.posts.splice(index, 1);\r\n      QR.status();\r\n      return QR.captcha.updateThread?.();\r\n    }\r\n\r\n    delete() {\r\n      $.rm(this.nodes.el);\r\n      URL.revokeObjectURL(this.URL);\r\n      return this.dismissErrors();\r\n    }\r\n\r\n    lock(lock = true) {\r\n      this.isLocked = lock;\r\n      if (this !== QR.selected) { return; }\r\n      for (var name of ['thread', 'name', 'email', 'sub', 'com', 'fileButton', 'filename', 'spoiler', 'flag']) {\r\n        var node;\r\n        if ((node = QR.nodes[name])) {\r\n          node.disabled = lock;\r\n        }\r\n      }\r\n      this.nodes.rm.style.visibility = lock ? 'hidden' : '';\r\n      this.nodes.spoiler.disabled = lock;\r\n      return this.nodes.el.draggable = !lock;\r\n    }\r\n\r\n    unlock() {\r\n      return this.lock(false);\r\n    }\r\n\r\n    select() {\r\n      if (QR.selected) {\r\n        QR.selected.nodes.el.removeAttribute('id');\r\n        QR.selected.forceSave();\r\n      }\r\n      QR.selected = this;\r\n      this.lock(this.isLocked);\r\n      this.nodes.el.id = 'selected';\r\n      // Scroll the list to center the focused post.\r\n      const rectEl = this.nodes.el.getBoundingClientRect();\r\n      const rectList = this.nodes.el.parentNode.getBoundingClientRect();\r\n      this.nodes.el.parentNode.scrollLeft += (rectEl.left + (rectEl.width / 2)) - rectList.left - (rectList.width / 2);\r\n      return this.load();\r\n    }\r\n\r\n    load() {\r\n      // Load this post's values.\r\n\r\n      for (var name of ['thread', 'name', 'email', 'sub', 'com', 'filename', 'flag']) {\r\n        var node;\r\n        if (!(node = QR.nodes[name])) { continue; }\r\n        node.value = this[name] || node.dataset.default || '';\r\n      }\r\n\r\n      (this.thread !== 'new' ? $.addClass : $.rmClass)(QR.nodes.el, 'reply-to-thread');\r\n\r\n      this.showFileData();\r\n      return QR.characterCount();\r\n    }\r\n\r\n    save(input, forced) {\r\n      if (input.type === 'checkbox') {\r\n        this.spoiler = input.checked;\r\n        return;\r\n      }\r\n      const { name } = input.dataset;\r\n      if (!['thread', 'name', 'email', 'sub', 'com', 'filename', 'flag'].includes(name)) { return; }\r\n      const prev = this[name] || input.dataset.default || null;\r\n      this[name] = input.value || input.dataset.default || null;\r\n      switch (name) {\r\n        case 'thread':\r\n          (this.thread !== 'new' ? $.addClass : $.rmClass)(QR.nodes.el, 'reply-to-thread');\r\n          QR.status();\r\n          QR.captcha.updateThread?.();\r\n          break;\r\n        case 'com':\r\n          this.updateComment();\r\n          break;\r\n        case 'filename':\r\n          if (!this.file) { return; }\r\n          this.saveFilename();\r\n          this.updateFilename();\r\n          break;\r\n        case 'name': case 'flag':\r\n          if (this[name] !== prev) { // only save manual changes, not values filled in by persona settings\r\n            QR.persona.set(this);\r\n          }\r\n          break;\r\n      }\r\n      if (!forced) { return this.preventAutoPost(); }\r\n    }\r\n\r\n    forceSave() {\r\n      if (this !== QR.selected) { return; }\r\n      // Do this in case people use extensions\r\n      // that do not trigger the `input` event.\r\n      for (var name of ['thread', 'name', 'email', 'sub', 'com', 'filename', 'spoiler', 'flag']) {\r\n        var node;\r\n        if (!(node = QR.nodes[name])) { continue; }\r\n        this.save(node, true);\r\n      }\r\n    }\r\n\r\n    preventAutoPost() {\r\n      // Disable auto-posting if you're editing the first post\r\n      // during the last 5 seconds of the cooldown.\r\n      if (QR.cooldown.auto && (this === QR.posts[0])) {\r\n        QR.cooldown.update(); // adding/removing file can change cooldown\r\n        if (QR.cooldown.seconds <= 5) { return QR.cooldown.auto = false; }\r\n      }\r\n    }\r\n\r\n    setComment(com) {\r\n      this.com = com || null;\r\n      if (this === QR.selected) {\r\n        QR.nodes.com.value = this.com;\r\n      }\r\n      return this.updateComment();\r\n    }\r\n\r\n    updateComment() {\r\n      if (this === QR.selected) {\r\n        QR.characterCount();\r\n      }\r\n      this.nodes.span.textContent = this.com;\r\n      QR.captcha.moreNeeded();\r\n      if (QR.captcha === Captcha.v2) {\r\n        return Captcha.cache.prerequest();\r\n      }\r\n    }\r\n\r\n    isOnlyQuotes() {\r\n      return (this.com || '').trim() === (this.quotedText || '').trim();\r\n    }\r\n\r\n    static rmErrored(e) {\r\n      e.stopPropagation();\r\n      for (let i = QR.posts.length - 1; i >= 0; i--) {\r\n        var errors;\r\n        var post = QR.posts[i];\r\n        if ((errors = post.errors)) {\r\n          for (var error of errors) {\r\n            if (doc.contains(error)) {\r\n              post.rm();\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    error(className, message, link) {\r\n      const div = $.el('div', { className });\r\n      $.extend(div, {\r\n        innerHTML: message + (link ? ` [<a href=\"${E(link)}\" target=\"_blank\">More info</a>]` : '') +\r\n          `<br>[<a href=\"javascript:;\">delete post</a>] [<a href=\"javascript:;\">delete all</a>]`\r\n      });\r\n      (this.errors || (this.errors = [])).push(div);\r\n      const [rm, rmAll] = Array.from($$('a', div));\r\n      $.on(div, 'click', () => {\r\n        if (QR.posts.includes(this)) { return this.select(); }\r\n      });\r\n      $.on(rm, 'click', e => {\r\n        e.stopPropagation();\r\n        if (QR.posts.includes(this)) { return this.rm(); }\r\n      });\r\n      $.on(rmAll, 'click', QR.post.rmErrored);\r\n      return QR.error(div, true);\r\n    }\r\n\r\n    fileError(message, link) {\r\n      return this.error('file-error', `${this.filename}: ${message}`, link);\r\n    }\r\n\r\n    dismissErrors(test = () => true) {\r\n      if (this.errors) {\r\n        for (var error of this.errors) {\r\n          if (doc.contains(error) && test(error)) {\r\n            error.parentNode.previousElementSibling.click();\r\n          }\r\n        }\r\n      }\r\n    }\r\n\r\n    setFile(file) {\r\n      this.file = file;\r\n      if (Conf['Randomize Filename'] && (g.BOARD.ID !== 'f')) {\r\n        let ext;\r\n        this.filename = `${Date.now() * 1000 - Math.floor(Math.random() * 365 * DAY * 1000)}`;\r\n        if (ext = this.file.name.match(QR.validExtension)) { this.filename += ext[0]; }\r\n      } else {\r\n        this.filename = this.file.name;\r\n      }\r\n      this.filesize = $.bytesToString(this.file.size);\r\n      this.checkSize();\r\n      $.addClass(this.nodes.el, 'has-file');\r\n      QR.captcha.moreNeeded();\r\n      URL.revokeObjectURL(this.URL);\r\n      this.saveFilename();\r\n      if (this === QR.selected) {\r\n        this.showFileData();\r\n      } else {\r\n        this.updateFilename();\r\n      }\r\n      this.rmMetadata();\r\n      this.nodes.el.dataset.type = this.file.type;\r\n      this.nodes.el.style.backgroundImage = '';\r\n      if (!QR.mimeTypes.includes(this.file.type)) {\r\n        this.fileError('Unsupported file type.');\r\n      } else if (/^(image|video)\\//.test(this.file.type)) {\r\n        this.readFile();\r\n      }\r\n      return this.preventAutoPost();\r\n    }\r\n\r\n    checkSize() {\r\n      let max = QR.max_size;\r\n      if (/^video\\//.test(this.file.type)) { max = Math.min(max, QR.max_size_video); }\r\n      if (this.file.size > max) {\r\n        return this.fileError(`File too large (file: ${this.filesize}, max: ${$.bytesToString(max)}).`);\r\n      }\r\n    }\r\n\r\n    readFile() {\r\n      const isVideo = /^video\\//.test(this.file.type);\r\n      const el = $.el(isVideo ? 'video' : 'img');\r\n      if (isVideo && !el.canPlayType(this.file.type)) { return; }\r\n\r\n      const event = isVideo ? 'loadeddata' : 'load';\r\n      var onload = () => {\r\n        $.off(el, event, onload);\r\n        $.off(el, 'error', onerror);\r\n        this.checkDimensions(el);\r\n        this.setThumbnail(el);\r\n        return $.event('QRMetadata', null, this.nodes.el);\r\n      };\r\n      var onerror = () => {\r\n        $.off(el, event, onload);\r\n        $.off(el, 'error', onerror);\r\n        this.fileError(`Corrupt ${isVideo ? 'video' : 'image'} or error reading metadata.`, meta.faq + '#error-reading-metadata');\r\n        URL.revokeObjectURL(el.src);\r\n        // XXX https://bugzilla.mozilla.org/show_bug.cgi?id=1021289\r\n        this.nodes.el.removeAttribute('data-height');\r\n        return $.event('QRMetadata', null, this.nodes.el);\r\n      };\r\n      this.nodes.el.dataset.height = 'loading';\r\n      $.on(el, event, onload);\r\n      $.on(el, 'error', onerror);\r\n      return el.src = URL.createObjectURL(this.file);\r\n    }\r\n\r\n    checkDimensions(el) {\r\n      let height, width;\r\n      if (el.tagName === 'IMG') {\r\n        ({ height, width } = el);\r\n        this.nodes.el.dataset.height = height;\r\n        this.nodes.el.dataset.width = width;\r\n        if ((height > QR.max_height) || (width > QR.max_width)) {\r\n          this.fileError(`Image too large (image: ${height}x${width}px, max: ${QR.max_height}x${QR.max_width}px)`);\r\n        }\r\n        if ((height < QR.min_height) || (width < QR.min_width)) {\r\n          return this.fileError(`Image too small (image: ${height}x${width}px, min: ${QR.min_height}x${QR.min_width}px)`);\r\n        }\r\n      } else {\r\n        const { videoHeight, videoWidth, duration } = el;\r\n        this.nodes.el.dataset.height = videoHeight;\r\n        this.nodes.el.dataset.width = videoWidth;\r\n        this.nodes.el.dataset.duration = duration;\r\n        const max_height = Math.min(QR.max_height, QR.max_height_video);\r\n        const max_width = Math.min(QR.max_width, QR.max_width_video);\r\n        if ((videoHeight > max_height) || (videoWidth > max_width)) {\r\n          this.fileError(`Video too large (video: ${videoHeight}x${videoWidth}px, max: ${max_height}x${max_width}px)`);\r\n        }\r\n        if ((videoHeight < QR.min_height) || (videoWidth < QR.min_width)) {\r\n          this.fileError(`Video too small (video: ${videoHeight}x${videoWidth}px, min: ${QR.min_height}x${QR.min_width}px)`);\r\n        }\r\n        if (!isFinite(duration)) {\r\n          this.fileError('Video lacks duration metadata (try remuxing)');\r\n        } else if (duration > QR.max_duration_video) {\r\n          this.fileError(`Video too long (video: ${duration}s, max: ${QR.max_duration_video}s)`);\r\n        }\r\n        if (BoardConfig.noAudio(g.BOARD.ID) && $.hasAudio(el)) {\r\n          return this.fileError('Audio not allowed');\r\n        }\r\n      }\r\n    }\r\n\r\n    setThumbnail(el) {\r\n      // Create a redimensioned thumbnail.\r\n      let height, width;\r\n      const isVideo = el.tagName === 'VIDEO';\r\n\r\n      // Generate thumbnails only if they're really big.\r\n      // Resized pictures through canvases look like ass,\r\n      // so we generate thumbnails `s` times bigger then expected\r\n      // to avoid crappy resized quality.\r\n      let s = 90 * 2 * window.devicePixelRatio;\r\n      if (this.file.type === 'image/gif') { s *= 3; } // let them animate\r\n      if (isVideo) {\r\n        height = el.videoHeight;\r\n        width = el.videoWidth;\r\n      } else {\r\n        ({ height, width } = el);\r\n        if ((height < s) || (width < s)) {\r\n          this.URL = el.src;\r\n          this.nodes.el.style.backgroundImage = `url(${this.URL})`;\r\n          return;\r\n        }\r\n      }\r\n\r\n      if (height <= width) {\r\n        width = (s / height) * width;\r\n        height = s;\r\n      } else {\r\n        height = (s / width) * height;\r\n        width = s;\r\n      }\r\n      const cv = $.el('canvas');\r\n      cv.height = height;\r\n      cv.width = width;\r\n      cv.getContext('2d').drawImage(el, 0, 0, width, height);\r\n      URL.revokeObjectURL(el.src);\r\n      return cv.toBlob(blob => {\r\n        this.URL = URL.createObjectURL(blob);\r\n        return this.nodes.el.style.backgroundImage = `url(${this.URL})`;\r\n      });\r\n    }\r\n\r\n    rmFile() {\r\n      if (this.isLocked) { return; }\r\n      delete this.file;\r\n      delete this.filename;\r\n      delete this.filesize;\r\n      this.nodes.el.removeAttribute('title');\r\n      QR.nodes.filename.removeAttribute('title');\r\n      this.rmMetadata();\r\n      this.nodes.el.style.backgroundImage = '';\r\n      $.rmClass(this.nodes.el, 'has-file');\r\n      this.showFileData();\r\n      URL.revokeObjectURL(this.URL);\r\n      this.dismissErrors(error => $.hasClass(error, 'file-error'));\r\n      return this.preventAutoPost();\r\n    }\r\n\r\n    rmMetadata() {\r\n      for (var attr of ['type', 'height', 'width', 'duration']) {\r\n        // XXX https://bugzilla.mozilla.org/show_bug.cgi?id=1021289\r\n        this.nodes.el.removeAttribute(`data-${attr}`);\r\n      }\r\n    }\r\n\r\n    saveFilename() {\r\n      this.file.newName = (this.filename || '').replace(/[/\\\\]/g, '-');\r\n      if (!QR.validExtension.test(this.filename)) {\r\n        // 4chan will truncate the filename if it has no extension.\r\n        return this.file.newName += `.${$.getOwn(QR.extensionFromType, this.file.type) || 'jpg'}`;\r\n      }\r\n    }\r\n\r\n    updateFilename() {\r\n      const long = `${this.filename} (${this.filesize})`;\r\n      this.nodes.el.title = long;\r\n      if (this !== QR.selected) { return; }\r\n      return QR.nodes.filename.title = long;\r\n    }\r\n\r\n    showFileData() {\r\n      if (this.file) {\r\n        this.updateFilename();\r\n        QR.nodes.filename.value = this.filename;\r\n        $.addClass(QR.nodes.oekaki, 'has-file');\r\n        $.addClass(QR.nodes.fileSubmit, 'has-file');\r\n      } else {\r\n        $.rmClass(QR.nodes.oekaki, 'has-file');\r\n        $.rmClass(QR.nodes.fileSubmit, 'has-file');\r\n      }\r\n      if (this.file?.source != null) {\r\n        QR.nodes.fileSubmit.dataset.source = this.file.source;\r\n      } else {\r\n        QR.nodes.fileSubmit.removeAttribute('data-source');\r\n      }\r\n      return QR.nodes.spoiler.checked = this.spoiler;\r\n    }\r\n\r\n    pasteText(file) {\r\n      this.pasting = true;\r\n      this.preventAutoPost();\r\n      const reader = new FileReader();\r\n      reader.onload = e => {\r\n        const { result } = e.target;\r\n        this.setComment((this.com ? `${this.com}\\n${result}` : result));\r\n        return delete this.pasting;\r\n      };\r\n      return reader.readAsText(file);\r\n    }\r\n\r\n    dragStart(e) {\r\n      const { left, top } = this.getBoundingClientRect();\r\n      e.dataTransfer.setDragImage(this, e.clientX - left, e.clientY - top);\r\n      return $.addClass(this, 'drag');\r\n    }\r\n    dragEnd() { return $.rmClass(this, 'drag'); }\r\n    dragEnter() { return $.addClass(this, 'over'); }\r\n    dragLeave() { return $.rmClass(this, 'over'); }\r\n\r\n    dragOver(e) {\r\n      e.preventDefault();\r\n      return e.dataTransfer.dropEffect = 'move';\r\n    }\r\n\r\n    drop() {\r\n      $.rmClass(this, 'over');\r\n      if (!this.draggable) { return; }\r\n      const el = $('.drag', this.parentNode);\r\n      const index = el => [...Array.from(el.parentNode.children)].indexOf(el);\r\n      const oldIndex = index(el);\r\n      const newIndex = index(this);\r\n      if (QR.posts[oldIndex].isLocked || QR.posts[newIndex].isLocked) { return; }\r\n      (oldIndex < newIndex ? $.after : $.before)(this, el);\r\n      const post = QR.posts.splice(oldIndex, 1)[0];\r\n      QR.posts.splice(newIndex, 0, post);\r\n      QR.status();\r\n      return QR.captcha.updateThread?.();\r\n    }\r\n  }\r\n\r\n};\r\nexport default QR;\r\n","import QR from \"../Posting/QR\";\r\nimport $ from \"./$\";\r\nimport { dict, platform } from \"./helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * DS206: Consider reworking classes to avoid initClass\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nlet eventPageRequest;\r\nif (platform === 'crx') {\r\n  eventPageRequest = (function () {\r\n    const callbacks = [];\r\n    chrome.runtime.onMessage.addListener(function(response) {\r\n      callbacks[response.id](response.data);\r\n      return delete callbacks[response.id];});\r\n    return (params, cb) => chrome.runtime.sendMessage(params, id => callbacks[id] = cb);\r\n  })();\r\n}\r\nvar CrossOrigin = {\r\n  binary(url, cb, headers = dict()) {\r\n    // XXX https://forums.lanik.us/viewtopic.php?f=64&t=24173&p=78310\r\n    url = url.replace(/^((?:https?:)?\\/\\/(?:\\w+\\.)?(?:4chan|4channel|4cdn)\\.org)\\/adv\\//, '$1//adv/');\r\n    if (platform === 'crx') {\r\n    eventPageRequest({type: 'ajax', url, headers, responseType: 'arraybuffer'}, function({response, responseHeaderString}) {\r\n      if (response) { response = new Uint8Array(response); }\r\n      return cb(response, responseHeaderString);\r\n    });\r\n    } else {\r\n      const fallback = function() {\r\n        return $.ajax(url, {\r\n          headers,\r\n          responseType: 'arraybuffer',\r\n          onloadend() {\r\n            if (this.status && this.response) {\r\n              return cb(new Uint8Array(this.response), this.getAllResponseHeaders());\r\n            } else {\r\n              return cb(null);\r\n            }\r\n          }\r\n        });\r\n      };\r\n      if ((typeof window.GM_xmlhttpRequest === 'undefined' || window.GM_xmlhttpRequest === null)) {\r\n        fallback();\r\n        return;\r\n      }\r\n      const gmOptions = {\r\n        method: \"GET\",\r\n        url,\r\n        headers,\r\n        responseType: 'arraybuffer',\r\n        overrideMimeType: 'text/plain; charset=x-user-defined',\r\n        onload(xhr) {\r\n          let data;\r\n          if (xhr.response instanceof ArrayBuffer) {\r\n            data = new Uint8Array(xhr.response);\r\n          } else {\r\n            const r = xhr.responseText;\r\n            data = new Uint8Array(r.length);\r\n            let i = 0;\r\n            while (i < r.length) {\r\n              data[i] = r.charCodeAt(i);\r\n              i++;\r\n            }\r\n          }\r\n          return cb(data, xhr.responseHeaders);\r\n        },\r\n        onerror() {\r\n          return cb(null);\r\n        },\r\n        onabort() {\r\n          return cb(null);\r\n        }\r\n      };\r\n      try {\r\n        return (GM?.xmlHttpRequest || GM_xmlhttpRequest)(gmOptions);\r\n      } catch (error) {\r\n        return fallback();\r\n      }\r\n    }\r\n  },\r\n\r\n  file(url, cb) {\r\n    return CrossOrigin.binary(url, function(data, headers) {\r\n      if (data == null) { return cb(null); }\r\n      let name = url.match(/([^\\/?#]+)\\/*(?:$|[?#])/)?.[1];\r\n      const contentType        = headers.match(/Content-Type:\\s*(.*)/i)?.[1];\r\n      const contentDisposition = headers.match(/Content-Disposition:\\s*(.*)/i)?.[1];\r\n      let mime = contentType?.match(/[^;]*/)[0] || 'application/octet-stream';\r\n      const match =\r\n        contentDisposition?.match(/\\bfilename\\s*=\\s*\"((\\\\\"|[^\"])+)\"/i)?.[1] ||\r\n        contentType?.match(/\\bname\\s*=\\s*\"((\\\\\"|[^\"])+)\"/i)?.[1];\r\n      if (match) {\r\n        name = match.replace(/\\\\\"/g, '\"');\r\n      }\r\n      if (/^text\\/plain;\\s*charset=x-user-defined$/i.test(mime)) {\r\n        // In JS Blocker (Safari) content type comes back as 'text/plain; charset=x-user-defined'; guess from filename instead.\r\n        mime = $.getOwn(QR.typeFromExtension, name.match(/[^.]*$/)[0].toLowerCase()) || 'application/octet-stream';\r\n      }\r\n      const blob = new Blob([data], {type: mime});\r\n      blob.name = name;\r\n      return cb(blob);\r\n    });\r\n  },\r\n\r\n  Request: (function() {\r\n    const Request = class Request {\r\n      static initClass() {\r\n        this.prototype.status = 0;\r\n        this.prototype.statusText = '';\r\n        this.prototype.response = null;\r\n        this.prototype.responseHeaderString = null;\r\n      }\r\n      getResponseHeader(headerName) {\r\n        if ((this.responseHeaders == null) && (this.responseHeaderString != null)) {\r\n          this.responseHeaders = dict();\r\n          for (var header of this.responseHeaderString.split('\\r\\n')) {\r\n            var i;\r\n            if ((i = header.indexOf(':')) >= 0) {\r\n              var key = header.slice(0, i).trim().toLowerCase();\r\n              var val = header.slice(i+1).trim();\r\n              this.responseHeaders[key] = val;\r\n            }\r\n          }\r\n        }\r\n        return this.responseHeaders?.[headerName.toLowerCase()] ?? null;\r\n      }\r\n      abort() {}\r\n      onloadend() {}\r\n    };\r\n    Request.initClass();\r\n    return Request;\r\n  })(),\r\n\r\n  // Attempts to fetch `url` using cross-origin privileges, if available.\r\n  // Interface is a subset of that of $.ajax.\r\n  // Options:\r\n  //   `onloadend` - called with the returned object as `this` on success or error/abort/timeout.\r\n  //   `timeout` - time limit for request\r\n  //   `responseType` - expected response type, 'json' by default; 'json' and 'text' supported\r\n  //   `headers` - request headers\r\n  // Returned object properties:\r\n  //   `status` - HTTP status (0 if connection not successful)\r\n  //   `statusText` - HTTP status text\r\n  //   `response` - decoded response body\r\n  //   `abort` - function for aborting the request (silently fails on some platforms)\r\n  //   `getResponseHeader` - function for reading response headers\r\n  ajax(url, options={}) {\r\n    let gmReq;\r\n    let {onloadend, timeout, responseType, headers} = options;\r\n    if (responseType == null) { responseType = 'json'; }\r\n\r\n    if ((window.GM?.xmlHttpRequest == null) && (typeof window.GM_xmlhttpRequest === 'undefined' || window.GM_xmlhttpRequest === null)) {\r\n      return $.ajax(url, options);\r\n    }\r\n\r\n    const req = new CrossOrigin.Request();\r\n    req.onloadend = onloadend;\r\n\r\n    if (platform === 'userscript') {\r\n      const gmOptions = {\r\n        method: 'GET',\r\n        url,\r\n        headers,\r\n        timeout,\r\n        onload(xhr) {\r\n          try {\r\n            const response = (() => { switch (responseType) {\r\n              case 'json':\r\n                if (xhr.responseText) { return JSON.parse(xhr.responseText); } else { return null; }\r\n              default:\r\n                return xhr.responseText;\r\n            } })();\r\n            $.extend(req, {\r\n              response,\r\n              status: xhr.status,\r\n              statusText: xhr.statusText,\r\n              responseHeaderString: xhr.responseHeaders\r\n            });\r\n          } catch (error) {}\r\n          return req.onloadend();\r\n        },\r\n        onerror() { return req.onloadend(); },\r\n        onabort() { return req.onloadend(); },\r\n        ontimeout() { return req.onloadend(); }\r\n      };\r\n      try {\r\n        gmReq = (GM?.xmlHttpRequest || GM_xmlhttpRequest)(gmOptions);\r\n      } catch (error) {\r\n        return $.ajax(url, options);\r\n      }\r\n\r\n      if (gmReq && (typeof gmReq.abort === 'function')) {\r\n        req.abort = function() {\r\n          try {\r\n            return gmReq.abort();\r\n          } catch (error1) {}\r\n        };\r\n      }\r\n    } else {\r\n      eventPageRequest({type: 'ajax', url, responseType, headers, timeout}, function(result) {\r\n        if (result.status) {\r\n          $.extend(req, result);\r\n        }\r\n        return req.onloadend();\r\n      });\r\n    }\r\n\r\n    return req;\r\n  },\r\n\r\n  cache(url, cb) {\r\n    return $.cache(url, cb,\r\n      {ajax: CrossOrigin.ajax});\r\n  },\r\n\r\n  permission(cb, cbFail, origins) {\r\n    if (platform === 'crx') {\r\n      return eventPageRequest({type: 'permission', origins}, function(result) {\r\n        if (result) {\r\n          return cb();\r\n        } else {\r\n          return cbFail();\r\n        }\r\n      });\r\n    }\r\n    return cb();\r\n  },\r\n};\r\nexport default CrossOrigin;\r\n","/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n// loosely follows the jquery api:\r\n// http://api.jquery.com/\r\n\r\nimport Notice from \"../classes/Notice\";\r\nimport { c, Conf, d, doc, g } from \"../globals/globals\";\r\nimport CrossOrigin from \"./CrossOrigin\";\r\nimport { debounce, dict, MINUTE, platform, SECOND } from \"./helpers\";\r\n\r\n// not chainable\r\nconst $ = (selector, root = document.body) => root.querySelector(selector);\r\n\r\n$.id = id => d.getElementById(id);\r\n\r\n$.ready = function(fc) {\r\n  if (d.readyState !== 'loading') {\r\n    $.queueTask(fc);\r\n    return;\r\n  }\r\n  var cb = function() {\r\n    $.off(d, 'DOMContentLoaded', cb);\r\n    return fc();\r\n  };\r\n  return $.on(d, 'DOMContentLoaded', cb);\r\n};\r\n\r\n$.formData = function(form) {\r\n  if (form instanceof HTMLFormElement) {\r\n    return new FormData(form);\r\n  }\r\n  const fd = new FormData();\r\n  for (var key in form) {\r\n    var val = form[key];\r\n    if (val) {\r\n      if ((typeof val === 'object') && 'newName' in val) {\r\n        fd.append(key, val, val.newName);\r\n      } else {\r\n        fd.append(key, val);\r\n      }\r\n    }\r\n  }\r\n  return fd;\r\n};\r\n\r\n$.extend = function(object, properties) {\r\n  for (var key in properties) {\r\n    var val = properties[key];\r\n    object[key] = val;\r\n  }\r\n};\r\n\r\n$.hasOwn = (obj, key) => Object.prototype.hasOwnProperty.call(obj, key);\r\n\r\n$.getOwn = function(obj, key) {\r\n  if (Object.prototype.hasOwnProperty.call(obj, key)) { return obj[key]; } else { return undefined; }\r\n};\r\n\r\n$.ajax = (function() {\r\n  let pageXHR;\r\n  if (window.wrappedJSObject && !XMLHttpRequest.wrappedJSObject) {\r\n    pageXHR = XPCNativeWrapper(window.wrappedJSObject.XMLHttpRequest);\r\n  } else {\r\n    pageXHR = XMLHttpRequest;\r\n  }\r\n\r\n  const r = (function (url, options={}) {\r\n    if (options.responseType == null) { options.responseType = 'json'; }\r\n    if (!options.type) { options.type = (options.form && 'post') || 'get'; }\r\n    // XXX https://forums.lanik.us/viewtopic.php?f=64&t=24173&p=78310\r\n    url = url.replace(/^((?:https?:)?\\/\\/(?:\\w+\\.)?(?:4chan|4channel|4cdn)\\.org)\\/adv\\//, '$1//adv/');\r\n    if (platform === 'crx') {\r\n      // XXX https://bugs.chromium.org/p/chromium/issues/detail?id=920638\r\n      if (Conf['Work around CORB Bug'] && g.SITE.software === 'yotsuba' && !options.testCORB && FormData.prototype.entries) {\r\n        return $.ajaxPage(url, options);\r\n      }\r\n    }\r\n    const {onloadend, timeout, responseType, withCredentials, type, onprogress, form, headers} = options;\r\n    const r = new pageXHR();\r\n    try {\r\n      r.open(type, url, true);\r\n      const object = headers || {};\r\n      for (var key in object) {\r\n        var value = object[key];\r\n        r.setRequestHeader(key, value);\r\n      }\r\n      $.extend(r, {onloadend, timeout, responseType, withCredentials});\r\n      $.extend(r.upload, {onprogress});\r\n      // connection error or content blocker\r\n      $.on(r, 'error', function() { if (!r.status) { return c.warn(`4chan X failed to load: ${url}`); } });\r\n      if (platform === 'crx') {\r\n        // https://bugs.chromium.org/p/chromium/issues/detail?id=920638\r\n        $.on(r, 'load', () => {\r\n          if (!Conf['Work around CORB Bug'] && r.readyState === 4 && r.status === 200 && r.statusText === '' && r.response === null) {\r\n            $.set('Work around CORB Bug', (Conf['Work around CORB Bug'] = Date.now()));\r\n          }\r\n        });\r\n      }\r\n      r.send(form);\r\n    } catch (err) {\r\n      // XXX Some content blockers in Firefox (e.g. Adblock Plus and NoScript) throw an exception instead of simulating a connection error.\r\n      if (err.result !== 0x805e0006) { throw err; }\r\n      r.onloadend = onloadend;\r\n      $.queueTask($.event, 'error',   null, r);\r\n      $.queueTask($.event, 'loadend', null, r);\r\n    }\r\n    return r;\r\n  });\r\n\r\n  if (platform === 'userscript') {\r\n    return r;\r\n  } else {\r\n    // # XXX https://bugs.chromium.org/p/chromium/issues/detail?id=920638\r\n    let requestID = 0;\r\n    const requests = dict();\r\n\r\n    $.ajaxPageInit = function() {\r\n      $.global(function() {\r\n        window.FCX.requests = Object.create(null);\r\n\r\n        document.addEventListener('4chanXAjax', function(e) {\r\n          let fd, r;\r\n          const {url, timeout, responseType, withCredentials, type, onprogress, form, headers, id} = e.detail;\r\n          window.FCX.requests[id] = (r = new XMLHttpRequest());\r\n          r.open(type, url, true);\r\n          const object = headers || {};\r\n          for (var key in object) {\r\n            var value = object[key];\r\n            r.setRequestHeader(key, value);\r\n          }\r\n          r.responseType = responseType === 'document' ? 'text' : responseType;\r\n          r.timeout = timeout;\r\n          r.withCredentials = withCredentials;\r\n          if (onprogress) {\r\n            r.upload.onprogress = function(e) {\r\n              const {loaded, total} = e;\r\n              const detail = {loaded, total, id};\r\n              return document.dispatchEvent(new CustomEvent('4chanXAjaxProgress', {bubbles: true, detail}));\r\n            };\r\n          }\r\n          r.onloadend = function() {\r\n            delete window.FCX.requests[id];\r\n            const {status, statusText, response} = this;\r\n            const responseHeaderString = this.getAllResponseHeaders();\r\n            const detail = {status, statusText, response, responseHeaderString, id};\r\n            return document.dispatchEvent(new CustomEvent('4chanXAjaxLoadend', {bubbles: true, detail}));\r\n          };\r\n          // connection error or content blocker\r\n          r.onerror = function() {\r\n            if (!r.status) { return console.warn(`4chan X failed to load: ${url}`); }\r\n          };\r\n          if (form) {\r\n            fd = new FormData();\r\n            for (var entry of form) {\r\n              fd.append(entry[0], entry[1]);\r\n            }\r\n          } else {\r\n            fd = null;\r\n          }\r\n          return r.send(fd);\r\n      }\r\n        , false);\r\n\r\n      return document.addEventListener('4chanXAjaxAbort', function(e) {\r\n        let r;\r\n        if (!(r = window.FCX.requests[e.detail.id])) { return; }\r\n        return r.abort();\r\n      }\r\n      , false);\r\n    });\r\n\r\n    $.on(d, '4chanXAjaxProgress', function(e) {\r\n      let req;\r\n      if (!(req = requests[e.detail.id])) { return; }\r\n      return req.upload.onprogress.call(req.upload, e.detail);\r\n    });\r\n\r\n    return $.on(d, '4chanXAjaxLoadend', function(e) {\r\n      let req;\r\n      if (!(req = requests[e.detail.id])) { return; }\r\n      delete requests[e.detail.id];\r\n      if (e.detail.status) {\r\n        for (var key of ['status', 'statusText', 'response', 'responseHeaderString']) {\r\n          req[key] = e.detail[key];\r\n        }\r\n        if (req.responseType === 'document') {\r\n          req.response = new DOMParser().parseFromString(e.detail.response, 'text/html');\r\n        }\r\n      }\r\n      return req.onloadend();\r\n    });\r\n  };\r\n\r\n  return $.ajaxPage = function(url, options={}) {\r\n      let req;\r\n      let {onloadend, timeout, responseType, withCredentials, type, onprogress, form, headers} = options;\r\n        const id = requestID++;\r\n        requests[id] = (req = new CrossOrigin.Request());\r\n      $.extend(req, {responseType, onloadend});\r\n      req.upload = {onprogress};\r\n      req.abort = () => $.event('4chanXAjaxAbort', {id});\r\n        if (form) { form = Array.from(form.entries()); }\r\n      $.event('4chanXAjax', {url, timeout, responseType, withCredentials, type, onprogress: !!onprogress, form, headers, id});\r\n        return req;\r\n    };\r\n  }\r\n})();\r\n\r\n// Status Code 304: Not modified\r\n// With the `If-Modified-Since` header we only receive the HTTP headers and no body for 304 responses.\r\n// This saves a lot of bandwidth and CPU time for both the users and the servers.\r\n$.lastModified = dict();\r\n$.whenModified = function(url, bucket, cb, options={}) {\r\n  let t;\r\n  const {timeout, ajax} = options;\r\n  const params = [];\r\n  // XXX https://bugs.chromium.org/p/chromium/issues/detail?id=643659\r\n  if ($.engine === 'blink') { params.push(`s=${bucket}`); }\r\n  if (url.split('/')[2] === 'a.4cdn.org') { params.push(`t=${Date.now()}`); }\r\n  const url0 = url;\r\n  if (params.length) { url += '?' + params.join('&'); }\r\n  const headers = dict();\r\n  if ((t = $.lastModified[bucket]?.[url0]) != null) {\r\n    headers['If-Modified-Since'] = t;\r\n  }\r\n  const r = (ajax || $.ajax)(url, {\r\n    onloadend() {\r\n      ($.lastModified[bucket] || ($.lastModified[bucket] = dict()))[url0] = this.getResponseHeader('Last-Modified');\r\n      return cb.call(this);\r\n    },\r\n    timeout,\r\n    headers\r\n  });\r\n  return r;\r\n};\r\n\r\n(function() {\r\n  const reqs = dict();\r\n  $.cache = function(url, cb, options={}) {\r\n    let req;\r\n    const {ajax} = options;\r\n    if (req = reqs[url]) {\r\n      if (req.callbacks) {\r\n        req.callbacks.push(cb);\r\n      } else {\r\n        $.queueTask(() => cb.call(req, {isCached: true}));\r\n      }\r\n      return req;\r\n    }\r\n    const onloadend = function() {\r\n      if (!this.status) {\r\n        delete reqs[url];\r\n      }\r\n      for (cb of this.callbacks) {\r\n        (cb => $.queueTask(() => cb.call(this, {isCached: false})))(cb);\r\n      }\r\n      return delete this.callbacks;\r\n    };\r\n    req = (ajax || $.ajax)(url, {onloadend});\r\n    req.callbacks = [cb];\r\n    return reqs[url] = req;\r\n  };\r\n  return $.cleanCache = function(testf) {\r\n    for (var url in reqs) {\r\n      if (testf(url)) {\r\n        delete reqs[url];\r\n      }\r\n    }\r\n  };\r\n})();\r\n\r\n$.cb = {\r\n  checked() {\r\n    if ($.hasOwn(Conf, this.name)) {\r\n      $.set(this.name, this.checked);\r\n      return Conf[this.name] = this.checked;\r\n    }\r\n  },\r\n  value() {\r\n    if ($.hasOwn(Conf, this.name)) {\r\n      $.set(this.name, this.value.trim());\r\n      return Conf[this.name] = this.value;\r\n    }\r\n  }\r\n};\r\n\r\n$.asap = function(test, cb) {\r\n  if (test()) {\r\n    return cb();\r\n  } else {\r\n    return setTimeout($.asap, 25, test, cb);\r\n  }\r\n};\r\n\r\n$.onExists = function(root, selector, cb) {\r\n  let el;\r\n  if (el = $(selector, root)) {\r\n    return cb(el);\r\n  }\r\n  var observer = new MutationObserver(function() {\r\n    if (el = $(selector, root)) {\r\n      observer.disconnect();\r\n      return cb(el);\r\n    }\r\n  });\r\n  return observer.observe(root, {childList: true, subtree: true});\r\n};\r\n\r\n$.addStyle = function(css, id, test='head') {\r\n  const style = $.el('style',\r\n    {textContent: css});\r\n  if (id != null) { style.id = id; }\r\n  $.onExists(doc, test, () => $.add(d.head, style));\r\n  return style;\r\n};\r\n\r\n$.addCSP = function(policy) {\r\n  const meta = $.el('meta', {\r\n    httpEquiv: 'Content-Security-Policy',\r\n    content:   policy\r\n  }\r\n  );\r\n  if (d.head) {\r\n    $.add(d.head, meta);\r\n    return $.rm(meta);\r\n  } else {\r\n    const head = $.add((doc || d), $.el('head'));\r\n    $.add(head, meta);\r\n    return $.rm(head);\r\n  }\r\n};\r\n\r\n$.x = function(path, root) {\r\n  if (!root) { root = d.body; }\r\n  // XPathResult.ANY_UNORDERED_NODE_TYPE === 8\r\n  return d.evaluate(path, root, null, 8, null).singleNodeValue;\r\n};\r\n\r\n$.X = function(path, root) {\r\n  if (!root) { root = d.body; }\r\n  // XPathResult.ORDERED_NODE_SNAPSHOT_TYPE === 7\r\n  return d.evaluate(path, root, null, 7, null);\r\n};\r\n\r\n$.addClass = function(el, ...classNames) {\r\n  for (var className of classNames) { el.classList.add(className); }\r\n};\r\n\r\n$.rmClass = function(el, ...classNames) {\r\n  for (var className of classNames) { el.classList.remove(className); }\r\n};\r\n\r\n$.toggleClass = (el, className) => el.classList.toggle(className);\r\n\r\n$.hasClass = (el, className) => el.classList.contains(className);\r\n\r\n$.rm = el => el?.remove();\r\n\r\n$.rmAll = root => // https://gist.github.com/MayhemYDG/8646194\r\nroot.textContent = null;\r\n\r\n$.tn = s => d.createTextNode(s);\r\n\r\n$.frag = () => d.createDocumentFragment();\r\n\r\n$.nodes = function(nodes) {\r\n  if (!(nodes instanceof Array)) {\r\n    return nodes;\r\n  }\r\n  const frag = $.frag();\r\n  for (var node of nodes) {\r\n    frag.appendChild(node);\r\n  }\r\n  return frag;\r\n};\r\n\r\n$.add = (parent, el) => parent.appendChild($.nodes(el));\r\n\r\n$.prepend = (parent, el) => parent.insertBefore($.nodes(el), parent.firstChild);\r\n\r\n$.after = (root, el) => root.parentNode.insertBefore($.nodes(el), root.nextSibling);\r\n\r\n$.before = (root, el) => root.parentNode.insertBefore($.nodes(el), root);\r\n\r\n$.replace = (root, el) => root.parentNode.replaceChild($.nodes(el), root);\r\n\r\n$.el = function(tag, properties, properties2) {\r\n  const el = d.createElement(tag);\r\n  if (properties) { $.extend(el, properties); }\r\n  if (properties2) { $.extend(el, properties2); }\r\n  return el;\r\n};\r\n\r\n$.on = function(el, events, handler) {\r\n  for (var event of events.split(' ')) {\r\n    el.addEventListener(event, handler, false);\r\n  }\r\n};\r\n\r\n$.off = function(el, events, handler) {\r\n  for (var event of events.split(' ')) {\r\n    el.removeEventListener(event, handler, false);\r\n  }\r\n};\r\n\r\n$.one = function(el, events, handler) {\r\n  var cb = function(e) {\r\n    $.off(el, events, cb);\r\n    return handler.call(this, e);\r\n  };\r\n  return $.on(el, events, cb);\r\n};\r\n\r\n$.event = function(event, detail, root=d) {\r\n  if (!globalThis.chrome?.extension) {\r\n    if ((detail != null) && (typeof cloneInto === 'function')) {\r\n      detail = cloneInto(detail, d.defaultView);\r\n    }\r\n  }\r\n  return root.dispatchEvent(new CustomEvent(event, {bubbles: true, cancelable: true, detail}));\r\n};\r\n\r\nif (platform === 'userscript') {\r\n  // XXX Make $.event work in Pale Moon with GM 3.x (no cloneInto function).\r\n  (function() {\r\n    if (!/PaleMoon\\//.test(navigator.userAgent) || (+GM_info?.version?.split('.')[0] < 2) || (typeof cloneInto !== 'undefined')) { return; }\r\n\r\n    try {\r\n      return new CustomEvent('x', {detail: {}});\r\n    } catch (err) {\r\n      const unsafeConstructors = {\r\n        Object: unsafeWindow.Object,\r\n        Array:  unsafeWindow.Array\r\n      };\r\n      var clone = function(obj) {\r\n        let constructor;\r\n        if ((obj != null) && (typeof obj === 'object') && (constructor = unsafeConstructors[obj.constructor.name])) {\r\n          const obj2 = new constructor();\r\n          for (var key in obj) { var val = obj[key]; obj2[key] = clone(val); }\r\n          return obj2;\r\n        } else {\r\n          return obj;\r\n        }\r\n      };\r\n      return $.event = (event, detail, root=d) => root.dispatchEvent(new CustomEvent(event, {bubbles: true, cancelable: true, detail: clone(detail)}));\r\n    }\r\n  })();\r\n}\r\n\r\n$.modifiedClick = e => e.shiftKey || e.altKey || e.ctrlKey || e.metaKey || (e.button !== 0);\r\n\r\nif (!globalThis.chrome?.extension) {\r\n  $.open =\r\n    (GM?.openInTab != null) ?\r\n      GM.openInTab\r\n    : (typeof GM_openInTab !== 'undefined' && GM_openInTab !== null) ?\r\n      GM_openInTab\r\n    :\r\n      url => window.open(url, '_blank');\r\n} else {\r\n  $.open =\r\n    url => window.open(url, '_blank');\r\n} \r\n\r\n$.debounce = function(wait, fn) {\r\n  let lastCall = 0;\r\n  let timeout  = null;\r\n  let that     = null;\r\n  let args     = null;\r\n  const exec = function() {\r\n    lastCall = Date.now();\r\n    return fn.apply(that, args);\r\n  };\r\n  return function() {\r\n    args = arguments;\r\n    that = this;\r\n    if (lastCall < (Date.now() - wait)) {\r\n      return exec();\r\n    }\r\n    // stop current reset\r\n    clearTimeout(timeout);\r\n    // after wait, let next invocation execute immediately\r\n    return timeout = setTimeout(exec, wait);\r\n  };\r\n};\r\n\r\n$.queueTask = (function() {\r\n  // inspired by https://www.w3.org/Bugs/Public/show_bug.cgi?id=15007\r\n  const taskQueue = [];\r\n  const execTask = function() {\r\n    const task = taskQueue.shift();\r\n    const func = task[0];\r\n    const args = Array.prototype.slice.call(task, 1);\r\n    return func.apply(func, args);\r\n  };\r\n  if (window.MessageChannel) {\r\n    const taskChannel = new MessageChannel();\r\n    taskChannel.port1.onmessage = execTask;\r\n    return function() {\r\n      taskQueue.push(arguments);\r\n      return taskChannel.port2.postMessage(null);\r\n    };\r\n  } else { // XXX Firefox\r\n    return function() {\r\n      taskQueue.push(arguments);\r\n      return setTimeout(execTask, 0);\r\n    };\r\n  }\r\n})();\r\n\r\n$.global = function(fn, data) {\r\n  if (doc) {\r\n    const script = $.el('script',\r\n      {textContent: `(${fn}).call(document.currentScript.dataset);`});\r\n    if (data) { $.extend(script.dataset, data); }\r\n    $.add((d.head || doc), script);\r\n    $.rm(script);\r\n    return script.dataset;\r\n  } else {\r\n    // XXX dwb\r\n    try {\r\n      fn.call(data);\r\n    } catch (error) {}\r\n    return data;\r\n  }\r\n};\r\n\r\n$.bytesToString = function(size) {\r\n  let unit = 0; // Bytes\r\n  while (size >= 1024) {\r\n    size /= 1024;\r\n    unit++;\r\n  }\r\n  // Remove trailing 0s.\r\n  size =\r\n    unit > 1 ?\r\n      // Keep the size as a float if the size is greater than 2^20 B.\r\n      // Round to hundredth.\r\n      Math.round(size * 100) / 100\r\n    :\r\n      // Round to an integer otherwise.\r\n      Math.round(size);\r\n  return `${size} ${['B', 'KB', 'MB', 'GB'][unit]}`;\r\n};\r\n\r\n$.minmax = (value, min, max) => value < min ?\r\n  min\r\n:\r\n  value > max ?\r\n    max\r\n  :\r\n    value;\r\n\r\n$.hasAudio = video => video.mozHasAudio || !!video.webkitAudioDecodedByteCount;\r\n\r\n$.luma = rgb => (rgb[0] * 0.299) + (rgb[1] * 0.587) + (rgb[2] * 0.114);\r\n\r\n$.unescape = function(text) {\r\n  if (text == null) { return text; }\r\n  return text.replace(/<[^>]*>/g, '').replace(/&(amp|#039|quot|lt|gt|#44);/g, c => ({'&amp;': '&', '&#039;': \"'\", '&quot;': '\"', '&lt;': '<', '&gt;': '>', '&#44;': ','})[c]);\r\n};\r\n\r\n$.isImage = url => /\\.(jpe?g|jfif|png|gif|bmp|webp|avif|jxl)$/i.test(url);\r\n$.isVideo = url => /\\.(webm|mp4|ogv)$/i.test(url);\r\n\r\n$.engine = (function() {\r\n  if (/Edge\\//.test(navigator.userAgent)) { return 'edge'; }\r\n  if (/Chrome\\//.test(navigator.userAgent)) { return 'blink'; }\r\n  if (/WebKit\\//.test(navigator.userAgent)) { return 'webkit'; }\r\n  if (/Gecko\\/|Goanna/.test(navigator.userAgent)) { return 'gecko'; } // Goanna = Pale Moon 26+\r\n})();\r\n\r\n$.hasStorage = (function() {\r\n  try {\r\n    if (localStorage.getItem(g.NAMESPACE + 'hasStorage') === 'true') { return true; }\r\n    localStorage.setItem(g.NAMESPACE + 'hasStorage', 'true');\r\n    return localStorage.getItem(g.NAMESPACE + 'hasStorage') === 'true';\r\n  } catch (error) {\r\n    return false;\r\n  }\r\n})();\r\n\r\n$.item = function(key, val) {\r\n  const item = dict();\r\n  item[key] = val;\r\n  return item;\r\n};\r\n\r\n$.oneItemSugar = fn => (function(key, val, cb) {\r\n  if (typeof key === 'string') {\r\n    return fn($.item(key, val), cb);\r\n  } else {\r\n    return fn(key, val);\r\n  }\r\n});\r\n\r\n$.syncing = dict();\r\n\r\n$.securityCheck = function(data) {\r\n  if (location.protocol !== 'https:') {\r\n    return delete data['Redirect to HTTPS'];\r\n  }\r\n};\r\n\r\nif (platform === 'crx') {\r\n  // https://developer.chrome.com/extensions/storage.html\r\n  $.oldValue = {\r\n    local: dict(),\r\n    sync:  dict()\r\n  };\r\n\r\n  chrome.storage.onChanged.addListener(function(changes, area) {\r\n    for (var key in changes) {\r\n      var oldValue = $.oldValue.local[key] ?? $.oldValue.sync[key];\r\n      $.oldValue[area][key] = dict.clone(changes[key].newValue);\r\n      var newValue = $.oldValue.local[key] ?? $.oldValue.sync[key];\r\n      var cb = $.syncing[key];\r\n      if (cb && (JSON.stringify(newValue) !== JSON.stringify(oldValue))) {\r\n        cb(newValue, key);\r\n      }\r\n    }\r\n  });\r\n  $.sync = (key, cb) => $.syncing[key] = cb;\r\n  $.forceSync = function() {  };\r\n\r\n  $.crxWorking = function() {\r\n    try {\r\n      if (chrome.runtime.getManifest()) {\r\n        return true;\r\n      }\r\n    } catch (error) {}\r\n    if (!$.crxWarningShown) {\r\n      const msg = $.el('div',\r\n        {innerHTML: '4chan X seems to have been updated. You will need to <a href=\"javascript:;\">reload</a> the page.'});\r\n      $.on($('a', msg), 'click', () => location.reload());\r\n      new Notice('warning', msg);\r\n      $.crxWarningShown = true;\r\n    }\r\n    return false;\r\n  };\r\n\r\n  $.get = $.oneItemSugar(function(data, cb) {\r\n    if (!$.crxWorking()) { return; }\r\n    const results = {};\r\n    const get = function(area) {\r\n      let keys = Object.keys(data);\r\n      // XXX slow performance in Firefox\r\n      if (($.engine === 'gecko') && (area === 'sync') && (keys.length > 3)) {\r\n        keys = null;\r\n      }\r\n      return chrome.storage[area].get(keys, function(result) {\r\n        let key;\r\n        result = dict.clone(result);\r\n        if (chrome.runtime.lastError) {\r\n          c.error(chrome.runtime.lastError.message);\r\n        }\r\n        if (keys === null) {\r\n          const result2 = dict();\r\n          for (key in result) { var val = result[key]; if ($.hasOwn(data, key)) { result2[key] = val; } }\r\n          result = result2;\r\n        }\r\n        for (key in data) {\r\n          $.oldValue[area][key] = result[key];\r\n        }\r\n        results[area] = result;\r\n        if (results.local && results.sync) {\r\n          $.extend(data, results.sync);\r\n          $.extend(data, results.local);\r\n          return cb(data);\r\n        }\r\n      });\r\n    };\r\n    get('local');\r\n    return get('sync');\r\n  });\r\n\r\n  (function() {\r\n    const items = {\r\n      local: dict(),\r\n      sync:  dict()\r\n    };\r\n\r\n    const exceedsQuota = (key, value) => // bytes in UTF-8\r\n    unescape(encodeURIComponent(JSON.stringify(key))).length + unescape(encodeURIComponent(JSON.stringify(value))).length > chrome.storage.sync.QUOTA_BYTES_PER_ITEM;\r\n\r\n    $.delete = function(keys) {\r\n      if (!$.crxWorking()) { return; }\r\n      if (typeof keys === 'string') {\r\n        keys = [keys];\r\n      }\r\n      for (var key of keys) {\r\n        delete items.local[key];\r\n        delete items.sync[key];\r\n      }\r\n      chrome.storage.local.remove(keys);\r\n      return chrome.storage.sync.remove(keys);\r\n    };\r\n\r\n    const timeout = {};\r\n    var setArea = function(area, cb) {\r\n      const data = dict();\r\n      $.extend(data, items[area]);\r\n      if (!Object.keys(data).length || (timeout[area] > Date.now())) { return; }\r\n      return chrome.storage[area].set(data, function() {\r\n        let err;\r\n        let key;\r\n        if (err = chrome.runtime.lastError) {\r\n          c.error(err.message);\r\n          setTimeout(setArea, MINUTE, area);\r\n          timeout[area] = Date.now() + MINUTE;\r\n          return cb?.(err);\r\n        }\r\n\r\n        delete timeout[area];\r\n        for (key in data) { if (items[area][key] === data[key]) { delete items[area][key]; } }\r\n        if (area === 'local') {\r\n          for (key in data) { var val = data[key]; if (!exceedsQuota(key, val)) { items.sync[key] = val; } }\r\n          setSync();\r\n        } else {\r\n          chrome.storage.local.remove(((() => {\r\n            const result = [];\r\n            for (key in data) {\r\n              if (!(key in items.local)) {\r\n                result.push(key);\r\n              }\r\n            }\r\n            return result;\r\n          })()));\r\n        }\r\n        return cb?.();\r\n      });\r\n    };\r\n\r\n    var setSync = debounce(SECOND, () => setArea('sync'));\r\n\r\n    $.set = $.oneItemSugar(function(data, cb) {\r\n      if (!$.crxWorking()) { return; }\r\n      $.securityCheck(data);\r\n      $.extend(items.local, data);\r\n      return setArea('local', cb);\r\n    });\r\n\r\n    return $.clear = function(cb) {\r\n      if (!$.crxWorking()) { return; }\r\n      items.local = dict();\r\n      items.sync =  dict();\r\n      let count = 2;\r\n      let err   = null;\r\n      const done  = function() {\r\n        if (chrome.runtime.lastError) {\r\n          c.error(chrome.runtime.lastError.message);\r\n        }\r\n        if (err == null) { err = chrome.runtime.lastError; }\r\n        if (!--count) { return cb?.(err); }\r\n      };\r\n      chrome.storage.local.clear(done);\r\n      return chrome.storage.sync.clear(done);\r\n    };\r\n  })();\r\n} else {\r\n\r\n  // http://wiki.greasespot.net/Main_Page\r\n  // https://tampermonkey.net/documentation.php\r\n\r\n  if ((GM?.deleteValue != null) && window.BroadcastChannel && (typeof GM_addValueChangeListener === 'undefined' || GM_addValueChangeListener === null)) {\r\n\r\n    $.syncChannel = new BroadcastChannel(g.NAMESPACE + 'sync');\r\n\r\n    $.on($.syncChannel, 'message', e => (() => {\r\n      const result = [];\r\n      for (var key in e.data) {\r\n        var cb;\r\n        var val = e.data[key];\r\n        if (cb = $.syncing[key]) {\r\n          result.push(cb(dict.json(JSON.stringify(val)), key));\r\n        }\r\n      }\r\n      return result;\r\n    })());\r\n\r\n    $.sync = (key, cb) => $.syncing[key] = cb;\r\n\r\n    $.forceSync = function() {};\r\n\r\n    $.delete = function(keys, cb) {\r\n      let key;\r\n      if (!(keys instanceof Array)) {\r\n        keys = [keys];\r\n      }\r\n      return Promise.all((() => {\r\n        const result = [];\r\n        for (key of keys) {         result.push(GM.deleteValue(g.NAMESPACE + key));\r\n        }\r\n        return result;\r\n      })()).then(function() {\r\n        const items = dict();\r\n        for (key of keys) { items[key] = undefined; }\r\n        $.syncChannel.postMessage(items);\r\n        return cb?.();\r\n      });\r\n    };\r\n\r\n    $.get = $.oneItemSugar(function(items, cb) {\r\n      const keys = Object.keys(items);\r\n      return Promise.all(keys.map((key) => GM.getValue(g.NAMESPACE + key))).then(function(values) {\r\n        for (let i = 0; i < values.length; i++) {\r\n          var val = values[i];\r\n          if (val) {\r\n            items[keys[i]] = dict.json(val);\r\n          }\r\n        }\r\n        return cb(items);\r\n      });\r\n    });\r\n\r\n    $.set = $.oneItemSugar(function(items, cb) {\r\n      $.securityCheck(items);\r\n      return Promise.all((() => {\r\n        const result = [];\r\n        for (var key in items) {\r\n          var val = items[key];\r\n          result.push(GM.setValue(g.NAMESPACE + key, JSON.stringify(val)));\r\n        }\r\n        return result;\r\n      })()).then(function() {\r\n        $.syncChannel.postMessage(items);\r\n        return cb?.();\r\n      });\r\n    });\r\n\r\n    $.clear = cb => GM.listValues().then(keys => $.delete(keys.map(key => key.replace(g.NAMESPACE, '')), cb)).catch( () => $.delete(Object.keys(Conf).concat(['previousversion', 'QR Size', 'QR.persona']), cb));\r\n  } else {\r\n\r\n    if (typeof GM_deleteValue === 'undefined' || GM_deleteValue === null) {\r\n      $.perProtocolSettings = true;\r\n    }\r\n\r\n    if (typeof GM_deleteValue !== 'undefined' && GM_deleteValue !== null) {\r\n      $.getValue   = GM_getValue;\r\n      $.listValues = () => GM_listValues(); // error when called if missing\r\n    } else if ($.hasStorage) {\r\n      $.getValue = key => localStorage.getItem(key);\r\n      $.listValues = () => (() => {\r\n        const result = [];\r\n        for (var key in localStorage) {\r\n          if (key.slice(0, g.NAMESPACE.length) === g.NAMESPACE) {\r\n            result.push(key);\r\n          }\r\n        }\r\n        return result;\r\n      })();\r\n    } else {\r\n      $.getValue   = function() {};\r\n      $.listValues = () => [];\r\n    }\r\n\r\n    if (typeof GM_addValueChangeListener !== 'undefined' && GM_addValueChangeListener !== null) {\r\n      $.setValue    = GM_setValue;\r\n      $.deleteValue = GM_deleteValue;\r\n    } else if (typeof GM_deleteValue !== 'undefined' && GM_deleteValue !== null) {\r\n      $.oldValue = dict();\r\n      $.setValue = function(key, val) {\r\n        GM_setValue(key, val);\r\n        if (key in $.syncing) {\r\n          $.oldValue[key]   = val;\r\n          if ($.hasStorage) { return localStorage.setItem(key, val); } // for `storage` events\r\n        }\r\n      };\r\n      $.deleteValue = function(key) {\r\n        GM_deleteValue(key);\r\n        if (key in $.syncing) {\r\n          delete $.oldValue[key];\r\n          if ($.hasStorage) { return localStorage.removeItem(key); } // for `storage` events\r\n        }\r\n      };\r\n      if (!$.hasStorage) { $.cantSync = true; }\r\n    } else if ($.hasStorage) {\r\n      $.oldValue = dict();\r\n      $.setValue = function(key, val) {\r\n        if (key in $.syncing) { $.oldValue[key]   = val; }\r\n        return localStorage.setItem(key, val);\r\n      };\r\n      $.deleteValue = function(key) {\r\n        if (key in $.syncing) { delete $.oldValue[key]; }\r\n        return localStorage.removeItem(key);\r\n      };\r\n    } else {\r\n      $.setValue = function() {};\r\n      $.deleteValue = function() {};\r\n      $.cantSync = ($.cantSet = true);\r\n    }\r\n\r\n    if (typeof GM_addValueChangeListener !== 'undefined' && GM_addValueChangeListener !== null) {\r\n      $.sync = (key, cb) => $.syncing[key] = GM_addValueChangeListener(g.NAMESPACE + key, function(key2, oldValue, newValue, remote) {\r\n        if (remote) {\r\n          if (newValue !== undefined) { newValue = dict.json(newValue); }\r\n          return cb(newValue, key);\r\n        }\r\n      });\r\n      $.forceSync = function() {};\r\n    } else if ((typeof GM_deleteValue !== 'undefined' && GM_deleteValue !== null) || $.hasStorage) {\r\n      $.sync = function(key, cb) {\r\n        key = g.NAMESPACE + key;\r\n        $.syncing[key] = cb;\r\n        return $.oldValue[key] = $.getValue(key);\r\n      };\r\n\r\n      (function() {\r\n        const onChange = function({key, newValue}) {\r\n          let cb;\r\n          if (!(cb = $.syncing[key])) { return; }\r\n          if (newValue != null) {\r\n            if (newValue === $.oldValue[key]) { return; }\r\n            $.oldValue[key] = newValue;\r\n            return cb(dict.json(newValue), key.slice(g.NAMESPACE.length));\r\n          } else {\r\n            if ($.oldValue[key] == null) { return; }\r\n            delete $.oldValue[key];\r\n            return cb(undefined, key.slice(g.NAMESPACE.length));\r\n          }\r\n        };\r\n        $.on(window, 'storage', onChange);\r\n\r\n        return $.forceSync = function(key) {\r\n          // Storage events don't work across origins\r\n          // e.g. http://boards.4chan.org and https://boards.4chan.org\r\n          // so force a check for changes to avoid lost data.\r\n          key = g.NAMESPACE + key;\r\n          return onChange({key, newValue: $.getValue(key)});\r\n        };\r\n      })();\r\n    } else {\r\n      $.sync = function() {};\r\n      $.forceSync = function() {};\r\n    }\r\n\r\n    $.delete = function(keys) {\r\n      if (!(keys instanceof Array)) {\r\n        keys = [keys];\r\n      }\r\n      for (var key of keys) {\r\n        $.deleteValue(g.NAMESPACE + key);\r\n      }\r\n    };\r\n\r\n    $.get = $.oneItemSugar((items, cb) => $.queueTask($.getSync, items, cb));\r\n\r\n    $.getSync = function(items, cb) {\r\n      for (var key in items) {\r\n        var val2;\r\n        if (val2 = $.getValue(g.NAMESPACE + key)) {\r\n          try {\r\n            items[key] = dict.json(val2);\r\n          } catch (err) {\r\n            // XXX https://github.com/ccd0/4chan-x/issues/2218\r\n            if (!/^(?:undefined)*$/.test(val2)) {\r\n              throw err;\r\n            }\r\n          }\r\n        }\r\n      }\r\n      return cb(items);\r\n    };\r\n\r\n    $.set = $.oneItemSugar(function(items, cb) {\r\n      $.securityCheck(items);\r\n      return $.queueTask(function() {\r\n        for (var key in items) {\r\n          var value = items[key];\r\n          $.setValue(g.NAMESPACE + key, JSON.stringify(value));\r\n        }\r\n        return cb?.();\r\n      });\r\n    });\r\n\r\n    $.clear = function(cb) {\r\n      // XXX https://github.com/greasemonkey/greasemonkey/issues/2033\r\n      // Also support case where GM_listValues is not defined.\r\n      $.delete(Object.keys(Conf));\r\n      $.delete(['previousversion', 'QR Size', 'QR.persona']);\r\n      try {\r\n        $.delete($.listValues().map(key => key.replace(g.NAMESPACE, '')));\r\n      } catch (error) {}\r\n      return cb?.();\r\n    };\r\n  }\r\n}\r\n\r\nexport default $;\r\n","import { Conf, g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Get = {\r\n  url(type, IDs, ...args) {\r\n    let f, site;\r\n    if ((site = g.sites[IDs.siteID]) && (f = $.getOwn(site.urls, type))) {\r\n      return f(IDs, ...Array.from(args));\r\n    } else {\r\n      return undefined;\r\n    }\r\n  },\r\n  threadExcerpt(thread) {\r\n    const {OP} = thread;\r\n    const excerpt = (`/${decodeURIComponent(thread.board.ID)}/ - `) + (\r\n      OP.info.subject?.trim() ||\r\n      OP.commentDisplay().replace(/\\n+/g, ' // ') ||\r\n      OP.file?.name ||\r\n      `No.${OP}`);\r\n    if (excerpt.length > 73) { return `${excerpt.slice(0, 70)}...`; }\r\n    return excerpt;\r\n  },\r\n  threadFromRoot(root) {\r\n    if (root == null) { return null; }\r\n    const {board} = root.dataset;\r\n    return g.threads.get(`${board ? encodeURIComponent(board) : g.BOARD.ID}.${root.id.match(/\\d*$/)[0]}`);\r\n  },\r\n  threadFromNode(node) {\r\n    return Get.threadFromRoot($.x(`ancestor-or-self::${g.SITE.xpath.thread}`, node));\r\n  },\r\n  postFromRoot(root) {\r\n    if (root == null) { return null; }\r\n    const post  = g.posts.get(root.dataset.fullID);\r\n    const index = root.dataset.clone;\r\n    if (index) { return post.clones[+index]; } else { return post; }\r\n  },\r\n  postFromNode(root) {\r\n    return Get.postFromRoot($.x(`ancestor-or-self::${g.SITE.xpath.postContainer}[1]`, root));\r\n  },\r\n  postDataFromLink(link) {\r\n    let boardID, postID, threadID;\r\n    if (link.dataset.postID) { // resurrected quote\r\n      ({boardID, threadID, postID} = link.dataset);\r\n      if (!threadID) { threadID = 0; }\r\n    } else {\r\n      const match = link.href.match(g.SITE.regexp.quotelink);\r\n      [boardID, threadID, postID] = Array.from(match.slice(1));\r\n      if (!postID) { postID = threadID; }\r\n    }\r\n    return {\r\n      boardID,\r\n      threadID: +threadID,\r\n      postID:   +postID\r\n    };\r\n  },\r\n  allQuotelinksLinkingTo(post) {\r\n    // Get quotelinks & backlinks linking to the given post.\r\n    const quotelinks = [];\r\n    const {posts} = g;\r\n    const {fullID} = post;\r\n    const handleQuotes = function(qPost, type) {\r\n      quotelinks.push(...Array.from(qPost.nodes[type] || []));\r\n      for (var clone of qPost.clones) { quotelinks.push(...Array.from(clone.nodes[type] || [])); }\r\n    };\r\n    // First:\r\n    //   In every posts,\r\n    //   if it did quote this post,\r\n    //   get all their backlinks.\r\n    posts.forEach(function(qPost) {\r\n      if (qPost.quotes.includes(fullID)) {\r\n        return handleQuotes(qPost, 'quotelinks');\r\n      }\r\n    });\r\n\r\n    // Second:\r\n    //   If we have quote backlinks:\r\n    //   in all posts this post quoted\r\n    //   and their clones,\r\n    //   get all of their backlinks.\r\n    if (Conf['Quote Backlinks']) {\r\n      for (var quote of post.quotes) { var qPost;\r\n      if ((qPost = posts.get(quote))) { handleQuotes(qPost, 'backlinks'); } }\r\n    }\r\n\r\n    // Third:\r\n    //   Filter out irrelevant quotelinks.\r\n    return quotelinks.filter(function(quotelink) {\r\n      const {boardID, postID} = Get.postDataFromLink(quotelink);\r\n      return (boardID === post.board.ID) && (postID === post.ID);\r\n    });\r\n  }\r\n};\r\nexport default Get;\r\n",null,"import { Conf, doc, g } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\nimport { dict } from \"../platform/helpers\";\r\nimport SW from \"./SW\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Site = {\r\n  defaultProperties: {\r\n    '4chan.org':    {software: 'yotsuba'},\r\n    '4channel.org': {canonical: '4chan.org'},\r\n    '4cdn.org':     {canonical: '4chan.org'},\r\n    'notso.smuglo.li': {canonical: 'smuglo.li'},\r\n    'smugloli.net':    {canonical: 'smuglo.li'},\r\n    'smug.nepu.moe':   {canonical: 'smuglo.li'}\r\n  },\r\n\r\n  init(cb) {\r\n    $.extend(Conf['siteProperties'], Site.defaultProperties);\r\n    let hostname = Site.resolve();\r\n    if (hostname && $.hasOwn(SW, Conf['siteProperties'][hostname].software)) {\r\n      this.set(hostname);\r\n      cb();\r\n    }\r\n    return $.onExists(doc, 'body', () => {\r\n      for (var software in SW) {\r\n        var changes;\r\n        if (changes = SW[software].detect?.()) {\r\n          changes.software = software;\r\n          hostname = location.hostname.replace(/^www\\./, '');\r\n          var properties = (Conf['siteProperties'][hostname] || (Conf['siteProperties'][hostname] = dict()));\r\n          var changed = 0;\r\n          for (var key in changes) {\r\n            if (properties[key] !== changes[key]) {\r\n              properties[key] = changes[key];\r\n              changed++;\r\n            }\r\n          }\r\n          if (changed) {\r\n            $.set('siteProperties', Conf['siteProperties']);\r\n          }\r\n          if (!g.SITE) {\r\n            this.set(hostname);\r\n            cb();\r\n          }\r\n          return;\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  resolve(url=location) {\r\n    let {hostname} = url;\r\n    while (hostname && !$.hasOwn(Conf['siteProperties'], hostname)) {\r\n      hostname = hostname.replace(/^[^.]*\\.?/, '');\r\n    }\r\n    if (hostname) {\r\n      let canonical;\r\n      if (canonical = Conf['siteProperties'][hostname].canonical) { hostname = canonical; }\r\n    }\r\n    return hostname;\r\n  },\r\n\r\n  parseURL(url) {\r\n    const siteID = Site.resolve(url);\r\n    return Main.parseURL(g.sites[siteID], url);\r\n  },\r\n\r\n  set(hostname) {\r\n    for (var ID in Conf['siteProperties']) {\r\n      var site;\r\n      var properties = Conf['siteProperties'][ID];\r\n      if (properties.canonical) { continue; }\r\n      var {\r\n        software\r\n      } = properties;\r\n      if (!software || !$.hasOwn(SW, software)) { continue; }\r\n      g.sites[ID] = (site = Object.create(SW[software]));\r\n      $.extend(site, {ID, siteID: ID, properties, software});\r\n    }\r\n    return g.SITE = g.sites[hostname];\r\n  }\r\n};\r\nexport default Site;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Filter from \"../Filtering/Filter\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport meta from '../../package.json';\r\nimport Index from \"../General/Index\";\r\nimport Site from \"../site/Site\";\r\nimport Header from \"../General/Header\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport UI from \"../General/UI\";\r\nimport Get from \"../General/Get\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar CatalogLinks = {\r\n  init() {\r\n    if ((g.SITE.software === 'yotsuba') && (Conf['External Catalog'] || Conf['JSON Index']) && !(Conf['JSON Index'] && (g.VIEW === 'index'))) {\r\n      const selector = (() => { switch (g.VIEW) {\r\n        case 'thread': case 'archive': return '.navLinks.desktop > a';\r\n        case 'catalog':           return '.navLinks > :first-child > a';\r\n        case 'index':             return '#ctrl-top > a, .cataloglink > a';\r\n      } })();\r\n      $.ready(function() {\r\n        for (var link of $$(selector)) {\r\n          var catalogURL;\r\n          switch (link.pathname.replace(/\\/+/g, '/')) {\r\n            case `/${g.BOARD}/`:\r\n              if (Conf['JSON Index']) { link.textContent = 'Index'; }\r\n              link.href = CatalogLinks.index();\r\n              break;\r\n            case `/${g.BOARD}/catalog`:\r\n              link.href = CatalogLinks.catalog();\r\n              break;\r\n          }\r\n          if ((g.VIEW === 'catalog') && ((catalogURL = CatalogLinks.catalog()) !== g.SITE.urls.catalog?.(g.BOARD))) {\r\n            var catalogLink = link.parentNode.cloneNode(true);\r\n            var link2 = catalogLink.firstElementChild;\r\n            link2.href = catalogURL;\r\n            link2.textContent = link2.hostname === location.hostname ? `${meta.name} Catalog` : 'External Catalog';\r\n            $.after(link.parentNode, [$.tn(' '), catalogLink]);\r\n          }\r\n        }\r\n      });\r\n    }\r\n\r\n    if ((g.SITE.software === 'yotsuba') && Conf['JSON Index'] && Conf[`Use ${meta.name} Catalog`]) {\r\n      Callbacks.Post.push({\r\n        name: 'Catalog Link Rewrite',\r\n        cb:   this.node\r\n      });\r\n    }\r\n\r\n    if (this.enabled = Conf['Catalog Links']) {\r\n      let el;\r\n      CatalogLinks.el = (el = UI.checkbox('Header catalog links', 'Catalog Links'));\r\n      el.id = 'toggleCatalog';\r\n      const input = $('input', el);\r\n      $.on(input, 'change', this.toggle);\r\n      $.sync('Header catalog links', CatalogLinks.set);\r\n      return Header.menu.addEntry({\r\n        el,\r\n        order: 95\r\n      });\r\n    }\r\n  },\r\n\r\n  node() {\r\n    for (var a of $$('a', this.nodes.comment)) {\r\n      var m;\r\n      if (m = a.href.match(/^https?:\\/\\/(boards\\.4chan(?:nel)?\\.org\\/[^\\/]+)\\/catalog(#s=.*)?/)) {\r\n        a.href = `//${m[1]}/${m[2] || '#catalog'}`;\r\n      }\r\n    }\r\n  },\r\n\r\n  toggle() {\r\n    $.event('CloseMenu');\r\n    $.set('Header catalog links', this.checked);\r\n    return CatalogLinks.set(this.checked);\r\n  },\r\n\r\n  set(useCatalog) {\r\n    Conf['Header catalog links'] = useCatalog;\r\n    CatalogLinks.setLinks(Header.boardList);\r\n    CatalogLinks.setLinks(Header.bottomBoardList);\r\n    CatalogLinks.el.title = `Turn catalog links ${useCatalog ? 'off' : 'on'}.`;\r\n    return $('input', CatalogLinks.el).checked = useCatalog;\r\n  },\r\n\r\n  // Also called by Header when board lists are loaded / generated.\r\n  setLinks(list) {\r\n    if ((!(CatalogLinks.enabled ?? Conf['Catalog Links'])) || !list) { return; }\r\n\r\n    // do not transform links unless they differ from the expected value at most by this tail\r\n    const tail = /(?:index)?(?:\\.\\w+)?$/;\r\n\r\n    for (var a of $$('a:not([data-only])', list)) {\r\n      var {siteID, boardID} = a.dataset;\r\n      if (!siteID || !boardID) {\r\n        var VIEW;\r\n        ({siteID, boardID, VIEW} = Site.parseURL(a));\r\n        if (\r\n          !siteID || !boardID ||\r\n          !['index', 'catalog'].includes(VIEW) ||\r\n          (!a.dataset.indexOptions && (a.href.replace(tail, '') !== (Get.url(VIEW, {siteID, boardID}) || '').replace(tail, '')))\r\n        ) { continue; }\r\n        $.extend(a.dataset, {siteID, boardID});\r\n      }\r\n\r\n      var board = {siteID, boardID};\r\n      var url = Conf['Header catalog links'] ? CatalogLinks.catalog(board) : Get.url('index', board);\r\n      if (url) {\r\n        a.href = url;\r\n        if (a.dataset.indexOptions && (url.split('#')[0] === Get.url('index', board))) {\r\n          a.href += (a.hash ? '/' : '#') + a.dataset.indexOptions;\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  externalParse() {\r\n    CatalogLinks.externalList = dict();\r\n    for (var line of Conf['externalCatalogURLs'].split('\\n')) {\r\n      if (line[0] === '#') { continue; }\r\n      var url = line.split(';')[0];\r\n      var boards   = Filter.parseBoards(line.match(/;boards:([^;]+)/)?.[1] || '*');\r\n      var excludes = Filter.parseBoards(line.match(/;exclude:([^;]+)/)?.[1]) || dict();\r\n      for (var board in boards) {\r\n        if (!excludes[board] && !excludes[board.split('/')[0] + '/*']) {\r\n          CatalogLinks.externalList[board] = url;\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  external({siteID, boardID}) {\r\n    if (!CatalogLinks.externalList) { CatalogLinks.externalParse(); }\r\n    const external = (CatalogLinks.externalList[`${siteID}/${boardID}`] || CatalogLinks.externalList[`${siteID}/*`]);\r\n    if (external) { return external.replace(/%board/g, boardID); } else { return undefined; }\r\n  },\r\n\r\n  jsonIndex(board, hash) {\r\n    if ((g.SITE.ID === board.siteID) && (g.BOARD.ID === board.boardID) && (g.VIEW === 'index')) {\r\n      return hash;\r\n    } else {\r\n      return Get.url('index', board) + hash;\r\n    }\r\n  },\r\n\r\n  catalog(board=g.BOARD) {\r\n    let external, nativeCatalog;\r\n    if (Conf['External Catalog'] && (external = CatalogLinks.external(board))) {\r\n      return external;\r\n    } else if (Index.enabledOn(board) && Conf[`Use ${meta.name} Catalog`]) {\r\n      return CatalogLinks.jsonIndex(board, '#catalog');\r\n    } else if (nativeCatalog = Get.url('catalog', board)) {\r\n      return nativeCatalog;\r\n    } else {\r\n      return CatalogLinks.external(board);\r\n    }\r\n  },\r\n\r\n  index(board=g.BOARD) {\r\n    if (Index.enabledOn(board)) {\r\n      return CatalogLinks.jsonIndex(board, '#index');\r\n    } else {\r\n      return Get.url('index', board);\r\n    }\r\n  }\r\n};\r\nexport default CatalogLinks;\r\n","import Redirect from \"../Archive/Redirect\";\r\nimport Notice from \"../classes/Notice\";\r\nimport { Conf, d, doc, g } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport CatalogLinks from \"../Miscellaneous/CatalogLinks\";\r\nimport ReplyPruning from \"../Monitoring/ReplyPruning\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport BoardConfig from \"./BoardConfig\";\r\nimport Get from \"./Get\";\r\nimport Settings from \"./Settings\";\r\nimport UI from \"./UI\";\r\nimport meta from '../../package.json';\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Header = {\r\n  init() {\r\n    $.onExists(doc, 'body', () => {\r\n      if (!Main.isThisPageLegit()) { return; }\r\n      $.add(this.bar, [this.noticesRoot, this.toggle]);\r\n      $.prepend(d.body, this.bar);\r\n      $.add(d.body, Header.hover);\r\n      return this.setBarPosition(Conf['Bottom Header']);\r\n  });\r\n\r\n    this.menu = new UI.Menu('header');\r\n\r\n    const menuButton = $.el('span',\r\n      {className: 'menu-button'});\r\n    $.extend(menuButton, {innerHTML: \"<i></i>\"});\r\n\r\n    const box = UI.checkbox;\r\n\r\n    const barFixedToggler     = box('Fixed Header',               'Fixed Header');\r\n    const headerToggler       = box('Header auto-hide',           'Auto-hide header');\r\n    const scrollHeaderToggler = box('Header auto-hide on scroll', 'Auto-hide header on scroll');\r\n    const barPositionToggler  = box('Bottom Header',              'Bottom header');\r\n    const linkJustifyToggler  = box('Centered links',             'Centered links');\r\n    const customNavToggler    = box('Custom Board Navigation',    'Custom board navigation');\r\n    const footerToggler       = box('Bottom Board List',          'Hide bottom board list');\r\n    const shortcutToggler     = box('Shortcut Icons',             'Shortcut Icons');\r\n    const editCustomNav = $.el('a', {\r\n      textContent: 'Edit custom board navigation',\r\n      href: 'javascript:;'\r\n    }\r\n    );\r\n\r\n    this.barFixedToggler     = barFixedToggler.firstElementChild;\r\n    this.scrollHeaderToggler = scrollHeaderToggler.firstElementChild;\r\n    this.barPositionToggler  = barPositionToggler.firstElementChild;\r\n    this.linkJustifyToggler  = linkJustifyToggler.firstElementChild;\r\n    this.headerToggler       = headerToggler.firstElementChild;\r\n    this.footerToggler       = footerToggler.firstElementChild;\r\n    this.shortcutToggler     = shortcutToggler.firstElementChild;\r\n    this.customNavToggler    = customNavToggler.firstElementChild;\r\n\r\n    $.on(menuButton,           'click',  this.menuToggle);\r\n    $.on(this.headerToggler,       'change', this.toggleBarVisibility);\r\n    $.on(this.barFixedToggler,     'change', this.toggleBarFixed);\r\n    $.on(this.barPositionToggler,  'change', this.toggleBarPosition);\r\n    $.on(this.scrollHeaderToggler, 'change', this.toggleHideBarOnScroll);\r\n    $.on(this.linkJustifyToggler,  'change', this.toggleLinkJustify);\r\n    $.on(this.footerToggler,       'change', this.toggleFooterVisibility);\r\n    $.on(this.shortcutToggler,     'change', this.toggleShortcutIcons);\r\n    $.on(this.customNavToggler,    'change', this.toggleCustomNav);\r\n    $.on(editCustomNav,        'click',  this.editCustomNav);\r\n\r\n    this.setBarFixed(Conf['Fixed Header']);\r\n    this.setHideBarOnScroll(Conf['Header auto-hide on scroll']);\r\n    this.setBarVisibility(Conf['Header auto-hide']);\r\n    this.setLinkJustify(Conf['Centered links']);\r\n    this.setShortcutIcons(Conf['Shortcut Icons']);\r\n    this.setFooterVisibility(Conf['Bottom Board List']);\r\n\r\n    $.sync('Fixed Header',               this.setBarFixed);\r\n    $.sync('Header auto-hide on scroll', this.setHideBarOnScroll);\r\n    $.sync('Bottom Header',              this.setBarPosition);\r\n    $.sync('Shortcut Icons',             this.setShortcutIcons);\r\n    $.sync('Header auto-hide',           this.setBarVisibility);\r\n    $.sync('Centered links',             this.setLinkJustify);\r\n    $.sync('Bottom Board List',          this.setFooterVisibility);\r\n\r\n    this.addShortcut('menu', menuButton, 900);\r\n\r\n    this.menu.addEntry({\r\n      el: $.el('span',\r\n        {textContent: 'Header'}),\r\n      order: 107,\r\n      subEntries: [\r\n          {el: barFixedToggler}\r\n        ,\r\n          {el: headerToggler}\r\n        ,\r\n          {el: scrollHeaderToggler}\r\n        ,\r\n          {el: barPositionToggler}\r\n        ,\r\n          {el: linkJustifyToggler}\r\n        ,\r\n          {el: footerToggler}\r\n        ,\r\n          {el: shortcutToggler}\r\n        ,\r\n          {el: customNavToggler}\r\n        ,\r\n          {el: editCustomNav}\r\n      ]});\r\n\r\n    $.on(window, 'load popstate', Header.hashScroll);\r\n    $.on(d, 'CreateNotification', this.createNotification);\r\n\r\n    this.setBoardList();\r\n\r\n    $.onExists(doc, `${g.SITE.selectors.boardList} + *`, Header.generateFullBoardList);\r\n\r\n    Main.ready(function() {\r\n      let footer;\r\n      if ((g.SITE.software === 'yotsuba') && !(footer = $.id('boardNavDesktopFoot'))) {\r\n        let absbot;\r\n        if (!(absbot = $.id('absbot'))) { return; }\r\n        footer = $.id('boardNavDesktop').cloneNode(true);\r\n        footer.id = 'boardNavDesktopFoot';\r\n        $('#navtopright',        footer).id = 'navbotright';\r\n        $('#settingsWindowLink', footer).id = 'settingsWindowLinkBot';\r\n        $.before(absbot, footer);\r\n        $.global(() => window.cloneTopNav = function() {});\r\n      }\r\n      if (Header.bottomBoardList = $(g.SITE.selectors.boardListBottom)) {\r\n        for (var a of $$('a', Header.bottomBoardList)) {\r\n          if ((a.hostname === location.hostname) && (a.pathname.split('/')[1] === g.BOARD.ID)) { a.className = 'current'; }\r\n        }\r\n        return CatalogLinks.setLinks(Header.bottomBoardList);\r\n      }\r\n    });\r\n\r\n    if ((g.SITE.software === 'yotsuba') && ((g.VIEW === 'catalog') || !Conf['Disable Native Extension'])) {\r\n      const cs = $.el('a', {href: 'javascript:;'});\r\n      if (g.VIEW === 'catalog') {\r\n        cs.title = (cs.textContent = 'Catalog Settings');\r\n        cs.textContent = '';\r\n      } else {\r\n        cs.title = (cs.textContent = '4chan Settings');\r\n        cs.className = 'native-settings';\r\n      }\r\n      $.on(cs, 'click', () => $.id('settingsWindowLink').click());\r\n      this.addShortcut('native', cs, 810);\r\n    }\r\n\r\n    return this.enableDesktopNotifications();\r\n  },\r\n\r\n  bar: $.el('div',\r\n    {id: 'header-bar'}),\r\n\r\n  noticesRoot: $.el('div',\r\n    {id: 'notifications'}),\r\n\r\n  shortcuts: $.el('span',\r\n    {id: 'shortcuts'}),\r\n\r\n  hover: $.el('div',\r\n    {id: 'hoverUI'}),\r\n\r\n  toggle: $.el('div',\r\n    {id: 'scroll-marker'}),\r\n\r\n  setBoardList() {\r\n    let boardList;\r\n    Header.boardList = (boardList = $.el('span',\r\n      {id: 'board-list'}));\r\n    $.extend(boardList, {innerHTML: \"<span id=\\\"custom-board-list\\\"></span><span id=\\\"full-board-list\\\" hidden><span class=\\\"hide-board-list-container brackets-wrap\\\"><a href=\\\"javascript:;\\\" class=\\\"hide-board-list-button\\\">&nbsp;-&nbsp;</a></span> <span class=\\\"boardList\\\"></span></span>\"});\r\n\r\n    const btn = $('.hide-board-list-button', boardList);\r\n    $.on(btn, 'click', Header.toggleBoardList);\r\n\r\n    $.prepend(Header.bar, [Header.boardList, Header.shortcuts]);\r\n\r\n    Header.setCustomNav(Conf['Custom Board Navigation']);\r\n    Header.generateBoardList(Conf['boardnav']);\r\n\r\n    $.sync('Custom Board Navigation', Header.setCustomNav);\r\n    return $.sync('boardnav', Header.generateBoardList);\r\n  },\r\n\r\n  generateFullBoardList() {\r\n    let nodes;\r\n    if (g.SITE.transformBoardList) {\r\n      nodes = g.SITE.transformBoardList();\r\n    } else {\r\n      nodes = [...Array.from($(g.SITE.selectors.boardList).cloneNode(true).childNodes)];\r\n    }\r\n    const fullBoardList = $('.boardList', Header.boardList);\r\n    $.add(fullBoardList, nodes);\r\n    for (var a of $$('a', fullBoardList)) {\r\n      if ((a.hostname === location.hostname) && (a.pathname.split('/')[1] === g.BOARD.ID)) { a.className = 'current'; }\r\n    }\r\n    return CatalogLinks.setLinks(fullBoardList);\r\n  },\r\n\r\n  generateBoardList(boardnav) {\r\n    const list = $('#custom-board-list', Header.boardList);\r\n    $.rmAll(list);\r\n    if (!boardnav) { return; }\r\n    boardnav = boardnav.replace(/(\\r\\n|\\n|\\r)/g, ' ');\r\n    const re = /[\\w@]+(-(all|title|replace|full|index|catalog|archive|expired|nt|(mode|sort|text):\"[^\"]+\"(,\"[^\"]+\")?))*|[^\\w@]+/g;\r\n    const nodes = (boardnav.match(re).map((t) => Header.mapCustomNavigation(t)));\r\n    $.add(list, nodes);\r\n    return CatalogLinks.setLinks(list);\r\n  },\r\n\r\n  mapCustomNavigation(t) {\r\n    let a, href, m, url;\r\n    if (/^[^\\w@]/.test(t)) {\r\n      return $.tn(t);\r\n    }\r\n\r\n    let text = (url = null);\r\n    t = t.replace(/-text:\"([^\"]+)\"(?:,\"([^\"]+)\")?/g, function(m0, m1, m2) {\r\n      text = m1;\r\n      url  = m2;\r\n      return '';\r\n    });\r\n\r\n    let indexOptions = [];\r\n    t = t.replace(/-(?:mode|sort):\"([^\"]+)\"/g, function(m0, m1) {\r\n      indexOptions.push(m1.toLowerCase().replace(/\\ /g, '-'));\r\n      return '';\r\n    });\r\n    indexOptions = indexOptions.join('/');\r\n\r\n    if (/^toggle-all/.test(t)) {\r\n      a = $.el('a', {\r\n        className: 'show-board-list-button',\r\n        textContent: text || '+',\r\n        href: 'javascript:;'\r\n      }\r\n      );\r\n      $.on(a, 'click', Header.toggleBoardList);\r\n      return a;\r\n    }\r\n\r\n    if (/^external/.test(t)) {\r\n      a = $.el('a', {\r\n        href: url || 'javascript:;',\r\n        textContent: text || '+',\r\n        className: 'external'\r\n      }\r\n      );\r\n      if (/-nt/.test(t)) {\r\n        a.target = '_blank';\r\n        a.rel = 'noopener';\r\n      }\r\n      return a;\r\n    }\r\n\r\n    let boardID = t.split('-')[0];\r\n    if (boardID === 'current') {\r\n      if (['boards.4chan.org', 'boards.4channel.org'].includes(location.hostname)) {\r\n        boardID = g.BOARD.ID;\r\n      } else {\r\n        a = $.el('a', {\r\n          href: `/${g.BOARD.ID}/`,\r\n          textContent: text || decodeURIComponent(g.BOARD.ID),\r\n          className: 'current'\r\n        }\r\n        );\r\n        if (/-nt/.test(t)) {\r\n          a.target = '_blank';\r\n          a.rel = 'noopener';\r\n        }\r\n        if (/-index/.test(t)) {\r\n          a.dataset.only = 'index';\r\n        } else if (/-catalog/.test(t)) {\r\n          a.dataset.only = 'catalog';\r\n          a.href += 'catalog.html';\r\n        } else if (/-(archive|expired)/.test(t)) {\r\n          a = a.firstChild; // Its text node.\r\n        }\r\n        return a;\r\n      }\r\n    }\r\n\r\n    a = (function() {\r\n      let urlV;\r\n      if (boardID === '@') {\r\n        return $.el('a', {\r\n          href: 'https://twitter.com/4chan',\r\n          title: '4chan Twitter',\r\n          textContent: '@'\r\n        }\r\n        );\r\n      }\r\n\r\n      a = $.el('a', {\r\n        href: `//${BoardConfig.domain(boardID)}/${boardID}/`,\r\n        textContent: boardID,\r\n        title: BoardConfig.title(boardID)\r\n      }\r\n      );\r\n      if (['catalog', 'archive'].includes(g.VIEW) && (urlV = Get.url(g.VIEW, {siteID: '4chan.org', boardID}))) {\r\n        a.href = urlV;\r\n      }\r\n      if ((a.hostname === location.hostname) && (boardID === g.BOARD.ID)) { a.className = 'current'; }\r\n      return a;\r\n    })();\r\n\r\n    a.textContent = /-title/.test(t) || (/-replace/.test(t) && (a.hostname === location.hostname) && (boardID === g.BOARD.ID)) ?\r\n      a.title || a.textContent\r\n    : /-full/.test(t) ?\r\n      (`/${boardID}/`) + (a.title ? ` - ${a.title}` : '')\r\n    :\r\n      text || boardID;\r\n\r\n    if (m = t.match(/-(index|catalog)/)) {\r\n      const urlIC = CatalogLinks[m[1]]({siteID: '4chan.org', boardID});\r\n      if (urlIC) {\r\n        a.dataset.only = m[1];\r\n        a.href = urlIC;\r\n        if (m[1] === 'catalog') { $.addClass(a, 'catalog'); }\r\n      } else {\r\n        return a.firstChild; // Its text node.\r\n      }\r\n    }\r\n\r\n    if (Conf['JSON Index'] && indexOptions) {\r\n      a.dataset.indexOptions = indexOptions;\r\n      if (['boards.4chan.org', 'boards.4channel.org'].includes(a.hostname) && (a.pathname.split('/')[2] === '')) {\r\n        a.href += (a.hash ? '/' : '#') + indexOptions;\r\n      }\r\n    }\r\n\r\n    if (/-archive/.test(t)) {\r\n      if (href = Redirect.to('board', {boardID})) {\r\n        a.href = href;\r\n      } else {\r\n        return a.firstChild; // Its text node.\r\n      }\r\n    }\r\n\r\n    if (/-expired/.test(t)) {\r\n      if (BoardConfig.isArchived(boardID)) {\r\n        a.href = `//${BoardConfig.domain(boardID)}/${boardID}/archive`;\r\n      } else {\r\n        return a.firstChild; // Its text node.\r\n      }\r\n    }\r\n\r\n    if (/-nt/.test(t)) {\r\n      a.target = '_blank';\r\n      a.rel = 'noopener';\r\n    }\r\n\r\n    if (boardID === '@') { $.addClass(a, 'navSmall'); }\r\n    return a;\r\n  },\r\n\r\n  toggleBoardList() {\r\n    const {bar}  = Header;\r\n    const custom = $('#custom-board-list', bar);\r\n    const full   = $('#full-board-list',   bar);\r\n    const showBoardList = !full.hidden;\r\n    custom.hidden = !showBoardList;\r\n    return full.hidden   =  showBoardList;\r\n  },\r\n\r\n  setLinkJustify(centered) {\r\n    Header.linkJustifyToggler.checked = centered;\r\n    if (centered) {\r\n      return $.addClass(doc, 'centered-links');\r\n    } else {\r\n      return $.rmClass(doc, 'centered-links');\r\n    }\r\n  },\r\n\r\n  toggleLinkJustify() {\r\n    $.event('CloseMenu');\r\n    const centered = this.nodeName === 'INPUT' ?\r\n      this.checked : undefined;\r\n    Header.setLinkJustify(centered);\r\n    return $.set('Centered links', centered);\r\n  },\r\n\r\n  setBarFixed(fixed) {\r\n    Header.barFixedToggler.checked = fixed;\r\n    if (fixed) {\r\n      $.addClass(doc, 'fixed');\r\n      return $.addClass(Header.bar, 'dialog');\r\n    } else {\r\n      $.rmClass(doc, 'fixed');\r\n      return $.rmClass(Header.bar, 'dialog');\r\n    }\r\n  },\r\n\r\n  toggleBarFixed() {\r\n    $.event('CloseMenu');\r\n\r\n    Header.setBarFixed(this.checked);\r\n\r\n    Conf['Fixed Header'] = this.checked;\r\n    return $.set('Fixed Header',  this.checked);\r\n  },\r\n\r\n  setShortcutIcons(show) {\r\n    Header.shortcutToggler.checked = show;\r\n    if (show) {\r\n      return $.addClass(doc, 'shortcut-icons');\r\n    } else {\r\n      return $.rmClass(doc, 'shortcut-icons');\r\n    }\r\n  },\r\n\r\n  toggleShortcutIcons() {\r\n    $.event('CloseMenu');\r\n\r\n    Header.setShortcutIcons(this.checked);\r\n\r\n    Conf['Shortcut Icons'] = this.checked;\r\n    return $.set('Shortcut Icons',  this.checked);\r\n  },\r\n\r\n  setBarVisibility(hide) {\r\n    Header.headerToggler.checked = hide;\r\n    $.event('CloseMenu');\r\n    (hide ? $.addClass : $.rmClass)(Header.bar, 'autohide');\r\n    return (hide ? $.addClass : $.rmClass)(doc, 'autohide');\r\n  },\r\n\r\n  toggleBarVisibility() {\r\n    const hide = this.nodeName === 'INPUT' ?\r\n      this.checked\r\n    :\r\n      !$.hasClass(Header.bar, 'autohide');\r\n\r\n    Conf['Header auto-hide'] = hide;\r\n    $.set('Header auto-hide', hide);\r\n    Header.setBarVisibility(hide);\r\n    const message = `The header bar will ${hide ?\r\n      'automatically hide itself.'\r\n    :\r\n      'remain visible.'}`;\r\n    return new Notice('info', message, 2);\r\n  },\r\n\r\n  setHideBarOnScroll(hide) {\r\n    Header.scrollHeaderToggler.checked = hide;\r\n    if (hide) {\r\n      $.on(window, 'scroll', Header.hideBarOnScroll);\r\n      return;\r\n    }\r\n    $.off(window, 'scroll', Header.hideBarOnScroll);\r\n    $.rmClass(Header.bar, 'scroll');\r\n    return Header.bar.classList.toggle('autohide', Conf['Header auto-hide']);\r\n  },\r\n\r\n  toggleHideBarOnScroll() {\r\n    const hide = this.checked;\r\n    $.cb.checked.call(this);\r\n    return Header.setHideBarOnScroll(hide);\r\n  },\r\n\r\n  hideBarOnScroll() {\r\n    const offsetY = window.pageYOffset;\r\n    if (offsetY > (Header.previousOffset || 0)) {\r\n      $.addClass(Header.bar, 'autohide', 'scroll');\r\n    } else {\r\n      $.rmClass(Header.bar,  'autohide', 'scroll');\r\n    }\r\n    return Header.previousOffset = offsetY;\r\n  },\r\n\r\n  setBarPosition(bottom) {\r\n    if (Header.barPositionToggler) Header.barPositionToggler.checked = bottom;\r\n    $.event('CloseMenu');\r\n    const args = bottom ? [\r\n      'bottom-header',\r\n      'top-header',\r\n      'after'\r\n    ] : [\r\n      'top-header',\r\n      'bottom-header',\r\n      'add'\r\n    ];\r\n\r\n    $.addClass(doc, args[0]);\r\n    $.rmClass(doc, args[1]);\r\n    return $[args[2]](Header.bar, Header.noticesRoot);\r\n  },\r\n\r\n  toggleBarPosition() {\r\n    $.cb.checked.call(this);\r\n    return Header.setBarPosition(this.checked);\r\n  },\r\n\r\n  setFooterVisibility(hide) {\r\n    Header.footerToggler.checked = hide;\r\n    return doc.classList.toggle('hide-bottom-board-list', hide);\r\n  },\r\n\r\n  toggleFooterVisibility() {\r\n    $.event('CloseMenu');\r\n    const hide = this.nodeName === 'INPUT' ?\r\n      this.checked\r\n    :\r\n      $.hasClass(doc, 'hide-bottom-board-list');\r\n    Header.setFooterVisibility(hide);\r\n    $.set('Bottom Board List', hide);\r\n    const message = hide ?\r\n      'The bottom navigation will now be hidden.'\r\n    :\r\n      'The bottom navigation will remain visible.';\r\n    return new Notice('info', message, 2);\r\n  },\r\n\r\n  setCustomNav(show) {\r\n    let ref;\r\n    Header.customNavToggler.checked = show;\r\n    const cust = $('#custom-board-list', Header.bar);\r\n    const full = $('#full-board-list',   Header.bar);\r\n    const btn = $('.hide-board-list-container', full);\r\n    return [cust.hidden, full.hidden, btn.hidden] = Array.from(ref = show ?\r\n      [false, true, false]\r\n    :\r\n      [true, false, true]), ref;\r\n  },\r\n\r\n  toggleCustomNav() {\r\n    $.cb.checked.call(this);\r\n    return Header.setCustomNav(this.checked);\r\n  },\r\n\r\n  editCustomNav() {\r\n    Settings.open('Advanced');\r\n    const settings = $.id('fourchanx-settings');\r\n    return $('[name=boardnav]', settings).focus();\r\n  },\r\n\r\n  hashScroll(e) {\r\n    let hash;\r\n    if (e) {\r\n      // Don't scroll when navigating to an already visited state.\r\n      if (e.state) { return; }\r\n      if (!history.state) { history.replaceState({}, ''); }\r\n    }\r\n\r\n    if (hash = location.hash.slice(1)) {\r\n      let el;\r\n      ReplyPruning.showIfHidden(hash);\r\n      if (el = $.id(hash)) {\r\n        return $.queueTask(() => Header.scrollTo(el));\r\n      }\r\n    }\r\n  },\r\n\r\n  scrollTo(root, down, needed) {\r\n    let height, x;\r\n    if (!root.offsetParent) { return; } // hidden or fixed\r\n    if (down) {\r\n      x = Header.getBottomOf(root);\r\n      if (Conf['Fixed Header'] && Conf['Header auto-hide on scroll'] && Conf['Bottom header']) {\r\n        ({height} = Header.bar.getBoundingClientRect());\r\n        if (x <= 0) {\r\n          if (!Header.isHidden()) { x += height; }\r\n        } else {\r\n          if  (Header.isHidden()) { x -= height; }\r\n        }\r\n      }\r\n      if (!needed || (x < 0)) { return window.scrollBy(0, -x); }\r\n    } else {\r\n      x = Header.getTopOf(root);\r\n      if (Conf['Fixed Header'] && Conf['Header auto-hide on scroll'] && !Conf['Bottom header']) {\r\n        ({height} = Header.bar.getBoundingClientRect());\r\n        if (x >= 0) {\r\n          if (!Header.isHidden()) { x += height; }\r\n        } else {\r\n          if  (Header.isHidden()) { x -= height; }\r\n        }\r\n      }\r\n      if (!needed || (x < 0)) { return window.scrollBy(0,  x); }\r\n    }\r\n  },\r\n\r\n  scrollToIfNeeded(root, down) {\r\n    return Header.scrollTo(root, down, true);\r\n  },\r\n\r\n  getTopOf(root) {\r\n    let {top} = root.getBoundingClientRect();\r\n    if (Conf['Fixed Header'] && !Conf['Bottom Header']) {\r\n      const headRect = Header.toggle.getBoundingClientRect();\r\n      top     -= headRect.top + headRect.height;\r\n    }\r\n    return top;\r\n  },\r\n\r\n  getBottomOf(root) {\r\n    const {clientHeight} = doc;\r\n    let bottom = clientHeight - root.getBoundingClientRect().bottom;\r\n    if (Conf['Fixed Header'] && Conf['Bottom Header']) {\r\n      const headRect = Header.toggle.getBoundingClientRect();\r\n      bottom  -= (clientHeight - headRect.bottom) + headRect.height;\r\n    }\r\n    return bottom;\r\n  },\r\n\r\n  isNodeVisible(node) {\r\n    if (d.hidden || !doc.contains(node)) { return false; }\r\n    const {height} = node.getBoundingClientRect();\r\n    return ((Header.getTopOf(node) + height) >= 0) && ((Header.getBottomOf(node) + height) >= 0);\r\n  },\r\n\r\n  isHidden() {\r\n    const {top} = Header.bar.getBoundingClientRect();\r\n    if (Conf['Bottom header']) {\r\n      return top === doc.clientHeight;\r\n    } else {\r\n      return top < 0;\r\n    }\r\n  },\r\n\r\n  addShortcut(id, el, index) {\r\n    const shortcut = $.el('span', {\r\n      id: `shortcut-${id}`,\r\n      className: 'shortcut brackets-wrap'\r\n    }\r\n    );\r\n    $.add(shortcut, el);\r\n    shortcut.dataset.index = index;\r\n    for (var item of $$('[data-index]', Header.shortcuts)) {\r\n      if (+item.dataset.index > +index) {\r\n        $.before(item, shortcut);\r\n        return;\r\n      }\r\n    }\r\n    return $.add(Header.shortcuts, shortcut);\r\n  },\r\n\r\n  rmShortcut(el) {\r\n    return $.rm(el.parentElement);\r\n  },\r\n\r\n  menuToggle(e) {\r\n    return Header.menu.toggle(e, this, g);\r\n  },\r\n\r\n  createNotification(e) {\r\n    let notice;\r\n    const {type, content, lifetime} = e.detail;\r\n    return notice = new Notice(type, content, lifetime);\r\n  },\r\n\r\n  areNotificationsEnabled: false,\r\n  enableDesktopNotifications() {\r\n    let notice;\r\n    if (!window.Notification || !Conf['Desktop Notifications']) { return; }\r\n    switch (Notification.permission) {\r\n      case 'granted':\r\n        Header.areNotificationsEnabled = true;\r\n        return;\r\n        break;\r\n      case 'denied':\r\n        // requestPermission doesn't work if status is 'denied',\r\n        // but it'll still work if status is 'default'.\r\n        return;\r\n        break;\r\n    }\r\n\r\n    const el = $.el('span',\r\n      {innerHTML:\r\n        `${meta.name} needs your permission to show desktop notifications. ` +\r\n        `[<a href=\\\"${meta.faq}#why-is-4chan-x-asking-for-permission-to-show-desktop-notifications\\\" target=\\\"_blank\\\">FAQ</a>]` +\r\n        `<br><button>Authorize</button> or <button>Disable</button>`\r\n    });\r\n    const [authorize, disable] = Array.from($$('button', el));\r\n    $.on(authorize, 'click', () => Notification.requestPermission(function(status) {\r\n      Header.areNotificationsEnabled = status === 'granted';\r\n      if (status === 'default') { return; }\r\n      return notice.close();\r\n    }));\r\n    $.on(disable, 'click', function() {\r\n      $.set('Desktop Notifications', false);\r\n      return notice.close();\r\n    });\r\n    return notice = new Notice('info', el);\r\n  }\r\n};\r\nexport default Header;\r\n","import Header from \"../General/Header\";\r\nimport { d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { SECOND } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nexport default class Notice {\r\n  constructor(type, content, timeout, onclose) {\r\n    this.add = this.add.bind(this);\r\n    this.close = this.close.bind(this);\r\n    this.timeout = timeout;\r\n    this.onclose = onclose;\r\n    this.el = $.el('div',\r\n      {innerHTML: \"<a href=\\\"javascript:;\\\" class=\\\"close\\\" title=\\\"Close\\\"></a><div class=\\\"message\\\"></div>\"});\r\n    this.el.style.opacity = 0;\r\n    this.setType(type);\r\n    $.on(this.el.firstElementChild, 'click', this.close);\r\n    if (typeof content === 'string') {\r\n      content = $.tn(content);\r\n    }\r\n    $.add(this.el.lastElementChild, content);\r\n\r\n    $.ready(this.add);\r\n  }\r\n\r\n  setType(type) {\r\n    return this.el.className = `notification ${type}`;\r\n  }\r\n\r\n  add() {\r\n    if (this.closed) { return; }\r\n    if (d.hidden) {\r\n      $.on(d, 'visibilitychange', this.add);\r\n      return;\r\n    }\r\n    $.off(d, 'visibilitychange', this.add);\r\n    $.add(Header.noticesRoot, this.el);\r\n    this.el.clientHeight; // force reflow\r\n    this.el.style.opacity = 1;\r\n    if (this.timeout) { return setTimeout(this.close, this.timeout * SECOND); }\r\n  }\r\n\r\n  close() {\r\n    this.closed = true;\r\n    $.off(d, 'visibilitychange', this.add);\r\n    $.rm(this.el);\r\n    return this.onclose?.();\r\n  }\r\n}\r\n","import Notice from '../classes/Notice.js';\r\nimport { Conf } from '../globals/globals.js';\r\nimport $ from '../platform/$.js';\r\nimport CrossOrigin from '../platform/CrossOrigin.js';\r\nimport { DAY, dict } from '../platform/helpers.js';\r\nimport archives from './archives.json';\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\n\r\nvar Redirect = {\r\n  archives,\r\n\r\n  init() {\r\n    this.selectArchives();\r\n    if (Conf['archiveAutoUpdate']) {\r\n      const now = Date.now();\r\n      if (now - (2 * DAY) >= Conf['lastarchivecheck'] || Conf['lastarchivecheck'] > now) { return this.update(); }\r\n    }\r\n  },\r\n\r\n  selectArchives() {\r\n    let boardID, boards, data, files;\r\n    const o = {\r\n      thread: dict(),\r\n      post:   dict(),\r\n      file:   dict()\r\n    };\r\n\r\n    const archives = dict();\r\n    for (data of Conf['archives']) {\r\n      var name, software, uid;\r\n      for (var key of ['boards', 'files']) {\r\n        if (!(data[key] instanceof Array)) { data[key] = []; }\r\n      }\r\n      ({uid, name, boards, files, software} = data);\r\n      if (!['fuuka', 'foolfuuka'].includes(software)) { continue; }\r\n      archives[JSON.stringify(uid ?? name)] = data;\r\n      for (boardID of boards) {\r\n        if (!(boardID in o.thread)) { o.thread[boardID] = data; }\r\n        if (!(boardID in o.post)   && (software === 'foolfuuka')) { o.post[boardID]   = data; }\r\n        if (!(boardID in o.file)   && files.includes(boardID)) { o.file[boardID]   = data; }\r\n      }\r\n    }\r\n\r\n    for (boardID in Conf['selectedArchives']) {\r\n      var record = Conf['selectedArchives'][boardID];\r\n      for (var type in record) {\r\n        var archive;\r\n        var id = record[type];\r\n        if ((archive = archives[JSON.stringify(id)]) && $.hasOwn(o, type)) {\r\n          boards = type === 'file' ? archive.files : archive.boards;\r\n          if (boards.includes(boardID)) { o[type][boardID] = archive; }\r\n        }\r\n      }\r\n    }\r\n\r\n    return Redirect.data = o;\r\n  },\r\n\r\n  update(cb) {\r\n    let url;\r\n    const urls = [];\r\n    const responses = [];\r\n    let nloaded = 0;\r\n    for (url of Conf['archiveLists'].split('\\n')) {\r\n      if (url[0] !== '#') {\r\n        url = url.trim();\r\n        if (url) { urls.push(url); }\r\n      }\r\n    }\r\n\r\n    const fail = (url, action, msg) => new Notice('warning', `Error ${action} archive data from\\n${url}\\n${msg}`, 20);\r\n\r\n    const load = i => (function() {\r\n      if (this.status !== 200) { return fail(urls[i], 'fetching', (this.status ? `Error ${this.statusText} (${this.status})` : 'Connection Error')); }\r\n      let {response} = this;\r\n      if (!(response instanceof Array)) { response = [response]; }\r\n      responses[i] = response;\r\n      nloaded++;\r\n      if (nloaded === urls.length) {\r\n        return Redirect.parse(responses, cb);\r\n      }\r\n    });\r\n\r\n    if (urls.length) {\r\n      for (let i = 0; i < urls.length; i++) {\r\n        url = urls[i];\r\n        if (['[', '{'].includes(url[0])) {\r\n          var response;\r\n          try {\r\n            response = JSON.parse(url);\r\n          } catch (err) {\r\n            fail(url, 'parsing', err.message);\r\n            continue;\r\n          }\r\n          load(i).call({status: 200, response});\r\n        } else {\r\n          CrossOrigin.ajax(url,\r\n            {onloadend: load(i)});\r\n        }\r\n      }\r\n    } else {\r\n      Redirect.parse([], cb);\r\n    }\r\n  },\r\n\r\n  parse(responses, cb) {\r\n    const archives = [];\r\n    const archiveUIDs = dict();\r\n    for (var response of responses) {\r\n      for (var data of response) {\r\n        var uid = JSON.stringify(data.uid ?? data.name);\r\n        if (uid in archiveUIDs) {\r\n          $.extend(archiveUIDs[uid], data);\r\n        } else {\r\n          archiveUIDs[uid] = dict.clone(data);\r\n          archives.push(data);\r\n        }\r\n      }\r\n    }\r\n    const items = {archives, lastarchivecheck: Date.now()};\r\n    $.set(items);\r\n    $.extend(Conf, items);\r\n    Redirect.selectArchives();\r\n    return cb?.();\r\n  },\r\n\r\n  to(dest, data) {\r\n    const archive = (['search', 'board'].includes(dest) ? Redirect.data.thread : Redirect.data[dest])[data.boardID];\r\n    if (!archive) { return ''; }\r\n    return Redirect[dest](archive, data);\r\n  },\r\n\r\n  protocol(archive) {\r\n    let {\r\n      protocol\r\n    } = location;\r\n    if (!$.getOwn(archive, protocol.slice(0, -1))) {\r\n      protocol = protocol === 'https:' ? 'http:' : 'https:';\r\n    }\r\n    return `${protocol}//`;\r\n  },\r\n\r\n  thread(archive, {boardID, threadID, postID}) {\r\n    // Keep the post number only if the location.hash was sent f.e.\r\n    let path = threadID ?\r\n      `${boardID}/thread/${threadID}`\r\n    :\r\n      `${boardID}/post/${postID}`;\r\n    if (archive.software === 'foolfuuka') {\r\n      path += '/';\r\n    }\r\n    if (threadID && postID) {\r\n      path += archive.software === 'foolfuuka' ?\r\n        `#${postID}`\r\n      :\r\n        `#p${postID}`;\r\n    }\r\n    return `${Redirect.protocol(archive)}${archive.domain}/${path}`;\r\n  },\r\n\r\n  post(archive, {boardID, postID}) {\r\n    // For fuuka-based archives:\r\n    // https://github.com/eksopl/fuuka/issues/27\r\n    const protocol = Redirect.protocol(archive);\r\n    const url = `${protocol}${archive.domain}/_/api/chan/post/?board=${boardID}&num=${postID}`;\r\n    if (!Redirect.securityCheck(url)) { return ''; }\r\n\r\n    return url;\r\n  },\r\n\r\n  file(archive, {boardID, filename}) {\r\n    if (!filename) { return ''; }\r\n    if (boardID === 'f') {\r\n      filename = encodeURIComponent($.unescape(decodeURIComponent(filename)));\r\n    } else {\r\n      if (/[sm]\\.jpg$/.test(filename)) { return ''; }\r\n    }\r\n    return `${Redirect.protocol(archive)}${archive.domain}/${boardID}/full_image/${filename}`;\r\n  },\r\n\r\n  board(archive, {boardID}) {\r\n    return `${Redirect.protocol(archive)}${archive.domain}/${boardID}/`;\r\n  },\r\n\r\n  search(archive, {boardID, type, value}) {\r\n    type = type === 'name' ?\r\n      'username'\r\n    : type === 'MD5' ?\r\n      'image'\r\n    :\r\n      type;\r\n    if (type === 'capcode') {\r\n      // https://github.com/pleebe/FoolFuuka/blob/bf4224eed04637a4d0bd4411c2bf5f9945dfec0b/src/Model/Search.php#L363\r\n      value = $.getOwn({\r\n        'Developer': 'dev',\r\n        'Verified':  'ver'\r\n      }, value) || value.toLowerCase();\r\n    } else if (type === 'image') {\r\n      value = value.replace(/[+/=]/g, c => ({'+': '-', '/': '_', '=': ''})[c]);\r\n    }\r\n    value = encodeURIComponent(value);\r\n    const path  = archive.software === 'foolfuuka' ?\r\n      `${boardID}/search/${type}/${value}/`\r\n    : type === 'image' ?\r\n      `${boardID}/image/${value}`\r\n    :\r\n      `${boardID}/?task=search2&search_${type}=${value}`;\r\n    return `${Redirect.protocol(archive)}${archive.domain}/${path}`;\r\n  },\r\n\r\n  report(boardID) {\r\n    const urls = [];\r\n    for (var archive of Conf['archives']) {\r\n      var {software, https, reports, boards, name, domain} = archive;\r\n      if ((software === 'foolfuuka') && https && reports && boards instanceof Array && boards.includes(boardID)) {\r\n        urls.push([name, `https://${domain}/_/api/chan/offsite_report/`]);\r\n      }\r\n    }\r\n    return urls;\r\n  },\r\n\r\n  securityCheck(url) {\r\n    return /^https:\\/\\//.test(url) ||\r\n    (location.protocol === 'http:') ||\r\n    Conf['Exempt Archives from Encryption'];\r\n  },\r\n\r\n  navigate(dest, data, alternative) {\r\n    if (!Redirect.data) { Redirect.init(); }\r\n    const url = Redirect.to(dest, data);\r\n    if (url && (\r\n      Redirect.securityCheck(url) ||\r\n      confirm(`Redirect to ${url}?\\n\\nYour connection will not be encrypted.`)\r\n    )) {\r\n      return location.replace(url);\r\n    } else if (alternative) {\r\n      return location.replace(alternative);\r\n    }\r\n  }\r\n};\r\n\r\nexport default Redirect;\r\n","import { g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport Board from \"./Board\";\r\nimport Thread from \"./Thread\";\r\n\r\nexport default class CatalogThreadNative {\r\n  toString() { return this.ID; }\r\n\r\n  constructor(root) {\r\n    this.nodes = {\r\n      root,\r\n      thumb: $(g.SITE.selectors.catalog.thumb, root)\r\n    };\r\n    this.siteID  = g.SITE.ID;\r\n    this.boardID = this.nodes.thumb.parentNode.pathname.split(/\\/+/)[1];\r\n    this.board = g.boards[this.boardID] || new Board(this.boardID);\r\n    this.ID = (this.threadID = +(root.dataset.id || root.id).match(/\\d*$/)[0]);\r\n    this.thread = this.board.threads.get(this.ID) || new Thread(this.ID, this.board);\r\n  }\r\n}\r\n","import { Conf, doc } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst Anonymize = {\r\n  init() {\r\n    if (!Conf['Anonymize']) { return; }\r\n    return $.addClass(doc, 'anonymize');\r\n  }\r\n};\r\nexport default Anonymize;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Header from \"../General/Header\";\r\nimport UI from \"../General/UI\";\r\nimport { g, Conf, doc } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { SECOND } from \"../platform/helpers\";\r\nimport ImageCommon from \"./ImageCommon\";\r\nimport Volume from \"./Volume\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ImageHover = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW)) { return; }\r\n    if (Conf['Image Hover']) {\r\n      Callbacks.Post.push({\r\n        name: 'Image Hover',\r\n        cb:   this.node\r\n      });\r\n    }\r\n    if (Conf['Image Hover in Catalog']) {\r\n      return Callbacks.CatalogThread.push({\r\n        name: 'Image Hover',\r\n        cb:   this.catalogNode\r\n      });\r\n    }\r\n  },\r\n\r\n  node() {\r\n    return this.files.filter((file) => (file.isImage || file.isVideo) && file.thumb).map((file) =>\r\n      $.on(file.thumb, 'mouseover', ImageHover.mouseover(this, file)));\r\n  },\r\n\r\n  catalogNode() {\r\n    const file = this.thread.OP.files[0];\r\n    if (!file || (!file.isImage && !file.isVideo)) { return; }\r\n    return $.on(this.nodes.thumb, 'mouseover', ImageHover.mouseover(this.thread.OP, file));\r\n  },\r\n\r\n  mouseover(post, file) { return function(e) {\r\n    let el, height, width;\r\n    if (!doc.contains(this)) { return; }\r\n    const {isVideo} = file;\r\n    if (file.isExpanding || file.isExpanded || g.SITE.isThumbExpanded?.(file)) { return; }\r\n    const error = ImageHover.error(post, file);\r\n    if (ImageCommon.cache?.dataset.fileID === `${post.fullID}.${file.index}`) {\r\n      el = ImageCommon.popCache();\r\n      $.on(el, 'error', error);\r\n    } else {\r\n      el = $.el((isVideo ? 'video' : 'img'));\r\n      el.dataset.fileID = `${post.fullID}.${file.index}`;\r\n      $.on(el, 'error', error);\r\n      el.src = file.url;\r\n    }\r\n\r\n    if (Conf['Restart when Opened']) {\r\n      ImageCommon.rewind(el);\r\n      ImageCommon.rewind(this);\r\n    }\r\n    el.id = 'ihover';\r\n    $.add(Header.hover, el);\r\n    if (isVideo) {\r\n      el.loop     = true;\r\n      el.controls = false;\r\n      Volume.setup(el);\r\n      if (Conf['Autoplay']) {\r\n        el.play();\r\n        if (this.nodeName === 'VIDEO') { this.currentTime = el.currentTime; }\r\n      }\r\n    }\r\n    if (file.dimensions) {\r\n      [width, height] = Array.from((file.dimensions.split('x').map((x) => +x)));\r\n      const maxWidth = doc.clientWidth;\r\n      const maxHeight = doc.clientHeight - UI.hover.padding;\r\n      const scale = Math.min(1, maxWidth / width, maxHeight / height);\r\n      width *= scale;\r\n      height *= scale;\r\n      el.style.maxWidth  = `${width}px`;\r\n      el.style.maxHeight = `${height}px`;\r\n    }\r\n    return UI.hover({\r\n      root: this,\r\n      el,\r\n      latestEvent: e,\r\n      endEvents: 'mouseout click',\r\n      height,\r\n      width,\r\n      noRemove: true,\r\n      cb() {\r\n        $.off(el, 'error', error);\r\n        ImageCommon.pushCache(el);\r\n        ImageCommon.pause(el);\r\n        $.rm(el);\r\n        return el.removeAttribute('style');\r\n      }\r\n    });\r\n  }; },\r\n\r\n  error(post, file) { return function() {\r\n    if (ImageCommon.decodeError(this, file)) { return; }\r\n    return ImageCommon.error(this, post, file, 3 * SECOND, URL => {\r\n      if (URL) {\r\n        return this.src = URL + (this.src === URL ? '?' + Date.now() : '');\r\n      } else {\r\n        return $.rm(this);\r\n      }\r\n    });\r\n  }; }\r\n};\r\nexport default ImageHover;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Header from \"../General/Header\";\r\nimport { g, Conf, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ImageLoader = {\r\n  init() {\r\n    if (!['index', 'thread', 'archive'].includes(g.VIEW)) { return; }\r\n    const replace = Conf['Replace JPG'] || Conf['Replace PNG'] || Conf['Replace GIF'] || Conf['Replace WEBM'];\r\n    if (!Conf['Image Prefetching'] && !replace) { return; }\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Image Replace',\r\n      cb:   this.node\r\n    });\r\n\r\n    $.on(d, 'PostsInserted', function() {\r\n      if (ImageLoader.prefetchEnabled || replace) {\r\n        return g.posts.forEach(ImageLoader.prefetchAll);\r\n      }\r\n    });\r\n\r\n    if (Conf['Replace WEBM']) {\r\n      $.on(d, 'scroll visibilitychange 4chanXInitFinished PostsInserted', this.playVideos);\r\n    }\r\n\r\n    if (!Conf['Image Prefetching'] || !['index', 'thread'].includes(g.VIEW)) { return; }\r\n\r\n    const el = $.el('a', {\r\n      href: 'javascript:;',\r\n      title: 'Prefetch Images',\r\n      innerHTML: ''\r\n    }\r\n    );\r\n\r\n    $.on(el, 'click', this.toggle);\r\n\r\n    return Header.addShortcut('prefetch', el, 525);\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone) { return; }\r\n    for (var file of this.files) {\r\n      if (Conf['Replace WEBM'] && file.isVideo) { ImageLoader.replaceVideo(this, file); }\r\n      ImageLoader.prefetch(this, file);\r\n    }\r\n  },\r\n\r\n  replaceVideo(post, file) {\r\n    const {thumb} = file;\r\n    const video = $.el('video', {\r\n      preload:     'none',\r\n      loop:        true,\r\n      muted:       true,\r\n      poster:      thumb.src || thumb.dataset.src,\r\n      textContent: thumb.alt,\r\n      className:   thumb.className\r\n    }\r\n    );\r\n    video.setAttribute('muted', 'muted');\r\n    video.dataset.md5 = thumb.dataset.md5;\r\n    for (var attr of ['height', 'width', 'maxHeight', 'maxWidth']) { video.style[attr] = thumb.style[attr]; }\r\n    video.src         = file.url;\r\n    $.replace(thumb, video);\r\n    file.thumb      = video;\r\n    return file.videoThumb = true;\r\n  },\r\n\r\n  prefetch(post, file) {\r\n    let clone, type;\r\n    const {isImage, isVideo, thumb, url} = file;\r\n    if (file.isPrefetched || !(isImage || isVideo) || post.isHidden || post.thread.isHidden) { return; }\r\n    if (isVideo) {\r\n      type = 'WEBM';\r\n    } else {\r\n      type = url.match(/\\.([^.]+)$/)?.[1].toUpperCase();\r\n      if (type === 'JPEG') { type = 'JPG'; }\r\n    }\r\n    const replace = Conf[`Replace ${type}`] && !/spoiler/.test(thumb.src || thumb.dataset.src);\r\n    if (!replace && !ImageLoader.prefetchEnabled) { return; }\r\n    if ($.hasClass(doc, 'catalog-mode')) { return; }\r\n    if (![post, ...Array.from(post.clones)].some(clone => doc.contains(clone.nodes.root))) { return; }\r\n    file.isPrefetched = true;\r\n    if (file.videoThumb) {\r\n      for (clone of post.clones) { clone.file.thumb.preload = 'auto'; }\r\n      thumb.preload = 'auto';\r\n      // XXX Cloned video elements with poster in Firefox cause momentary display of image loading icon.\r\n      if ($.engine === 'gecko') {\r\n        $.on(thumb, 'loadeddata', function() { return this.removeAttribute('poster'); });\r\n      }\r\n      return;\r\n    }\r\n\r\n    const el = $.el(isImage ? 'img' : 'video');\r\n    if (isVideo) { el.preload = 'auto'; }\r\n    if (replace && isImage) {\r\n      $.on(el, 'load', function() {\r\n        for (clone of post.clones) { clone.file.thumb.src = url; }\r\n        return thumb.src = url;\r\n      });\r\n    }\r\n    return el.src = url;\r\n  },\r\n\r\n  prefetchAll(post) {\r\n    for (var file of post.files) {\r\n      ImageLoader.prefetch(post, file);\r\n    }\r\n  },\r\n\r\n  toggle() {\r\n    ImageLoader.prefetchEnabled = !ImageLoader.prefetchEnabled;\r\n    this.classList.toggle('disabled', !ImageLoader.prefetchEnabled);\r\n    if (ImageLoader.prefetchEnabled) {\r\n      g.posts.forEach(ImageLoader.prefetchAll);\r\n    }\r\n  },\r\n\r\n  playVideos() {\r\n    // Special case: Quote previews are off screen when inserted into document, but quickly moved on screen.\r\n    const qpClone = $.id('qp')?.firstElementChild;\r\n    return g.posts.forEach(function(post) {\r\n      for (post of [post, ...Array.from(post.clones)]) {\r\n        for (var file of post.files) {\r\n          if (file.videoThumb) {\r\n            var {thumb} = file;\r\n            if (Header.isNodeVisible(thumb) || (post.nodes.root === qpClone)) { thumb.play(); } else { thumb.pause(); }\r\n          }\r\n        }\r\n      }\r\n    });\r\n  }\r\n};\r\nexport default ImageLoader;\r\n","import $ from \"../platform/$\";\r\nimport Callbacks from \"../classes/Callbacks\";\r\nimport CrossOrigin from \"../platform/CrossOrigin\";\r\nimport { Conf, d, g } from \"../globals/globals\";\r\nimport Get from \"../General/Get\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Metadata = {\r\n  init() {\r\n    if (!Conf['WEBM Metadata'] || !['index', 'thread'].includes(g.VIEW)) { return; }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'WEBM Metadata',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    for (let i = 0; i < this.files.length; i++) {\r\n      var file = this.files[i];\r\n      if (/webm$/i.test(file.url)) {var el;\r\n      \r\n        if (this.isClone) {\r\n          el = $('.webm-title', file.text);\r\n        } else {\r\n          el = $.el('span',\r\n            {className: 'webm-title'});\r\n          el.dataset.index = i;\r\n          $.extend(el,\r\n            {innerHTML: \"<a href=\\\"javascript:;\\\"></a>\"});\r\n          $.add(file.text, [$.tn(' '), el]);\r\n        }\r\n        if (el.children.length === 1) { $.one(el.lastElementChild, 'mouseover focus', Metadata.load); }\r\n      }\r\n    }\r\n  },\r\n\r\n  load() {\r\n    $.rmClass(this.parentNode, 'error');\r\n    $.addClass(this.parentNode, 'loading');\r\n    const {index} = this.parentNode.dataset;\r\n    return CrossOrigin.binary(Get.postFromNode(this).files[+index].url, data => {\r\n      $.rmClass(this.parentNode, 'loading');\r\n      if (data != null) {\r\n        const title = Metadata.parse(data);\r\n        const output = $.el('span',\r\n          {textContent: title || ''});\r\n        if (title == null) { $.addClass(this.parentNode, 'not-found'); }\r\n        $.before(this, output);\r\n        this.parentNode.tabIndex = 0;\r\n        if (d.activeElement === this) { this.parentNode.focus(); }\r\n        return this.tabIndex = -1;\r\n      } else {\r\n        $.addClass(this.parentNode, 'error');\r\n        return $.one(this, 'click', Metadata.load);\r\n      }\r\n    }\r\n    ,\r\n      {Range: 'bytes=0-9999'});\r\n  },\r\n\r\n  parse(data) {\r\n    const readInt = function() {\r\n      let n = data[i++];\r\n      let len = 0;\r\n      while (n < (0x80 >> len)) { len++; }\r\n      n ^= (0x80 >> len);\r\n      while (len-- && (i < data.length)) {\r\n        n = (n << 8) ^ data[i++];\r\n      }\r\n      return n;\r\n    };\r\n\r\n    var i = 0;\r\n    while (i < data.length) {\r\n      var element = readInt();\r\n      var size    = readInt();\r\n      if (element === 0x3BA9) { // Title\r\n        var title = '';\r\n        while (size-- && (i < data.length)) {\r\n          title += String.fromCharCode(data[i++]);\r\n        }\r\n        return decodeURIComponent(escape(title)); // UTF-8 decoding\r\n      } else if (![0x8538067, 0x549A966].includes(element)) { // Segment, Info\r\n        i += size;\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n};\r\nexport default Metadata;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { g, Conf } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst RevealSpoilers = {\r\n  init() {\r\n    if (!['index', 'thread', 'archive'].includes(g.VIEW) || !Conf['Reveal Spoiler Thumbnails']) { return; }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Reveal Spoiler Thumbnails',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone) { return; }\r\n    for (var file of this.files) {\r\n      if (file.thumb && file.isSpoiler) {\r\n        var {thumb} = file;\r\n        // Remove old width and height.\r\n        thumb.removeAttribute('style');\r\n        // Enforce thumbnail size if thumbnail is replaced.\r\n        thumb.style.maxHeight = (thumb.style.maxWidth = this.isReply ? '125px' : '250px');\r\n        if (thumb.src) {\r\n          thumb.src = file.thumbURL;\r\n        } else {\r\n          thumb.dataset.src = file.thumbURL;\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default RevealSpoilers;\r\n","import Callbacks from \"../classes/Callbacks\";\r\n// import Test from \"../General/Test\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport ImageHost from \"../Images/ImageHost\";\r\nimport ExpandComment from \"../Miscellaneous/ExpandComment\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport Embedding from \"./Embedding\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Linkify = {\r\n  init() {\r\n    if (!['index', 'thread', 'archive'].includes(g.VIEW) || !Conf['Linkify']) { return; }\r\n\r\n    if (Conf['Comment Expansion']) {\r\n      ExpandComment.callbacks.push(this.node);\r\n    }\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Linkify',\r\n      cb:   this.node\r\n    });\r\n\r\n    return Embedding.init();\r\n  },\r\n\r\n  node() {\r\n    let link;\r\n    if (this.isClone) { return Embedding.events(this); }\r\n    if (!Linkify.regString.test(this.info.comment)) { return; }\r\n    for (link of $$('a', this.nodes.comment)) {\r\n      if (g.SITE.isLinkified?.(link)) {\r\n        $.addClass(link, 'linkify');\r\n        if (ImageHost.useFaster) { ImageHost.fixLinks([link]); }\r\n        Embedding.process(link, this);\r\n      }\r\n    }\r\n    const links = Linkify.process(this.nodes.comment);\r\n    if (ImageHost.useFaster) { ImageHost.fixLinks(links); }\r\n    for (link of links) { Embedding.process(link, this); }\r\n  },\r\n\r\n  process(node) {\r\n    let length;\r\n    const test     = /[^\\s\"]+/g;\r\n    const space    = /[\\s\"]/;\r\n    const snapshot = $.X('.//br|.//text()', node);\r\n    let i = 0;\r\n    const links = [];\r\n    while ((node = snapshot.snapshotItem(i++))) {\r\n      var result;\r\n      var {data} = node;\r\n      if (!data || (node.parentElement.nodeName === \"A\")) { continue; }\r\n\r\n      while ((result = test.exec(data))) {\r\n        var {index} = result;\r\n        var endNode = node;\r\n        var word    = result[0];\r\n        // End of node, not necessarily end of space-delimited string\r\n        if ((length = index + word.length) === data.length) {\r\n          var saved;\r\n          test.lastIndex = 0;\r\n\r\n          while (saved = snapshot.snapshotItem(i++)) {\r\n            var end;\r\n            if ((saved.nodeName === 'BR') || ((saved.parentElement.nodeName === 'P') && !saved.previousSibling)) {\r\n              var part1, part2;\r\n              if (\r\n                // link deliberately split\r\n                (part1 = word.match(/(https?:\\/\\/)?([a-z\\d-]+\\.)*[a-z\\d-]+$/i)) &&\r\n                (part2 = snapshot.snapshotItem(i)?.data?.match(/^(\\.[a-z\\d-]+)*\\//i)) &&\r\n                ((part1[0] + part2[0]).search(Linkify.regString) === 0)\r\n              ) {\r\n                continue;\r\n              } else {\r\n                break;\r\n              }\r\n            }\r\n\r\n            if ((saved.parentElement.nodeName === \"A\") && !Linkify.regString.test(word)) {\r\n              break;\r\n            }\r\n\r\n            endNode  = saved;\r\n            ({data}   = saved);\r\n\r\n            if (end = space.exec(data)) {\r\n              // Set our snapshot and regex to start on this node at this position when the loop resumes\r\n              word += data.slice(0, end.index);\r\n              test.lastIndex = (length = end.index);\r\n              i--;\r\n              break;\r\n            } else {\r\n              ({length} = data);\r\n              word    += data;\r\n            }\r\n          }\r\n        }\r\n\r\n        if (Linkify.regString.test(word)) {\r\n          links.push(Linkify.makeRange(node, endNode, index, length));\r\n\r\n          // <% if (readJSON('/.tests_enabled')) { %>\r\n          // if (links.length) {\r\n          // Test.assert(() => word === links[links.length - 1]?.toString());\r\n          // }\r\n          // <% } %>\r\n        }\r\n\r\n        if (!test.lastIndex || (node !== endNode)) { break; }\r\n      }\r\n    }\r\n\r\n    i = links.length;\r\n    while (i--) {\r\n      links[i] = Linkify.makeLink(links[i]);\r\n    }\r\n    return links;\r\n  },\r\n\r\n  regString: new RegExp(`(\\\r\n\\\r\n(https?|mailto|git|magnet|ftp|irc):(\\\r\n[a-z\\\\d%/?]\\\r\n)\\\r\n|\\\r\n([-a-z\\\\d]+[.])+(\\\r\naero|asia|biz|cat|com|coop|dance|info|int|jobs|mobi|moe|museum|name|net|org|post|pro|tel|travel|xxx|xyz|edu|gov|mil|[a-z]{2}\\\r\n)([:/]|(?![^\\\\s\"]))\\\r\n|\\\r\n[\\\\d]{1,3}\\\\.[\\\\d]{1,3}\\\\.[\\\\d]{1,3}\\\\.[\\\\d]{1,3}\\\r\n|\\\r\n[-\\\\w\\\\d.@]+@[a-z\\\\d.-]+\\\\.[a-z\\\\d]\\\r\n)`, 'i'),\r\n\r\n  makeRange(startNode, endNode, startOffset, endOffset) {\r\n    const range = document.createRange();\r\n    range.setStart(startNode, startOffset);\r\n    range.setEnd(endNode,   endOffset);\r\n    return range;\r\n  },\r\n\r\n  makeLink(range) {\r\n    let t;\r\n    let encodedDomain;\r\n    let text = range.toString();\r\n\r\n    // Clean start of range\r\n    let i = text.search(Linkify.regString);\r\n\r\n    if (i > 0) {\r\n      text = text.slice(i);\r\n      while ((range.startOffset + i) >= range.startContainer.data.length) { i--; }\r\n\r\n      if (i) { range.setStart(range.startContainer, range.startOffset + i); }\r\n    }\r\n\r\n    // Clean end of range\r\n    i = 0;\r\n    while (/[)\\]}>.,]/.test(t = text.charAt(text.length - (1 + i)))) {\r\n      if (!/[.,]/.test(t) && !((text.match(/[()\\[\\]{}<>]/g)).length % 2)) { break; }\r\n      i++;\r\n    }\r\n\r\n    if (i) {\r\n      text = text.slice(0, -i);\r\n      while ((range.endOffset - i) < 0) { i--; }\r\n\r\n      if (i) {\r\n        range.setEnd(range.endContainer, range.endOffset - i);\r\n      }\r\n    }\r\n\r\n    // Make our link 'valid' if it is formatted incorrectly.\r\n    if (!/((mailto|magnet):|.+:\\/\\/)/.test(text)) {\r\n      text = (\r\n        /@/.test(text) ?\r\n          'mailto:'\r\n        :\r\n          'http://'\r\n      ) + text;\r\n    }\r\n\r\n    // Decode percent-encoded characters in domain so that they behave consistently across browsers.\r\n    if (encodedDomain = text.match(/^(https?:\\/\\/[^/]*%[0-9a-f]{2})(.*)$/i)) {\r\n      text = encodedDomain[1].replace(/%([0-9a-f]{2})/ig, function(x, y) {\r\n        if (y === '25') { return x; } else { return String.fromCharCode(parseInt(y, 16)); }\r\n      }) + encodedDomain[2];\r\n    }\r\n\r\n    const a = $.el('a', {\r\n      className: 'linkify',\r\n      rel:       'noreferrer noopener',\r\n      target:    '_blank',\r\n      href:      text\r\n    }\r\n    );\r\n\r\n    // Insert the range into the anchor, the anchor into the range's DOM location, and destroy the range.\r\n    $.add(a, range.extractContents());\r\n    range.insertNode(a);\r\n\r\n    return a;\r\n  }\r\n};\r\nexport default Linkify;\r\n","import $ from \"../platform/$\";\r\nimport Redirect from \"../Archive/Redirect\";\r\nimport Filter from \"../Filtering/Filter\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport Menu from \"./Menu\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst ArchiveLink = {\r\n  init() {\r\n    if ((g.SITE.software !== 'yotsuba') || !['index', 'thread'].includes(g.VIEW) || !Conf['Menu'] || !Conf['Archive Link']) { return; }\r\n\r\n    const div = $.el('div',\r\n      {textContent: 'Archive'});\r\n\r\n    const entry = {\r\n      el: div,\r\n      order: 60,\r\n      open({ID, thread, board}) {\r\n        return !!Redirect.to('thread', {postID: ID, threadID: thread.ID, boardID: board.ID});\r\n      },\r\n      subEntries: []\r\n    };\r\n\r\n    for (var type of [\r\n      ['Post',      'post'],\r\n      ['Name',      'name'],\r\n      ['Tripcode',  'tripcode'],\r\n      ['Capcode',   'capcode'],\r\n      ['Subject',   'subject'],\r\n      ['Flag',      'country'],\r\n      ['Filename',  'filename'],\r\n      ['Image MD5', 'MD5']\r\n    ]) {\r\n      // Add a sub entry for each type.\r\n      entry.subEntries.push(this.createSubEntry(type[0], type[1]));\r\n    }\r\n\r\n    return Menu.menu.addEntry(entry);\r\n  },\r\n\r\n  createSubEntry(text, type) {\r\n    const el = $.el('a', {\r\n      textContent: text,\r\n      target: '_blank'\r\n    }\r\n    );\r\n\r\n    const open = type === 'post' ?\r\n      function({ID, thread, board}) {\r\n        el.href = Redirect.to('thread', {postID: ID, threadID: thread.ID, boardID: board.ID});\r\n        return true;\r\n      }\r\n    :\r\n      function(post) {\r\n        const typeParam = (type === 'country') && post.info.flagCodeTroll ?\r\n          'troll_country'\r\n        :\r\n          type;\r\n        const value = type === 'country' ?\r\n          post.info.flagCode || post.info.flagCodeTroll?.toLowerCase()\r\n        :\r\n          Filter.values(type, post)[0];\r\n        // We want to parse the exact same stuff as the filter does already.\r\n        if (!value) { return false; }\r\n        el.href = Redirect.to('search', {\r\n          boardID:  post.board.ID,\r\n          type:     typeParam,\r\n          value,\r\n          isSearch: true\r\n        }\r\n        );\r\n        return true;\r\n      };\r\n\r\n    return {\r\n      el,\r\n      open\r\n    };\r\n  }\r\n};\r\nexport default ArchiveLink;\r\n","import { g, Conf, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport Menu from \"./Menu\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar CopyTextLink = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Menu'] || !Conf['Copy Text Link']) { return; }\r\n\r\n    const a = $.el('a', {\r\n      className: 'copy-text-link',\r\n      href: 'javascript:;',\r\n      textContent: 'Copy Text'\r\n    }\r\n    );\r\n    $.on(a, 'click', CopyTextLink.copy);\r\n\r\n    return Menu.menu.addEntry({\r\n      el: a,\r\n      order: 12,\r\n      open(post) {\r\n        CopyTextLink.text = (post.origin || post).commentOrig();\r\n        return true;\r\n      }\r\n    });\r\n  },\r\n\r\n  copy() {\r\n    const el = $.el('textarea', {\r\n      className: 'copy-text-element',\r\n      value: CopyTextLink.text\r\n    }\r\n    );\r\n    $.add(d.body, el);\r\n    el.select();\r\n    try {\r\n      d.execCommand('copy');\r\n    } catch (error) {}\r\n    return $.rm(el);\r\n  }\r\n};\r\nexport default CopyTextLink;\r\n","import Notice from \"../classes/Notice\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { dict } from \"../platform/helpers\";\r\nimport QR from \"../Posting/QR\";\r\nimport Menu from \"./Menu\";\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar DeleteLink = {\r\n  auto: [dict(), dict()],\r\n\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Menu'] || !Conf['Delete Link']) { return; }\r\n\r\n    const div = $.el('div', {\r\n      className: 'delete-link',\r\n      textContent: 'Delete'\r\n    }\r\n    );\r\n    const postEl = $.el('a', {\r\n      className: 'delete-post',\r\n      href: 'javascript:;'\r\n    }\r\n    );\r\n    const fileEl = $.el('a', {\r\n      className: 'delete-file',\r\n      href: 'javascript:;'\r\n    }\r\n    );\r\n    this.nodes = {\r\n      menu:  div.firstChild,\r\n      links: [postEl, fileEl]\r\n    };\r\n\r\n    const postEntry = {\r\n      el: postEl,\r\n      open() {\r\n        postEl.textContent = DeleteLink.linkText(false);\r\n        $.on(postEl, 'click', DeleteLink.toggle);\r\n        return true;\r\n      }\r\n    };\r\n    const fileEntry = {\r\n      el: fileEl,\r\n      open({file}) {\r\n        if (!file || file.isDead) { return false; }\r\n        fileEl.textContent = DeleteLink.linkText(true);\r\n        $.on(fileEl, 'click', DeleteLink.toggle);\r\n        return true;\r\n      }\r\n    };\r\n\r\n    return Menu.menu.addEntry({\r\n      el: div,\r\n      order: 40,\r\n      open(post) {\r\n        if (post.isDead) { return false; }\r\n        DeleteLink.post = post;\r\n        DeleteLink.nodes.menu.textContent = DeleteLink.menuText();\r\n        DeleteLink.cooldown.start(post);\r\n        return true;\r\n      },\r\n      subEntries: [postEntry, fileEntry]});\r\n  },\r\n\r\n  menuText() {\r\n    let seconds;\r\n    if ((seconds = DeleteLink.cooldown.seconds[DeleteLink.post.fullID])) {\r\n      return `Delete (${seconds})`;\r\n    } else {\r\n      return 'Delete';\r\n    }\r\n  },\r\n\r\n  linkText(fileOnly) {\r\n    let text = fileOnly ? 'File' : 'Post';\r\n    if (DeleteLink.auto[+fileOnly][DeleteLink.post.fullID]) {\r\n      text = `Deleting ${text.toLowerCase()}...`;\r\n    }\r\n    return text;\r\n  },\r\n\r\n  toggle() {\r\n    const {post} = DeleteLink;\r\n    const fileOnly = $.hasClass(this, 'delete-file');\r\n    const auto = DeleteLink.auto[+fileOnly];\r\n\r\n    if (auto[post.fullID]) {\r\n      delete auto[post.fullID];\r\n    } else {\r\n      auto[post.fullID] = true;\r\n    }\r\n    this.textContent = DeleteLink.linkText(fileOnly);\r\n\r\n    if (!DeleteLink.cooldown.seconds[post.fullID]) {\r\n      return DeleteLink.delete(post, fileOnly);\r\n    }\r\n  },\r\n\r\n  delete(post, fileOnly) {\r\n    const link = DeleteLink.nodes.links[+fileOnly];\r\n    delete DeleteLink.auto[+fileOnly][post.fullID];\r\n    if (post.fullID === DeleteLink.post.fullID) { $.off(link, 'click', DeleteLink.toggle); }\r\n\r\n    const form = {\r\n      mode: 'usrdel',\r\n      onlyimgdel: fileOnly,\r\n      pwd: QR.persona.getPassword()\r\n    };\r\n    form[+post.ID] = 'delete';\r\n\r\n    return $.ajax($.id('delform').action.replace(`/${g.BOARD}/`, `/${post.board}/`), {\r\n      responseType: 'document',\r\n      withCredentials: true,\r\n      onloadend() { return DeleteLink.load(link, post, fileOnly, this.response); },\r\n      form: $.formData(form)\r\n    }\r\n    );\r\n  },\r\n\r\n  load(link, post, fileOnly, resDoc) {\r\n    let msg;\r\n    if (!resDoc) {\r\n      new Notice('warning', 'Connection error, please retry.', 20);\r\n      if (post.fullID === DeleteLink.post.fullID) { $.on(link, 'click', DeleteLink.toggle); }\r\n      return;\r\n    }\r\n\r\n    link.textContent = DeleteLink.linkText(fileOnly);\r\n    if (resDoc.title === '4chan - Banned') { // Ban/warn check\r\n      const el = $.el('span', {innerHTML: \"You can&#039;t delete posts because you are <a href=\\\"//www.4chan.org/banned\\\" target=\\\"_blank\\\">banned</a>.\"});\r\n      return new Notice('warning', el, 20);\r\n    } else if (msg = resDoc.getElementById('errmsg')) { // error!\r\n      new Notice('warning', msg.textContent, 20);\r\n      if (post.fullID === DeleteLink.post.fullID) { $.on(link, 'click', DeleteLink.toggle); }\r\n      if (QR.cooldown.data && Conf['Cooldown'] && /\\bwait\\b/i.test(msg.textContent)) {\r\n        DeleteLink.cooldown.start(post, 5);\r\n        DeleteLink.auto[+fileOnly][post.fullID] = true;\r\n        return DeleteLink.nodes.links[+fileOnly].textContent = DeleteLink.linkText(fileOnly);\r\n      }\r\n    } else {\r\n      if (!fileOnly) { QR.cooldown.delete(post); }\r\n      if (resDoc.title === 'Updating index...') {\r\n        // We're 100% sure.\r\n        (post.origin || post).kill(fileOnly);\r\n      }\r\n      if (post.fullID === DeleteLink.post.fullID) { return link.textContent = 'Deleted'; }\r\n    }\r\n  },\r\n\r\n  cooldown: {\r\n    seconds: dict(),\r\n\r\n    start(post, seconds) {\r\n      // Already counting.\r\n      if (DeleteLink.cooldown.seconds[post.fullID] != null) { return; }\r\n\r\n      if (seconds == null) { seconds = QR.cooldown.secondsDeletion(post); }\r\n      if (seconds > 0) {\r\n        DeleteLink.cooldown.seconds[post.fullID] = seconds;\r\n        return DeleteLink.cooldown.count(post);\r\n      }\r\n    },\r\n\r\n    count(post) {\r\n      if (post.fullID === DeleteLink.post.fullID) { DeleteLink.nodes.menu.textContent = DeleteLink.menuText(); }\r\n      if ((DeleteLink.cooldown.seconds[post.fullID] > 0) && Conf['Cooldown']) {\r\n        DeleteLink.cooldown.seconds[post.fullID]--;\r\n        setTimeout(DeleteLink.cooldown.count, 1000, post);\r\n      } else {\r\n        delete DeleteLink.cooldown.seconds[post.fullID];\r\n        for (var fileOnly of [false, true]) {\r\n          if (DeleteLink.auto[+fileOnly][post.fullID]) {\r\n            DeleteLink.delete(post, fileOnly);\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default DeleteLink;\r\n","import { g, Conf } from \"../globals/globals\";\r\nimport ImageCommon from \"../Images/ImageCommon\";\r\nimport $ from \"../platform/$\";\r\nimport Menu from \"./Menu\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst DownloadLink = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Menu'] || !Conf['Download Link']) { return; }\r\n\r\n    const a = $.el('a', {\r\n      className: 'download-link',\r\n      textContent: 'Download file'\r\n    }\r\n    );\r\n\r\n    // Specifying the filename with the download attribute only works for same-origin links.\r\n    $.on(a, 'click', ImageCommon.download);\r\n\r\n    return Menu.menu.addEntry({\r\n      el: a,\r\n      order: 100,\r\n      open({file}) {\r\n        if (!file) { return false; }\r\n        a.href     = file.url;\r\n        a.download = file.name;\r\n        return true;\r\n      }\r\n    });\r\n  }\r\n};\r\nexport default DownloadLink;\r\n","import { g, Conf, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport Menu from \"./Menu\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ReportLink = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Menu'] || !Conf['Report Link']) { return; }\r\n\r\n    const a = $.el('a', {\r\n      className: 'report-link',\r\n      href: 'javascript:;',\r\n      textContent: 'Report'\r\n    }\r\n    );\r\n    $.on(a, 'click', ReportLink.report);\r\n\r\n    return Menu.menu.addEntry({\r\n      el: a,\r\n      order: 10,\r\n      open(post) {\r\n        ReportLink.url = `//sys.${location.hostname.split('.')[1]}.org/${post.board}/imgboard.php?mode=report&no=${post}`;\r\n        if (d.cookie.indexOf('pass_enabled=1') >= 0) {\r\n          ReportLink.dims = 'width=350,height=275';\r\n        } else {\r\n          ReportLink.dims = 'width=400,height=550';\r\n        }\r\n        return true;\r\n      }\r\n    });\r\n  },\r\n\r\n  report() {\r\n    const {url, dims} = ReportLink;\r\n    const id  = Date.now();\r\n    const set = `toolbar=0,scrollbars=1,location=0,status=1,menubar=0,resizable=1,${dims}`;\r\n    return window.open(url, id, set);\r\n  }\r\n};\r\nexport default ReportLink;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { Conf, doc } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar AntiAutoplay = {\r\n  init() {\r\n    if (!Conf['Disable Autoplaying Sounds']) { return; }\r\n    $.addClass(doc, 'anti-autoplay');\r\n    for (var audio of $$('audio[autoplay]', doc)) { this.stop(audio); }\r\n    window.addEventListener('loadstart', (e => this.stop(e.target)), true);\r\n    Callbacks.Post.push({\r\n      name: 'Disable Autoplaying Sounds',\r\n      cb:   this.node\r\n    });\r\n    return $.ready(() => this.process(d.body));\r\n  },\r\n\r\n  stop(audio) {\r\n    if (!audio.autoplay) { return; }\r\n    audio.pause();\r\n    audio.autoplay = false;\r\n    if (audio.controls) { return; }\r\n    audio.controls = true;\r\n    return $.addClass(audio, 'controls-added');\r\n  },\r\n\r\n  node() {\r\n    return AntiAutoplay.process(this.nodes.comment);\r\n  },\r\n\r\n  process(root) {\r\n    for (var iframe of $$('iframe[src*=\"youtube\"][src*=\"autoplay=1\"]', root)) {\r\n      AntiAutoplay.processVideo(iframe, 'src');\r\n    }\r\n    for (var object of $$('object[data*=\"youtube\"][data*=\"autoplay=1\"]', root)) {\r\n      AntiAutoplay.processVideo(object, 'data');\r\n    }\r\n  },\r\n\r\n  processVideo(el, attr) {\r\n    el[attr] = el[attr].replace(/\\?autoplay=1&?/, '?').replace('&autoplay=1', '');\r\n    if (window.getComputedStyle(el).display === 'none') { el.style.display = 'block'; }\r\n    return $.addClass(el, 'autoplay-removed');\r\n  }\r\n};\r\nexport default AntiAutoplay;\r\n","import DataBoard from \"../classes/DataBoard\";\r\nimport { Conf, d, g } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport Unread from \"../Monitoring/Unread\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Banner = {\r\n  init() {\r\n    if (Conf['Custom Board Titles']) {\r\n      this.db = new DataBoard('customTitles', null, true);\r\n    }\r\n\r\n    $.asap((() => d.body), () => $.asap((() => $('hr')), Banner.ready));\r\n\r\n    // Let 4chan's JS load the banner if enabled; otherwise, load it ourselves.\r\n    if (g.BOARD.ID !== 'f') {\r\n      return Main.ready(() => $.queueTask(Banner.load));\r\n    }\r\n  },\r\n\r\n  ready() {\r\n    const banner = $(\".boardBanner\");\r\n    const {children} = banner;\r\n\r\n    if ((g.VIEW === 'thread') && Conf['Remove Thread Excerpt']) {\r\n      Banner.setTitle(children[1].textContent);\r\n    }\r\n\r\n    children[0].title = \"Click to change\";\r\n    $.on(children[0], 'click', Banner.cb.toggle);\r\n\r\n    if (Conf['Custom Board Titles']) {\r\n      Banner.custom(children[1]);\r\n      if (children[2]) { return Banner.custom(children[2]); }\r\n    }\r\n  },\r\n\r\n  load() {\r\n    const bannerCnt = $.id('bannerCnt');\r\n    if (!bannerCnt.firstChild) {\r\n      const img = $.el('img', {\r\n        alt: '4chan',\r\n        src: '//s.4cdn.org/image/title/' + bannerCnt.dataset.src\r\n      }\r\n      );\r\n      return $.add(bannerCnt, img);\r\n    }\r\n  },\r\n\r\n  setTitle(title) {\r\n    if (Unread.title != null) {\r\n      Unread.title = title;\r\n      return Unread.update();\r\n    } else {\r\n      return d.title = title;\r\n    }\r\n  },\r\n\r\n  cb: {\r\n    toggle() {\r\n      if (!Banner.choices?.length) {\r\n        Banner.choices = Conf['knownBanners'].split(',').slice();\r\n      }\r\n      const i = Math.floor(Banner.choices.length * Math.random());\r\n      const banner = Banner.choices.splice(i, 1);\r\n      return $('img', this.parentNode).src = `//s.4cdn.org/image/title/${banner}`;\r\n    },\r\n\r\n    click(e) {\r\n      if (!e.ctrlKey && !e.metaKey) { return; }\r\n      if (Banner.original[this.className] == null) { Banner.original[this.className] = this.cloneNode(true); }\r\n      this.contentEditable = true;\r\n      for (var br of $$('br', this)) { $.replace(br, $.tn('\\n')); }\r\n      return this.focus();\r\n    },\r\n\r\n    keydown(e) {\r\n      e.stopPropagation();\r\n      if (!e.shiftKey && (e.keyCode === 13)) { return this.blur(); }\r\n    },\r\n\r\n    blur() {\r\n      for (var br of $$('br', this)) { $.replace(br, $.tn('\\n')); }\r\n      if (this.textContent = this.textContent.replace(/\\n*$/, '')) {\r\n        this.contentEditable = false;\r\n        return Banner.db.set({\r\n          boardID:  g.BOARD.ID,\r\n          threadID: this.className,\r\n          val: {\r\n            title: this.textContent,\r\n            orig:  Banner.original[this.className].textContent\r\n          }\r\n        });\r\n      } else {\r\n        $.rmAll(this);\r\n        $.add(this, [...Array.from(Banner.original[this.className].cloneNode(true).childNodes)]);\r\n        return Banner.db.delete({\r\n          boardID:  g.BOARD.ID,\r\n          threadID: this.className\r\n        });\r\n      }\r\n    }\r\n  },\r\n\r\n  original: dict(),\r\n\r\n  custom(child) {\r\n    let data;\r\n    const {className} = child;\r\n    child.title = `Ctrl/\\u2318+click to edit board ${className.slice(5).toLowerCase()}`;\r\n    child.spellcheck = false;\r\n\r\n    for (var event of ['click', 'keydown', 'blur']) {\r\n      $.on(child, event, Banner.cb[event]);\r\n    }\r\n\r\n    if (data = Banner.db.get({boardID: g.BOARD.ID, threadID: className})) {\r\n      if (Conf['Persistent Custom Board Titles'] || (data.orig === child.textContent)) {\r\n        Banner.original[className] = child.cloneNode(true);\r\n        return child.textContent = data.title;\r\n      } else {\r\n        return Banner.db.delete({boardID: g.BOARD.ID, threadID: className});\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default Banner;\r\n","import { g, Conf } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Flash = {\r\n  init() {\r\n    if ((g.BOARD.ID === 'f') && Conf['Enable Native Flash Embedding']) {\r\n      return $.ready(Flash.initReady);\r\n    }\r\n  },\r\n\r\n  initReady() {\r\n    if ($.hasStorage) {\r\n      return $.global(function() { if (JSON.parse(localStorage['4chan-settings'] || '{}').disableAll) { return window.SWFEmbed.init(); } });\r\n    } else {\r\n      if (g.VIEW === 'thread') {\r\n        $.global(() => window.Main.tid = location.pathname.split(/\\/+/)[3]);\r\n      }\r\n      return $.global(() => window.SWFEmbed.init());\r\n    }\r\n  }\r\n};\r\nexport default Flash;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport BoardConfig from \"../General/BoardConfig\";\r\nimport { d, doc, g } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport ExpandComment from \"./ExpandComment\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Fourchan = {\r\n  init() {\r\n    if ((g.SITE.software !== 'yotsuba') || !['index', 'thread', 'archive'].includes(g.VIEW)) { return; }\r\n    BoardConfig.ready(this.initBoard);\r\n    return Main.ready(this.initReady);\r\n  },\r\n\r\n  initBoard() {\r\n    if (g.BOARD.config.code_tags) {\r\n      $.on(window, 'prettyprint:cb', function(e) {\r\n        let post, pre;\r\n        if (!(post = g.posts.get(e.detail.ID))) { return; }\r\n        if (!(pre  = $$('.prettyprint', post.nodes.comment)[+e.detail.i])) { return; }\r\n        if (!$.hasClass(pre, 'prettyprinted')) {\r\n          pre.innerHTML = e.detail.html;\r\n          return $.addClass(pre, 'prettyprinted');\r\n        }\r\n      });\r\n      $.global(() => window.addEventListener('prettyprint', e => window.dispatchEvent(new CustomEvent('prettyprint:cb', {\r\n        detail: {\r\n          ID:   e.detail.ID,\r\n          i:    e.detail.i,\r\n          html: window.prettyPrintOne(e.detail.html)\r\n        }\r\n      }))\r\n      , false));\r\n      Callbacks.Post.push({\r\n        name: 'Parse [code] tags',\r\n        cb:   Fourchan.code\r\n      });\r\n      g.posts.forEach(function(post) {\r\n        if (post.callbacksExecuted) {\r\n          return Callbacks.Post.execute(post, ['Parse [code] tags'], true);\r\n        }\r\n      });\r\n      ExpandComment.callbacks.push(Fourchan.code);\r\n    }\r\n\r\n    if (g.BOARD.config.math_tags) {\r\n      $.global(() => window.addEventListener('mathjax', function(e) {\r\n        if (window.MathJax) {\r\n          return window.MathJax.Hub.Queue(['Typeset', window.MathJax.Hub, e.target]);\r\n        } else {\r\n          if (!document.querySelector('script[src^=\"//cdn.mathjax.org/\"]')) { // don't load MathJax if already loading\r\n            window.loadMathJax();\r\n            window.loadMathJax = function() {};\r\n          }\r\n          // 4chan only handles post comments on MathJax load; anything else (e.g. the QR preview) must be queued explicitly.\r\n          if (!e.target.classList.contains('postMessage')) {\r\n            return document.querySelector('script[src^=\"//cdn.mathjax.org/\"]').addEventListener('load', () => window.MathJax.Hub.Queue(['Typeset', window.MathJax.Hub, e.target])\r\n            , false);\r\n          }\r\n        }\r\n      }\r\n      , false));\r\n      Callbacks.Post.push({\r\n        name: 'Parse [math] tags',\r\n        cb:   Fourchan.math\r\n      });\r\n      g.posts.forEach(function(post) {\r\n        if (post.callbacksExecuted) {\r\n          return Callbacks.Post.execute(post, ['Parse [math] tags'], true);\r\n        }\r\n      });\r\n      return ExpandComment.callbacks.push(Fourchan.math);\r\n    }\r\n  },\r\n\r\n  // Disable 4chan's ID highlighting (replaced by IDHighlight) and reported post hiding.\r\n  initReady() {\r\n    return $.global(function() {\r\n      window.clickable_ids = false;\r\n      for (var node of document.querySelectorAll('.posteruid, .capcode')) {\r\n        node.removeEventListener('click', window.idClick, false);\r\n      }\r\n    });\r\n  },\r\n\r\n  code() {\r\n    if (this.isClone) { return; }\r\n    return $.ready(() => {\r\n      const iterable = $$('.prettyprint', this.nodes.comment);\r\n      for (let i = 0; i < iterable.length; i++) {\r\n        var pre = iterable[i];\r\n        if (!$.hasClass(pre, 'prettyprinted')) {\r\n          $.event('prettyprint', {ID: this.fullID, i, html: pre.innerHTML}, window);\r\n        }\r\n      }\r\n    });\r\n  },\r\n\r\n  math() {\r\n    let wbrs;\r\n    if (!/\\[(math|eqn)\\]/.test(this.nodes.comment.textContent)) { return; }\r\n    // XXX <wbr> tags frequently break MathJax; remove them.\r\n    if ((wbrs = $$('wbr', this.nodes.comment)).length) {\r\n      for (var wbr of wbrs) { $.rm(wbr); }\r\n      this.nodes.comment.normalize();\r\n    }\r\n    var cb = () => {\r\n      if (!doc.contains(this.nodes.comment)) { return; }\r\n      $.off(d, 'PostsInserted', cb);\r\n      return $.event('mathjax', null, this.nodes.comment);\r\n    };\r\n    $.on(d, 'PostsInserted', cb);\r\n    return cb();\r\n  }\r\n};\r\nexport default Fourchan;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { dict } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar IDColor = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Color User IDs']) { return; }\r\n    this.ids = dict();\r\n    this.ids['Heaven'] = [0, 0, 0, '#fff'];\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Color User IDs',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    let span, uid;\r\n    if (this.isClone || !((uid = this.info.uniqueID) && (span = this.nodes.uniqueID))) { return; }\r\n\r\n    const rgb = IDColor.ids[uid] || IDColor.compute(uid);\r\n\r\n    // Style the damn node.\r\n    const {style} = span;\r\n    style.color = rgb[3];\r\n    style.backgroundColor = `rgb(${rgb[0]},${rgb[1]},${rgb[2]})`;\r\n    return $.addClass(span, 'painted');\r\n  },\r\n\r\n  compute(uid) {\r\n    // Convert chars to integers, bitshift and math to create a larger integer\r\n    // Create a nice string of binary\r\n    const hash = g.SITE.uidColor ? g.SITE.uidColor(uid) : parseInt(uid, 16);\r\n\r\n    // Convert binary string to numerical values with bitshift and '&' truncation.\r\n    const rgb = [\r\n      (hash >> 16) & 0xFF,\r\n      (hash >> 8)  & 0xFF,\r\n      hash & 0xFF\r\n    ];\r\n\r\n    // Weight color luminance values, assign a font color that should be readable. \r\n    rgb.push($.luma(rgb) > 125 ?\r\n      '#000'\r\n    :\r\n      '#fff'\r\n    );\r\n\r\n    // Cache.\r\n    return this.ids[uid] = rgb;\r\n  }\r\n};\r\nexport default IDColor;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar IDHighlight = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW)) { return; }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Highlight by User ID',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  uniqueID: null,\r\n\r\n  node() {\r\n    if (this.nodes.uniqueIDRoot) { $.on(this.nodes.uniqueIDRoot, 'click', IDHighlight.click(this)); }\r\n    if (this.nodes.capcode) { $.on(this.nodes.capcode,      'click', IDHighlight.click(this)); }\r\n    if (!this.isClone) { return IDHighlight.set(this); }\r\n  },\r\n\r\n  set(post) {\r\n    const match = (post.info.uniqueID || post.info.capcode) === IDHighlight.uniqueID;\r\n    return $[match ? 'addClass' : 'rmClass'](post.nodes.post, 'highlight');\r\n  },\r\n\r\n  click(post) { return function() {\r\n    const uniqueID = post.info.uniqueID || post.info.capcode;\r\n    IDHighlight.uniqueID = IDHighlight.uniqueID === uniqueID ? null : uniqueID;\r\n    return g.posts.forEach(IDHighlight.set);\r\n  }; }\r\n};\r\nexport default IDHighlight;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Get from \"../General/Get\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar IDPostCount = {\r\n  init() {\r\n    if ((g.VIEW !== 'thread') || !Conf['Count Posts by ID']) { return; }\r\n    Callbacks.Thread.push({\r\n      name: 'Count Posts by ID',\r\n      cb() { return IDPostCount.thread = this; }\r\n    });\r\n    return Callbacks.Post.push({\r\n      name: 'Count Posts by ID',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.nodes.uniqueID && (this.thread === IDPostCount.thread)) {\r\n      return $.on(this.nodes.uniqueID, 'mouseover', IDPostCount.count);\r\n    }\r\n  },\r\n\r\n  count() {\r\n    const {uniqueID} = Get.postFromNode(this).info;\r\n    let n = 0;\r\n    IDPostCount.thread.posts.forEach(function(post) {\r\n      if (post.info.uniqueID === uniqueID) { return n++; }\r\n    });\r\n    return this.title = `${n} post${n === 1 ? '' : 's'} by this ID`;\r\n  }\r\n};\r\nexport default IDPostCount;\r\n","import $ from \"../platform/$\";\r\nimport Callbacks from \"../classes/Callbacks\";\r\nimport { g } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ModContact = {\r\n  init() {\r\n    if ((g.SITE.software !== 'yotsuba') || !['index', 'thread'].includes(g.VIEW)) { return; }\r\n    return Callbacks.Post.push({\r\n      name: 'Mod Contact Links',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    let moved;\r\n    if (this.isClone || !$.hasOwn(ModContact.specific, this.info.capcode)) { return; }\r\n    const links = $.el('span', {className: 'contact-links brackets-wrap'});\r\n    $.extend(links, ModContact.template(this.info.capcode));\r\n    $.after(this.nodes.capcode, links);\r\n    if ((moved = this.info.comment.match(/This thread was moved to >>>\\/(\\w+)\\//)) && $.hasOwn(ModContact.moveNote, moved[1])) {\r\n      const moveNote = $.el('div', {className: 'move-note'});\r\n      $.extend(moveNote, ModContact.moveNote[moved[1]]);\r\n      return $.add(this.nodes.post, moveNote);\r\n    }\r\n  },\r\n\r\n  template(capcode) {\r\n    return {innerHTML: \"<a href=\\\"https://www.4chan.org/feedback\\\" target=\\\"_blank\\\">feedback</a>\" + (ModContact.specific[capcode]()).innerHTML};\r\n  },\r\n\r\n  specific: {\r\n    Mod() { return {innerHTML: \" <a href=\\\"https://www.4chan-x.net/4chan-irc.html\\\" target=\\\"_blank\\\">IRC</a>\"}; },\r\n    Manager() { return ModContact.specific.Mod(); },\r\n    Developer() { return {innerHTML: \" <a href=\\\"https://github.com/4chan\\\" target=\\\"_blank\\\">github</a>\"}; },\r\n    Admin() { return {innerHTML: \" <a href=\\\"https://twitter.com/hiroyuki_ni\\\" target=\\\"_blank\\\">twitter</a>\"}; }\r\n  },\r\n\r\n  moveNote: {\r\n    qa: {innerHTML: \"Moving a thread to /qa/ does not imply mods will read it. If you wish to contact mods, use <a href=\\\"https://www.4chan.org/feedback\\\" target=\\\"_blank\\\">feedback</a><span class=\\\"invisible\\\"> (https://www.4chan.org/feedback)</span> or <a href=\\\"https://www.4chan-x.net/4chan-irc.html\\\" target=\\\"_blank\\\">IRC</a><span class=\\\"invisible\\\"> (https://www.4chan-x.net/4chan-irc.html)</span>.\"}\r\n  }\r\n};\r\nexport default ModContact;\r\n","import { Conf, g } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst NormalizeURL = {\r\n  init() {\r\n    if (!Conf['Normalize URL']) { return; }\r\n\r\n    let pathname = location.pathname.split(/\\/+/);\r\n    if (g.SITE.software === 'yotsuba') {\r\n      switch (g.VIEW) {\r\n        case 'thread':\r\n          pathname[2] = 'thread';\r\n          pathname = pathname.slice(0, 4);\r\n          break;\r\n        case 'index':\r\n          pathname = pathname.slice(0, 3);\r\n          break;\r\n      }\r\n    }\r\n    pathname = pathname.join('/');\r\n    if (location.pathname !== pathname) {\r\n      return history.replaceState(history.state, '', `${location.protocol}//${location.host}${pathname}${location.hash}`);\r\n    }\r\n  }\r\n};\r\nexport default NormalizeURL;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { Conf, g, E } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar PostJumper = { \r\n  init() {\r\n    if (!Conf['Unique ID and Capcode Navigation'] || !['index', 'thread'].includes(g.VIEW)) { return; }\r\n\r\n    this.buttons = this.makeButtons();\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Post Jumper',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone) {\r\n      for (var buttons of $$('.postJumper', this.nodes.info)) {\r\n        PostJumper.addListeners(buttons);\r\n      }\r\n      return;\r\n    }\r\n\r\n    if (this.nodes.uniqueIDRoot) {\r\n      PostJumper.addButtons(this,'uniqueID');\r\n    }\r\n\r\n    if (this.nodes.capcode) {\r\n      return PostJumper.addButtons(this,'capcode');\r\n    }\r\n  },\r\n\r\n  addButtons(post,type) {\r\n    const value = post.info[type];\r\n    const buttons = PostJumper.buttons.cloneNode(true);\r\n    $.extend(buttons.dataset, {type, value});\r\n    $.after(post.nodes[type+(type === 'capcode' ? '' : 'Root')], buttons);\r\n    return PostJumper.addListeners(buttons);\r\n  },\r\n\r\n  addListeners(buttons) {\r\n    $.on(buttons.firstChild, 'click', PostJumper.buttonClick);\r\n    return $.on(buttons.lastChild, 'click', PostJumper.buttonClick);\r\n  },\r\n\r\n  buttonClick() {\r\n    let toJumper;\r\n    const dir = $.hasClass(this, 'prev') ? -1 : 1;\r\n    if (toJumper = PostJumper.find(this.parentNode, dir)) {\r\n      return PostJumper.scroll(this.parentNode, toJumper);\r\n    }\r\n  },\r\n\r\n  find(jumper, dir) {\r\n    const {type, value} = jumper.dataset;\r\n    const xpath = `span[contains(@class,\\\"postJumper\\\") and @data-value=\\\"${value}\\\" and @data-type=\\\"${type}\\\"]`;\r\n    const axis = dir < 0 ? 'preceding' : 'following';\r\n    let jumper2 = jumper;\r\n    while (jumper2 = $.x(`${axis}::${xpath}`, jumper2)) {\r\n      if (jumper2.getBoundingClientRect().height) { return jumper2; }\r\n    }\r\n    if (jumper2 = $.x(`(//${xpath})[${dir < 0 ? 'last()' : '1'}]`)) {\r\n      if (jumper2.getBoundingClientRect().height) { return jumper2; }\r\n    }\r\n    while ((jumper2 = $.x(`${axis}::${xpath}`, jumper2)) && (jumper2 !== jumper)) {\r\n      if (jumper2.getBoundingClientRect().height) { return jumper2; }\r\n    }\r\n    return null;\r\n  },\r\n\r\n  makeButtons() {\r\n    const charPrev = '\\u23EB';\r\n    const charNext = '\\u23EC';\r\n    const classPrev = 'prev';\r\n    const classNext = 'next';\r\n    const span = $.el('span',\r\n      {className: 'postJumper'});\r\n    $.extend(span, {innerHTML: \"<a href=\\\"javascript:;\\\" class=\\\"\" + E(classPrev) + \"\\\">\" + E(charPrev) + \"</a><a href=\\\"javascript:;\\\" class=\\\"\" + E(classNext) + \"\\\">\" + E(charNext) + \"</a>\"});\r\n    return span;\r\n  },\r\n\r\n  scroll(fromJumper, toJumper) {\r\n    const prevPos = fromJumper.getBoundingClientRect().top;\r\n    const destPos = toJumper.getBoundingClientRect().top;\r\n    return window.scrollBy(0, destPos-prevPos);\r\n  }\r\n};\r\nexport default PostJumper;\r\n","import Notice from \"../classes/Notice\";\r\nimport { g, Conf, doc } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst PSA = {\r\n  init() {\r\n    let el;\r\n    if ((g.SITE.software === 'yotsuba') && (g.BOARD.ID === 'qa')) {\r\n      const announcement = {innerHTML: \"Stay in touch with your <a href=\\\"https://www.4chan-x.net/qa_friends.html\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">/qa/ friends</a>!\"};\r\n      el = $.el('div', {className: 'fcx-announcement'}, announcement);\r\n      $.onExists(doc, '.boardBanner', banner => $.after(banner, el));\r\n    }\r\n    if ('samachan.org' in Conf['siteProperties'] && !Conf['PSAseen'].includes('samachan')) {\r\n      el = $.el('span',\r\n        {innerHTML: \"<a href=\\\"https://sushigirl.us/yakuza/res/776.html\\\" target=\\\"_blank\\\" rel=\\\"noopener\\\">Looking for a new home?<br>Some former Samachan users are regrouping on SushiChan.</a><br>(a message from 4chan X)\"});\r\n      return Main.ready(function() {\r\n        new Notice('info', el);\r\n        Conf['PSAseen'].push('samachan');\r\n        return $.set('PSAseen', Conf['PSAseen']);});\r\n    }\r\n  }\r\n};\r\nexport default PSA;\r\n","import Header from \"../General/Header\";\r\nimport { Conf, doc, g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar PSAHiding = {\r\n  init() {\r\n    if (!Conf['Announcement Hiding'] || !g.SITE.selectors.psa) { return; }\r\n    $.addClass(doc, 'hide-announcement');\r\n    $.onExists(doc, g.SITE.selectors.psa, this.setup);\r\n    return $.ready(function() {\r\n      if (!$(g.SITE.selectors.psa)) { return $.rmClass(doc, 'hide-announcement'); }\r\n    });\r\n  },\r\n\r\n  setup(psa) {\r\n    let btn, hr;\r\n    PSAHiding.psa = psa;\r\n    PSAHiding.text = psa.dataset.utc ?? psa.innerHTML;\r\n    if (g.SITE.selectors.psaTop && (hr = $(g.SITE.selectors.psaTop)?.previousElementSibling) && (hr.nodeName === 'HR')) {\r\n      PSAHiding.hr = hr;\r\n    }\r\n    PSAHiding.content = $.el('div');\r\n\r\n    const entry = {\r\n      el: $.el('a', {\r\n        textContent: 'Show announcement',\r\n        className: 'show-announcement',\r\n        href: 'javascript:;'\r\n      }\r\n      ),\r\n      order: 50,\r\n      open() { return psa.hidden; }\r\n    };\r\n    Header.menu.addEntry(entry);\r\n    $.on(entry.el, 'click', PSAHiding.toggle);\r\n\r\n    PSAHiding.btn = (btn = $.el('a', {\r\n      title:       'Mark announcement as read and hide.',\r\n      className:   'hide-announcement-button',\r\n      href:        'javascript:;',\r\n      textContent: '',\r\n    }\r\n    ));\r\n    $.on(btn, 'click', PSAHiding.toggle);\r\n    if (psa.firstChild?.tagName === 'HR') {\r\n      $.after(psa.firstChild, btn);\r\n    } else {\r\n      $.prepend(psa, btn);\r\n    }\r\n\r\n    PSAHiding.sync(Conf['hiddenPSAList']);\r\n    $.rmClass(doc, 'hide-announcement');\r\n\r\n    return $.sync('hiddenPSAList', PSAHiding.sync);\r\n  },\r\n\r\n  toggle() {\r\n    const hide = $.hasClass(this, 'hide-announcement-button');\r\n    const set = function(hiddenPSAList) {\r\n      if (hide) {\r\n        return hiddenPSAList[g.SITE.ID] = PSAHiding.text;\r\n      } else {\r\n        return delete hiddenPSAList[g.SITE.ID];\r\n      }\r\n    };\r\n    set(Conf['hiddenPSAList']);\r\n    PSAHiding.sync(Conf['hiddenPSAList']);\r\n    return $.get('hiddenPSAList', Conf['hiddenPSAList'], function({hiddenPSAList}) {\r\n      set(hiddenPSAList);\r\n      return $.set('hiddenPSAList', hiddenPSAList);\r\n    });\r\n  },\r\n\r\n  sync(hiddenPSAList) {\r\n    const {psa, content} = PSAHiding;\r\n    psa.hidden = (hiddenPSAList[g.SITE.ID] === PSAHiding.text);\r\n    // Remove content to prevent autoplaying sounds from hidden announcements\r\n    if (psa.hidden) {\r\n      $.add(content, [...Array.from(psa.childNodes)]);\r\n    } else {\r\n      $.add(psa, [...Array.from(content.childNodes)]);\r\n    }\r\n    if (PSAHiding.hr) PSAHiding.hr.hidden = psa.hidden;\r\n  }\r\n};\r\nexport default PSAHiding;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { Conf, doc, g } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar RemoveSpoilers = {\r\n  init() {\r\n    if (Conf['Reveal Spoilers']) {\r\n      $.addClass(doc, 'reveal-spoilers');\r\n    }\r\n\r\n    if (!Conf['Remove Spoilers']) { return; }\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Reveal Spoilers',\r\n      cb:   this.node\r\n    });\r\n\r\n    if (g.VIEW === 'archive') {\r\n      return $.ready(() => RemoveSpoilers.unspoiler($.id('arc-list')));\r\n    }\r\n  },\r\n\r\n  node() {\r\n    return RemoveSpoilers.unspoiler(this.nodes.comment);\r\n  },\r\n\r\n  unspoiler(el) {\r\n    const spoilers = $$(g.SITE.selectors.spoiler, el);\r\n    for (var spoiler of spoilers) {\r\n      var span = $.el('span', {className: 'removed-spoiler'});\r\n      $.replace(spoiler, span);\r\n      $.add(span, [...Array.from(spoiler.childNodes)]);\r\n    }\r\n  }\r\n};\r\nexport default RemoveSpoilers;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { g, Conf } from \"../globals/globals\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ThreadLinks = {\r\n  init() {\r\n    if ((g.VIEW !== 'index') || !Conf['Open Threads in New Tab']) { return; }\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Thread Links',\r\n      cb:   this.node\r\n    });\r\n    return Callbacks.CatalogThread.push({\r\n      name: 'Thread Links',\r\n      cb:   this.catalogNode\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.isReply || this.isClone) { return; }\r\n    return ThreadLinks.process(this.nodes.reply);\r\n  },\r\n\r\n  catalogNode() {\r\n    return ThreadLinks.process(this.nodes.thumb.parentNode);\r\n  },\r\n\r\n  process(link) {\r\n    return link.target = '_blank';\r\n  }\r\n};\r\nexport default ThreadLinks;\r\n","import { g } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst Tinyboard = {\r\n  init() {\r\n    if (g.SITE.software !== 'tinyboard') { return; }\r\n    if (g.VIEW === 'thread') {\r\n      return Main.ready(() => $.global(function() {\r\n        let base;\r\n        let {boardID, threadID} = document.currentScript.dataset;\r\n        threadID = +threadID;\r\n        const form = document.querySelector('form[name=\"post\"]');\r\n        window.$(document).ajaxComplete(function(event, request, settings) {\r\n          let postID;\r\n          if (settings.url !== form.action) { return; }\r\n          if (!(postID = +request.responseJSON?.id)) { return; }\r\n          const detail = {boardID, threadID, postID};\r\n          try {\r\n            const {redirect, noko} = request.responseJSON;\r\n            if (redirect && (originalNoko != null) && !originalNoko && !noko) {\r\n              detail.redirect = redirect;\r\n            }\r\n          } catch (error) {}\r\n          event = new CustomEvent('QRPostSuccessful', {bubbles: true, detail});\r\n          return document.dispatchEvent(event);\r\n        });\r\n        var originalNoko = window.tb_settings?.ajax?.always_noko_replies;\r\n        return (((base = window.tb_settings || (window.tb_settings = {}))).ajax || (base.ajax = {})).always_noko_replies = true;\r\n      }\r\n      , {boardID: g.BOARD.ID, threadID: g.THREADID}));\r\n    }\r\n  }\r\n};\r\nexport default Tinyboard;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { g, Conf, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar MarkNewIPs = {\r\n  init() {\r\n    if ((g.SITE.software !== 'yotsuba') || (g.VIEW !== 'thread') || !Conf['Mark New IPs']) { return; }\r\n    return Callbacks.Thread.push({\r\n      name: 'Mark New IPs',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    MarkNewIPs.ipCount = this.ipCount;\r\n    MarkNewIPs.postCount = this.posts.keys.length;\r\n    return $.on(d, 'ThreadUpdate', MarkNewIPs.onUpdate);\r\n  },\r\n\r\n  onUpdate(e) {\r\n    let fullID;\r\n    const {ipCount, postCount, newPosts, deletedPosts} = e.detail;\r\n    if (ipCount == null) { return; }\r\n\r\n    switch (ipCount - MarkNewIPs.ipCount) {\r\n      case (postCount - MarkNewIPs.postCount) + deletedPosts.length:\r\n        var i = MarkNewIPs.ipCount;\r\n        for (fullID of newPosts) {\r\n          MarkNewIPs.markNew(g.posts.get(fullID), ++i);\r\n        }\r\n        break;\r\n      case -deletedPosts.length:\r\n        for (fullID of newPosts) {\r\n          MarkNewIPs.markOld(g.posts.get(fullID));\r\n        }\r\n        break;\r\n    }\r\n    MarkNewIPs.ipCount = ipCount;\r\n    return MarkNewIPs.postCount = postCount;\r\n  },\r\n\r\n  markNew(post, ipCount) {\r\n    const suffix = ((Math.floor(ipCount / 10)) % 10) === 1 ?\r\n      'th'\r\n    :\r\n      ['st', 'nd', 'rd'][(ipCount % 10) - 1] || 'th'; // fuck switches\r\n    const counter = $.el('span', {\r\n      className: 'ip-counter',\r\n      textContent: `(${ipCount})`\r\n    }\r\n    );\r\n    post.nodes.nameBlock.title = `This is the ${ipCount}${suffix} IP in the thread.`;\r\n    $.add(post.nodes.nameBlock, [$.tn(' '), counter]);\r\n    return $.addClass(post.nodes.root, 'new-ip');\r\n  },\r\n\r\n  markOld(post) {\r\n    post.nodes.nameBlock.title = 'Not the first post from this IP.';\r\n    return $.addClass(post.nodes.root, 'old-ip');\r\n  }\r\n};\r\nexport default MarkNewIPs;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Header from \"../General/Header\";\r\nimport UI from \"../General/UI\";\r\nimport { g, Conf, E, doc, d } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { MINUTE, SECOND } from \"../platform/helpers\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar ThreadStats = {\r\n  postCount: 0,\r\n  fileCount: 0,\r\n  postIndex: 0,\r\n\r\n  init() {\r\n    let sc;\r\n    if ((g.VIEW !== 'thread') || !Conf['Thread Stats']) { return; }\r\n\r\n    if (Conf['Page Count in Stats']) {\r\n      this[g.SITE.isPrunedByAge?.(g.BOARD) ? 'showPurgePos' : 'showPage'] = true;\r\n    }\r\n\r\n    const statsHTML = {innerHTML: \"<span id=\\\"post-count\\\">?</span> / <span id=\\\"file-count\\\">?</span>\" + ((Conf[\"IP Count in Stats\"] && g.SITE.hasIPCount) ? \" / <span id=\\\"ip-count\\\">?</span>\" : \"\") + ((Conf[\"Page Count in Stats\"]) ? \" / <span id=\\\"page-count\\\">?</span>\" : \"\")};\r\n    let statsTitle = 'Posts / Files';\r\n    if (Conf['IP Count in Stats'] && g.SITE.hasIPCount) { statsTitle += ' / IPs'; }\r\n    if (Conf['Page Count in Stats']) { statsTitle += (this.showPurgePos ? ' / Purge Position' : ' / Page'); }\r\n\r\n    if (Conf['Updater and Stats in Header']) {\r\n      this.dialog = (sc = $.el('span', {\r\n        id:    'thread-stats',\r\n        title: statsTitle\r\n      }\r\n      ));\r\n      $.extend(sc, statsHTML);\r\n      Header.addShortcut('stats', sc, 200);\r\n\r\n    } else {\r\n      this.dialog = (sc = UI.dialog('thread-stats',\r\n        {innerHTML: \"<div class=\\\"move\\\" title=\\\"\" + E(statsTitle) + \"\\\">\" + (statsHTML).innerHTML + \"</div>\"}));\r\n      $.addClass(doc, 'float');\r\n      $.ready(() => $.add(d.body, sc));\r\n    }\r\n\r\n    this.postCountEl = $('#post-count', sc);\r\n    this.fileCountEl = $('#file-count', sc);\r\n    this.ipCountEl   = $('#ip-count',   sc);\r\n    this.pageCountEl = $('#page-count', sc);\r\n\r\n    if (this.pageCountEl) { $.on(this.pageCountEl, 'click', ThreadStats.fetchPage); }\r\n\r\n    return Callbacks.Thread.push({\r\n      name: 'Thread Stats',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    ThreadStats.thread = this;\r\n    ThreadStats.count();\r\n    ThreadStats.update();\r\n    ThreadStats.fetchPage();\r\n    $.on(d, 'PostsInserted', () => $.queueTask(ThreadStats.onPostsInserted));\r\n    return $.on(d, 'ThreadUpdate', ThreadStats.onUpdate);\r\n  },\r\n\r\n  count() {\r\n    const {posts} = ThreadStats.thread;\r\n    const n = posts.keys.length;\r\n    for (let i = ThreadStats.postIndex, end = n; i < end; i++) {\r\n      var post = posts.get(posts.keys[i]);\r\n      if (!post.isFetchedQuote) {\r\n        ThreadStats.postCount++;\r\n        ThreadStats.fileCount += post.files.length;\r\n      }\r\n    }\r\n    return ThreadStats.postIndex = n;\r\n  },\r\n\r\n  onUpdate(e) {\r\n    if (e.detail[404]) { return; }\r\n    const {postCount, fileCount} = e.detail;\r\n    $.extend(ThreadStats, {postCount, fileCount});\r\n    ThreadStats.postIndex = ThreadStats.thread.posts.keys.length;\r\n    ThreadStats.update();\r\n    if (ThreadStats.showPage && (ThreadStats.pageCountEl.textContent !== '1')) {\r\n      return ThreadStats.fetchPage();\r\n    }\r\n  },\r\n\r\n  onPostsInserted() {\r\n    if (ThreadStats.thread.posts.keys.length <= ThreadStats.postIndex) { return; }\r\n    ThreadStats.count();\r\n    ThreadStats.update();\r\n    if (ThreadStats.showPage && (ThreadStats.pageCountEl.textContent !== '1')) {\r\n      return ThreadStats.fetchPage();\r\n    }\r\n  },\r\n\r\n  update() {\r\n    const {thread, postCountEl, fileCountEl, ipCountEl} = ThreadStats;\r\n    postCountEl.textContent = ThreadStats.postCount;\r\n    fileCountEl.textContent = ThreadStats.fileCount;\r\n    // TOTO check if ipCountEl exists\r\n    ipCountEl.textContent  = thread.ipCount ?? '?';\r\n    postCountEl.classList.toggle('warning', (thread.postLimit && !thread.isSticky));\r\n    return fileCountEl.classList.toggle('warning', (thread.fileLimit && !thread.isSticky));\r\n  },\r\n\r\n  fetchPage() {\r\n    if (!ThreadStats.pageCountEl) { return; }\r\n    clearTimeout(ThreadStats.timeout);\r\n    if (ThreadStats.thread.isDead) {\r\n      ThreadStats.pageCountEl.textContent = 'Dead';\r\n      $.addClass(ThreadStats.pageCountEl, 'warning');\r\n      return;\r\n    }\r\n    ThreadStats.timeout = setTimeout(ThreadStats.fetchPage, 2 * MINUTE);\r\n    return $.whenModified(\r\n      g.SITE.urls.threadsListJSON(ThreadStats.thread),\r\n      'ThreadStats',\r\n      ThreadStats.onThreadsLoad\r\n    );\r\n  },\r\n\r\n  onThreadsLoad() {\r\n    if (this.status === 200) {\r\n      let page, thread;\r\n      if (ThreadStats.showPurgePos) {\r\n        let purgePos = 1;\r\n        for (page of this.response) {\r\n          for (thread of page.threads) {\r\n            if (thread.no < ThreadStats.thread.ID) {\r\n              purgePos++;\r\n            }\r\n          }\r\n        }\r\n        ThreadStats.pageCountEl.textContent = purgePos;\r\n        return ThreadStats.pageCountEl.classList.toggle('warning', (purgePos === 1));\r\n      } else {\r\n        let nThreads;\r\n        let i = (nThreads = 0);\r\n        for (page of this.response) {\r\n          nThreads += page.threads.length;\r\n        }\r\n        for (let pageNum = 0; pageNum < this.response.length; pageNum++) {\r\n          page = this.response[pageNum];\r\n          for (thread of page.threads) {\r\n            if (thread.no === ThreadStats.thread.ID) {\r\n              ThreadStats.pageCountEl.textContent = pageNum + 1;\r\n              ThreadStats.pageCountEl.classList.toggle('warning', (i >= (nThreads - this.response[0].threads.length)));\r\n              ThreadStats.lastPageUpdate = new Date(thread.last_modified * SECOND);\r\n              ThreadStats.retry();\r\n              return;\r\n            }\r\n            i++;\r\n          }\r\n        }\r\n      }\r\n    } else if (this.status === 304) {\r\n      return ThreadStats.retry();\r\n    }\r\n  },\r\n\r\n  retry() {\r\n    // If thread data is stale (modification date given < time of last post), try again.\r\n    // Skip this on vichan sites due to sage posts not updating modification time in threads.json.\r\n    if (\r\n      !ThreadStats.showPage ||\r\n      (ThreadStats.pageCountEl.textContent === '1') ||\r\n      !!g.SITE.threadModTimeIgnoresSage ||\r\n      (ThreadStats.thread.posts.get(ThreadStats.thread.lastPost).info.date <= ThreadStats.lastPageUpdate)\r\n    ) { return; }\r\n    clearTimeout(ThreadStats.timeout);\r\n    return ThreadStats.timeout = setTimeout(ThreadStats.fetchPage, 5 * SECOND);\r\n  }\r\n};\r\nexport default ThreadStats;\r\n","import { g, Conf } from \"../globals/globals\";\r\nimport Main from \"../main/Main\";\r\nimport $ from \"../platform/$\";\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst PassLink = {\r\n  init() {\r\n    if ((g.SITE.software !== 'yotsuba') || !Conf['Pass Link']) { return; }\r\n    return Main.ready(this.ready);\r\n  },\r\n\r\n  ready() {\r\n    let styleSelector;\r\n    if (!(styleSelector = $.id('styleSelector'))) { return; }\r\n\r\n    const passLink = $.el('span',\r\n      {className: 'brackets-wrap pass-link-container'});\r\n    $.extend(passLink, {innerHTML: \"<a href=\\\"javascript:;\\\">4chan Pass</a>\"});\r\n    $.on(passLink.firstElementChild, 'click', () => window.open(`//sys.${location.hostname.split('.')[1]}.org/auth`,\r\n      Date.now(),\r\n      'width=500,height=280,toolbar=0'));\r\n    return $.before(styleSelector.previousSibling, [passLink, $.tn('\\u00A0\\u00A0')]);\r\n  }\r\n};\r\nexport default PassLink;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Fetcher from \"../classes/Fetcher\";\r\nimport Get from \"../General/Get\";\r\nimport { g, Conf, doc } from \"../globals/globals\";\r\nimport ExpandComment from \"../Miscellaneous/ExpandComment\";\r\nimport Unread from \"../Monitoring/Unread\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar QuoteInline = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Quote Inlining']) { return; }\r\n\r\n    if (Conf['Comment Expansion']) {\r\n      ExpandComment.callbacks.push(this.node);\r\n    }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Quote Inlining',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    const {process} = QuoteInline;\r\n    const {isClone} = this;\r\n    for (var link of this.nodes.quotelinks.concat([...Array.from(this.nodes.backlinks)], this.nodes.archivelinks)) {\r\n      process(link, isClone);\r\n    }\r\n  },\r\n\r\n  process(link, clone) {\r\n    if (Conf['Quote Hash Navigation']) {\r\n      if (!clone) { $.after(link, QuoteInline.qiQuote(link, $.hasClass(link, 'filtered'))); }\r\n    }\r\n    return $.on(link, 'click', QuoteInline.toggle);\r\n  },\r\n\r\n  qiQuote(link, hidden) {\r\n    let name = \"hashlink\";\r\n    if (hidden) { name += \" filtered\"; }\r\n    return $.el('a', {\r\n      className: name,\r\n      textContent: '#',\r\n      href: link.href\r\n    }\r\n    );\r\n  },\r\n\r\n  toggle(e) {\r\n    if ($.modifiedClick(e)) { return; }\r\n\r\n    const {boardID, threadID, postID} = Get.postDataFromLink(this);\r\n    if (Conf['Inline Cross-thread Quotes Only'] && (g.VIEW === 'thread') && g.posts.get(`${boardID}.${postID}`)?.nodes.root.offsetParent) { return; } // exists and not hidden\r\n    if ($.hasClass(doc, 'catalog-mode')) { return; }\r\n\r\n    e.preventDefault();\r\n    const quoter = Get.postFromNode(this);\r\n    const {context} = quoter;\r\n    if ($.hasClass(this, 'inlined')) {\r\n      QuoteInline.rm(this, boardID, threadID, postID, context);\r\n    } else {\r\n      if ($.x(`ancestor::div[@data-full-i-d='${boardID}.${postID}']`, this)) { return; }\r\n      QuoteInline.add(this, boardID, threadID, postID, context, quoter);\r\n    }\r\n    return this.classList.toggle('inlined');\r\n  },\r\n\r\n  findRoot(quotelink, isBacklink) {\r\n    if (isBacklink) {\r\n      return $.x('ancestor::*[parent::*[contains(@class,\"post\")]][1]', quotelink);\r\n    } else {\r\n      return $.x('ancestor-or-self::*[parent::blockquote][1]', quotelink);\r\n    }\r\n  },\r\n\r\n  add(quotelink, boardID, threadID, postID, context, quoter) {\r\n    let post;\r\n    const isBacklink = $.hasClass(quotelink, 'backlink');\r\n    const inline = $.el('div',\r\n      {className: 'inline'});\r\n    inline.dataset.fullID = `${boardID}.${postID}`;\r\n    const root = QuoteInline.findRoot(quotelink, isBacklink);\r\n    $.after(root, inline);\r\n\r\n    const qroot = $.x('ancestor::*[contains(@class,\"postContainer\")][1]', root);\r\n\r\n    $.addClass(qroot, 'hasInline');\r\n    new Fetcher(boardID, threadID, postID, inline, quoter);\r\n\r\n    if (!(\r\n      (post = g.posts.get(`${boardID}.${postID}`)) &&\r\n      (context.thread === post.thread)\r\n    )) { return; }\r\n\r\n    // Hide forward post if it's a backlink of a post in this thread.\r\n    // Will only unhide if there's no inlined backlinks of it anymore.\r\n    if (isBacklink && Conf['Forward Hiding']) {\r\n      $.addClass(post.nodes.root, 'forwarded');\r\n      post.forwarded++ || (post.forwarded = 1);\r\n    }\r\n\r\n    // Decrease the unread count if this post\r\n    // is in the array of unread posts.\r\n    if (!Unread.posts) { return; }\r\n    return Unread.readSinglePost(post);\r\n  },\r\n\r\n  rm(quotelink, boardID, threadID, postID, context) {\r\n    let el;\r\n    let inlined;\r\n    const isBacklink = $.hasClass(quotelink, 'backlink');\r\n    // Select the corresponding inlined quote, and remove it.\r\n    let root = QuoteInline.findRoot(quotelink, isBacklink);\r\n    root = $.x(`following-sibling::div[@data-full-i-d='${boardID}.${postID}'][1]`, root);\r\n    const qroot = $.x('ancestor::*[contains(@class,\"postContainer\")][1]', root);\r\n    const {parentNode} = root;\r\n    $.rm(root);\r\n    $.event('PostsRemoved', null, parentNode);\r\n\r\n    if (!$('.inline', qroot)) {\r\n      $.rmClass(qroot, 'hasInline');\r\n    }\r\n\r\n    // Stop if it only contains text.\r\n    if (!(el = root.firstElementChild)) { return; }\r\n\r\n    // Dereference clone.\r\n    const post = g.posts.get(`${boardID}.${postID}`);\r\n    post.rmClone(el.dataset.clone);\r\n\r\n    // Decrease forward count and unhide.\r\n    if (Conf['Forward Hiding'] &&\r\n      isBacklink &&\r\n      (context.thread === g.threads.get(`${boardID}.${threadID}`)) &&\r\n      !--post.forwarded) {\r\n        delete post.forwarded;\r\n        $.rmClass(post.nodes.root, 'forwarded');\r\n      }\r\n\r\n    // Repeat.\r\n    while ((inlined = $('.inlined', el))) {\r\n      ({boardID, threadID, postID} = Get.postDataFromLink(inlined));\r\n      QuoteInline.rm(inlined, boardID, threadID, postID, context);\r\n      $.rmClass(inlined, 'inlined');\r\n    }\r\n  }\r\n};\r\nexport default QuoteInline;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport { g, Conf, doc } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\nimport { dict } from \"../platform/helpers\";\r\nimport QuoteInline from \"./QuoteInline\";\r\nimport QuotePreview from \"./QuotePreview\";\r\nimport QuoteYou from \"./QuoteYou\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar QuoteBacklink = {\r\n  // Backlinks appending need to work for:\r\n  //  - previous, same, and following posts.\r\n  //  - existing and yet-to-exist posts.\r\n  //  - newly fetched posts.\r\n  //  - in copies.\r\n  // XXX what about order for fetched posts?\r\n  //\r\n  // First callback creates backlinks and add them to relevant containers.\r\n  // Second callback adds relevant containers into posts.\r\n  // This is is so that fetched posts can get their backlinks,\r\n  // and that as much backlinks are appended in the background as possible.\r\n  containers: dict(),\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Quote Backlinks']) { return; }\r\n\r\n    // Add a class to differentiate when backlinks are at\r\n    // the top (default) or bottom of a post\r\n    if (this.bottomBacklinks = Conf['Bottom Backlinks']) {\r\n      $.addClass(doc, 'bottom-backlinks');\r\n    }\r\n\r\n    Callbacks.Post.push({\r\n      name: 'Quote Backlinking Part 1',\r\n      cb:   this.firstNode\r\n    });\r\n    return Callbacks.Post.push({\r\n      name: 'Quote Backlinking Part 2',\r\n      cb:   this.secondNode\r\n    });\r\n  },\r\n  firstNode() {\r\n    if (this.isClone || !this.quotes.length || this.isRebuilt) { return; }\r\n    const markYours = Conf['Mark Quotes of You'] && QuoteYou.isYou(this);\r\n    const a = $.el('a', {\r\n      href: g.SITE.Build.postURL(this.board.ID, this.thread.ID, this.ID),\r\n      className: this.isHidden ? 'filtered backlink' : 'backlink',\r\n      textContent: Conf['backlink'].replace(/%(?:id|%)/g, x => ({'%id': this.ID, '%%': '%'})[x])\r\n    }\r\n    );\r\n    if (markYours) { $.add(a, QuoteYou.mark.cloneNode(true)); }\r\n    for (var quote of this.quotes) {\r\n      var post;\r\n      var containers = [QuoteBacklink.getContainer(quote)];\r\n      if ((post = g.posts.get(quote)) && post.nodes.backlinkContainer) {\r\n        // Don't add OP clones when OP Backlinks is disabled,\r\n        // as the clones won't have the backlink containers.\r\n        for (var clone of post.clones) {\r\n          containers.push(clone.nodes.backlinkContainer);\r\n        }\r\n      }\r\n      for (var container of containers) {\r\n        var link = a.cloneNode(true);\r\n        var nodes = container.firstChild ? [$.tn(' '), link] : [link];\r\n        if (Conf['Quote Previewing']) {\r\n          $.on(link, 'mouseover', QuotePreview.mouseover);\r\n        }\r\n        if (Conf['Quote Inlining']) {\r\n          $.on(link, 'click', QuoteInline.toggle);\r\n          if (Conf['Quote Hash Navigation']) {\r\n            var hash = QuoteInline.qiQuote(link, $.hasClass(link, 'filtered'));\r\n            nodes.push(hash);\r\n          }\r\n        }\r\n        $.add(container, nodes);\r\n      }\r\n    }\r\n  },\r\n  secondNode() {\r\n    if (this.isClone && (this.origin.isReply || Conf['OP Backlinks'])) {\r\n      this.nodes.backlinkContainer = $('.container', this.nodes.post);\r\n      return;\r\n    }\r\n    // Don't backlink the OP.\r\n    if (!this.isReply && !Conf['OP Backlinks']) { return; }\r\n    const container = QuoteBacklink.getContainer(this.fullID);\r\n    this.nodes.backlinkContainer = container;\r\n    if (QuoteBacklink.bottomBacklinks) {\r\n      return $.add(this.nodes.post, container);\r\n    } else {\r\n      return $.add(this.nodes.info, container);\r\n    }\r\n  },\r\n  getContainer(id) {\r\n    return this.containers[id] ||\r\n      (this.containers[id] = $.el('span', {className: 'container'}));\r\n  }\r\n};\r\nexport default QuoteBacklink;\r\n","import $ from \"../platform/$\";\r\nimport Callbacks from \"../classes/Callbacks\";\r\nimport ExpandComment from \"../Miscellaneous/ExpandComment\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport Get from \"../General/Get\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar QuoteCT = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Mark Cross-thread Quotes']) { return; }\r\n\r\n    if (Conf['Comment Expansion']) {\r\n      ExpandComment.callbacks.push(this.node);\r\n    }\r\n\r\n    // \\u00A0 is nbsp\r\n    this.mark = $.el('span', {\r\n      textContent: '\\u00A0(Cross-thread)',\r\n      className:   'qmark-ct'\r\n    }\r\n    );\r\n    return Callbacks.Post.push({\r\n      name: 'Mark Cross-thread Quotes',\r\n      cb:   this.node\r\n    });\r\n  },\r\n  node() {\r\n    // Stop there if it's a clone of a post in the same thread.\r\n    if (this.isClone && (this.thread === this.context.thread)) { return; }\r\n\r\n    const {board, thread} = this.context;\r\n    for (var quotelink of this.nodes.quotelinks) {\r\n      var {boardID, threadID} = Get.postDataFromLink(quotelink);\r\n      if (!threadID) { continue; } // deadlink\r\n      if (this.isClone) {\r\n        $.rm($('.qmark-ct', quotelink));\r\n      }\r\n      if ((boardID === board.ID) && (threadID !== thread.ID)) {\r\n        $.add(quotelink, QuoteCT.mark.cloneNode(true));\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default QuoteCT;\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Get from \"../General/Get\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport ExpandComment from \"../Miscellaneous/ExpandComment\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar QuoteOP = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Mark OP Quotes']) { return; }\r\n\r\n    if (Conf['Comment Expansion']) {\r\n      ExpandComment.callbacks.push(this.node);\r\n    }\r\n\r\n    // \\u00A0 is nbsp\r\n    this.mark = $.el('span', {\r\n      textContent: '\\u00A0(OP)',\r\n      className:   'qmark-op'\r\n    }\r\n    );\r\n    return Callbacks.Post.push({\r\n      name: 'Mark OP Quotes',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    // Stop there if it's a clone of a post in the same thread.\r\n    let i, quotelink, quotes;\r\n    if (this.isClone && (this.thread === this.context.thread)) { return; }\r\n    // Stop there if there's no quotes in that post.\r\n    if (!(quotes = this.quotes).length) { return; }\r\n    const {quotelinks} = this.nodes;\r\n\r\n    // rm (OP) from cross-thread quotes.\r\n    if (this.isClone && quotes.includes(this.thread.fullID)) {\r\n      i = 0;\r\n      while ((quotelink = quotelinks[i++])) {\r\n        $.rm($('.qmark-op', quotelink));\r\n      }\r\n    }\r\n\r\n    const {fullID} = this.context.thread;\r\n    // add (OP) to quotes quoting this context's OP.\r\n\r\n    if (!quotes.includes(fullID)) { return; }\r\n    i = 0;\r\n    while ((quotelink = quotelinks[i++])) {\r\n      var {boardID, postID} = Get.postDataFromLink(quotelink);\r\n      if (`${boardID}.${postID}` === fullID) {\r\n        $.add(quotelink, QuoteOP.mark.cloneNode(true));\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default QuoteOP;\r\n","import Redirect from \"../Archive/Redirect\";\r\nimport Callbacks from \"../classes/Callbacks\";\r\nimport Post from \"../classes/Post\";\r\nimport { g, Conf, doc } from \"../globals/globals\";\r\nimport ExpandComment from \"../Miscellaneous/ExpandComment\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Quotify = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) || !Conf['Resurrect Quotes']) { return; }\r\n\r\n    $.addClass(doc, 'resurrect-quotes');\r\n\r\n    if (Conf['Comment Expansion']) {\r\n      ExpandComment.callbacks.push(this.node);\r\n    }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Resurrect Quotes',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone) {\r\n      this.nodes.archivelinks = $$('a.linkify.quotelink', this.nodes.comment);\r\n      return;\r\n    }\r\n    for (var link of $$('a.linkify', this.nodes.comment)) {\r\n      Quotify.parseArchivelink.call(this, link);\r\n    }\r\n    for (var deadlink of $$('.deadlink', this.nodes.comment)) {\r\n      Quotify.parseDeadlink.call(this, deadlink);\r\n    }\r\n  },\r\n\r\n  parseArchivelink(link) {\r\n    let m;\r\n    if (!(m = link.pathname.match(/^\\/([^/]+)\\/thread\\/S?(\\d+)\\/?$/))) { return; }\r\n    if (['boards.4chan.org', 'boards.4channel.org'].includes(link.hostname)) { return; }\r\n    const boardID  = m[1];\r\n    const threadID = m[2];\r\n    const postID   = link.hash.match(/^#[pq]?(\\d+)$|$/)[1] || threadID;\r\n    if (Redirect.to('post', {boardID, postID})) {\r\n      $.addClass(link, 'quotelink');\r\n      $.extend(link.dataset, {boardID, threadID, postID});\r\n      return this.nodes.archivelinks.push(link);\r\n    }\r\n  },\r\n\r\n  parseDeadlink(deadlink) {\r\n    let a, m, post, postID;\r\n    if ($.hasClass(deadlink.parentNode, 'prettyprint')) {\r\n      // Don't quotify deadlinks inside code tags,\r\n      // un-`span` them.\r\n      // This won't be necessary once 4chan\r\n      // stops quotifying inside code tags:\r\n      // https://github.com/4chan/4chan-JS/issues/77\r\n      Quotify.fixDeadlink(deadlink);\r\n      return;\r\n    }\r\n\r\n    const quote = deadlink.textContent;\r\n    if (!(postID = quote.match(/\\d+$/)?.[0])) { return; }\r\n    if (postID[0] === '0') {\r\n      // Fix quotelinks that start with a `0`.\r\n      Quotify.fixDeadlink(deadlink);\r\n      return;\r\n    }\r\n    const boardID = (m = quote.match(/^>>>\\/([a-z\\d]+)/)) ?\r\n      m[1]\r\n    :\r\n      this.board.ID;\r\n    const quoteID = `${boardID}.${postID}`;\r\n\r\n    if (post = g.posts.get(quoteID)) {\r\n      if (!post.isDead) {\r\n        // Don't (Dead) when quotifying in an archived post,\r\n        // and we know the post still exists.\r\n        a = $.el('a', {\r\n          href:        g.SITE.Build.postURL(boardID, post.thread.ID, postID),\r\n          className:   'quotelink',\r\n          textContent: quote\r\n        }\r\n        );\r\n      } else {\r\n        // Replace the .deadlink span if we can redirect.\r\n        a = $.el('a', {\r\n          href:        g.SITE.Build.postURL(boardID, post.thread.ID, postID),\r\n          className:   'quotelink deadlink',\r\n          textContent: quote\r\n        }\r\n        );\r\n        $.add(a, Post.deadMark.cloneNode(true));\r\n        $.extend(a.dataset, {boardID, threadID: post.thread.ID, postID});\r\n      }\r\n\r\n    } else {\r\n      const redirect = Redirect.to('thread', {boardID, threadID: 0, postID});\r\n      const fetchable = Redirect.to('post', {boardID, postID});\r\n      if (redirect || fetchable) {\r\n        // Replace the .deadlink span if we can redirect or fetch the post.\r\n        a = $.el('a', {\r\n          href:        redirect || 'javascript:;',\r\n          className:   'deadlink',\r\n          textContent: quote\r\n        }\r\n        );\r\n        $.add(a, Post.deadMark.cloneNode(true));\r\n        if (fetchable) {\r\n          // Make it function as a normal quote if we can fetch the post.\r\n          $.addClass(a, 'quotelink');\r\n          $.extend(a.dataset, {boardID, postID});\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!this.quotes.includes(quoteID)) { this.quotes.push(quoteID); }\r\n\r\n    if (!a) {\r\n      $.add(deadlink, Post.deadMark.cloneNode(true));\r\n      return;\r\n    }\r\n\r\n    $.replace(deadlink, a);\r\n    if ($.hasClass(a, 'quotelink')) {\r\n      return this.nodes.quotelinks.push(a);\r\n    }\r\n  },\r\n\r\n  fixDeadlink(deadlink) {\r\n    let el;\r\n    if (!(el = deadlink.previousSibling) || (el.nodeName === 'BR')) {\r\n      const green = $.el('span',\r\n        {className: 'quote'});\r\n      $.before(deadlink, green);\r\n      $.add(green, deadlink);\r\n    }\r\n    return $.replace(deadlink, [...Array.from(deadlink.childNodes)]);\r\n  }\r\n};\r\nexport default Quotify;\r\n","import $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst Polyfill = {\r\n  init() {\r\n    this.toBlob();\r\n    $.global(this.toBlob);\r\n    if (!Element.prototype.matches) { Element.prototype.matches = Element.prototype.mozMatchesSelector || Element.prototype.webkitMatchesSelector; }\r\n  },\r\n  // This function is converted to a string and then put in a script tag.\r\n  // Do NOT shorten to `toBlob() {`.\r\n  toBlob: function() {\r\n    if (HTMLCanvasElement.prototype.toBlob) { return; }\r\n    HTMLCanvasElement.prototype.toBlob = function(cb, type, encoderOptions) {\r\n      const url = this.toDataURL(type, encoderOptions);\r\n      const data = atob(url.slice(url.indexOf(',')+1));\r\n      // DataUrl to Binary code from Aeosynth's 4chan X repo\r\n      const l = data.length;\r\n      const ui8a = new Uint8Array(l);\r\n      for (let i = 0, end = l; i < end; i++) {\r\n        ui8a[i] = data.charCodeAt(i);\r\n      }\r\n      return cb(new Blob([ui8a], {type: type || 'image/png'}));\r\n    };\r\n  }\r\n};\r\nexport default Polyfill;\r\n","import Redirect from \"../Archive/Redirect\";\r\nimport Board from \"../classes/Board\";\r\nimport Callbacks from \"../classes/Callbacks\";\r\nimport CatalogThreadNative from \"../classes/CatalogThreadNative\";\r\nimport DataBoard from \"../classes/DataBoard\";\r\nimport Notice from \"../classes/Notice\";\r\nimport Post from \"../classes/Post\";\r\nimport SimpleDict from \"../classes/SimpleDict\";\r\nimport Thread from \"../classes/Thread\";\r\nimport Config from \"../config/Config\";\r\nimport Anonymize from \"../Filtering/Anonymize\";\r\nimport Filter from \"../Filtering/Filter\";\r\nimport PostHiding from \"../Filtering/PostHiding\";\r\nimport Recursive from \"../Filtering/Recursive\";\r\nimport ThreadHiding from \"../Filtering/ThreadHiding\";\r\nimport Index from \"../General/Index\";\r\nimport Settings from \"../General/Settings\";\r\nimport FappeTyme from \"../Images/FappeTyme\";\r\nimport Gallery from \"../Images/Gallery\";\r\nimport ImageCommon from \"../Images/ImageCommon\";\r\nimport ImageExpand from \"../Images/ImageExpand\";\r\nimport ImageHost from \"../Images/ImageHost\";\r\nimport ImageHover from \"../Images/ImageHover\";\r\nimport ImageLoader from \"../Images/ImageLoader\";\r\nimport Metadata from \"../Images/Metadata\";\r\nimport RevealSpoilers from \"../Images/RevealSpoilers\";\r\nimport Sauce from \"../Images/Sauce\";\r\nimport Volume from \"../Images/Volume\";\r\nimport Linkify from \"../Linkification/Linkify\";\r\nimport ArchiveLink from \"../Menu/ArchiveLink\";\r\nimport CopyTextLink from \"../Menu/CopyTextLink\";\r\nimport DeleteLink from \"../Menu/DeleteLink\";\r\nimport DownloadLink from \"../Menu/DownloadLink\";\r\nimport ReportLink from \"../Menu/ReportLink\";\r\nimport AntiAutoplay from \"../Miscellaneous/AntiAutoplay\";\r\nimport Banner from \"../Miscellaneous/Banner\";\r\nimport CatalogLinks from \"../Miscellaneous/CatalogLinks\";\r\nimport CustomCSS from \"../Miscellaneous/CustomCSS\";\r\nimport ExpandComment from \"../Miscellaneous/ExpandComment\";\r\nimport ExpandThread from \"../Miscellaneous/ExpandThread\";\r\nimport FileInfo from \"../Miscellaneous/FileInfo\";\r\nimport Flash from \"../Miscellaneous/Flash\";\r\nimport Fourchan from \"../Miscellaneous/Fourchan\";\r\nimport IDColor from \"../Miscellaneous/IDColor\";\r\nimport IDHighlight from \"../Miscellaneous/IDHighlight\";\r\nimport IDPostCount from \"../Miscellaneous/IDPostCount\";\r\nimport Keybinds from \"../Miscellaneous/Keybinds\";\r\nimport ModContact from \"../Miscellaneous/ModContact\";\r\nimport Nav from \"../Miscellaneous/Nav\";\r\nimport NormalizeURL from \"../Miscellaneous/NormalizeURL\";\r\nimport PostJumper from \"../Miscellaneous/PostJumper\";\r\nimport PSA from \"../Miscellaneous/PSA\";\r\nimport PSAHiding from \"../Miscellaneous/PSAHiding\";\r\nimport RelativeDates from \"../Miscellaneous/RelativeDates\";\r\nimport RemoveSpoilers from \"../Miscellaneous/RemoveSpoilers\";\r\nimport ThreadLinks from \"../Miscellaneous/ThreadLinks\";\r\nimport Time from \"../Miscellaneous/Time\";\r\nimport Tinyboard from \"../Miscellaneous/Tinyboard\";\r\nimport Favicon from \"../Monitoring/Favicon\";\r\nimport MarkNewIPs from \"../Monitoring/MarkNewIPs\";\r\nimport ReplyPruning from \"../Monitoring/ReplyPruning\";\r\nimport ThreadStats from \"../Monitoring/ThreadStats\";\r\nimport ThreadUpdater from \"../Monitoring/ThreadUpdater\";\r\nimport ThreadWatcher from \"../Monitoring/ThreadWatcher\";\r\nimport Unread from \"../Monitoring/Unread\";\r\nimport UnreadIndex from \"../Monitoring/UnreadIndex\";\r\nimport $ from \"../platform/$\";\r\nimport $$ from \"../platform/$$\";\r\nimport PassLink from \"../Posting/PassLink\";\r\nimport PostRedirect from \"../Posting/PostRedirect\";\r\nimport QR from \"../Posting/QR\";\r\nimport QuoteBacklink from \"../Quotelinks/QuoteBacklink\";\r\nimport QuoteCT from \"../Quotelinks/QuoteCT\";\r\nimport QuoteInline from \"../Quotelinks/QuoteInline\";\r\nimport QuoteOP from \"../Quotelinks/QuoteOP\";\r\nimport QuotePreview from \"../Quotelinks/QuotePreview\";\r\nimport QuoteStrikeThrough from \"../Quotelinks/QuoteStrikeThrough\";\r\nimport QuoteThreading from \"../Quotelinks/QuoteThreading\";\r\nimport QuoteYou from \"../Quotelinks/QuoteYou\";\r\nimport Quotify from \"../Quotelinks/Quotify\";\r\nimport Site from \"../site/Site\";\r\nimport SW from \"../site/SW\";\r\nimport CSS from \"../css/CSS\";\r\nimport meta from '../../package.json';\r\nimport Header from \"../General/Header\";\r\nimport { c, Conf, d, doc, docSet, E, g } from \"../globals/globals\";\r\nimport Menu from \"../Menu/Menu\";\r\nimport BoardConfig from \"../General/BoardConfig\";\r\nimport CaptchaReplace from \"../Posting/Captcha.replace\";\r\nimport Get from \"../General/Get\";\r\nimport Captcha from \"../Posting/Captcha\";\r\nimport { dict, platform } from \"../platform/helpers\";\r\nimport Polyfill from \"../General/Polyfill\";\r\n// import Test from \"../General/Test\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS101: Remove unnecessary use of Array.from\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * DS104: Avoid inline assignments\r\n * DS205: Consider reworking code to avoid use of IIFEs\r\n * DS207: Consider shorter variations of null checks\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nvar Main = {\r\n  init() {\r\n    // XXX dwb userscripts extension reloads scripts run at document-start when replaceState/pushState is called.\r\n    // XXX Firefox reinjects WebExtension content scripts when extension is updated / reloaded.\r\n    let key;\r\n    try {\r\n      let w = window;\r\n      if (platform === 'crx') { w = (w.wrappedJSObject || w); }\r\n      if (`${meta.name} antidup` in w) { return; }\r\n      w[`${meta.name} antidup`] = true;\r\n    } catch (error) {}\r\n\r\n    // Don't run inside ad iframes.\r\n    try {\r\n      if (window.frameElement && ['', 'about:blank'].includes(window.frameElement.src)) { return; }\r\n    } catch (error1) {}\r\n\r\n    // Detect multiple copies of 4chan X\r\n    if (doc && $.hasClass(doc, 'fourchan-x')) { return; }\r\n    $.asap(docSet, function() {\r\n      $.addClass(doc, 'fourchan-x', 'seaweedchan');\r\n      if ($.engine) { return $.addClass(doc, `ua-${$.engine}`); }\r\n    });\r\n    $.on(d, '4chanXInitFinished', function() {\r\n      if (Main.expectInitFinished) {\r\n        return delete Main.expectInitFinished;\r\n      } else {\r\n        new Notice('error', 'Error: Multiple copies of 4chan X are enabled.');\r\n        return $.addClass(doc, 'tainted');\r\n      }\r\n    });\r\n\r\n    // Detect \"mounted\" event from Kissu\r\n    var mountedCB = function() {\r\n      d.removeEventListener('mounted', mountedCB, true);\r\n      Main.isMounted = true;\r\n      return Main.mountedCBs.map((cb) =>\r\n        (() => { try {\r\n          return cb();\r\n        } catch (error2) {} })());\r\n    };\r\n    d.addEventListener('mounted', mountedCB, true);\r\n\r\n    // Flatten default values from Config into Conf\r\n    var flatten = function(parent, obj) {\r\n      if (obj instanceof Array) {\r\n        Conf[parent] = dict.clone(obj[0]);\r\n      } else if (typeof obj === 'object') {\r\n        for (var key in obj) {\r\n          var val = obj[key];\r\n          flatten(key, val);\r\n        }\r\n      } else { // string or number\r\n        Conf[parent] = obj;\r\n      }\r\n    };\r\n\r\n    // XXX Remove document-breaking ad\r\n    if (['boards.4chan.org', 'boards.4channel.org'].includes(location.hostname)) {\r\n      $.global(function() {\r\n        const fromCharCode0 = String.fromCharCode;\r\n        return String.fromCharCode = function() {\r\n          if (document.body) {\r\n            String.fromCharCode = fromCharCode0;\r\n          } else if (document.currentScript && !document.currentScript.src) {\r\n            throw Error();\r\n          }\r\n          return fromCharCode0.apply(this, arguments);\r\n        };\r\n      });\r\n      $.asap(docSet, () => $.onExists(doc, 'iframe[srcdoc]', $.rm));\r\n    }\r\n\r\n    flatten(null, Config);\r\n\r\n    for (var db of DataBoard.keys) {\r\n      Conf[db] = dict();\r\n    }\r\n    Conf['customTitles'] = dict.clone({'4chan.org': {boards: {'qa': {'boardTitle': {orig: '/qa/ - Question & Answer', title: '/qa/ - 2D/Random'}}}}});\r\n    Conf['boardConfig'] = {boards: dict()};\r\n    Conf['archives'] = Redirect.archives;\r\n    Conf['selectedArchives'] = dict();\r\n    Conf['cooldowns'] = dict();\r\n    Conf['Index Sort'] = dict();\r\n    for (let i = 0; i < 2; i++) { Conf[`Last Long Reply Thresholds ${i}`] = dict(); }\r\n    Conf['siteProperties'] = dict();\r\n\r\n    // XXX old key names\r\n    Conf['Except Archives from Encryption'] = false;\r\n    Conf['JSON Navigation'] = true;\r\n    Conf['Oekaki Links'] = true;\r\n    Conf['Show Name and Subject'] = false;\r\n    Conf['QR Shortcut'] = true;\r\n    Conf['Bottom QR Link'] = true;\r\n    Conf['Toggleable Thread Watcher'] = true;\r\n    Conf['siteSoftware'] = '';\r\n    Conf['Use Faster Image Host'] = 'true';\r\n    Conf['Captcha Fixes'] = true;\r\n    Conf['captchaServiceDomain'] = '';\r\n    Conf['captchaServiceKey'] = dict();\r\n\r\n    // Enforce JS whitelist\r\n    if (\r\n      /\\.4chan(?:nel)?\\.org$/.test(location.hostname) &&\r\n      !SW.yotsuba.regexp.pass.test(location.href) &&\r\n      !SW.yotsuba.regexp.captcha.test(location.href) &&\r\n      !$$('script:not([src])', d).filter(s => /this\\[/.test(s.textContent)).length\r\n    ) {\r\n      ($.getSync || $.get)({'jsWhitelist': Conf['jsWhitelist']}, ({jsWhitelist}) => $.addCSP(`script-src ${jsWhitelist.replace(/^#.*$/mg, '').replace(/[\\s;]+/g, ' ').trim()}`));\r\n    }\r\n\r\n    // Get saved values as items\r\n    const items = dict();\r\n    for (key in Conf) { items[key] = undefined; }\r\n    items['previousversion'] = undefined;\r\n    return ($.getSync || $.get)(items, function(items) {\r\n      if (!$.perProtocolSettings && /\\.4chan(?:nel)?\\.org$/.test(location.hostname) && (items['Redirect to HTTPS'] ?? Conf['Redirect to HTTPS']) && (location.protocol !== 'https:')) {\r\n        location.replace('https://' + location.host + location.pathname + location.search + location.hash);\r\n        return;\r\n      }\r\n      return $.asap(docSet, function() {\r\n\r\n        // Don't hide the local storage warning behind a settings panel.\r\n        if ($.cantSet) {\r\n          // pass\r\n\r\n        // Fresh install\r\n        } else if ((items.previousversion == null)) {\r\n          Main.isFirstRun = true;\r\n          Main.ready(function() {\r\n            $.set('previousversion', g.VERSION);\r\n            return Settings.open();\r\n          });\r\n\r\n        // Migrate old settings\r\n        } else if (items.previousversion !== g.VERSION) {\r\n          Main.upgrade(items);\r\n        }\r\n\r\n        // Combine default values with saved values\r\n        for (key in Conf) {\r\n          var val = Conf[key];\r\n          Conf[key] = items[key] ?? val;\r\n        }\r\n\r\n        return Site.init(Main.initFeatures);\r\n      });\r\n    });\r\n  },\r\n\r\n  upgrade(items) {\r\n    const {previousversion} = items;\r\n    const changes = Settings.upgrade(items, previousversion);\r\n    items.previousversion = (changes.previousversion = g.VERSION);\r\n    return $.set(changes, function() {\r\n      if (items['Show Updated Notifications'] ?? true) {\r\n        const el = $.el('span',\r\n          { innerHTML: `${meta.name} has been updated to <a href=\"${meta.changelog}\" target=\"_blank\">version ${g.VERSION}</a>.` });\r\n        return new Notice('info', el, 15);\r\n      }\r\n    });\r\n  },\r\n\r\n  parseURL(site=g.SITE, url=location) {\r\n    const r = {};\r\n\r\n    if (!site) { return r; }\r\n    r.siteID = site.ID;\r\n\r\n    if (site.isBoardlessPage?.(url)) { return r; }\r\n    const pathname = url.pathname.split(/\\/+/);\r\n    r.boardID = pathname[1];\r\n\r\n    if (site.isFileURL(url)) {\r\n      r.VIEW = 'file';\r\n    } else if (site.isAuxiliaryPage?.(url)) {\r\n      // pass\r\n    } else if (['thread', 'res'].includes(pathname[2])) {\r\n      r.VIEW = 'thread';\r\n      r.threadID = (r.THREADID = +pathname[3].replace(/\\.\\w+$/, ''));\r\n    } else if ((pathname[2] === 'archive') && (pathname[3] === 'res')) {\r\n      r.VIEW = 'thread';\r\n      r.threadID = (r.THREADID = +pathname[4].replace(/\\.\\w+$/, ''));\r\n      r.threadArchived = true;\r\n    } else if (/^(?:catalog|archive)(?:\\.\\w+)?$/.test(pathname[2])) {\r\n      r.VIEW = pathname[2].replace(/\\.\\w+$/, '');\r\n    } else if (/^(?:index|\\d*)(?:\\.\\w+)?$/.test(pathname[2])) {\r\n      r.VIEW = 'index';\r\n    }\r\n    return r;\r\n  },\r\n\r\n  initFeatures() {\r\n    $.global(function() {\r\n      document.documentElement.classList.add('js-enabled');\r\n      return window.FCX = {};});\r\n    Main.jsEnabled = $.hasClass(doc, 'js-enabled');\r\n\r\n    // XXX https://bugs.chromium.org/p/chromium/issues/detail?id=920638\r\n    $.ajaxPageInit?.();\r\n\r\n    $.extend(g, Main.parseURL());\r\n    if (g.boardID) { g.BOARD = new Board(g.boardID); }\r\n\r\n    if (!g.VIEW) {\r\n      g.SITE.initAuxiliary?.();\r\n      return;\r\n    }\r\n\r\n    if (g.VIEW === 'file') {\r\n      $.asap((() => d.readyState !== 'loading'), function() {\r\n        let video;\r\n        if ((g.SITE.software === 'yotsuba') && Conf['404 Redirect'] && g.SITE.is404?.()) {\r\n          const pathname = location.pathname.split(/\\/+/);\r\n          return Redirect.navigate('file', {\r\n            boardID:  g.BOARD.ID,\r\n            filename: pathname[pathname.length - 1]\r\n          });\r\n        } else if (video = $('video')) {\r\n          if (Conf['Volume in New Tab']) {\r\n            Volume.setup(video);\r\n          }\r\n          if (Conf['Loop in New Tab']) {\r\n            video.loop = true;\r\n            video.controls = false;\r\n            video.play();\r\n            return ImageCommon.addControls(video);\r\n          }\r\n        }\r\n      });\r\n      return;\r\n    }\r\n\r\n    g.threads = new SimpleDict();\r\n    g.posts   = new SimpleDict();\r\n\r\n    // set up CSS when <head> is completely loaded\r\n    $.onExists(doc, 'body', Main.initStyle);\r\n\r\n    // c.time 'All initializations'\r\n    for (var [name, feature] of Main.features) {\r\n      if (g.SITE.disabledFeatures && g.SITE.disabledFeatures.includes(name)) { continue; }\r\n      // c.time \"#{name} initialization\"\r\n      try {\r\n        feature.init();\r\n      } catch (err) {\r\n        Main.handleErrors({\r\n          message: `\\\"${name}\\\" initialization crashed.`,\r\n          error: err\r\n        });\r\n      }\r\n    }\r\n      // finally\r\n      //   c.timeEnd \"#{name} initialization\"\r\n\r\n    // c.timeEnd 'All initializations'\r\n\r\n    return $.ready(Main.initReady);\r\n  },\r\n\r\n  initStyle() {\r\n    if (!Main.isThisPageLegit()) { return; }\r\n\r\n    // disable the mobile layout\r\n    const mobileLink = $('link[href*=mobile]', d.head);\r\n    if (mobileLink) mobileLink.disabled = true;\r\n    doc.dataset.host = location.host;\r\n    $.addClass(doc, `sw-${g.SITE.software}`);\r\n    $.addClass(doc, g.VIEW === 'thread' ? 'thread-view' : g.VIEW);\r\n    $.onExists(doc, '.ad-cnt, .adg-rects > .desktop', ad => $.onExists(ad, 'img, iframe', () => $.addClass(doc, 'ads-loaded')));\r\n    if (Conf['Autohiding Scrollbar']) { $.addClass(doc, 'autohiding-scrollbar'); }\r\n    $.ready(function() {\r\n      if ((d.body.clientHeight > doc.clientHeight) && ((window.innerWidth === doc.clientWidth) !== Conf['Autohiding Scrollbar'])) {\r\n        Conf['Autohiding Scrollbar'] = !Conf['Autohiding Scrollbar'];\r\n        $.set('Autohiding Scrollbar', Conf['Autohiding Scrollbar']);\r\n        return $.toggleClass(doc, 'autohiding-scrollbar');\r\n      }\r\n    });\r\n    $.addStyle(CSS.sub(CSS.boards), 'fourchanx-css');\r\n    Main.bgColorStyle = $.el('style', {id: 'fourchanx-bgcolor-css'});\r\n\r\n    let keyboard = false;\r\n    $.on(d, 'mousedown', () => keyboard = false);\r\n    $.on(d, 'keydown', function(e) { if (e.keyCode === 9) { return keyboard = true; } }); // tab\r\n    window.addEventListener('focus', (() => doc.classList.toggle('keyboard-focus', keyboard)), true);\r\n\r\n    return Main.setClass();\r\n  },\r\n\r\n  setClass() {\r\n    let mainStyleSheet, style, styleSheets;\r\n    const knownStyles = ['yotsuba', 'yotsuba-b', 'futaba', 'burichan', 'photon', 'tomorrow', 'spooky'];\r\n\r\n    if ((g.SITE.software === 'yotsuba') && (g.VIEW === 'catalog')) {\r\n      if (mainStyleSheet = $.id('base-css')) {\r\n        style = mainStyleSheet.href.match(/catalog_(\\w+)/)?.[1].replace('_new', '').replace(/_+/g, '-');\r\n        if (knownStyles.includes(style)) {\r\n          $.addClass(doc, style);\r\n          return;\r\n        }\r\n      }\r\n    }\r\n\r\n    style = (mainStyleSheet = (styleSheets = null));\r\n\r\n    const setStyle = function() {\r\n      // Use preconfigured CSS for 4chan's default themes.\r\n      if (g.SITE.software === 'yotsuba') {\r\n        $.rmClass(doc, style);\r\n        style = null;\r\n        for (var styleSheet of styleSheets) {\r\n          if (styleSheet.href === mainStyleSheet?.href) {\r\n            style = styleSheet.title.toLowerCase().replace('new', '').trim().replace(/\\s+/g, '-');\r\n            if (style === '_special') { style = styleSheet.href.match(/[a-z]*(?=[^/]*$)/)[0]; }\r\n            if (!knownStyles.includes(style)) { style = null; }\r\n            break;\r\n          }\r\n        }\r\n        if (style) {\r\n          $.addClass(doc, style);\r\n          $.rm(Main.bgColorStyle);\r\n          return;\r\n        }\r\n      }\r\n\r\n      // Determine proper dialog background color for other themes.\r\n      const div = g.SITE.bgColoredEl();\r\n      div.style.position = 'absolute';\r\n      div.style.visibility = 'hidden';\r\n      $.add(d.body, div);\r\n      let bgColor = window.getComputedStyle(div).backgroundColor;\r\n      $.rm(div);\r\n      const rgb = bgColor.match(/[\\d.]+/g);\r\n      // Use body background if reply background is transparent\r\n      if (!/^rgb\\(/.test(bgColor)) {\r\n        const s = window.getComputedStyle(d.body);\r\n        bgColor = `${s.backgroundColor} ${s.backgroundImage} ${s.backgroundRepeat} ${s.backgroundPosition}`;\r\n      }\r\n      let css = `\\\r\n.dialog, .suboption-list > div:last-of-type, :root.catalog-hover-expand .catalog-container:hover > .post {\r\n  background: ${bgColor};\r\n}\r\n.unread-mark-read {\r\n  background-color: rgba(${rgb.slice(0, 3).join(', ')}, ${0.5*(rgb[3] || 1)});\r\n}\\\r\n`;\r\n      if ($.luma(rgb) < 100) {\r\n        css += `\\\r\n.watch-thread-link {\r\n  background-image: url(\"data:image/svg+xml,<svg viewBox='0 0 26 26' preserveAspectRatio='true' xmlns='http://www.w3.org/2000/svg'><path fill='rgb(200,200,200)' d='M24.132,7.971c-2.203-2.205-5.916-2.098-8.25,0.235L15.5,8.588l-0.382-0.382c-2.334-2.333-6.047-2.44-8.25-0.235c-2.204,2.203-2.098,5.916,0.235,8.249l8.396,8.396l8.396-8.396C26.229,13.887,26.336,10.174,24.132,7.971z'/></svg>\");\r\n}\\\r\n`;\r\n      }\r\n      Main.bgColorStyle.textContent = css;\r\n      return $.after($.id('fourchanx-css'), Main.bgColorStyle);\r\n    };\r\n\r\n    $.onExists(d.head, g.SITE.selectors.styleSheet, function(el) {\r\n      mainStyleSheet = el;\r\n      if (g.SITE.software === 'yotsuba') {\r\n        styleSheets = $$('link[rel=\"alternate stylesheet\"]', d.head);\r\n      }\r\n      new MutationObserver(setStyle).observe(mainStyleSheet, {\r\n        attributes: true,\r\n        attributeFilter: ['href']\r\n      });\r\n      $.on(mainStyleSheet, 'load', setStyle);\r\n      return setStyle();\r\n    });\r\n    if (!mainStyleSheet) {\r\n      for (var styleSheet of $$('link[rel=\"stylesheet\"]', d.head)) {\r\n        $.on(styleSheet, 'load', setStyle);\r\n      }\r\n      return setStyle();\r\n    }\r\n  },\r\n\r\n  initReady() {\r\n    if (g.SITE.is404?.()) {\r\n      if (g.VIEW === 'thread') {\r\n        ThreadWatcher.set404(g.BOARD.ID, g.THREADID, function() {\r\n          if (Conf['404 Redirect']) {\r\n            return Redirect.navigate('thread', {\r\n              boardID:  g.BOARD.ID,\r\n              threadID: g.THREADID,\r\n              postID:   +location.hash.match(/\\d+/)\r\n            } // post number or 0\r\n            , `/${g.BOARD}/`);\r\n          }\r\n        });\r\n      }\r\n\r\n      return;\r\n    }\r\n\r\n    if (g.SITE.isIncomplete?.()) {\r\n      const msg = $.el('div',\r\n        {innerHTML: 'The page didn&#039;t load completely.<br>Some features may not work unless you <a href=\"javascript:;\">reload</a>.'});\r\n      $.on($('a', msg), 'click', () => location.reload());\r\n      new Notice('warning', msg);\r\n    }\r\n\r\n    // Parse HTML or skip it and start building from JSON.\r\n    if (g.VIEW === 'catalog') {\r\n      return Main.initCatalog();\r\n    } else if (!Index.enabled) {\r\n      if (g.SITE.awaitBoard) {\r\n        return g.SITE.awaitBoard(Main.initThread);\r\n      } else {\r\n        return Main.initThread();\r\n      }\r\n    } else {\r\n      Main.expectInitFinished = true;\r\n      return $.event('4chanXInitFinished');\r\n    }\r\n  },\r\n\r\n  initThread() {\r\n    let board;\r\n    const s = g.SITE.selectors;\r\n    if (board = $((s.boardFor?.[g.VIEW] || s.board))) {\r\n      const threads = [];\r\n      const posts   = [];\r\n      const errors  = [];\r\n\r\n      try {\r\n        g.SITE.preParsingFixes?.(board);\r\n      } catch (error) {}\r\n\r\n      Main.addThreadsObserver = new MutationObserver(Main.addThreads);\r\n      Main.addPostsObserver   = new MutationObserver(Main.addPosts);\r\n      Main.addThreadsObserver.observe(board, {childList: true});\r\n\r\n      Main.parseThreads($$(s.thread, board), threads, posts, errors);\r\n      if (errors.length) { Main.handleErrors(errors); }\r\n\r\n      if (g.VIEW === 'thread') {\r\n        if (g.threadArchived) {\r\n          threads[0].isArchived = true;\r\n          threads[0].kill();\r\n        }\r\n        g.SITE.parseThreadMetadata?.(threads[0]);\r\n      }\r\n\r\n      Main.callbackNodes('Thread', threads);\r\n      return Main.callbackNodesDB('Post', posts, function() {\r\n        for (var post of posts) { QuoteThreading.insert(post); }\r\n        Main.expectInitFinished = true;\r\n        return $.event('4chanXInitFinished');\r\n      });\r\n\r\n    } else {\r\n      Main.expectInitFinished = true;\r\n      return $.event('4chanXInitFinished');\r\n    }\r\n  },\r\n\r\n  parseThreads(threadRoots, threads, posts, errors) {\r\n    for (var threadRoot of threadRoots) {\r\n      var boardObj = (() => {\r\n        let boardID;\r\n        if (boardID = threadRoot.dataset.board) {\r\n        boardID = encodeURIComponent(boardID);\r\n        return g.boards[boardID] || new Board(boardID);\r\n      } else {\r\n        return g.BOARD;\r\n      }\r\n      })();\r\n      var threadID = +threadRoot.id.match(/\\d*$/)[0];\r\n      if (!threadID || boardObj.threads.get(threadID)?.nodes.root) { return; }\r\n      var thread = new Thread(threadID, boardObj);\r\n      thread.nodes.root = threadRoot;\r\n      threads.push(thread);\r\n      var postRoots = $$(g.SITE.selectors.postContainer, threadRoot);\r\n      if (g.SITE.isOPContainerThread) { postRoots.unshift(threadRoot); }\r\n      Main.parsePosts(postRoots, thread, posts, errors);\r\n      Main.addPostsObserver.observe(threadRoot, {childList: true});\r\n    }\r\n  },\r\n\r\n  parsePosts(postRoots, thread, posts, errors) {\r\n    for (var postRoot of postRoots) {\r\n      if (!(postRoot.dataset.fullID && g.posts.get(postRoot.dataset.fullID)) && $(g.SITE.selectors.comment, postRoot)) {\r\n        try {\r\n          posts.push(new Post(postRoot, thread, thread.board));\r\n        } catch (err) {\r\n          // Skip posts that we failed to parse.\r\n          errors.push({\r\n            message: `Parsing of Post No.${postRoot.id.match(/\\d+/)} failed. Post will be skipped.`,\r\n            error: err,\r\n            html: postRoot.outerHTML\r\n          });\r\n        }\r\n      }\r\n    }\r\n  },\r\n\r\n  addThreads(records) {\r\n    const threadRoots = [];\r\n    for (var record of records) {\r\n      for (var node of record.addedNodes) {\r\n        if ((node.nodeType === Node.ELEMENT_NODE) && node.matches(g.SITE.selectors.thread)) {\r\n          threadRoots.push(node);\r\n        }\r\n      }\r\n    }\r\n    if (!threadRoots.length) { return; }\r\n    const threads = [];\r\n    const posts   = [];\r\n    const errors  = [];\r\n    Main.parseThreads(threadRoots, threads, posts, errors);\r\n    if (errors.length) { Main.handleErrors(errors); }\r\n    Main.callbackNodes('Thread', threads);\r\n    return Main.callbackNodesDB('Post', posts, () => $.event('PostsInserted', null, records[0].target));\r\n  },\r\n\r\n  addPosts(records) {\r\n    let thread;\r\n    const threads   = [];\r\n    const threadsRM = [];\r\n    const posts     = [];\r\n    const errors    = [];\r\n    for (var record of records) {\r\n      thread = Get.threadFromRoot(record.target);\r\n      var postRoots = [];\r\n      for (var node of record.addedNodes) {\r\n        if (node.nodeType === Node.ELEMENT_NODE) {\r\n          if (node.matches(g.SITE.selectors.postContainer) || (node = $(g.SITE.selectors.postContainer, node))) {\r\n            postRoots.push(node);\r\n          }\r\n        }\r\n      }\r\n      var n = posts.length;\r\n      Main.parsePosts(postRoots, thread, posts, errors);\r\n      if ((posts.length > n) && !threads.includes(thread)) {\r\n        threads.push(thread);\r\n      }\r\n      var anyRemoved = false;\r\n      for (var el of record.removedNodes) {\r\n        if ((Get.postFromRoot(el)?.nodes.root === el) && !doc.contains(el)) {\r\n          anyRemoved = true;\r\n          break;\r\n        }\r\n      }\r\n      if (anyRemoved && !threadsRM.includes(thread)) {\r\n        threadsRM.push(thread);\r\n      }\r\n    }\r\n    if (errors.length) { Main.handleErrors(errors); }\r\n    return Main.callbackNodesDB('Post', posts, function() {\r\n      for (thread of threads) {\r\n        $.event('PostsInserted', null, thread.nodes.root);\r\n      }\r\n      for (thread of threadsRM) {\r\n        $.event('PostsRemoved', null, thread.nodes.root);\r\n      }\r\n    });\r\n  },\r\n\r\n  initCatalog() {\r\n    let board;\r\n    const s = g.SITE.selectors.catalog;\r\n    if (s && (board = $(s.board))) {\r\n      const threads = [];\r\n      const errors  = [];\r\n\r\n      Main.addCatalogThreadsObserver = new MutationObserver(Main.addCatalogThreads);\r\n      Main.addCatalogThreadsObserver.observe(board, {childList: true});\r\n\r\n      Main.parseCatalogThreads($$(s.thread, board), threads, errors);\r\n      if (errors.length) { Main.handleErrors(errors); }\r\n\r\n      Main.callbackNodes('CatalogThreadNative', threads);\r\n    }\r\n\r\n    Main.expectInitFinished = true;\r\n    return $.event('4chanXInitFinished');\r\n  },\r\n\r\n  parseCatalogThreads(threadRoots, threads, errors) {\r\n    for (var threadRoot of threadRoots) {\r\n      try {\r\n        var thread = new CatalogThreadNative(threadRoot);\r\n        if (thread.thread.catalogViewNative?.nodes.root !== threadRoot) {\r\n          thread.thread.catalogViewNative = thread;\r\n          threads.push(thread);\r\n        }\r\n      } catch (err) {\r\n        // Skip threads that we failed to parse.\r\n        errors.push({\r\n          message: `Parsing of Catalog Thread No.${(threadRoot.dataset.id || threadRoot.id).match(/\\d+/)} failed. Thread will be skipped.`,\r\n          error: err,\r\n          html: threadRoot.outerHTML\r\n        });\r\n      }\r\n    }\r\n  },\r\n\r\n  addCatalogThreads(records) {\r\n    const threadRoots = [];\r\n    for (var record of records) {\r\n      for (var node of record.addedNodes) {\r\n        if ((node.nodeType === Node.ELEMENT_NODE) && node.matches(g.SITE.selectors.catalog.thread)) {\r\n          threadRoots.push(node);\r\n        }\r\n      }\r\n    }\r\n    if (!threadRoots.length) { return; }\r\n    const threads = [];\r\n    const errors  = [];\r\n    Main.parseCatalogThreads(threadRoots, threads, errors);\r\n    if (errors.length) { Main.handleErrors(errors); }\r\n    return Main.callbackNodes('CatalogThreadNative', threads);\r\n  },\r\n\r\n  callbackNodes(klass, nodes) {\r\n    let node;\r\n    let i = 0;\r\n    const cb = Callbacks[klass];\r\n    while ((node = nodes[i++])) {\r\n      cb.execute(node);\r\n    }\r\n  },\r\n\r\n  callbackNodesDB(klass, nodes, cb) {\r\n    let i   = 0;\r\n    const cbs = Callbacks[klass];\r\n    const fn  = function() {\r\n      let node;\r\n      if (!(node = nodes[i])) { return false; }\r\n      cbs.execute(node);\r\n      return ++i % 25;\r\n    };\r\n\r\n    var softTask = function() {\r\n      while (fn()) {\r\n        continue;\r\n      }\r\n      if (!nodes[i]) {\r\n        if (cb) { cb(); }\r\n        return;\r\n      }\r\n      return setTimeout(softTask, 0);\r\n    };\r\n\r\n    return softTask();\r\n  },\r\n\r\n  handleErrors(errors) {\r\n    // Detect conflicts with 4chan X v2\r\n    let error;\r\n    if (d.body && $.hasClass(d.body, 'fourchan_x') && !$.hasClass(doc, 'tainted')) {\r\n      new Notice('error', 'Error: Multiple copies of 4chan X are enabled.');\r\n      $.addClass(doc, 'tainted');\r\n    }\r\n\r\n    // Detect conflicts with native extension\r\n    if (g.SITE.testNativeExtension && !$.hasClass(doc, 'tainted')) {\r\n      const {enabled} = g.SITE.testNativeExtension();\r\n      if (enabled) {\r\n        $.addClass(doc, 'tainted');\r\n        if (Conf['Disable Native Extension'] && !Main.isFirstRun) {\r\n          const msg = $.el('div',\r\n            { innerHTML: 'Failed to disable the native extension. You may need to <a href=\"' + E(meta.faq) + '#blocking-native-extension\" target=\"_blank\">block it</a>.' });\r\n          new Notice('error', msg);\r\n        }\r\n      }\r\n    }\r\n\r\n    if (!(errors instanceof Array)) {\r\n      error = errors;\r\n    } else if (errors.length === 1) {\r\n      error = errors[0];\r\n    }\r\n    if (error) {\r\n      new Notice('error', Main.parseError(error, Main.reportLink([error])), 15);\r\n      return;\r\n    }\r\n\r\n    const div = $.el('div', {\r\n      innerHTML:\r\n        `${errors.length} errors occurred.${Main.reportLink(errors).innerHTML} [<a href=\"javascript:;\">show</a>]`\r\n    });\r\n    $.on(div.lastElementChild, 'click', function () {\r\n      let ref;\r\n      return [this.textContent, logs.hidden] = Array.from(ref = this.textContent === 'show' ? (\r\n        ['hide', false]\r\n      ) : (\r\n        ['show', true]\r\n      )), ref;\r\n    });\r\n\r\n    var logs = $.el('div',\r\n      {hidden: true});\r\n    for (error of errors) {\r\n      $.add(logs, Main.parseError(error));\r\n    }\r\n\r\n    return new Notice('error', [div, logs], 30);\r\n  },\r\n\r\n  parseError(data, reportLink) {\r\n    c.error(data.message, data.error.stack);\r\n    const message = $.el('div',\r\n      { innerHTML: E(data.message) + ((reportLink) ? (reportLink).innerHTML : \"\") });\r\n    const error = $.el('div',\r\n      {textContent: `${data.error.name || 'Error'}: ${data.error.message || 'see console for details'}`});\r\n    const lines = data.error.stack?.match(/\\d+(?=:\\d+\\)?$)/mg)?.join().replace(/^/, ' at ') || '';\r\n    const context = $.el('div',\r\n      { textContent: `(${meta.name} ${meta.fork} v${g.VERSION} ${platform} on ${$.engine}${lines})` });\r\n    return [message, error, context];\r\n  },\r\n\r\n  reportLink(errors) {\r\n    let info;\r\n    const data = errors[0];\r\n    let title  = data.message;\r\n    if (errors.length > 1) { title += ` (+${errors.length - 1} other errors)`; }\r\n    let details = '';\r\n    const addDetails = function(text) {\r\n      if (encodeURIComponent(title + details + text + '\\n').length <= meta.newIssueMaxLength - meta.newIssue.replace(/%(title|details)/, '').length) {\r\n        return details += text + '\\n';\r\n      }\r\n    };\r\n    addDetails(`\\\r\n[Please describe the steps needed to reproduce this error.]\r\n\r\nScript: ${meta.name} ${meta.fork} v${g.VERSION} ${platform}\r\nURL: ${location.href}\r\nUser agent: ${navigator.userAgent}\\\r\n`\r\n    );\r\n    if ((platform === 'userscript') && (info = (() => {\r\n      if (typeof GM !== 'undefined' && GM !== null) { return GM.info; } else { if (typeof GM_info !== 'undefined' && GM_info !== null) { return GM_info; }\r\n  }\r\n    })())) {\r\n      addDetails(`Userscript manager: ${info.scriptHandler} ${info.version}`);\r\n    }\r\n    addDetails('\\n' + data.error);\r\n    if (data.error.stack) { addDetails(data.error.stack.replace(data.error.toString(), '').trim()); }\r\n    if (data.html) { addDetails('\\n`' + data.html + '`'); }\r\n    details = details.replace(/file:\\/{3}.+\\//g, ''); // Remove local file paths\r\n    const url = meta.newIssue.replace('%title', encodeURIComponent(title)).replace('%details', encodeURIComponent(details));\r\n    return { innerHTML: `<span class=\"report-error\"> [<a href=\"${url}\" target=\"_blank\">report</a>]</span>` };\r\n  },\r\n\r\n  isThisPageLegit() {\r\n    // not 404 error page or similar.\r\n    if (!('thisPageIsLegit' in Main)) {\r\n      Main.thisPageIsLegit = g.SITE.isThisPageLegit ?\r\n        g.SITE.isThisPageLegit()\r\n      :\r\n        !/^[45]\\d\\d\\b/.test(document.title) && !/\\.(?:json|rss)$/.test(location.pathname);\r\n    }\r\n    return Main.thisPageIsLegit;\r\n  },\r\n\r\n  ready(cb) {\r\n    return $.ready(function() {\r\n      if (Main.isThisPageLegit()) { return cb(); }\r\n    });\r\n  },\r\n\r\n  mounted(cb) {\r\n    if (Main.isMounted) {\r\n      return cb();\r\n    } else {\r\n      return Main.mountedCBs.push(cb);\r\n    }\r\n  },\r\n\r\n  mountedCBs: [],\r\n\r\n  features: [\r\n    ['Polyfill',                  Polyfill],\r\n    ['Board Configuration',       BoardConfig],\r\n    ['Normalize URL',             NormalizeURL],\r\n    ['Delay Redirect on Post',    PostRedirect],\r\n    ['Captcha Configuration',     CaptchaReplace],\r\n    ['Image Host Rewriting',      ImageHost],\r\n    ['Redirect',                  Redirect],\r\n    ['Header',                    Header],\r\n    ['Catalog Links',             CatalogLinks],\r\n    ['Settings',                  Settings],\r\n    ['Index Generator',           Index],\r\n    ['Disable Autoplay',          AntiAutoplay],\r\n    ['Announcement Hiding',       PSAHiding],\r\n    ['Fourchan thingies',         Fourchan],\r\n    ['Tinyboard Glue',            Tinyboard],\r\n    ['Color User IDs',            IDColor],\r\n    ['Highlight by User ID',      IDHighlight],\r\n    ['Count Posts by ID',         IDPostCount],\r\n    ['Custom CSS',                CustomCSS],\r\n    ['Thread Links',              ThreadLinks],\r\n    ['Linkify',                   Linkify],\r\n    ['Reveal Spoilers',           RemoveSpoilers],\r\n    ['Resurrect Quotes',          Quotify],\r\n    ['Filter',                    Filter],\r\n    ['Thread Hiding Buttons',     ThreadHiding],\r\n    ['Reply Hiding Buttons',      PostHiding],\r\n    ['Recursive',                 Recursive],\r\n    ['Strike-through Quotes',     QuoteStrikeThrough],\r\n    ['Quick Reply Personas',      QR.persona],\r\n    ['Quick Reply',               QR],\r\n    ['Cooldown',                  QR.cooldown],\r\n    ['Post Jumper',               PostJumper],\r\n    ['Pass Link',                 PassLink],\r\n    ['Menu',                      Menu],\r\n    ['Index Generator (Menu)',    Index.menu],\r\n    ['Report Link',               ReportLink],\r\n    ['Copy Text Link',            CopyTextLink],\r\n    ['Thread Hiding (Menu)',      ThreadHiding.menu],\r\n    ['Reply Hiding (Menu)',       PostHiding.menu],\r\n    ['Delete Link',               DeleteLink],\r\n    ['Filter (Menu)',             Filter.menu],\r\n    ['Edit Link',                 QR.oekaki.menu],\r\n    ['Download Link',             DownloadLink],\r\n    ['Archive Link',              ArchiveLink],\r\n    ['Quote Inlining',            QuoteInline],\r\n    ['Quote Previewing',          QuotePreview],\r\n    ['Quote Backlinks',           QuoteBacklink],\r\n    ['Mark Quotes of You',        QuoteYou],\r\n    ['Mark OP Quotes',            QuoteOP],\r\n    ['Mark Cross-thread Quotes',  QuoteCT],\r\n    ['Anonymize',                 Anonymize],\r\n    ['Time Formatting',           Time],\r\n    ['Relative Post Dates',       RelativeDates],\r\n    ['File Info Formatting',      FileInfo],\r\n    ['Fappe Tyme',                FappeTyme],\r\n    ['Gallery',                   Gallery],\r\n    ['Gallery (menu)',            Gallery.menu],\r\n    ['Sauce',                     Sauce],\r\n    ['Image Expansion',           ImageExpand],\r\n    ['Image Expansion (Menu)',    ImageExpand.menu],\r\n    ['Reveal Spoiler Thumbnails', RevealSpoilers],\r\n    ['Image Loading',             ImageLoader],\r\n    ['Image Hover',               ImageHover],\r\n    ['Volume Control',            Volume],\r\n    ['WEBM Metadata',             Metadata],\r\n    ['Comment Expansion',         ExpandComment],\r\n    ['Thread Expansion',          ExpandThread],\r\n    ['Favicon',                   Favicon],\r\n    ['Unread',                    Unread],\r\n    ['Unread Line in Index',      UnreadIndex],\r\n    ['Quote Threading',           QuoteThreading],\r\n    ['Thread Stats',              ThreadStats],\r\n    ['Thread Updater',            ThreadUpdater],\r\n    ['Thread Watcher',            ThreadWatcher],\r\n    ['Thread Watcher (Menu)',     ThreadWatcher.menu],\r\n    ['Mark New IPs',              MarkNewIPs],\r\n    ['Index Navigation',          Nav],\r\n    ['Keybinds',                  Keybinds],\r\n    ['Banner',                    Banner],\r\n    ['Announcements',             PSA],\r\n    ['Flash Features',            Flash],\r\n    ['Reply Pruning',             ReplyPruning],\r\n    ['Mod Contact Links',         ModContact]\r\n  ]\r\n};\r\nexport default Main;\r\n$.ready(() => Main.init());\r\n\r\n// <% if (readJSON('/.tests_enabled')) { %>\r\n// Main.features.push(['Build Test', Test]);\r\n// <% } %>\r\n","import Callbacks from \"../classes/Callbacks\";\r\nimport Get from \"../General/Get\";\r\nimport { g, Conf } from \"../globals/globals\";\r\nimport $ from \"../platform/$\";\r\n\r\n/*\r\n * decaffeinate suggestions:\r\n * DS102: Remove unnecessary code created because of implicit returns\r\n * Full docs: https://github.com/decaffeinate/decaffeinate/blob/main/docs/suggestions.md\r\n */\r\nconst QuoteStrikeThrough = {\r\n  init() {\r\n    if (!['index', 'thread'].includes(g.VIEW) ||\r\n      (!Conf['Reply Hiding Buttons'] && (!Conf['Menu'] || !Conf['Reply Hiding Link']) && !Conf['Filter'])) { return; }\r\n\r\n    return Callbacks.Post.push({\r\n      name: 'Strike-through Quotes',\r\n      cb:   this.node\r\n    });\r\n  },\r\n\r\n  node() {\r\n    if (this.isClone) { return; }\r\n    for (var quotelink of this.nodes.quotelinks) {\r\n      var {boardID, postID} = Get.postDataFromLink(quotelink);\r\n      if (g.posts.get(`${boardID}.${postID}`)?.isHidden) {\r\n        $.addClass(quotelink, 'filtered');\r\n      }\r\n    }\r\n  }\r\n};\r\nexport default QuoteStrikeThrough;\r\n"],"names":["Conf","Object","create","g","VERSION","NAMESPACE","meta","name","sites","boards","E","str","regex","fn","x","output","text","toString","replace","cat","templates","html","i","length","innerHTML","d","document","doc","documentElement","c","console","docSet","Callbacks","static","this","Post","Thread","CatalogThread","CatalogThreadNative","constructor","type","keys","push","cb","execute","node","force","errors","callbacksExecuted","call","err","message","ID","board","join","error","nodes","root","outerHTML","Main","handleErrors","initClass","Config","main","Miscellaneous","Keybinds","Linkification","Linkify","Embedding","Filtering","Anonymize","Filter","Stubs","Gallery","Sauce","Autoplay","Menu","Monitoring","Cooldown","imageExpansion","gallery","threadWatcher","filter","general","postID","uniqueID","tripcode","capcode","pass","email","subject","comment","flag","filename","dimensions","filesize","MD5","sauces","FappeT","werk","Index","Header","archives","archiveLists","lastarchivecheck","archiveAutoUpdate","externalCatalogURLs","boardnav","QR","sjisPreview","jsWhitelist","captchaLanguage","time","timeLocale","backlink","pastedname","fileInfo","favicon","usercss","hotkeys","Close","Watch","Update","Pause","Slideshow","fappeTyme","werkTyme","Hide","updater","checkbox","Beep","Interval","customCooldown","customCooldownEnabled","position","fourchanImageHost","hiddenPSAList","knownBanners","passMessageClosed","PSAseen","Favicon","init","$","asap","head","el","initAsap","set","status","href","add","isSFW","test","default","switch","items","ferongr","Mayhem","Original","Metro","getOwn","f","unreadDead","unreadDeadY","unreadSFW","unreadSFWY","unreadNSFW","unreadNSFWY","Array","from","update","unread","unreadY","SFW","NSFW","dead","logo","$$","selector","body","querySelectorAll","CaptchaReplace","SITE","software","cookie","indexOf","jsEnabled","trim","includes","location","hostname","onExists","Captcha","iframe","ready","noscript","original","toggle","parentNode","span","id","rm","insert","textContent","on","lang","src","encodeURIComponent","CaptchaT","isEnabled","className","addClass","after","com","moreNeeded","getThread","threadID","boardID","BOARD","posts","thread","setup","focus","container","prepend","currentThread","global","querySelector","window","TCaptcha","setErrorCb","dispatchEvent","CustomEvent","detail","content","destroy","updateThread","newThread","getOne","response","key","value","setUsed","clearChallenge","occupied","debounce","wait","lastCall","timeout","that","args","exec","Date","now","apply","arguments","clearTimeout","setTimeout","dict","clone","obj","arr","end","map","val","json","JSON","parse","SECOND","MINUTE","HOUR","DAY","platform","GM_xmlhttpRequest","DataBoard","changes","sync","dontClean","onSync","bind","initData","clean","off","data","lastChecked","save","change","get","needSync","version","forceSync","delete","siteID","deleteIfEmpty","setUnsafe","undefined","base","extend","oldVal","defaultValue","subVal","setLastChecked","middle","ajaxClean","threadsList","urls","threadsListJSON","cache","archiveList","archiveListJSON","ajaxCleanParse","response1","archivedBoardsKnown","response2","threads","page","no","SimpleDict","splice","forEach","fullID","isDead","isHidden","isSticky","isClosed","isArchived","postLimit","fileLimit","lastPost","ipCount","OP","catalogView","setPage","pageNum","icon","info","reply","previousSibling","tn","title","pageCount","setCount","count","reachedLimit","rmClass","setStatus","setIcon","typeLC","toLowerCase","icons","Build","staticPath","gifIcon","alt","style","cssText","quote","cloneNode","kill","collect","n","post","clones","thumb","postCount","fileCount","replies","currentMenu","lastToggledButton","setPosition","close","keybinds","onFocus","addEntry","open","entries","makeMenu","menu","tabIndex","dataset","e","stopPropagation","button","preventDefault","previousButton","entry","sort","first","second","order","insertEntry","mRect","getBoundingClientRect","bRect","scrollY","top","scrollX","left","cHeight","clientHeight","cWidth","clientWidth","bottom","height","right","width","classList","parent","submenu","subEntries","subEntry","findNextEntry","direction","children","next","keyCode","click","firstElementChild","nextPrev","target","focused","sRect","eRect","parseEntry","dragstart","isTouching","changedTouches","rect","screenHeight","screenWidth","o","dx","clientX","dy","clientY","topBorder","bottomBorder","bar","identifier","move","touchmove","up","touchend","drag","dragend","touch","hoverstart","latestEvent","endEvents","noRemove","isImage","nodeName","hover","hoverend","MutationObserver","observe","childList","workaround","contains","padding","offsetHeight","offsetWidth","Math","max","min","threshold","marginX","UI","dialog","properties","child","tagName","checked","label","input","Nav","VIEW","prev","append","scrollTo","scroll","scrollHeight","THREADID","hasClass","threadRoot","selectors","Get","threadFromRoot","stub","getTopOf","delta","activeElement","blur","axis","xpath","extra","marginBottom","haveExtra","removeExtra","ImageHost","useFaster","suggestions","host","flashHost","thumbHost","isClone","file","url","split","link","thumbLink","fixLinks","links","pathname","Volume","inputs","unmute","volume","noAudio","catalogNode","unmuteEntry","volumeEntry","video","muted","files","isVideo","wheel","shiftKey","altKey","ctrlKey","metaKey","hasAudio","deltaY","minmax","ImageCommon","pause","rewind","readyState","HAVE_METADATA","currentTime","queueTask","pushCache","cacheError","popCache","decodeError","fileObj","code","MediaError","MEDIA_ERR_DECODE","isFromArchive","delay","timeoutID","Redirect","to","securityCheck","redirect","threadJSON","parseJSON","isArchiveURL","needle","postObj","archivedThreadJSON","ajax","onloadend","index","docIndex","filesDeleted","addControls","handler","t","getTime","engine","duration","controls","onControls","download","protocol","CrossOrigin","blob","a","URL","createObjectURL","hidden","Notice","ImageExpand","enabled","EAI","toggleAll","addShortcut","playVideos","videoControls","isExpanding","contract","expand","isExpanded","fullImage","setupVideoCB","setupVideo","origin","paused","wasPlaying","isFetchedQuote","isSpoiler","modifiedClick","postFromNode","play","func","event","visible","isNodeVisible","setFitness","scrollIntoView","oldHeight","scrollBy","scrollToIfNeeded","eventName","videoCB","fileID","removeAttribute","loop","completeExpand","naturalHeight","imageBottom","getBottomOf","playing","mousedown","mouseover","mouseup","mouseout","buttons","createSubEntry","conf","desc","flags","match","context","isReply","parseNodes","decodeURIComponent","flagCode","toUpperCase","flagCodeTroll","date","parseDate","nameBlock","parseComment","parseQuotes","parseFiles","isRebuilt","s","infoRoot","isOPContainerThread","opBottom","quotelinks","archivelinks","embedlinks","backlinks","getElementsByClassName","uniqueIDRoot","bq","normalize","commentClean","cleanComment","nodesToText","commentDisplay","cleanSpoilers","cleanCommentDisplay","commentOrig","insertTags","X","snapshotItem","spoilers","spoiler","quotelink","quotes","parseQuote","regexp","fileRoots","fileRoot","parseFile","multifile","roots","size","unit","sizeInBytes","strong","allQuotelinksLinkingTo","deadMark","resurrect","some","addClone","contractThumb","PostClone","rmClone","slice","setCatalogOP","isCatalogOP","createElement","super","cloneWithoutVideo","suffix","inline","inlined","originFile","videoThumb","md5","nodeType","Node","ELEMENT_NODE","childNodes","makeButton","Recursive","recursives","recursive","PostHiding","db","sa","thisPost","hide","makeStub","hideRecursively","sideArrows","firstChild","div","show","hideStubLink","hideStub","saveHiddenState","isHiding","showRecursively","RelativeDates","INTERVAL","flush","dateEl","relative","diff","abbrev","number","years","getFullYear","months","getMonth","days","getDate","rounded","round","stale","isPost","utc","singlePost","concat","setOwnTimeout","markStale","Element","BoardConfig","cbs","load","statusText","config","sfwBoards","sfw","result","object","ws_board","domain","is_archived","webm_audio","Board","cooldowns","c2","image","images","thread_global","ceil","PostRedirect","delays","ExpandComment","callbacks","longComment","shortComment","req","spoilerRange","custom_spoiler","getAttribute","callback","QuoteYou","mark","isYou","postDataFromLink","quoter","seek","highlighted","highlight","classes","lastRead","snapshotLength","postFromRoot","sel","postContainer","highlightable","matches","RandomAccessList","item","last","before","rmi","shift","Unread","hr","Set","postsQuotingYou","addPost","lastReadPost","readCount","one","onUpdate","resetLink","reset","setLine","read","positionPrev","hash","updatePosition","postIDs","addPostQuotingYou","openNotification","predicate","areNotificationsEnabled","notif","Notification","onclick","onshow","readSinglePost","has","saveLastReadPost","oldPosition","linePosition","nextSibling","countQuotingYou","titleQuotingYou","titleCount","titleDead","saveThreadWatcherCount","quotingYou","ThreadWatcher","ExpandThread","statuses","onIndexRefresh","setButton","summaryText","cursor","cbToggle","disconnect","refresh","oldReq","abort","threadFromNode","cbToggleBottom","numReplies","replyOriginal","postsCount","filesCount","postsRoot","postData","postFromObject","callbackNodes","a2","UnreadIndex","markReadLink","onPostsInserted","isCatalog","threadIDs","wasVisible","divider","repliesShown","repliesRead","firstUnread","summary","hasUnread","markRead","threadDivider","remove","sc","shortcut","dbLM","list","lastElementChild","refreshButton","closeButton","unreaddb","unreadEnabled","toggleWatcher","buttonFetchAll","addHeaderMenuEntry","addDialog","onIndexUpdate","onThreadRefresh","initLastModified","fetchAuto","isWatched","isWatchedRaw","setToggler","toggler","excerpt","threadExcerpt","isThisPageLegit","build","toggleClass","openAll","openUnread","openDeads","pruneDeads","getAll","dismiss","addRaw","nKilled","fetchStatus","requests","fetched","fetch","lastModified","whenModified","finished","clearRequests","syncing","lm","interval","hasFocus","fetchAllStatus","dbs","dbi","middle1","deep","lastChecked2","fetchBoard","modified","site","urlF","threadModTimeIgnoresSage","parseBoard","lmDate","getResponseHeader","pageLength","nThreads","oldest","last_modified","lastPage","isPrunedByAge","newData","parseStatus","archived","youOP","quotesYou","quotelinkHTML","lastIndex","archiveURL","mayLackJSON","groupByBoard","all","cont","makeLine","prefixes","setPrefixes","len","prefix","conflicts","conflicts2","siteID2","rmAll","refreshIcon","deferred","line","newLine","set404","oldData","addMenuEntries","entryEl","addCheckbox","disabled","ThreadWatcher$1","Fetcher","prototype","archiveTags","replyData","isCached","fetchedPost","archivedPost","flagCSS","cssVersion","rel","api","cleanCache","archive","encryptionOK","media","parseArchivedPost","tag","greentext","text2","j","thread_num","trip","poster_hash","poster_country","troll_country_code","poster_country_name","troll_country_name","dateUTC","timestamp","dateText","fourchan_date","commentHTML","banned","fileDeleted","media_filename","thumb_link","media_link","media_orig","media_h","media_w","media_hash","bytesToString","media_size","thumbURL","preview_orig","theight","preview_h","twidth","preview_w","exif","Tag","QuotePreview","qp","pop","showHiddenThreads","changed","enabledOn","initFinished","postsInserted","search","history","state","searched","mode","currentSort","currentPage","getCurrentPage","processHash","popstate","resort","watchSettings","sortEntry","select","perBoardSort","navLinks","CatalogLinks","catalog","refreshFront","searchInput","setupSearch","onSearchInput","clearSearch","hideLabel","toggleHiddenThreads","selectRev","selectMode","selectSort","selectSize","lastLongOptions","lastLongInputs","lastLongThresholds","tRaw","hoverToggle","pagelist","pageNav","hat","addStyle","loaded","implementation","createDocument","appendChild","topNavPos","previousElementSibling","timeEl","liveThreadData","innerHeight","pagesNum","endNotice","threadsOnPage","buildStructure","notify","toggleHide","threadPosition","floor","threadsNumPerPage","ThreadHiding","cycleSortType","types","options","option","selected","initFinishedFired","indexRefreshSeen","buildIndex","pushState","pageLoad","saveSort","saveLastLongThresholds","Number","isFinite","catalogReplies","hoverAdjust","setState","nCommands","userPageNav","buildCatalogReplies","scrollToIndex","hashCommands","paged","infinite","commands","leftover","command","pageBeforeSearch","oldpage","savePerBoard","buildPagelist","setupMode","setupSort","hashScroll","getPagesNum","sortedThreadIDs","getMaxPageNum","pagesRoot","maxPageNum","childElementCount","nextElementSibling","updateHideLabel","hiddenCount","liveThreadIDs","firstTime","notice","nTimeout","catalogJSON","reload","setType","stack","pages","parseThreadList","reduce","liveThreadDict","parsedThreads","results","filterResults","isOnTop","last_replies","isHiddenReply","buildThreads","withReplies","newThreads","newPosts","opRoot","threadData","stringify","bumplimit","ext","imagelimit","sticky","closed","buildReplies","lastReplies","buildCatalogViews","catalogThreads","catalogThread","sizeCatalogViews","ratio","catalogReply","tmp_time","sortType","repliesAvailable","lastlong","iterable","r","omitted_posts","lastlongD","b","reverse","querySearch","sortOnTop","topThreads","bottomThreads","buildCatalog","nodesPerPage","offset","node0","buildCatalogPart","searching","query","keywords","RegExp","values","searchMatch","keyword","Index$1","catalogWatch","catalogSet","hasStorage","hiddenThreads","localStorage","setItem","getItem","catalogSave","attributes","subtree","attributeFilter","hiddenThreads2","hasOwn","isEscaped","Symbol","voidElements","hFragment","h","attribute","isVoid","TypeError","separator","settingsHtml","class","changelog","issues","CSS","report","www","sub","css","variables","words","CustomCSS","rmStyle","SWTinyboard","disabledFeatures","detect","script","m","awaitBoard","boardFor","mounted","op","boardList","boardListBottom","styleSheet","psa","nav","replyContainer","extra_files","parseJSONFile","unescape","bgColoredEl","isFileURL","preParsingFixes","broken","splitText","isNaN","infoNode","nameNode","isThumbExpanded","expanded","isLinkified","catalogPin","passMessagePage","captchaFAQ","PassMessage","msg","PassMessagePage","hd","Report","fit","getComputedStyle","visibility","resizeBy","form","fieldset","reason","submit","archiveSubmit","action","archiveResults","formData","num","success","PostSuccessful","_","SWYotsuba","hasIPCount","areMD5sDeferred","isOnePage","psaTop","searchBox","captcha","doctype","is404","isIncomplete","isBoardlessPage","isAuxiliaryPage","initAuxiliary","navigate","scriptData","parseThreadMetadata","abbr","br","hasCORS","uidColor","uid","charCodeAt","testNativeExtension","Parser","postMenuIcon","transformBoardList","spacer","chr","nodeValue","devicePixelRatio","shortFilename","spoilerThumb","random","sameThread","threadURL","postURL","resto","filedeleted","since4pass","country","board_flag","country_name","flag_name","capcodeHighlight","tim","w","fsize","tn_h","tn_w","hasDownscale","m_img","parseCommentDisplay","html2","capcodeDescription","capcodePlural","capcodeLC","capcodeLong","Admin","Mod","postInfo","postLink","quoteLink","nameHtml","nameBlockContent","postNumContent","generatePostInfoHtml","fileURL","fileThumb","fileBlock","fileContent","loading","generateFileHtml","postClass","wholePost","imgClass","generateCatalogThreadHtml","highlights","SW","tinyboard","yotsuba","FileInfo","quickFilterMD5","oldInfo","format","formatString","outputNode","formatters","T","l","L","N","fullname","shortname","p","B","K","M","Time","day","month","localeFormat","Intl","DateTimeFormat","localeFormatPart","part","formatToParts","zeroPad","weekday","getDay","A","H","getHours","I","k","getMinutes","hour","hour12","P","S","getSeconds","y","Y","ReplyPruning","frag","setEnabled","hiddenFiles","total","totalFiles","other","QuoteThreading","active","showIfHidden","updateCount","boardTop","hidden1","hidden2","oldPos","lastChild","threadNewLink","rethread","setThread","inserted","toggleThreading","setThreadingState","navLinksBot","parents","lastParent","ancestor","descendants","threadContainer","prev2","ThreadUpdater","audio","beep","checkPostCount","timer","updateLink","scrollBG","setInterval","settings","intervalShortcut","outdateCount","fileIDs","checkpost","playBeep","seconds","parseInt","confirmed","limit","cur","Settings","klass","updateThreadStatus","ipCountEl","postObjects","unique_ips","postObject","deletedPosts","deletedFiles","unreadCount","unreadQYCount","firstPost","addSection","sauce","advanced","disableAll","defineProperty","openSection","sectionToOpen","SettingsPage","export","import","onImport","section","sections","hyphenatedTitle","scrollTop","warnings","cantSync","why","cantSet","ads","ad","addWarning","warning","addCheckboxes","containers","description","level","keyFS","fs","perProtocolSettings","hiddenPosts","hiddenNum","removeItem","Conf2","downloadExport","Blob","confirm","reader","FileReader","onload","loadSettings","readAsText","convertFrom","loadletter","prevKey","newKey","convertSettings","uniqueid","mod","openEmptyQR","openQR","openOptions","sageru","sjis","watch","unreadCountTo0","expandAllImages","expandImage","zero","nextPage","previousPage","nextThread","previousThread","expandThread","openThreadTab","openThread","nextReply","previousReply","Scrolling","Verbose","WatchedThreads","upgrade","corrupted","setD","addSauces","addCSS","compareString","val2","error1","uids","Moe","warosu","fgts","not4plebs","DesuStorage","record","rice","siteProperties","faq","clear","selectFilter","ta","spellcheck","feature","listImageHost","customCSS","applyCSS","togglecss","itemsArchive","selectArchives","addArchiveTable","boardSelect","table","updateArchives","toLocaleString","tbody","archBoards","rows","boardOptions","row","addArchiveCell","td","setAttribute","saveSelectedArchive","selectedArchives","boardid","generateBoardList","img","tr","keybind","FappeTyme","fappe","lc","indicator","check","linkData","parseLink","parts","parseBoards","createSauceLink","missing","orig","parameter","skip","skipped","observer","node2","TURL","IMG","sMD5","hMD5","atob","semi","generateThumb","mozRequestFullScreen","webkitRequestFullScreen","ALLOW_KEYBOARD_INPUT","slideshow","frame","thumbs","current","menuButton","blank","start","stop","createSubEntries","postThumb","keydown","setHeight","candidate","parentElement","overflow","thumbImg","errorCB","elType","webm","mp4","ogv","pdf","oldID","newID","offsetTop","setupTimer","cleanupTimer","startTimer","checkTimer","complete","advance","toggleSlideshow","rotateLeft","rotateRight","rotate","dataRotate","transform","mozCancelFullScreen","webkitExitFullscreen","dim","margin","minHeight","containerWidth","containerHeight","minWidth","maxWidth","maxHeight","setDelay","delayLabel","delayInput","ordered_types","embed","catalogRemove","service","batchSize","flushTitles","events","services","preview","process","regExp","closeFloat","dragEmbed","lastEmbed","pointerEvents","queue","post2","link2","preload","hrefEsc","videoHeight","counter","prettyPrint","getElementById","currentScript","hasOwnProperty","names","contentWindow","postMessage","element","onMessage","source","hotkey","notifications","toggleBoardList","toggleBarVisibility","postingIsEnabled","qr","notification","display","tags","sage","fileSubmit","toggleCustomCooldown","handleUrl","hl","kc","String","fromCharCode","code_tags","math_tags","sjis_tags","selStart","selectionStart","selEnd","selectionEnd","range","setSelectionRange","isSage","tab","replySelector","postEl","Cache","saveAPI","noCaptcha","captchas","getCount","neededRaw","haveCookie","submitCB","isOnlyQuotes","needed","prerequest","prerequested","cooldown","request","Replace","v2","lifetime","timeouts","prevNeeded","noscriptURL","recaptchaKey","auto","afterSetup","setupNoscript","setupJS","scrolling","textarea","render","widgetID","grecaptcha","sitekey","theme","cbNative","onRecaptchaLoaded","mutations","mutation","addedNodes","setupIFrame","setupTextArea","fixQRPosition","pasted","token","mimeTypes","validExtension","typeFromExtension","jpg","jpeg","png","gif","swf","extensionFromType","initReady","origToggle","captchaVersion","prop","def","min_width","min_height","max_width","max_height","max_size","max_size_video","max_comment","max_width_video","max_height_video","max_duration_video","forcedAnon","forced_anon","linkBot","getFile","drawFile","setFile","paste","dragOver","dropFile","generatePostableThreadsList","statusCheck","unhide","cleanNotifications","inBubble","bubbles","autohide","toggleSJIS","texPreviewShow","texPreviewHide","texPreview","wasOpen","setCustomCooldown","focusOverride","onclose","alert","connectionError","progress","openPost","isLocked","getSelection","postRange","Range","selectNode","rangeCount","asc","insideCode","getRangeAt","compareBoundaryPoints","START_TO_START","setStartBefore","END_TO_END","setEndAfter","cloneContents","commonAncestorContainer","wasOnlyQuotes","caretPos","quotedText","characterCount","charCount","openError","getContext","drawImage","revokeObjectURL","handleFiles","dataTransfer","dropEffect","clipboardData","score","file2","kind","getAsFile","score2","pasteFF","pasteArea","bstr","Uint8Array","urlDefault","preventAutoPost","permission","prompt","fileButton","handleFile","nfiles","isText","pasting","openFileInput","fileInput","setNode","flagsInput","sjisToggle","texButton","drawButton","oekaki","draw","noFile","oekakiButton","fileRM","rmFile","urlButton","dumpButton","addEventListener","DataTransferItemList","persona","addFlag","country_flags","board_flags","filetag","forceSave","flashTag","require_subject","text_only","lock","MAX_FILE_SIZE","pwd","getPassword","upfile","responseType","withCredentials","onprogress","upload","isUploadFinished","currentCaptcha","challenge","unlock","connErr","errorCount","addDelay","mi","addMute","h1","lastPostToThread","waitForThread","attempts","deletion","maxDelay","isSetup","isCounting","categorize","secondsDeletion","mergeChange","scope","nCooldowns","elapsed","editFile","canvas","videoWidth","toBlob","snapshot","edit","FCX","oekakiCB","Tegaki","flatten","oekakiLatest","oekakiName","bg","onDone","onCancel","bgColor","removeEventListener","naturalWidth","onOpenImageLoaded","onDoneCb","resume","always","parseItem","draggable","dumpList","dismissErrors","rectEl","rectList","scrollLeft","showFileData","forced","updateComment","saveFilename","updateFilename","setComment","rmErrored","fileError","checkSize","rmMetadata","backgroundImage","readFile","canPlayType","onerror","checkDimensions","setThumbnail","cv","attr","newName","long","pasteText","dragStart","setDragImage","dragEnd","dragEnter","dragLeave","drop","oldIndex","newIndex","eventPageRequest","chrome","runtime","addListener","params","sendMessage","binary","headers","responseHeaderString","fallback","getAllResponseHeaders","gmOptions","method","overrideMimeType","xhr","ArrayBuffer","responseText","responseHeaders","onabort","GM","xmlHttpRequest","contentType","contentDisposition","mime","Request","headerName","header","gmReq","ontimeout","cbFail","origins","CrossOrigin$1","fc","HTMLFormElement","FormData","fd","pageXHR","wrappedJSObject","XMLHttpRequest","XPCNativeWrapper","testCORB","ajaxPage","setRequestHeader","warn","send","requestID","ajaxPageInit","DOMParser","parseFromString","bucket","url0","reqs","testf","addCSP","policy","httpEquiv","path","evaluate","singleNodeValue","classNames","createTextNode","createDocumentFragment","insertBefore","replaceChild","properties2","globalThis","extension","cloneInto","defaultView","cancelable","navigator","userAgent","GM_info","unsafeConstructors","unsafeWindow","obj2","openInTab","GM_openInTab","taskQueue","execTask","task","MessageChannel","taskChannel","port1","onmessage","port2","mozHasAudio","webkitAudioDecodedByteCount","luma","rgb","oneItemSugar","oldValue","local","storage","onChanged","area","newValue","crxWorking","getManifest","crxWarningShown","lastError","result2","exceedsQuota","QUOTA_BYTES_PER_ITEM","setArea","setSync","done","deleteValue","BroadcastChannel","GM_addValueChangeListener","GM_deleteValue","getValue","GM_getValue","listValues","GM_listValues","setValue","GM_setValue","key2","remote","onChange","getSync","syncChannel","Promise","then","catch","$$1","IDs","handleQuotes","qPost","Get$1","filters","Map","isstring","excludes","mask","only","noti","filterObj","filtersForType","boardsRaw","parseBoardsMemo","siteFilter","boardID2","hideable","filtersOrMap","isArray","catalogData","catalogParse","catalogViewNative","valueF","v","addFilter","re","removeFilters","res","flat","escape","showFilters","tl","textLength","quickFilterCB","undo","makeFilter","Site","defaultProperties","canonical","resolve","parseURL","catalogURL","catalogLink","useCatalog","setLinks","bottomBoardList","tail","indexOptions","externalParse","externalList","external","jsonIndex","nativeCatalog","noticesRoot","setBarPosition","box","barFixedToggler","headerToggler","scrollHeaderToggler","barPositionToggler","linkJustifyToggler","customNavToggler","footerToggler","shortcutToggler","editCustomNav","menuToggle","toggleBarFixed","toggleBarPosition","toggleHideBarOnScroll","toggleLinkJustify","toggleFooterVisibility","toggleShortcutIcons","toggleCustomNav","setBarFixed","setHideBarOnScroll","setBarVisibility","setLinkJustify","setShortcutIcons","setFooterVisibility","createNotification","setBoardList","generateFullBoardList","footer","absbot","cloneTopNav","cs","enableDesktopNotifications","shortcuts","btn","setCustomNav","fullBoardList","mapCustomNavigation","m0","m1","m2","urlV","urlIC","custom","full","showBoardList","centered","fixed","hideBarOnScroll","offsetY","pageYOffset","previousOffset","ref","cust","replaceState","down","offsetParent","headRect","rmShortcut","authorize","disable","requestPermission","Header$1","opacity","responses","nloaded","fail","archiveUIDs","dest","Developer","Verified","https","reports","alternative","Redirect$1","ImageHover","scale","ImageLoader","prefetchEnabled","prefetchAll","replaceVideo","prefetch","poster","isPrefetched","qpClone","Metadata","readInt","RevealSpoilers","regString","space","saved","endNode","word","part1","part2","makeRange","makeLink","startNode","startOffset","endOffset","createRange","setStart","setEnd","encodedDomain","startContainer","charAt","endContainer","extractContents","insertNode","ArchiveLink","typeParam","isSearch","CopyTextLink","copy","execCommand","DeleteLink","fileEl","postEntry","linkText","fileEntry","menuText","fileOnly","onlyimgdel","resDoc","DownloadLink","ReportLink","dims","AntiAutoplay","autoplay","processVideo","Banner","banner","setTitle","bannerCnt","choices","contentEditable","Flash","SWFEmbed","tid","Fourchan","initBoard","pre","prettyPrintOne","MathJax","Hub","Queue","loadMathJax","math","clickable_ids","idClick","wbrs","wbr","IDColor","ids","compute","color","backgroundColor","IDHighlight","IDPostCount","ModContact","moved","specific","template","moveNote","Manager","qa","NormalizeURL","PostJumper","makeButtons","addListeners","addButtons","buttonClick","toJumper","dir","find","jumper","jumper2","fromJumper","prevPos","destPos","PSA","announcement","PSAHiding","RemoveSpoilers","unspoiler","ThreadLinks","Tinyboard","ajaxComplete","responseJSON","noko","originalNoko","tb_settings","always_noko_replies","MarkNewIPs","markNew","markOld","ThreadStats","postIndex","statsHTML","statsTitle","showPurgePos","postCountEl","fileCountEl","pageCountEl","fetchPage","showPage","onThreadsLoad","purgePos","lastPageUpdate","retry","PassLink","styleSelector","passLink","QuoteInline","qiQuote","findRoot","isBacklink","qroot","forwarded","QuoteBacklink","bottomBacklinks","firstNode","secondNode","markYours","getContainer","backlinkContainer","QuoteCT","QuoteOP","Quotify","parseArchivelink","deadlink","parseDeadlink","fixDeadlink","quoteID","fetchable","green","Polyfill","mozMatchesSelector","webkitMatchesSelector","HTMLCanvasElement","encoderOptions","toDataURL","ui8a","frameElement","expectInitFinished","mountedCB","isMounted","mountedCBs","error2","fromCharCode0","Error","boardTitle","previousversion","isFirstRun","initFeatures","threadArchived","initStyle","features","mobileLink","innerWidth","bgColorStyle","keyboard","setClass","mainStyleSheet","styleSheets","knownStyles","setStyle","backgroundRepeat","backgroundPosition","initCatalog","initThread","addThreadsObserver","addThreads","addPostsObserver","addPosts","parseThreads","callbackNodesDB","threadRoots","boardObj","postRoots","unshift","parsePosts","postRoot","records","threadsRM","anyRemoved","removedNodes","addCatalogThreadsObserver","addCatalogThreads","parseCatalogThreads","softTask","parseError","reportLink","logs","lines","fork","details","addDetails","newIssueMaxLength","newIssue","scriptHandler","thisPageIsLegit","Main$1"],"mappings":"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AgB,EACd,EACA,mCACA,GAEF,YAAa,EACX,EACA,wFACA,GAEF,gBAAiB,EACf,EACA,0DACA,IAIJC,WAAc,CACZ,iBAAkB,EAChB,EACA,6FAEF,eAAgB,EACd,EACA,iDAEF,eAAgB,EACd,EACA,uDACA,GAEF,2BAA4B,EAC1B,EACA,kEACA,GAEF,iBAAkB,EAChB,EACA;AAEF,cAAe,EACb,EACA,2DAEF,0BAA2B,EACzB,EACA,4DAEF,2BAA4B,EAC1B,EACA,6DACA,GAEF,uBAAwB,EACtB,EACA,qEACA,GAEF,wBAAyB,EACvB,EACA,4EAEF,eAAgB,EACd,EACA,kCAEF,oBAAqB,EACnB,EACA,mDACA,GAEF,sBAAuB,EACrB,EACA,8CACA,GAEF,8BAA+B,EAC7B,EACA,sFAEF,iBAAkB,EAChB,EACA,kEAEF,uBAAwB,EACtB,EACA,iDACA;AAEF,4BAA6B,EAC3B,EACA,8DACA,GAEF,eAAgB,EACd,EACA,qEAEF,gBAAiB,EACf,EACA,oGAEF,oBAAqB,EACnB,EACA,oDACA,IAIJ,uBAAwB,CACtB,cAAe,EACb,EACA,wEAEF,gBAAiB,EACf,EACA,iDACA,GAEF,eAAgB,EACd,EACA,mDACA,GAEF,uBAAwB,EACtB,EACA,oGACA,GAEF,mBAAoB,EAClB,EACA,wCACA,GAEF,mBAAoB,EAClB,EACA,kEACA;AAEF,qBAAsB,EACpB,EACA,gFACA,GAEF,oCAAqC,EACnC,EACA,yEACA,GAEF,uBAAwB,EACtB,EACA,iEACA,GAEFC,SAAY,EACV,EACA,oDACA,GAEF,gCAAiC,EAC/B,EACA,oEACA,GAEF,oBAAqB,EACnB,EACA,uEACA,GAEF,6BAA8B,EAC5B,EACA,6DACA,GAEF,yBAA0B,EACxB,EACA,0EAEF,YAAa,EACX,EACA,2DAIJ,cAAe,CACb,kBAAmB,EACjB,EACA,wBAEF,eAAgB,EACd,EACA,2BACA;AAEF,mBAAoB,EAClB,EACA,0CACA,GAEF,iBAAkB,EAChB,EACA,gCAEF,kCAAmC,EACjC,EACA,qEACA,GAEF,wBAAyB,EACvB,EACA,wEACA,GAEF,iBAA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"}